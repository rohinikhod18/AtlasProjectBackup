<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GBGroupTransformer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">kyc-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.kyc.gbgroupport</a> &gt; <span class="el_source">GBGroupTransformer.java</span></div><h1>GBGroupTransformer.java</h1><pre class="source lang-java linenums">/**
 * 
 */
package com.currenciesdirect.gtg.compliance.kyc.gbgroupport;

import java.lang.reflect.Field;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Date;
import java.util.List;

import com.currenciesdirect.gtg.compliance.commons.domain.kyc.Address;
import com.currenciesdirect.gtg.compliance.commons.domain.kyc.Identification;
import com.currenciesdirect.gtg.compliance.commons.domain.kyc.KYCContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.kyc.Phone;
import com.currenciesdirect.gtg.compliance.kyc.exception.KYCErrors;
import com.currenciesdirect.gtg.compliance.kyc.exception.KYCException;
import com.currenciesdirect.gtg.compliance.kyc.util.Constants;
import com.id3global.www.ID3gWS._2013._04.GlobalAddress;
import com.id3global.www.ID3gWS._2013._04.GlobalAddresses;
import com.id3global.www.ID3gWS._2013._04.GlobalContactDetails;
import com.id3global.www.ID3gWS._2013._04.GlobalGender;
import com.id3global.www.ID3gWS._2013._04.GlobalIdentityCard;
import com.id3global.www.ID3gWS._2013._04.GlobalIdentityDocuments;
import com.id3global.www.ID3gWS._2013._04.GlobalInputData;
import com.id3global.www.ID3gWS._2013._04.GlobalInternationalPassport;
import com.id3global.www.ID3gWS._2013._04.GlobalLandTelephone;
import com.id3global.www.ID3gWS._2013._04.GlobalMobileTelephone;
import com.id3global.www.ID3gWS._2013._04.GlobalPersonal;
import com.id3global.www.ID3gWS._2013._04.GlobalPersonalDetails;
import com.id3global.www.ID3gWS._2013._04.GlobalSpain;
import com.id3global.www.ID3gWS._2013._04.GlobalSpainTaxIDNumber;
import com.id3global.www.ID3gWS._2013._04.GlobalUKData;
import com.id3global.www.ID3gWS._2013._04.GlobalUKDrivingLicence;
import com.id3global.www.ID3gWS._2013._04.GlobalUS;
import com.id3global.www.ID3gWS._2013._04.GlobalUSSocialSecurity;
/**
 * The Class GBGroupTransformer.
 *
 * @author manish
 */
public class GBGroupTransformer {
	
	/** The Constant LOG. */
<span class="fc" id="L48">	private static final org.slf4j.Logger LOG = org.slf4j.LoggerFactory</span>
<span class="fc" id="L49">			.getLogger(GBGroupTransformer.class);</span>
	
	/** The replace regex. */
<span class="fc" id="L52">	private static String replaceRegex = &quot;(Appt|Apartment|Building|Build|Bldg|Bldg.|Apartment No.)&quot;;</span>
	
	/** The pattern to split. */
<span class="fc" id="L55">	private static String patternToSplit = &quot;(,)|(\r+\n+)|(;)|(\\.)&quot;;</span>
	
	/** The g B group transformer. */
<span class="fc" id="L58">	private static GBGroupTransformer gBGroupTransformer = null;</span>
	 
	/**
	 * Instantiates a new GB group transformer.
	 */
	private GBGroupTransformer() {
		
	}
	
	/**
	 * Gets the single instance of GBGroupTransformer.
	 *
	 * @return single instance of GBGroupTransformer
	 */
	public static GBGroupTransformer getInstance() {
<span class="nc bnc" id="L73" title="All 2 branches missed.">		if(gBGroupTransformer == null) {</span>
<span class="nc" id="L74">			gBGroupTransformer = new GBGroupTransformer();</span>
		}
<span class="nc" id="L76">		return gBGroupTransformer;</span>
	}
	
	
	/**
	 * Transform request object.
	 *
	 * @param request the request
	 * @return the global input data
	 * @throws KYCException the KYC exception
	 */
	public GlobalInputData transformRequestObject(KYCContactRequest request) throws KYCException {
<span class="fc" id="L88">		GlobalInputData  data = new GlobalInputData();</span>
<span class="fc" id="L89">		SimpleDateFormat formatter = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
		try {
			
<span class="fc" id="L92">	    	GlobalPersonalDetails personalDetails = new GlobalPersonalDetails();</span>
<span class="pc bpc" id="L93" title="3 of 4 branches missed.">	    	if(request.getPersonalDetails().getGender()!=null &amp;&amp; !request.getPersonalDetails().getGender().isEmpty())</span>
	    	{
	    		GlobalGender gender;
<span class="nc bnc" id="L96" title="All 2 branches missed.">	    		if(&quot;MALE&quot;.equalsIgnoreCase(request.getPersonalDetails().getGender().trim())){</span>
<span class="nc" id="L97">	    			 gender = new GlobalGender(&quot;Male&quot;);</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">	    		}else if(&quot;FEMALE&quot;.equalsIgnoreCase(request.getPersonalDetails().getGender().trim())){</span>
<span class="nc" id="L99">	    			 gender = new GlobalGender(&quot;Female&quot;);</span>
	    		}else {
<span class="nc" id="L101">	    			 gender = new GlobalGender(request.getPersonalDetails().getGender());</span>
	    		}
	      	
<span class="nc" id="L104">	      	personalDetails.setGender(gender);</span>
<span class="nc" id="L105">	    	}else{</span>
<span class="fc" id="L106">	    		GlobalGender gender = new GlobalGender(&quot;Unspecified&quot;);</span>
<span class="fc" id="L107">		      	personalDetails.setGender(gender);</span>
	    	}
<span class="fc" id="L109">	    	data = transformAsCountry(request, data, formatter, personalDetails);</span>
		} 
<span class="nc" id="L111">		catch(KYCException e) {</span>
<span class="nc" id="L112">			throw e;</span>
<span class="nc" id="L113">		} catch(Exception e) {</span>
<span class="nc" id="L114">			throw new KYCException(KYCErrors.INVALID_REQUEST,e);</span>
<span class="fc" id="L115">		}</span>
<span class="fc" id="L116">		return data;</span>
	}

	/**
	 * Transform as country.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 * @throws KYCException the KYC exception
	 */
	private GlobalInputData transformAsCountry(KYCContactRequest request, GlobalInputData data,
			SimpleDateFormat formatter, GlobalPersonalDetails personalDetails) throws ParseException, KYCException {
<span class="pc bpc" id="L132" title="9 of 10 branches missed.">		switch(request.getAddress().getCountry().toUpperCase()) {</span>
		
		case Constants.COUNTRY_UNITEDKINGDOM:
<span class="nc" id="L135">			transformUK(request, data, formatter, personalDetails);</span>
<span class="nc" id="L136">			break;</span>
		case Constants.COUNTRY_DENMARK:
<span class="nc" id="L138">			transformDenmark(request, data, formatter, personalDetails);</span>
<span class="nc" id="L139">			break;</span>
		case Constants.COUNTRY_SPAIN:
<span class="nc" id="L141">			transFormSpain(request, data, formatter, personalDetails);</span>
<span class="nc" id="L142">			break;</span>
		case Constants.COUNTRY_GERMANY:
<span class="nc" id="L144">			transformGermany(request, data, formatter, personalDetails);</span>
<span class="nc" id="L145">			break;</span>
		case Constants.COUNTRY_NORWAY:
<span class="fc" id="L147">			transFormNorway(request, data, formatter, personalDetails);</span>
<span class="fc" id="L148">			break;</span>
		case Constants.COUNTRY_SWITZERLAND:
<span class="nc" id="L150">			transformSwitzerland(request, data, formatter, personalDetails);</span>
<span class="nc" id="L151">			break;</span>
		case Constants.COUNTRY_SWEDEN:
<span class="nc" id="L153">			transFormSweden(request, data, formatter, personalDetails);</span>
<span class="nc" id="L154">			break;</span>
		case Constants.COUNTRY_NETHERLANDS :
<span class="nc" id="L156">			transformNetharlands(request, data, formatter, personalDetails);</span>
<span class="nc" id="L157">		    break;</span>
		//Add for AT-3662 - Automate US EIDV 
		case Constants.COUNTRY_USA :
<span class="nc" id="L160">			transformUSA(request, data, formatter, personalDetails);</span>
<span class="nc" id="L161">		    break;</span>
		default :
<span class="nc" id="L163">			throw new KYCException(KYCErrors.COUNTRY_IS_NOT_SUPPORTED);</span>
		}
<span class="fc" id="L165">		return data;</span>
	}

	/**
	 * Transform germany.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transformGermany(KYCContactRequest requestGermany, GlobalInputData dataGermany, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsGermany) throws ParseException {
		
		GlobalPersonal personalGermany ;
<span class="nc" id="L182">		GlobalAddress currentAddressGermany = new GlobalAddress();</span>
<span class="nc" id="L183">		GlobalAddresses  addresseGermany = new GlobalAddresses();</span>
<span class="nc" id="L184">		GlobalIdentityDocuments identityDocumentsGermany = new GlobalIdentityDocuments();</span>
<span class="nc" id="L185">		GlobalInternationalPassport internationalPassportGermany = new GlobalInternationalPassport();</span>
<span class="nc" id="L186">		GlobalLandTelephone globalLandTelephoneGermany = new GlobalLandTelephone();</span>
<span class="nc" id="L187">		GlobalMobileTelephone globalMobileTelephoneGermany = new GlobalMobileTelephone();</span>
<span class="nc" id="L188">		GlobalContactDetails contactDetailsGermany = new GlobalContactDetails();</span>
<span class="nc" id="L189">		personalDetailsGermany.setTitle(requestGermany.getPersonalDetails().getTitle());</span>
<span class="nc" id="L190">		personalDetailsGermany.setForename(requestGermany.getPersonalDetails().getForeName());</span>
<span class="nc" id="L191">		personalDetailsGermany.setMiddleName(requestGermany.getPersonalDetails().getMiddleName());</span>
<span class="nc" id="L192">		personalDetailsGermany.setSurname(requestGermany.getPersonalDetails().getSurName());</span>
   
<span class="nc" id="L194">		personalGermany= getPersonalDetails(requestGermany,personalDetailsGermany,formatter);</span>
<span class="nc" id="L195">		dataGermany.setPersonal(personalGermany);</span>
		
<span class="nc" id="L197">		currentAddressGermany.setCountry(requestGermany.getAddress().getCountry());</span>
<span class="nc" id="L198">		currentAddressGermany.setStateDistrict(requestGermany.getAddress().getState());</span>
<span class="nc" id="L199">		currentAddressGermany.setStreet(requestGermany.getAddress().getStreet());</span>
<span class="nc" id="L200">		currentAddressGermany.setRegion(requestGermany.getAddress().getRegion());</span>
<span class="nc" id="L201">		currentAddressGermany.setZipPostcode(requestGermany.getAddress().getPostCode());</span>
<span class="nc" id="L202">		currentAddressGermany.setBuilding(requestGermany.getAddress().getBuildingNumber());</span>
		
<span class="nc" id="L204">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L206" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L207">			setFreeFormatAddressLine(currentAddressGermany,requestGermany);</span>
		}
		
<span class="nc" id="L210">		addresseGermany.setCurrentAddress(currentAddressGermany);</span>
		
<span class="nc bnc" id="L212" title="All 2 branches missed.">		if(requestGermany.getIdentification()!=null) {</span>
<span class="nc bnc" id="L213" title="All 2 branches missed.">		for (Identification identity : requestGermany.getIdentification()) {</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">			if(Constants.KYC_PASSPORT.equalsIgnoreCase(identity.getType().replaceAll(&quot;\\s+&quot;,&quot;&quot;))) {</span>
<span class="nc" id="L215">				fillPassportDetails(formatter, identityDocumentsGermany, internationalPassportGermany, identity);</span>
			}
<span class="nc" id="L217">		}</span>
		}
		
<span class="nc bnc" id="L220" title="All 2 branches missed.">		if(requestGermany.getPhone()!=null) {</span>
<span class="nc" id="L221">			fillPhoneDetails(requestGermany, contactDetailsGermany, globalLandTelephoneGermany, globalMobileTelephoneGermany);</span>
		}
<span class="nc" id="L223">		dataGermany.setAddresses(addresseGermany);</span>
<span class="nc" id="L224">    	dataGermany.setIdentityDocuments(identityDocumentsGermany);</span>
<span class="nc" id="L225">    	dataGermany.setContactDetails(contactDetailsGermany);</span>
<span class="nc" id="L226">		return dataGermany;</span>
	}

	/**
	 * Trans form norway.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transFormNorway(KYCContactRequest requestNorway, GlobalInputData dataNorway, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsNorway) throws ParseException {

		GlobalPersonal personalNorway;
<span class="fc" id="L243">		GlobalAddress currentAddressNorway = new GlobalAddress();</span>
<span class="fc" id="L244">		GlobalAddresses  addresseNorway = new GlobalAddresses();</span>
<span class="fc" id="L245">		GlobalIdentityDocuments identityDocumentsNorway = new GlobalIdentityDocuments();</span>
<span class="fc" id="L246">		GlobalInternationalPassport internationalPassportNorway = new GlobalInternationalPassport();</span>
<span class="fc" id="L247">		GlobalLandTelephone globalLandTelephoneNorway = new GlobalLandTelephone();</span>
<span class="fc" id="L248">		GlobalMobileTelephone globalMobileTelephoneNorway = new GlobalMobileTelephone();</span>
<span class="fc" id="L249">		GlobalContactDetails contactDetailsNorway = new GlobalContactDetails();</span>
		
<span class="fc" id="L251">		personalNorway= getPersonalDetails(requestNorway,personalDetailsNorway,formatter);</span>
<span class="fc" id="L252">		dataNorway.setPersonal(personalNorway);</span>
		
<span class="fc" id="L254">		currentAddressNorway.setCountry(requestNorway.getAddress().getCountry());</span>
<span class="fc" id="L255">		currentAddressNorway.setStateDistrict(requestNorway.getAddress().getState());</span>
<span class="fc" id="L256">		currentAddressNorway.setStreet(requestNorway.getAddress().getStreet());</span>
<span class="fc" id="L257">		currentAddressNorway.setRegion(requestNorway.getAddress().getRegion());</span>
<span class="fc" id="L258">		currentAddressNorway.setCity(requestNorway.getAddress().getCity()); // added later.. temp</span>
<span class="fc" id="L259">		currentAddressNorway.setZipPostcode(requestNorway.getAddress().getPostCode());</span>
<span class="fc" id="L260">		currentAddressNorway.setStateDistrict(requestNorway.getAddress().getState());</span>
<span class="fc" id="L261">		currentAddressNorway.setBuilding(requestNorway.getAddress().getBuildingNumber());</span>
<span class="fc" id="L262">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L265">			setFreeFormatAddressLine(currentAddressNorway,requestNorway);</span>
		}
<span class="fc" id="L267">		addresseNorway.setCurrentAddress(currentAddressNorway);</span>
		
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">		if(requestNorway.getIdentification()!=null) {</span>
<span class="nc bnc" id="L270" title="All 2 branches missed.">		for (Identification identity : requestNorway.getIdentification()) {</span>
<span class="nc bnc" id="L271" title="All 2 branches missed.">			if(Constants.KYC_PASSPORT.equalsIgnoreCase(identity.getType().replaceAll(&quot;\\s+&quot;,&quot;&quot;))) {</span>
<span class="nc" id="L272">				fillPassportDetails(formatter, identityDocumentsNorway, internationalPassportNorway, identity);</span>
		    	
			}
<span class="nc" id="L275">		}</span>
		}
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">		if(requestNorway.getPhone()!=null) {</span>
<span class="nc" id="L278">			fillPhoneDetails(requestNorway, contactDetailsNorway, globalLandTelephoneNorway, globalMobileTelephoneNorway);</span>
		}
<span class="fc" id="L280">		dataNorway.setAddresses(addresseNorway);</span>
<span class="fc" id="L281">    	dataNorway.setIdentityDocuments(identityDocumentsNorway);</span>
<span class="fc" id="L282">    	dataNorway.setContactDetails(contactDetailsNorway);</span>
<span class="fc" id="L283">		return dataNorway;</span>
	}

	/**
	 * Transform switzerland.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transformSwitzerland(KYCContactRequest requestSwitzerland, GlobalInputData dataSwitzerland, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsSwitzerland) throws ParseException {
		GlobalPersonal personalSwitzerland;
<span class="nc" id="L299">		GlobalAddress currentAddressSwitzerland = new GlobalAddress();</span>
<span class="nc" id="L300">		GlobalAddresses  addresseSwitzerland = new GlobalAddresses();</span>
<span class="nc" id="L301">		GlobalIdentityDocuments identityDocumentsSwitzerland = new GlobalIdentityDocuments();</span>
<span class="nc" id="L302">		GlobalInternationalPassport internationalPassportSwitzerland = new GlobalInternationalPassport();</span>
<span class="nc" id="L303">		GlobalLandTelephone globalLandTelephoneSwitzerland = new GlobalLandTelephone();</span>
<span class="nc" id="L304">		GlobalMobileTelephone globalMobileTelephoneSwitzerland = new GlobalMobileTelephone();</span>
<span class="nc" id="L305">		GlobalContactDetails contactDetailsSwitzerland = new GlobalContactDetails();</span>

<span class="nc" id="L307">		personalSwitzerland= getPersonalDetails(requestSwitzerland,personalDetailsSwitzerland,formatter);</span>
<span class="nc" id="L308">		dataSwitzerland.setPersonal(personalSwitzerland);</span>
		
<span class="nc" id="L310">		currentAddressSwitzerland.setCountry(requestSwitzerland.getAddress().getCountry());</span>
<span class="nc" id="L311">		currentAddressSwitzerland.setStateDistrict(requestSwitzerland.getAddress().getState());</span>
<span class="nc" id="L312">		currentAddressSwitzerland.setStreet(requestSwitzerland.getAddress().getStreet());</span>
<span class="nc" id="L313">		currentAddressSwitzerland.setRegion(requestSwitzerland.getAddress().getRegion());</span>
<span class="nc" id="L314">		currentAddressSwitzerland.setCity(requestSwitzerland.getAddress().getCity()); // temp added</span>
<span class="nc" id="L315">		currentAddressSwitzerland.setZipPostcode(requestSwitzerland.getAddress().getPostCode());</span>
<span class="nc" id="L316">		currentAddressSwitzerland.setStateDistrict(requestSwitzerland.getAddress().getState());</span>
<span class="nc" id="L317">		currentAddressSwitzerland.setBuilding(requestSwitzerland.getAddress().getBuildingNumber());</span>
<span class="nc" id="L318">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L320" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L321">			setFreeFormatAddressLine(currentAddressSwitzerland,requestSwitzerland);</span>
		}
<span class="nc" id="L323">		addresseSwitzerland.setCurrentAddress(currentAddressSwitzerland);</span>
		
<span class="nc bnc" id="L325" title="All 2 branches missed.">		if(requestSwitzerland.getIdentification()!=null) {</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">		for (Identification identity : requestSwitzerland.getIdentification()) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">			if(Constants.KYC_PASSPORT.equalsIgnoreCase(identity.getType().replaceAll(&quot;\\s+&quot;,&quot;&quot;))) {</span>
<span class="nc" id="L328">				fillPassportDetails(formatter, identityDocumentsSwitzerland, internationalPassportSwitzerland, identity);</span>
		    	
			}
<span class="nc" id="L331">		}</span>
		}
<span class="nc bnc" id="L333" title="All 2 branches missed.">		if(requestSwitzerland.getPhone()!=null) {</span>
<span class="nc" id="L334">			fillPhoneDetails(requestSwitzerland, contactDetailsSwitzerland, globalLandTelephoneSwitzerland, globalMobileTelephoneSwitzerland);</span>
		}
<span class="nc" id="L336">		dataSwitzerland.setAddresses(addresseSwitzerland);</span>
<span class="nc" id="L337">    	dataSwitzerland.setIdentityDocuments(identityDocumentsSwitzerland);</span>
<span class="nc" id="L338">    	dataSwitzerland.setContactDetails(contactDetailsSwitzerland);</span>
<span class="nc" id="L339">		return dataSwitzerland;</span>
	}

	/**
	 * Trans form sweden.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transFormSweden(KYCContactRequest requestSweden, GlobalInputData dataSweden, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsSweden) throws ParseException {

		GlobalPersonal personalSweden;
<span class="nc" id="L356">		GlobalAddress currentAddressSweden = new GlobalAddress();</span>
<span class="nc" id="L357">		GlobalAddresses  addresseSweden = new GlobalAddresses();</span>
<span class="nc" id="L358">		GlobalIdentityDocuments identityDocumentsSweden = new GlobalIdentityDocuments();</span>
<span class="nc" id="L359">		GlobalInternationalPassport internationalPassportSweden = new GlobalInternationalPassport();</span>
<span class="nc" id="L360">		GlobalLandTelephone globalLandTelephoneSweden = new GlobalLandTelephone();</span>
<span class="nc" id="L361">		GlobalMobileTelephone globalMobileTelephoneSweden = new GlobalMobileTelephone();</span>
<span class="nc" id="L362">		GlobalContactDetails contactDetailsSweden = new GlobalContactDetails();</span>
	
<span class="nc" id="L364">		personalSweden= getPersonalDetails(requestSweden,personalDetailsSweden,formatter);</span>
<span class="nc" id="L365">		dataSweden.setPersonal(personalSweden);</span>
		
<span class="nc" id="L367">		currentAddressSweden.setCountry(requestSweden.getAddress().getCountry());</span>
<span class="nc" id="L368">		currentAddressSweden.setStateDistrict(requestSweden.getAddress().getState());</span>
<span class="nc" id="L369">		currentAddressSweden.setStreet(requestSweden.getAddress().getStreet());</span>
<span class="nc" id="L370">		currentAddressSweden.setRegion(requestSweden.getAddress().getRegion());</span>
<span class="nc" id="L371">		currentAddressSweden.setCity(requestSweden.getAddress().getCity()); //temp added </span>
<span class="nc" id="L372">		currentAddressSweden.setZipPostcode(requestSweden.getAddress().getPostCode());</span>
<span class="nc" id="L373">		currentAddressSweden.setBuilding(requestSweden.getAddress().getBuildingNumber());</span>
<span class="nc" id="L374">		currentAddressSweden.setStateDistrict(requestSweden.getAddress().getState());</span>
<span class="nc" id="L375">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L377" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L378">			setFreeFormatAddressLine(currentAddressSweden,requestSweden);</span>
		}
<span class="nc" id="L380">		addresseSweden.setCurrentAddress(currentAddressSweden);</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">		if (requestSweden.getIdentification() != null) {</span>
<span class="nc bnc" id="L382" title="All 2 branches missed.">			for (Identification identity : requestSweden.getIdentification()) {</span>
<span class="nc bnc" id="L383" title="All 3 branches missed.">				switch (identity.getType().toUpperCase().replaceAll(&quot;\\s+&quot;, &quot;&quot;)) {</span>
				case Constants.KYC_PASSPORT:
<span class="nc" id="L385">					fillPassportDetails(formatter, identityDocumentsSweden, internationalPassportSweden, identity);</span>
<span class="nc" id="L386">					break;</span>
				case Constants.KYC_NATIONAL_ID_NUMBER:
<span class="nc" id="L388">					GlobalIdentityCard globalIdentityCard = new GlobalIdentityCard();</span>
<span class="nc" id="L389">					globalIdentityCard.setNumber(identity.getNumber());</span>
<span class="nc" id="L390">					globalIdentityCard.setCountry(identity.getCountryOfIssue());</span>
<span class="nc" id="L391">					identityDocumentsSweden.setIdentityCard(globalIdentityCard);</span>
<span class="nc" id="L392">					break;</span>
				default:
					break;

				}
<span class="nc" id="L397">			}</span>
		}
		
		
		
<span class="nc bnc" id="L402" title="All 2 branches missed.">		if(requestSweden.getPhone()!=null) {</span>
<span class="nc" id="L403">			fillPhoneDetails(requestSweden, contactDetailsSweden, globalLandTelephoneSweden, globalMobileTelephoneSweden);</span>
		}
<span class="nc" id="L405">		dataSweden.setAddresses(addresseSweden);</span>
<span class="nc" id="L406">    	dataSweden.setIdentityDocuments(identityDocumentsSweden);</span>
<span class="nc" id="L407">    	dataSweden.setContactDetails(contactDetailsSweden);</span>
<span class="nc" id="L408">		return dataSweden;</span>
	}

	/**
	 * Transform netharlands.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @throws ParseException the parse exception
	 */
	private void transformNetharlands(KYCContactRequest requestNetharlands, GlobalInputData dataNetharlands, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsNetharlands) throws ParseException {
		GlobalPersonal personalNetharlands;
<span class="nc" id="L423">		GlobalAddress currentAddressNetharlands = new GlobalAddress();</span>
<span class="nc" id="L424">		GlobalAddresses addresseNetharlands = new GlobalAddresses();</span>

<span class="nc" id="L426">		personalNetharlands = getPersonalDetails(requestNetharlands, personalDetailsNetharlands, formatter);</span>

<span class="nc" id="L428">		dataNetharlands.setPersonal(personalNetharlands);</span>
<span class="nc" id="L429">		currentAddressNetharlands.setCountry(requestNetharlands.getAddress().getCountry());</span>

<span class="nc" id="L431">		currentAddressNetharlands.setStreet(requestNetharlands.getAddress().getStreet());</span>
<span class="nc" id="L432">		currentAddressNetharlands.setStateDistrict(requestNetharlands.getAddress().getState());</span>
<span class="nc" id="L433">		currentAddressNetharlands.setCity(requestNetharlands.getAddress().getCity());</span>
<span class="nc" id="L434">		currentAddressNetharlands.setZipPostcode(requestNetharlands.getAddress().getPostCode());</span>
<span class="nc" id="L435">		currentAddressNetharlands.setBuilding(requestNetharlands.getAddress().getBuildingNumber());</span>
<span class="nc" id="L436">		currentAddressNetharlands.setStateDistrict(requestNetharlands.getAddress().getState());</span>
<span class="nc" id="L437">		currentAddressNetharlands.setSubBuilding(requestNetharlands.getAddress().getSubBuildingOrFlat());</span>
<span class="nc" id="L438">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L440" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L441">			setFreeFormatAddressLine(currentAddressNetharlands,requestNetharlands);</span>
		}
<span class="nc" id="L443">		addresseNetharlands.setCurrentAddress(currentAddressNetharlands);</span>
<span class="nc" id="L444">		dataNetharlands.setAddresses(addresseNetharlands);</span>
<span class="nc" id="L445">	}</span>

	/**
	 * Trans form spain.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transFormSpain(KYCContactRequest requestSpain, GlobalInputData dataSpain, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsSpain) throws ParseException {

		GlobalPersonal personalSpain;
<span class="nc" id="L461">		GlobalAddress currentAddressSpain = new GlobalAddress();</span>
<span class="nc" id="L462">		GlobalAddresses  addresseSpain = new GlobalAddresses();</span>
<span class="nc" id="L463">		GlobalIdentityDocuments identityDocumentsSpain = new GlobalIdentityDocuments();</span>
<span class="nc" id="L464">		GlobalInternationalPassport internationalPassportSpain = new GlobalInternationalPassport();</span>
<span class="nc" id="L465">		GlobalLandTelephone globalLandTelephoneSpain = new GlobalLandTelephone();</span>
<span class="nc" id="L466">		GlobalMobileTelephone globalMobileTelephoneSpain = new GlobalMobileTelephone();</span>
<span class="nc" id="L467">		GlobalContactDetails contactDetailsSpain = new GlobalContactDetails();</span>
		
<span class="nc" id="L469">		personalSpain= getPersonalDetails(requestSpain,personalDetailsSpain,formatter);</span>
<span class="nc" id="L470">		dataSpain.setPersonal(personalSpain);</span>
		
<span class="nc" id="L472">		currentAddressSpain.setCountry(requestSpain.getAddress().getCountry());</span>
<span class="nc" id="L473">		currentAddressSpain.setStateDistrict(requestSpain.getAddress().getState());</span>
<span class="nc" id="L474">		currentAddressSpain.setStreet(requestSpain.getAddress().getStreet());</span>
<span class="nc" id="L475">		currentAddressSpain.setRegion(requestSpain.getAddress().getRegion());</span>
<span class="nc" id="L476">		currentAddressSpain.setCity(requestSpain.getAddress().getCity()); // added later.. temp</span>
<span class="nc" id="L477">		currentAddressSpain.setZipPostcode(requestSpain.getAddress().getPostCode());</span>
<span class="nc" id="L478">		currentAddressSpain.setStateDistrict(requestSpain.getAddress().getState());</span>
<span class="nc" id="L479">		currentAddressSpain.setBuilding(requestSpain.getAddress().getBuildingNumber());</span>
<span class="nc" id="L480">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L482" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L483">			setFreeFormatAddressLine(currentAddressSpain,requestSpain);</span>
		}
<span class="nc" id="L485">		addresseSpain.setCurrentAddress(currentAddressSpain);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">		if(requestSpain.getIdentification()!=null) {</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">		for (Identification identity : requestSpain.getIdentification()) {</span>
<span class="nc bnc" id="L488" title="All 3 branches missed.">			switch(identity.getType().toUpperCase().replaceAll(&quot;\\s+&quot;,&quot;&quot;)) {</span>
			case Constants.KYC_PASSPORT :
<span class="nc" id="L490">				fillPassportDetails(formatter, identityDocumentsSpain, internationalPassportSpain, identity);</span>
<span class="nc" id="L491">				break;</span>
			case Constants.KYC_TAX_ID_NUMBER :	
<span class="nc" id="L493">				setGlobalSpain(identityDocumentsSpain, identity);</span>
<span class="nc" id="L494">		    	break;</span>
		    default:
		    	break;
		    	
			}
<span class="nc" id="L499">		}</span>
		}
		
<span class="nc bnc" id="L502" title="All 2 branches missed.">		if(requestSpain.getPhone()!=null) {</span>
<span class="nc" id="L503">			fillPhoneDetails(requestSpain, contactDetailsSpain, globalLandTelephoneSpain, globalMobileTelephoneSpain);</span>
		}
<span class="nc" id="L505">		dataSpain.setAddresses(addresseSpain);</span>
<span class="nc" id="L506">    	dataSpain.setIdentityDocuments(identityDocumentsSpain);</span>
<span class="nc" id="L507">    	dataSpain.setContactDetails(contactDetailsSpain);</span>
<span class="nc" id="L508">		return dataSpain;</span>
	}

	/**
	 * Sets the global spain.
	 *
	 * @param identityDocuments the identity documents
	 * @param identity the identity
	 */
	private void setGlobalSpain(GlobalIdentityDocuments identityDocuments, Identification identity) {
<span class="nc" id="L518">		GlobalSpain globalSpain = new GlobalSpain();</span>
<span class="nc" id="L519">		GlobalSpainTaxIDNumber globalSpainTaxIDNumber = new GlobalSpainTaxIDNumber();</span>
<span class="nc" id="L520">		globalSpainTaxIDNumber.setNumber(identity.getNumber());</span>
<span class="nc" id="L521">		globalSpain.setTaxIDNumber(globalSpainTaxIDNumber);</span>
<span class="nc" id="L522">		identityDocuments.setSpain(globalSpain);</span>
<span class="nc" id="L523">	}</span>

	/**
	 * Transform denmark.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transformDenmark(KYCContactRequest requestDenmark, GlobalInputData dataDenmark, SimpleDateFormat formatter,
			GlobalPersonalDetails personalDetailsDenmark) throws ParseException {

		GlobalPersonal personalDenmark;
<span class="nc" id="L539">		GlobalAddress currentAddressDenmark = new GlobalAddress();</span>
<span class="nc" id="L540">		GlobalAddresses  addresseDenmark = new GlobalAddresses();</span>
<span class="nc" id="L541">		GlobalIdentityDocuments identityDocumentsDenmark = new GlobalIdentityDocuments();</span>
<span class="nc" id="L542">		GlobalInternationalPassport internationalPassportDenmark = new GlobalInternationalPassport();</span>
<span class="nc" id="L543">		GlobalLandTelephone globalLandTelephoneDenmark = new GlobalLandTelephone();</span>
<span class="nc" id="L544">		GlobalMobileTelephone globalMobileTelephoneDenmark = new GlobalMobileTelephone();</span>
<span class="nc" id="L545">		GlobalContactDetails contactDetailsDenmark = new GlobalContactDetails();</span>
		
<span class="nc" id="L547">		personalDenmark= getPersonalDetails(requestDenmark,personalDetailsDenmark,formatter);</span>
<span class="nc" id="L548">		dataDenmark.setPersonal(personalDenmark);</span>
		
<span class="nc" id="L550">		currentAddressDenmark.setCountry(requestDenmark.getAddress().getCountry());</span>
<span class="nc" id="L551">		currentAddressDenmark.setStateDistrict(requestDenmark.getAddress().getState());</span>
<span class="nc" id="L552">		currentAddressDenmark.setStreet(requestDenmark.getAddress().getStreet());</span>
<span class="nc" id="L553">		currentAddressDenmark.setRegion(requestDenmark.getAddress().getRegion());</span>
<span class="nc" id="L554">		currentAddressDenmark.setZipPostcode(requestDenmark.getAddress().getPostCode());</span>
<span class="nc" id="L555">		currentAddressDenmark.setBuilding(requestDenmark.getAddress().getBuildingNumber());</span>
<span class="nc" id="L556">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L558" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
<span class="nc" id="L559">			setFreeFormatAddressLine(currentAddressDenmark,requestDenmark);</span>
		}
<span class="nc" id="L561">		addresseDenmark.setCurrentAddress(currentAddressDenmark);</span>
		
<span class="nc bnc" id="L563" title="All 2 branches missed.">		if(requestDenmark.getIdentification()!=null) {</span>
<span class="nc bnc" id="L564" title="All 2 branches missed.">		for (Identification identity : requestDenmark.getIdentification()) {</span>
<span class="nc bnc" id="L565" title="All 3 branches missed.">			switch(identity.getType().toUpperCase().replaceAll(&quot;\\s+&quot;,&quot;&quot;)) {</span>
			case Constants.KYC_PASSPORT :
<span class="nc" id="L567">				fillPassportDetails(formatter, identityDocumentsDenmark, internationalPassportDenmark, identity);</span>
<span class="nc" id="L568">				break;</span>
			case Constants.KYC_IDENTITY_CARD :	
<span class="nc" id="L570">				GlobalIdentityCard globalIdentityCard = new GlobalIdentityCard();</span>
<span class="nc" id="L571">				globalIdentityCard.setNumber(identity.getNumber());</span>
<span class="nc" id="L572">				globalIdentityCard.setCountry(identity.getCountryOfIssue());</span>
<span class="nc" id="L573">				identityDocumentsDenmark.setIdentityCard(globalIdentityCard);</span>
<span class="nc" id="L574">		    	break;</span>
		    default:
		    	break;
		    	
			}
<span class="nc" id="L579">		}</span>
		}
<span class="nc bnc" id="L581" title="All 2 branches missed.">		if(requestDenmark.getPhone()!=null) {</span>
<span class="nc" id="L582">			fillPhoneDetails(requestDenmark, contactDetailsDenmark, globalLandTelephoneDenmark, globalMobileTelephoneDenmark);</span>
		}
<span class="nc" id="L584">		dataDenmark.setAddresses(addresseDenmark);</span>
<span class="nc" id="L585">    	dataDenmark.setIdentityDocuments(identityDocumentsDenmark);</span>
<span class="nc" id="L586">    	dataDenmark.setContactDetails(contactDetailsDenmark);</span>
<span class="nc" id="L587">		return dataDenmark;</span>
	}

	/**
	 * Transform UK.
	 *
	 * @param request the request
	 * @param data the data
	 * @param formatter the formatter
	 * @param personalDetails the personal details
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transformUK(KYCContactRequest requestUK, GlobalInputData dataUK, SimpleDateFormat formatter,GlobalPersonalDetails personalDetailsUK 
			)
			throws ParseException {
		GlobalPersonal personalUK;
<span class="nc" id="L604">		GlobalAddresses  addresseUK = new GlobalAddresses();</span>
<span class="nc" id="L605">		GlobalAddress currentAddressUK = new GlobalAddress();</span>
<span class="nc" id="L606">		GlobalContactDetails contactDetailsUK = new GlobalContactDetails();</span>
<span class="nc" id="L607">		GlobalLandTelephone globalLandTelephoneUK = new GlobalLandTelephone();</span>
<span class="nc" id="L608">		GlobalMobileTelephone globalMobileTelephoneUK = new GlobalMobileTelephone();</span>
<span class="nc" id="L609">    	GlobalIdentityDocuments identityDocumentsUK = new GlobalIdentityDocuments();</span>
<span class="nc" id="L610">    	GlobalInternationalPassport internationalPassportUK = new GlobalInternationalPassport();</span>
<span class="nc" id="L611">		GlobalUKData uk = new GlobalUKData();</span>
		
<span class="nc" id="L613">		personalUK= getPersonalDetails(requestUK,personalDetailsUK,formatter);</span>
<span class="nc" id="L614">		dataUK.setPersonal(personalUK);</span>
	
<span class="nc" id="L616">		currentAddressUK.setCountry(requestUK.getAddress().getCountry());</span>
<span class="nc" id="L617">		currentAddressUK.setStateDistrict(requestUK.getAddress().getState());</span>
<span class="nc" id="L618">		currentAddressUK.setStreet(requestUK.getAddress().getStreet());</span>
<span class="nc" id="L619">		currentAddressUK.setRegion(requestUK.getAddress().getRegion());</span>
<span class="nc" id="L620">		currentAddressUK.setCity(requestUK.getAddress().getCity()); //temp added</span>
<span class="nc" id="L621">		currentAddressUK.setZipPostcode(requestUK.getAddress().getPostCode());</span>
<span class="nc" id="L622">		currentAddressUK.setBuilding(requestUK.getAddress().getBuildingNumber());</span>
		
<span class="nc" id="L624">		Boolean isFreeFormatEnabled = getFreeFormatFlag();</span>
		
<span class="nc bnc" id="L626" title="All 2 branches missed.">		if (Boolean.TRUE.equals(isFreeFormatEnabled)){</span>
			/*Set Free Format Fields for UK*/
<span class="nc" id="L628">			setFreeFormatAddressLine(currentAddressUK,requestUK);</span>
		}
		
<span class="nc" id="L631">		addresseUK.setCurrentAddress(currentAddressUK);</span>
		
<span class="nc bnc" id="L633" title="All 2 branches missed.">		if(requestUK.getIdentification()!=null) {</span>
<span class="nc bnc" id="L634" title="All 2 branches missed.">		for (Identification identity : requestUK.getIdentification()) {</span>
<span class="nc bnc" id="L635" title="All 3 branches missed.">			switch(identity.getType().toUpperCase().replaceAll(&quot;\\s+&quot;,&quot;&quot;)) {</span>
			case Constants.KYC_PASSPORT :
<span class="nc" id="L637">				fillPassportDetails(formatter, identityDocumentsUK, internationalPassportUK, identity);</span>
<span class="nc" id="L638">				break;</span>
			case Constants.KYC_DRIVING_LICENSE :
<span class="nc" id="L640">		    	GlobalUKDrivingLicence drivingLicence = new GlobalUKDrivingLicence();</span>
<span class="nc" id="L641">		    	drivingLicence.setNumber(identity.getNumber());</span>
<span class="nc" id="L642">		    	uk.setDrivingLicence(drivingLicence);</span>
<span class="nc" id="L643">		    	identityDocumentsUK.setUK(uk);</span>
<span class="nc" id="L644">		    	break;</span>
		    default:
		    	break;
		    	
			}
<span class="nc" id="L649">		}</span>
		}

<span class="nc bnc" id="L652" title="All 2 branches missed.">		if(requestUK.getPhone()!=null) {</span>
<span class="nc" id="L653">		fillPhoneDetails(requestUK, contactDetailsUK, globalLandTelephoneUK, globalMobileTelephoneUK);</span>
		}
<span class="nc" id="L655">		dataUK.setAddresses(addresseUK);</span>
<span class="nc" id="L656">    	dataUK.setIdentityDocuments(identityDocumentsUK);</span>
<span class="nc" id="L657">    	dataUK.setContactDetails(contactDetailsUK);</span>
<span class="nc" id="L658">		return dataUK;</span>
	}
	
	/**
	 * Transform USA.
	 *
	 * @param requestUSA the request USA
	 * @param dataUSA the data USA
	 * @param formatter the formatter
	 * @param personalDetailsUSA the personal details USA
	 * @return the global input data
	 * @throws ParseException the parse exception
	 */
	private GlobalInputData transformUSA(KYCContactRequest requestUSA, GlobalInputData dataUSA, SimpleDateFormat formatter,GlobalPersonalDetails personalDetailsUSA 
			)
			throws ParseException {
		GlobalPersonal personalUSA;
<span class="nc" id="L675">		GlobalAddresses  addresseUSA = new GlobalAddresses();</span>
<span class="nc" id="L676">		GlobalAddress currentAddressUSA = new GlobalAddress();</span>
<span class="nc" id="L677">		GlobalContactDetails contactDetailsUSA = new GlobalContactDetails();</span>
<span class="nc" id="L678">		GlobalLandTelephone globalLandTelephoneUSA = new GlobalLandTelephone();</span>
<span class="nc" id="L679">    	GlobalIdentityDocuments identityDocumentsUSA = new GlobalIdentityDocuments();</span>
<span class="nc" id="L680">    	GlobalUS globalUS = new GlobalUS();</span>
		
<span class="nc" id="L682">		personalUSA= getPersonalDetails(requestUSA,personalDetailsUSA,formatter);</span>
<span class="nc" id="L683">		dataUSA.setPersonal(personalUSA);</span>
	
<span class="nc" id="L685">		currentAddressUSA.setCountry(requestUSA.getAddress().getCountry());</span>
<span class="nc" id="L686">		currentAddressUSA.setStateDistrict(requestUSA.getAddress().getState());</span>
<span class="nc" id="L687">		currentAddressUSA.setStreet(requestUSA.getAddress().getStreet());</span>
<span class="nc" id="L688">		currentAddressUSA.setRegion(requestUSA.getAddress().getRegion());</span>
<span class="nc" id="L689">		currentAddressUSA.setCity(requestUSA.getAddress().getCity()); //temp added</span>
<span class="nc" id="L690">		currentAddressUSA.setZipPostcode(requestUSA.getAddress().getPostCode());</span>
<span class="nc" id="L691">		currentAddressUSA.setBuilding(requestUSA.getAddress().getBuildingNumber());</span>
<span class="nc" id="L692">		currentAddressUSA.setPremise(requestUSA.getAddress().getBuildingName());//AT-3718</span>
<span class="nc" id="L693">		currentAddressUSA.setSubBuilding(requestUSA.getAddress().getSubBuildingOrFlat());</span>
		
<span class="nc" id="L695">		addresseUSA.setCurrentAddress(currentAddressUSA);</span>
		
<span class="nc bnc" id="L697" title="All 2 branches missed.">		if(requestUSA.getIdentification()!=null) {</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">			for (Identification identity : requestUSA.getIdentification()) {</span>
<span class="nc bnc" id="L699" title="All 2 branches missed.">				if(Constants.SSN_NUMBER.equalsIgnoreCase(identity.getType().replaceAll(&quot;\\s+&quot;,&quot;&quot;))) {</span>
<span class="nc" id="L700">					GlobalUSSocialSecurity globalUSSocialSecurity = new GlobalUSSocialSecurity();</span>
<span class="nc" id="L701">					globalUSSocialSecurity.setNumber(identity.getNumber());</span>
<span class="nc" id="L702">					globalUS.setSocialSecurity(globalUSSocialSecurity);</span>
<span class="nc" id="L703">					identityDocumentsUSA.setUS(globalUS);</span>
<span class="nc" id="L704">			    	break;</span>
				}
<span class="nc" id="L706">			}</span>
		}

<span class="nc bnc" id="L709" title="All 2 branches missed.">		if(null != requestUSA.getPhone()) {</span>
<span class="nc" id="L710">			fillPhoneDetailsForUSA(requestUSA, contactDetailsUSA, globalLandTelephoneUSA);</span>
		}
<span class="nc" id="L712">		dataUSA.setAddresses(addresseUSA);</span>
<span class="nc" id="L713">		dataUSA.setIdentityDocuments(identityDocumentsUSA);</span>
<span class="nc" id="L714">		dataUSA.setContactDetails(contactDetailsUSA);</span>
<span class="nc" id="L715">		return dataUSA;</span>
	}

	/**
	 * Sets the free format address line.
	 *
	 * @param currentAddress the current address
	 * @param request the request
	 */
	private void setFreeFormatAddressLine(GlobalAddress currentAddress, KYCContactRequest request) {
		
<span class="nc" id="L726">		Address address = request.getAddress();</span>
<span class="nc" id="L727">		String addressLine1 = address.getAddressLine1().replaceAll(replaceRegex, &quot;&quot;);</span>
<span class="nc" id="L728">		String[] parseStreet = addressLine1.split(patternToSplit);</span>
<span class="nc" id="L729">		List&lt;String&gt; trimParseStreet = Arrays.asList(parseStreet);  </span>
<span class="nc" id="L730">		List&lt;String&gt; resultList =  new ArrayList&lt;&gt;();</span>
		
<span class="nc bnc" id="L732" title="All 2 branches missed.">		for (String line: trimParseStreet)</span>
		{ 
<span class="nc" id="L734">			String temp =  line.trim();</span>
<span class="nc bnc" id="L735" title="All 2 branches missed.">			if(!&quot;&quot;.equals(temp))</span>
<span class="nc" id="L736">				resultList.add(temp);</span>
<span class="nc" id="L737">		}</span>
<span class="nc" id="L738">		List&lt;String&gt; finalresultList =  new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">		if(resultList.size()&gt;5){</span>
<span class="nc" id="L740">			StringBuilder s= new StringBuilder();</span>
<span class="nc bnc" id="L741" title="All 2 branches missed.">			for(int count=4;count&lt;resultList.size(); count++){</span>
<span class="nc" id="L742">				s.append(' ').append(resultList.get(count));</span>
			}
			
<span class="nc bnc" id="L745" title="All 2 branches missed.">			for(int count=0;count&lt;4; count++){</span>
<span class="nc" id="L746">				finalresultList.add(resultList.get(count));</span>
			}
			
<span class="nc" id="L749">			finalresultList.add(s.toString());</span>
<span class="nc" id="L750">		}else {</span>
<span class="nc" id="L751">			finalresultList.addAll(resultList);</span>
		}
<span class="nc" id="L753">		setFreeFormatAddressLineFields(currentAddress,finalresultList);</span>
<span class="nc" id="L754">		currentAddress.setAddressLine6(address.getCity());</span>
<span class="nc bnc" id="L755" title="All 4 branches missed.">		if(null != address.getState() &amp;&amp;  !address.getState().isEmpty()){</span>
<span class="nc" id="L756">			currentAddress.setAddressLine7(address.getState());</span>
		}
<span class="nc" id="L758">		currentAddress.setAddressLine8(address.getPostCode());</span>
		
<span class="nc" id="L760">	}</span>
	
	/**
	 * Fill phone details.
	 *
	 * @param request the request
	 * @param contactDetails the contact details
	 * @param globalLandTelephone the global land telephone
	 * @param globalMobileTelephone the global mobile telephone
	 */
	private void fillPhoneDetails(KYCContactRequest request, GlobalContactDetails contactDetails,
			GlobalLandTelephone globalLandTelephone, GlobalMobileTelephone globalMobileTelephone) {
<span class="nc bnc" id="L772" title="All 2 branches missed.">		for (Phone phone : request.getPhone()) {</span>
<span class="nc bnc" id="L773" title="All 2 branches missed.">			if(Constants.KYC_PHONE_TYPE_HOME.equalsIgnoreCase(phone.getType().replaceAll(&quot;\\s+&quot;,&quot;&quot;))) {</span>
<span class="nc" id="L774">				globalLandTelephone.setNumber(phone.getNumber());</span>
<span class="nc" id="L775">				contactDetails.setLandTelephone(globalLandTelephone);</span>
<span class="nc bnc" id="L776" title="All 2 branches missed.">			}else if(Constants.KYC_PHONE_TYPE_MOBILE.equalsIgnoreCase(phone.getType().replaceAll(&quot;\\s+&quot;,&quot;&quot;))){</span>
<span class="nc" id="L777">				globalMobileTelephone.setNumber(phone.getNumber());</span>
<span class="nc" id="L778">				contactDetails.setMobileTelephone(globalMobileTelephone);</span>
   
			}
<span class="nc" id="L781">		}</span>
<span class="nc" id="L782">	}</span>
	
	/**
	 * Fill phone details.
	 *
	 * @param request the request
	 * @param contactDetails the contact details
	 * @param globalLandTelephone the global land telephone
	 */
	private void fillPhoneDetailsForUSA(KYCContactRequest request, GlobalContactDetails contactDetails,
			GlobalLandTelephone globalLandTelephone) {
<span class="nc bnc" id="L793" title="All 2 branches missed.">		for (Phone phone : request.getPhone()) {</span>
<span class="nc bnc" id="L794" title="All 2 branches missed.">			if (Constants.KYC_PHONE_TYPE_HOME.equalsIgnoreCase(phone.getType().replaceAll(&quot;\\s+&quot;, &quot;&quot;))) {</span>
<span class="nc" id="L795">				phone.setNumber(phone.getNumber().replaceAll(&quot;\\D&quot;, &quot;&quot;));</span>
<span class="nc bnc" id="L796" title="All 4 branches missed.">				if (phone.getNumber().length() &gt;= 10 &amp;&amp; null != phone.getNumber()) {</span>
<span class="nc" id="L797">					phone.setNumber(phone.getNumber().substring(phone.getNumber().length()-10));//Add for AT-3837</span>
					
<span class="nc" id="L799">					String formattedLandTelephone = phone.getNumber().substring(0, 3) + '-'</span>
<span class="nc" id="L800">							+ phone.getNumber().substring(3, 6) + '-' + phone.getNumber().substring(6, 10);</span>
<span class="nc" id="L801">					globalLandTelephone.setNumber(formattedLandTelephone);</span>
<span class="nc" id="L802">				} else {</span>
<span class="nc" id="L803">					globalLandTelephone.setNumber(&quot;&quot;);</span>
				}
<span class="nc" id="L805">				contactDetails.setLandTelephone(globalLandTelephone);</span>
			}

<span class="nc" id="L808">		}</span>
<span class="nc" id="L809">	}</span>

	/**
	 * Fill passport details.
	 *
	 * @param formatter the formatter
	 * @param identityDocuments the identity documents
	 * @param internationalPassport the international passport
	 * @param identity the identity
	 * @throws ParseException the parse exception
	 */
	private void fillPassportDetails(SimpleDateFormat formatter, GlobalIdentityDocuments identityDocuments,
			GlobalInternationalPassport internationalPassport, Identification identity) throws ParseException {
		Date date;
		Calendar c1;
<span class="nc" id="L824">		internationalPassport.setNumber(identity.getNumber());	</span>
<span class="nc bnc" id="L825" title="All 4 branches missed.">		if(identity.getExiprydate()!=null &amp;&amp; !(identity.getExiprydate().isEmpty())) {</span>
<span class="nc" id="L826">			 date = formatter.parse(identity.getExiprydate());</span>
<span class="nc" id="L827">			 c1 = Calendar.getInstance();</span>
<span class="nc" id="L828">			 c1.setTime(date);</span>
<span class="nc" id="L829">			internationalPassport.setExpiryDay(c1.get(Calendar.DAY_OF_MONTH));</span>
<span class="nc" id="L830">			internationalPassport.setExpiryMonth(c1.get(Calendar.MONTH)+1);</span>
<span class="nc" id="L831">			internationalPassport.setExpiryYear(c1.get(Calendar.YEAR));</span>
			
		 	}
<span class="nc" id="L834">		internationalPassport.setCountryOfOrigin(identity.getCountryOfIssue());</span>
<span class="nc" id="L835">		identityDocuments.setInternationalPassport(internationalPassport);</span>
<span class="nc" id="L836">	}</span>
	
	/**
	 * Gets the personal details.
	 *
	 * @param request the request
	 * @param personalDetails the personal details
	 * @param formatter the formatter
	 * @return the personal details
	 * @throws ParseException the parse exception
	 */
	private GlobalPersonal getPersonalDetails(KYCContactRequest request, GlobalPersonalDetails personalDetails,
			SimpleDateFormat formatter) throws ParseException {
<span class="fc" id="L849">		GlobalPersonal personal = new GlobalPersonal();</span>
		Date date;
		Calendar c1;
		
<span class="fc" id="L853">		personalDetails.setTitle(request.getPersonalDetails().getTitle());</span>
<span class="fc" id="L854">		personalDetails.setForename(request.getPersonalDetails().getForeName());</span>
<span class="fc" id="L855">		personalDetails.setMiddleName(request.getPersonalDetails().getMiddleName());</span>
<span class="fc" id="L856">		personalDetails.setSurname(request.getPersonalDetails().getSurName());</span>
<span class="pc bpc" id="L857" title="1 of 2 branches missed.">		if (!(request.getPersonalDetails().getDob().isEmpty())) {</span>
<span class="fc" id="L858">			date = formatter.parse(request.getPersonalDetails().getDob());</span>
<span class="fc" id="L859">			c1 = Calendar.getInstance();</span>
<span class="fc" id="L860">			c1.setTime(date);</span>
<span class="fc" id="L861">			personalDetails.setDOBDay(c1.get(Calendar.DAY_OF_MONTH));</span>
<span class="fc" id="L862">			personalDetails.setDOBMonth(c1.get(Calendar.MONTH) + 1);</span>
<span class="fc" id="L863">			personalDetails.setDOBYear(c1.get(Calendar.YEAR));</span>
<span class="fc" id="L864">			personal.setPersonalDetails(personalDetails);</span>
		}
<span class="fc" id="L866">		return personal;</span>
	}
  
	/**
	 * Gets the flag for free format address fields.
	 *
	 * @return flag for free format address fields
	 */
	public static Boolean getFreeFormatFlag(){
<span class="fc" id="L875">		Boolean isFreeFormatEnabled = Boolean.FALSE;</span>
		try{
<span class="fc" id="L877">			isFreeFormatEnabled = Boolean.parseBoolean(System.getProperty(&quot;kyc.freeformat&quot;));	</span>
<span class="fc" id="L878">			return isFreeFormatEnabled;</span>
<span class="nc" id="L879">		}catch(Exception e){</span>
<span class="nc" id="L880">			LOG.error(&quot;Error while reading property 'kyc.freeformat' &quot;,e);</span>
<span class="nc" id="L881">			return isFreeFormatEnabled;</span>
		}
	}

     /**
      * Sets the free format address line fields.
      *
      * @param addr the addr
      * @param resultList the result list
      */
	@SuppressWarnings(&quot;squid:S3011&quot;)
     private void setFreeFormatAddressLineFields(Object addr, List&lt;String&gt; resultList){
		
		try {
<span class="nc" id="L895">			int count=1;</span>
<span class="nc bnc" id="L896" title="All 2 branches missed.">			for(String s:resultList){</span>
<span class="nc" id="L897">				Field newField = addr.getClass().getDeclaredField(&quot;addressLine&quot;+count);</span>
<span class="nc" id="L898">				newField.setAccessible(true);</span>
<span class="nc" id="L899">				newField.set(addr, s);</span>
<span class="nc" id="L900">				count++;</span>
<span class="nc bnc" id="L901" title="All 2 branches missed.">				if(count &gt; 5){</span>
<span class="nc" id="L902">					break;</span>
				}
<span class="nc" id="L904">			}</span>
<span class="nc" id="L905">		} catch (IllegalAccessException | IllegalArgumentException | NoSuchFieldException e) {</span>
<span class="nc" id="L906">			LOG.error(&quot; Error in GBGroupTransformer : setFreeFormatAddressLines() {1} &quot;, e);</span>
<span class="nc" id="L907">		}</span>
<span class="nc" id="L908">	}</span>

	
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>