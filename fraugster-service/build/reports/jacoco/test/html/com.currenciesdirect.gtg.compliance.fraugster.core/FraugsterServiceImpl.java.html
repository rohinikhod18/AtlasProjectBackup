<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FraugsterServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fraugster-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.fraugster.core</a> &gt; <span class="el_source">FraugsterServiceImpl.java</span></div><h1>FraugsterServiceImpl.java</h1><pre class="source lang-java linenums">/**
 * 
 */
package com.currenciesdirect.gtg.compliance.fraugster.core;

import java.util.ArrayList;
import java.util.List;

import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterBaseResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterOnUpdateContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterOnUpdateContactResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterOnUpdateRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterOnUpdateResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInContactResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsOutContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsOutContactResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsOutRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsOutResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterSignupContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterSignupContactResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterSignupRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterSignupResponse;
import com.currenciesdirect.gtg.compliance.fraugster.core.domain.FraugsterProviderProperty;
import com.currenciesdirect.gtg.compliance.fraugster.core.domain.FraugsterSessionToken;
import com.currenciesdirect.gtg.compliance.fraugster.core.sessionhandler.FraugsterSessionHandler;
import com.currenciesdirect.gtg.compliance.fraugster.core.validator.FraugsterValidator;
import com.currenciesdirect.gtg.compliance.fraugster.core.validator.IValidator;
import com.currenciesdirect.gtg.compliance.fraugster.exception.FraugsterErrors;
import com.currenciesdirect.gtg.compliance.fraugster.exception.FraugsterException;
import com.currenciesdirect.gtg.compliance.fraugster.fraugsterport.FraudPredictPort;
import com.currenciesdirect.gtg.compliance.fraugster.fraugsterport.FraugsterPort;
import com.currenciesdirect.gtg.compliance.fraugster.util.Constants;

/**
 * The Class FraugsterServiceImpl.
 *
 * @author manish
 */
public class FraugsterServiceImpl implements IFraugsterService {

	private static final String NOT_REQUIRED = &quot;NOT_REQUIRED&quot;;

    /** The Constant LOG. */
<span class="nc" id="L47">	private static final org.slf4j.Logger LOG = org.slf4j.LoggerFactory.getLogger(FraugsterServiceImpl.class);</span>

	/** The i fraugster service. */
	@SuppressWarnings(&quot;squid:S3077&quot;)
<span class="nc" id="L51">	private static volatile IFraugsterService iFraugsterService = null;</span>

	/** The i fraugster provider service. */
<span class="nc" id="L54">	private IFraugsterProviderService iFraugsterProviderService = FraugsterPort.getInstance();</span>
	
	/** The i fraugster provider service. */
<span class="nc" id="L57">	private IFraudPredictProviderService iFraudPredictProviderService = FraudPredictPort.getInstance();</span>

	/** The concrete data builder. */
<span class="nc" id="L60">	private FraugsterConcreteDataBuilder concreteDataBuilder = FraugsterConcreteDataBuilder.getInstance();</span>

	/** The ivalidator. */
<span class="nc" id="L63">	private IValidator ivalidator = FraugsterValidator.getInstance();</span>

	/** The fraugster session handler. */
<span class="nc" id="L66">	private FraugsterSessionHandler fraugsterSessionHandler = FraugsterSessionHandler.getInstance();</span>
	
	/** The Constant FRAUGSTER . */
	private static final String FRAUGSTER = &quot;Fraugster&quot;;
	
	/** The Constant FRAUGSTER_SERVICE_PROVIDER . */
	private static final String FRAUGSTER_SERVICE_PROVIDER = &quot;fraugster.service.provider&quot;;
	
	

	/**
	 * Instantiates a new fraugster service impl.
	 */
<span class="nc" id="L79">	private FraugsterServiceImpl() {</span>
<span class="nc" id="L80">	}</span>

	/**
	 * Gets the single instance of FraugsterServiceImpl.
	 *
	 * @return single instance of FraugsterServiceImpl
	 */
	public static IFraugsterService getInstance() {
<span class="nc bnc" id="L88" title="All 2 branches missed.">		if (iFraugsterService == null) {</span>
<span class="nc" id="L89">			synchronized (FraugsterServiceImpl.class) {</span>
<span class="nc bnc" id="L90" title="All 2 branches missed.">				if (iFraugsterService == null) {</span>
<span class="nc" id="L91">					iFraugsterService = new FraugsterServiceImpl();</span>
				}
<span class="nc" id="L93">			}</span>
		}
<span class="nc" id="L95">		return iFraugsterService;</span>

	}

	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.fraugster.core.IFraugsterService#doFraugsterCheckForNewSignUp(FraugsterSignupRequest)
	 */
	@Override
	public FraugsterSignupResponse doFraugsterCheckForNewSignUp(FraugsterSignupRequest request)
      throws FraugsterException {

<span class="nc" id="L106">    List&lt;FraugsterSignupContactRequest&gt; contacts = null;</span>
<span class="nc" id="L107">    List&lt;FraugsterSignupContactResponse&gt; contactResponsesNewSignup = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L108">    FraugsterSignupResponse responseNewSignup = new FraugsterSignupResponse();</span>
<span class="nc" id="L109">    FraugsterProviderProperty fraugsterProviderProperty = null;</span>
<span class="nc" id="L110">    FraugsterSessionToken sessionToken = null;</span>
<span class="nc" id="L111">    double score = 0.00;</span>
    try {

<span class="nc bnc" id="L114" title="All 2 branches missed.">      if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))) {</span>
<span class="nc" id="L115">        fraugsterProviderProperty = concreteDataBuilder.getProviderInitConfigProperty(Constants.TRANSACTION);</span>
<span class="nc" id="L116">        score = fraugsterProviderProperty.getRegistrationThreesholdScore();// added Reg_threesholdScore -Saylee</span>
<span class="nc" id="L117">        sessionToken = fraugsterSessionHandler.getSessionToken();</span>
      } else {
<span class="nc" id="L119">        fraugsterProviderProperty = concreteDataBuilder.getProviderInitConfigProperty(Constants.FRAUD_PREDICT_SIGNUP);</span>
<span class="nc" id="L120">        score = fraugsterProviderProperty.getRegistrationThreesholdScore();</span>
      }

<span class="nc" id="L123">      contacts = request.getContactRequests();</span>

<span class="nc bnc" id="L125" title="All 2 branches missed.">      for (FraugsterSignupContactRequest contact : contacts) {</span>
        FraugsterSignupContactResponse fraudDetectionResponse;
<span class="nc" id="L127">        fraudDetectionResponse =</span>
<span class="nc" id="L128">            doSignUpCheckForContact(request, fraugsterProviderProperty, sessionToken, score, contact);</span>
<span class="nc" id="L129">        contactResponsesNewSignup.add(fraudDetectionResponse);</span>
<span class="nc" id="L130">      }</span>

<span class="nc" id="L132">      responseNewSignup.setContactResponses(contactResponsesNewSignup);</span>
<span class="nc" id="L133">      responseNewSignup.setOrgCode(request.getOrgCode());</span>
<span class="nc" id="L134">      responseNewSignup.setSourceApplication(request.getSourceApplication());</span>
<span class="nc" id="L135">      responseNewSignup.setStatus(Constants.PASS);</span>


<span class="nc" id="L138">    } catch (FraugsterException e) {</span>
<span class="nc" id="L139">      LOG.error(&quot;Error:&quot;, e);</span>
<span class="nc" id="L140">      responseNewSignup.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L141">    } catch (Exception e) {</span>
<span class="nc" id="L142">      LOG.error(&quot;Error in doFraugsterCheckForNewRegistration() : &quot;, e);</span>
<span class="nc" id="L143">      throw new FraugsterException(FraugsterErrors.FAILED);</span>
<span class="nc" id="L144">    }</span>
<span class="nc" id="L145">    return responseNewSignup;</span>
  }

	/**
	 * Do sign up check for contact.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster signup contact response
	 */
	private FraugsterSignupContactResponse doSignUpCheckForContact(FraugsterSignupRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, double score,
			FraugsterSignupContactRequest contact) {
		
<span class="nc" id="L162">		FraugsterSessionToken reLoginSessionToken = null;</span>
		
<span class="nc" id="L164">		FraugsterSignupContactResponse fraudDetectionResponse = new FraugsterSignupContactResponse();</span>
		try {			
<span class="nc" id="L166">			fraudDetectionResponse = validateAndCallFraugsterSignUp(request, fraugsterProviderProperty, sessionToken,</span>
					score, contact);
			
<span class="nc" id="L169">		} catch (FraugsterException e) {</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">			if(e.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.UNAUTHORIZED_EXCEPTION.getErrorCode())) {</span>
				try {
<span class="nc" id="L172">					reLoginSessionToken = fraugsterSessionHandler.repeatLogin();</span>
<span class="nc" id="L173">					fraudDetectionResponse = validateAndCallFraugsterSignUp(request, fraugsterProviderProperty,</span>
							reLoginSessionToken, score, contact);					
<span class="nc" id="L175">				} catch(FraugsterException ex){</span>
<span class="nc" id="L176">					handleFraugsterExceptionForSignup(contact, fraudDetectionResponse, ex);</span>
<span class="nc" id="L177">				}				</span>
			}else {
<span class="nc" id="L179">				handleFraugsterExceptionForSignup(contact, fraudDetectionResponse, e);</span>
			}
<span class="nc" id="L181">		} catch (Exception e) {</span>
<span class="nc" id="L182">			logError(e);</span>
<span class="nc" id="L183">			fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L184">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L185">			fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L186">			fraudDetectionResponse.setErrorCode(&quot;0999&quot;);</span>
<span class="nc" id="L187">			fraudDetectionResponse.setErrorDescription(FraugsterErrors.FAILED.getErrorDescription());</span>
<span class="nc" id="L188">		}</span>
<span class="nc" id="L189">		return fraudDetectionResponse;</span>
	}

	/**
	 * Validate and call fraugster sign up.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster signup contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterSignupContactResponse validateAndCallFraugsterSignUp(FraugsterSignupRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, double score,
			FraugsterSignupContactRequest contact) throws FraugsterException {
		FraugsterSignupContactResponse fraudDetectionResponse;
<span class="nc" id="L207">		contact.setOrganizationCode(request.getOrgCode());</span>
<span class="nc" id="L208">		fraudDetectionResponse = validateAndCheckFraugsterSignup(fraugsterProviderProperty, sessionToken,</span>
				contact);		
<span class="nc" id="L210">		generateFraugsterResponseStatus(score, fraudDetectionResponse);</span>
<span class="nc" id="L211">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L212">		return fraudDetectionResponse;</span>
	}

	/**
	 * Handle fraugster exception for signup.
	 *
	 * @param contact the contact
	 * @param fraudDetectionResponse the fraud detection response
	 * @param ex the ex
	 */
	private void handleFraugsterExceptionForSignup(FraugsterSignupContactRequest contact,
			FraugsterSignupContactResponse fraudDetectionResponse, FraugsterException ex) {
<span class="nc" id="L224">		logDebug(ex);</span>
<span class="nc" id="L225">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">		if(ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.INVALID_REQUEST.getErrorCode())</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_REQUEST_TRANSFORMATION.getErrorCode())</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_RESPONSE_TRANSFORMATION.getErrorCode())){</span>
<span class="nc" id="L229">			fraudDetectionResponse.setStatus(Constants.NOT_PERFORMED);</span>
		}else{
<span class="nc" id="L231">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
		}
<span class="nc" id="L233">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L234">		fraudDetectionResponse.setErrorCode(ex.getFraugsterErrors().getErrorCode());</span>
<span class="nc" id="L235">		fraudDetectionResponse.setErrorDescription(ex.getFraugsterErrors().getErrorDescription());</span>
<span class="nc" id="L236">	}</span>

	/**
	 * Validate and check fraugster signup.
	 *
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param contact the contact
	 * @return the fraugster signup contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterSignupContactResponse validateAndCheckFraugsterSignup(
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken,
			FraugsterSignupContactRequest contact)
			throws FraugsterException {
		FraugsterSignupContactResponse fraudDetectionResponse;
		Boolean isValidate;
<span class="nc" id="L253">		isValidate = ivalidator.validateFraugsterSignupRequest(contact);</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">		if (Boolean.FALSE.equals(isValidate)) {</span>
<span class="nc" id="L255">			LOG.error(&quot;Request is not valid&quot;);</span>
<span class="nc" id="L256">			throw new FraugsterException(FraugsterErrors.INVALID_REQUEST);</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">		} else if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))) {</span>
<span class="nc" id="L258">			fraudDetectionResponse = iFraugsterProviderService.doFraugsterSignupCheck(contact,</span>
					fraugsterProviderProperty, sessionToken);
		}else {
<span class="nc" id="L261">			fraudDetectionResponse = iFraudPredictProviderService.doFraudPredictSignupCheck(contact,</span>
					fraugsterProviderProperty);
		}
<span class="nc" id="L264">		return fraudDetectionResponse;</span>
	}

	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.fraugster.core.IFraugsterService#doFraugsterCheckForOnUpdate(FraugsterOnUpdateRequest)
	 */
	@Override
	public FraugsterOnUpdateResponse doFraugsterCheckForOnUpdate(FraugsterOnUpdateRequest request)
			throws FraugsterException {

<span class="nc" id="L274">		List&lt;FraugsterOnUpdateContactRequest&gt; contacts = null;</span>
<span class="nc" id="L275">		List&lt;FraugsterOnUpdateContactResponse&gt; contactResponsesUpdate = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L276">		FraugsterOnUpdateResponse responseUpdate = new FraugsterOnUpdateResponse();</span>
<span class="nc" id="L277">		FraugsterProviderProperty fraugsterProviderProperty = null;</span>
<span class="nc" id="L278">		FraugsterSessionToken sessionToken = null;</span>
<span class="nc" id="L279">		double score = 0.00;</span>
		try {
			
<span class="nc bnc" id="L282" title="All 2 branches missed.">			if(FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))) {</span>
<span class="nc" id="L283">				fraugsterProviderProperty = concreteDataBuilder.getProviderInitConfigProperty(Constants.TRANSACTION);</span>
<span class="nc" id="L284">				score = fraugsterProviderProperty.getRegistrationThreesholdScore();</span>
<span class="nc" id="L285">				sessionToken = fraugsterSessionHandler.getSessionToken();</span>
			}
		   else {
<span class="nc" id="L288">				fraugsterProviderProperty = concreteDataBuilder.getProviderInitConfigProperty(Constants.FRAUD_PREDICT_SIGNUP);</span>
<span class="nc" id="L289">				score = fraugsterProviderProperty.getRegistrationThreesholdScore();</span>
			}
			
<span class="nc" id="L292">			contacts = request.getContactRequests();</span>

<span class="nc bnc" id="L294" title="All 2 branches missed.">			for (FraugsterOnUpdateContactRequest contact : contacts) {</span>
				FraugsterOnUpdateContactResponse fraudDetectionResponse;
<span class="nc" id="L296">				fraudDetectionResponse = doOnUpdateCheckForContact(request, fraugsterProviderProperty, sessionToken,</span>
						score, contact);
<span class="nc" id="L298">				contactResponsesUpdate.add(fraudDetectionResponse);</span>
<span class="nc" id="L299">			}</span>

<span class="nc" id="L301">			responseUpdate.setContactResponses(contactResponsesUpdate);</span>
<span class="nc" id="L302">			responseUpdate.setOrgCode(request.getOrgCode());</span>
<span class="nc" id="L303">			responseUpdate.setSourceApplication(request.getSourceApplication());</span>
<span class="nc" id="L304">			responseUpdate.setStatus(Constants.PASS);</span>

<span class="nc" id="L306">		} catch (FraugsterException e) {</span>
<span class="nc" id="L307">			LOG.error(&quot;Error:&quot;,e);</span>
<span class="nc" id="L308">			responseUpdate.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L309">		} catch (Exception e) {</span>
<span class="nc" id="L310">			LOG.error(&quot;Error in doFraugsterCheckForOnUpdate() : &quot;, e);</span>
<span class="nc" id="L311">			throw new FraugsterException(FraugsterErrors.FAILED);</span>
<span class="nc" id="L312">		}</span>
<span class="nc" id="L313">		return responseUpdate;</span>
	}

	/**
	 * Do on update check for contact.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster on update contact response
	 */
	private FraugsterOnUpdateContactResponse doOnUpdateCheckForContact(FraugsterOnUpdateRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, final double score,
			FraugsterOnUpdateContactRequest contact) {
<span class="nc" id="L329">		FraugsterOnUpdateContactResponse fraudDetectionResponse = new FraugsterOnUpdateContactResponse();</span>
		
<span class="nc" id="L331">		FraugsterSessionToken reLoginSessionToken = null;</span>
		try {
<span class="nc" id="L333">			fraudDetectionResponse = validateAndCallFraugsterUpdate(request, fraugsterProviderProperty, sessionToken,</span>
					score, contact);
			
<span class="nc" id="L336">		} catch (FraugsterException e) {</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">			if(e.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.UNAUTHORIZED_EXCEPTION.getErrorCode())) {</span>
				try {
<span class="nc" id="L339">					reLoginSessionToken = fraugsterSessionHandler.repeatLogin();</span>
<span class="nc" id="L340">					fraudDetectionResponse = validateAndCallFraugsterUpdate(request, fraugsterProviderProperty,</span>
							reLoginSessionToken, score, contact);
					
<span class="nc" id="L343">				}catch(FraugsterException ex){</span>
<span class="nc" id="L344">					handleFraugsterExceptionForUpdate(contact, fraudDetectionResponse, ex);</span>
<span class="nc" id="L345">				}</span>
			}
			else{
<span class="nc" id="L348">				handleFraugsterExceptionForUpdate(contact, fraudDetectionResponse, e);</span>
			}
<span class="nc" id="L350">		} catch (Exception e) {</span>
<span class="nc" id="L351">			logError(e);</span>
<span class="nc" id="L352">			fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L353">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L354">			fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L355">			fraudDetectionResponse.setErrorCode(&quot;0999&quot;);</span>
<span class="nc" id="L356">			fraudDetectionResponse.setErrorDescription(Constants.GENERIC_EXCEPTION);</span>
<span class="nc" id="L357">		}</span>
<span class="nc" id="L358">		return fraudDetectionResponse;</span>
	}

	/**
	 * Validate and call fraugster update.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster on update contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterOnUpdateContactResponse validateAndCallFraugsterUpdate(FraugsterOnUpdateRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, final double score,
			FraugsterOnUpdateContactRequest contact) throws FraugsterException {
		FraugsterOnUpdateContactResponse fraudDetectionResponse;
<span class="nc" id="L376">		contact.setOrganizationCode(request.getOrgCode());</span>
		

<span class="nc" id="L379">		fraudDetectionResponse = validateAndCheckFraugsterUpdate(fraugsterProviderProperty, sessionToken,</span>
				contact);
<span class="nc" id="L381">		generateFraugsterResponseStatus(score, fraudDetectionResponse);</span>
<span class="nc" id="L382">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L383">		return fraudDetectionResponse;</span>
	}

	/**
	 * Handle fraugster exception for update.
	 *
	 * @param contact the contact
	 * @param fraudDetectionResponse the fraud detection response
	 * @param ex the ex
	 */
	private void handleFraugsterExceptionForUpdate(FraugsterOnUpdateContactRequest contact,
			FraugsterOnUpdateContactResponse fraudDetectionResponse, FraugsterException ex) {
<span class="nc" id="L395">		logDebug(ex);</span>
<span class="nc" id="L396">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc bnc" id="L397" title="All 2 branches missed.">		if(ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.INVALID_REQUEST.getErrorCode())</span>
<span class="nc bnc" id="L398" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_REQUEST_TRANSFORMATION.getErrorCode())</span>
<span class="nc bnc" id="L399" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_RESPONSE_TRANSFORMATION.getErrorCode())){</span>
<span class="nc" id="L400">			fraudDetectionResponse.setStatus(Constants.NOT_PERFORMED);</span>
		}else{
<span class="nc" id="L402">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
		}
<span class="nc" id="L404">		fraudDetectionResponse.setErrorCode(ex.getFraugsterErrors().getErrorCode());</span>
<span class="nc" id="L405">		fraudDetectionResponse.setErrorDescription(ex.getFraugsterErrors().getErrorDescription());</span>
<span class="nc" id="L406">	}</span>

	

	/**
	 * Validate and check fraugster update.
	 *
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param contact the contact
	 * @return the fraugster on update contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterOnUpdateContactResponse validateAndCheckFraugsterUpdate(
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken,
			FraugsterOnUpdateContactRequest contact)
			throws FraugsterException {
		Boolean isValidate;
		FraugsterOnUpdateContactResponse fraudDetectionResponse;
<span class="nc" id="L425">		isValidate = ivalidator.validateFraugsterOnUpdateRequest(contact);</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">		if (Boolean.FALSE.equals(isValidate)) {</span>
<span class="nc" id="L427">			LOG.error(&quot;Request is not valid&quot;);</span>
<span class="nc" id="L428">			throw new FraugsterException(FraugsterErrors.INVALID_REQUEST);</span>
			
<span class="nc bnc" id="L430" title="All 2 branches missed.">		} else if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))){</span>
<span class="nc" id="L431">			 fraudDetectionResponse = iFraugsterProviderService.doFraugsterOnUpdateCheck(contact,</span>
					fraugsterProviderProperty, sessionToken);
		}else {
<span class="nc" id="L434">			fraudDetectionResponse = iFraudPredictProviderService.doFraudPredictOnUpdateCheck(contact,</span>
					fraugsterProviderProperty);
		}
<span class="nc" id="L437">		return fraudDetectionResponse;</span>
	}

	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.fraugster.core.IFraugsterService#doFraugsterCheckForPaymentsOut(FraugsterPaymentsOutRequest)
	 */
	@Override
	public FraugsterPaymentsOutResponse doFraugsterCheckForPaymentsOut(FraugsterPaymentsOutRequest request)
			throws FraugsterException {


<span class="nc" id="L448">		List&lt;FraugsterPaymentsOutContactRequest&gt; contacts = null;</span>
<span class="nc" id="L449">		List&lt;FraugsterPaymentsOutContactResponse&gt; contactResponsesPaymentsOut = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L450">		FraugsterPaymentsOutResponse responsePaymentsOut = new FraugsterPaymentsOutResponse();</span>
<span class="nc" id="L451">		FraugsterProviderProperty fraugsterProviderProperty = null;</span>
<span class="nc" id="L452">		FraugsterSessionToken sessionToken = null;</span>
<span class="nc" id="L453">		double score = 0.00;</span>
		try {
			
<span class="nc bnc" id="L456" title="All 2 branches missed.">      if (System.getProperty(&quot;custType.toPerform.fraugster&quot;).contains(request.getCustType())) {</span>

<span class="nc bnc" id="L458" title="All 2 branches missed.">        if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))) {</span>
<span class="nc" id="L459">          fraugsterProviderProperty = concreteDataBuilder.getProviderInitConfigProperty(Constants.TRANSACTION);</span>
<span class="nc" id="L460">          score = fraugsterProviderProperty.getPaymentOutThreesholdScore();</span>
<span class="nc" id="L461">          sessionToken = fraugsterSessionHandler.getSessionToken();</span>
        } else {
<span class="nc" id="L463">          fraugsterProviderProperty =</span>
<span class="nc" id="L464">              concreteDataBuilder.getProviderInitConfigProperty(Constants.FRAUD_PREDICT_FUNDSOUT);</span>
<span class="nc" id="L465">          score = fraugsterProviderProperty.getPaymentOutThreesholdScore();</span>
        }

<span class="nc" id="L468">        contacts = request.getContactRequests();</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">        for (FraugsterPaymentsOutContactRequest contact : contacts) {</span>
          FraugsterPaymentsOutContactResponse fraudDetectionResponse;
<span class="nc" id="L471">          fraudDetectionResponse =</span>
<span class="nc" id="L472">              doPayementsOutCheckForContact(request, fraugsterProviderProperty, sessionToken, score, contact);</span>
<span class="nc" id="L473">          contactResponsesPaymentsOut.add(fraudDetectionResponse);</span>
<span class="nc" id="L474">        }</span>

<span class="nc" id="L476">        responsePaymentsOut.setContactResponses(contactResponsesPaymentsOut);</span>
<span class="nc" id="L477">        responsePaymentsOut.setOrgCode(request.getOrgCode());</span>
<span class="nc" id="L478">        responsePaymentsOut.setSourceApplication(request.getSourceApplication());</span>
<span class="nc" id="L479">        responsePaymentsOut.setStatus(&quot;Success&quot;);</span>
      }
			
	 else {
<span class="nc" id="L483">			contacts = request.getContactRequests();</span>
<span class="nc bnc" id="L484" title="All 2 branches missed.">		 for (FraugsterPaymentsOutContactRequest contact : contacts) {</span>
<span class="nc" id="L485">				FraugsterPaymentsOutContactResponse fraudDetectionResponse=new FraugsterPaymentsOutContactResponse();</span>
<span class="nc" id="L486">				fraudDetectionResponse.setFraugsterApproved(Constants.NOT_REQUIRED); </span>
<span class="nc" id="L487">				fraudDetectionResponse.setFraugsterId(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L488">				fraudDetectionResponse.setFrgTransId(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L489">				fraudDetectionResponse.setProviderResponse(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L490">				fraudDetectionResponse.setScore(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L491">				fraudDetectionResponse.setStatus(NOT_REQUIRED);</span>
<span class="nc" id="L492">				fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L493">				contactResponsesPaymentsOut.add(fraudDetectionResponse);</span>
<span class="nc" id="L494">			}</span>
<span class="nc" id="L495">		    responsePaymentsOut.setStatus(NOT_REQUIRED);</span>
<span class="nc" id="L496">			responsePaymentsOut.setContactResponses(contactResponsesPaymentsOut);</span>
		}
			
<span class="nc" id="L499">		} catch (FraugsterException e) {</span>
<span class="nc" id="L500">			LOG.error(&quot;Error in doFraugsterCheckForPaymentsOut() : &quot;, e);</span>
<span class="nc" id="L501">			responsePaymentsOut.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L502">		} catch (Exception e) {</span>
<span class="nc" id="L503">			LOG.error(&quot;Error in doFraugsterCheckFPaymentsOut() : &quot;, e);</span>
<span class="nc" id="L504">			throw new FraugsterException(FraugsterErrors.FAILED);</span>
<span class="nc" id="L505">		}</span>
<span class="nc" id="L506">		return responsePaymentsOut;</span>
	
	}

	/**
	 * Do payements out check for contact.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster payments out contact response
	 */
	private FraugsterPaymentsOutContactResponse doPayementsOutCheckForContact(FraugsterPaymentsOutRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, final double score,
			FraugsterPaymentsOutContactRequest contact) {
<span class="nc" id="L523">		FraugsterPaymentsOutContactResponse fraudDetectionResponse = new FraugsterPaymentsOutContactResponse();</span>
		
<span class="nc" id="L525">		FraugsterSessionToken reLoginSessionToken = null;</span>
		try {
<span class="nc" id="L527">			fraudDetectionResponse = validateAndCallFraugsterPaymentOut(request, fraugsterProviderProperty,</span>
					sessionToken, score, contact);
			
<span class="nc" id="L530">		} catch (FraugsterException e) {</span>
<span class="nc bnc" id="L531" title="All 2 branches missed.">			if(e.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.UNAUTHORIZED_EXCEPTION.getErrorCode())) {</span>
				try {
<span class="nc" id="L533">					reLoginSessionToken = fraugsterSessionHandler.repeatLogin();</span>
<span class="nc" id="L534">					fraudDetectionResponse = validateAndCallFraugsterPaymentOut(request, fraugsterProviderProperty,</span>
							reLoginSessionToken, score, contact);
					
<span class="nc" id="L537">				} catch (FraugsterException ex) {</span>
<span class="nc" id="L538">					handleFraugsterExceptionForPaymentOut(contact, fraudDetectionResponse, ex);</span>
<span class="nc" id="L539">				}</span>
			}else {
<span class="nc" id="L541">				handleFraugsterExceptionForPaymentOut(contact, fraudDetectionResponse, e);</span>
			}
<span class="nc" id="L543">		} catch (Exception e) {</span>
<span class="nc" id="L544">			logError(e);</span>
<span class="nc" id="L545">			fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L546">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L547">			fraudDetectionResponse.setErrorCode(&quot;0999&quot;);</span>
<span class="nc" id="L548">			fraudDetectionResponse.setErrorDescription(Constants.GENERIC_EXCEPTION);</span>
<span class="nc" id="L549">		}</span>
<span class="nc" id="L550">		return fraudDetectionResponse;</span>
	}

	/**
	 * Validate and call fraugster payment out.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster payments out contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterPaymentsOutContactResponse validateAndCallFraugsterPaymentOut(FraugsterPaymentsOutRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, final double score,
			FraugsterPaymentsOutContactRequest contact) throws FraugsterException {
		FraugsterPaymentsOutContactResponse fraudDetectionResponse;
<span class="nc" id="L568">		contact.setOrganizationCode(request.getOrgCode());</span>
<span class="nc" id="L569">		fraudDetectionResponse = validateAndCheckFraugsterPaymentsOut(request, fraugsterProviderProperty,</span>
				sessionToken, contact);
<span class="nc" id="L571">        generateFraugsterResponseStatus(score, fraudDetectionResponse);</span>
<span class="nc" id="L572">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L573">		return fraudDetectionResponse;</span>
	}

	/**
	 * Handle fraugster exception for payment out.
	 *
	 * @param contact the contact
	 * @param fraudDetectionResponse the fraud detection response
	 * @param ex the ex
	 */
	private void handleFraugsterExceptionForPaymentOut(FraugsterPaymentsOutContactRequest contact,
			FraugsterPaymentsOutContactResponse fraudDetectionResponse, FraugsterException ex) {
<span class="nc" id="L585">		logDebug(ex);</span>
<span class="nc bnc" id="L586" title="All 2 branches missed.">		if(ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.INVALID_REQUEST.getErrorCode())</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_REQUEST_TRANSFORMATION.getErrorCode())</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_RESPONSE_TRANSFORMATION.getErrorCode())){</span>
<span class="nc" id="L589">			fraudDetectionResponse.setStatus(Constants.NOT_PERFORMED);</span>
		}else{
<span class="nc" id="L591">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
		}
<span class="nc" id="L593">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L594">		fraudDetectionResponse.setErrorCode(ex.getFraugsterErrors().getErrorCode());</span>
<span class="nc" id="L595">		fraudDetectionResponse.setErrorDescription(ex.getFraugsterErrors().getErrorDescription());</span>
<span class="nc" id="L596">	}</span>

	

	/**
	 * Validate and check fraugster payments out.
	 *
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param contact the contact
	 * @return the fraugster payments out contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterPaymentsOutContactResponse validateAndCheckFraugsterPaymentsOut(FraugsterPaymentsOutRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken,
			FraugsterPaymentsOutContactRequest contact)
          throws FraugsterException {
        FraugsterPaymentsOutContactResponse fraudDetectionResponse;
        Boolean isValidate;
<span class="nc" id="L615">        isValidate = ivalidator.validateFraugsterPaymentsOutRequest(contact);</span>
<span class="nc bnc" id="L616" title="All 2 branches missed.">        if (Boolean.FALSE.equals(isValidate)) {</span>
<span class="nc" id="L617">          throw new FraugsterException(FraugsterErrors.INVALID_REQUEST);</span>
    
<span class="nc bnc" id="L619" title="All 2 branches missed.">        } else if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))) {</span>
<span class="nc" id="L620">          fraudDetectionResponse =</span>
<span class="nc" id="L621">              iFraugsterProviderService.doFraugsterPaymentsOutCheck(contact, fraugsterProviderProperty, sessionToken);</span>
        } else {
<span class="nc" id="L623">          fraudDetectionResponse =</span>
<span class="nc" id="L624">              iFraudPredictProviderService.doFraudPredictPaymentsOutCheck(request, contact, fraugsterProviderProperty);</span>
        }
<span class="nc" id="L626">        return fraudDetectionResponse;</span>
      }
	
	/**
	 * Log error.
	 *
	 * @param exception the exception
	 */
	private void logError(Throwable exception) {
<span class="nc" id="L635">		LOG.error(&quot;Error in class FraugsterServiceImpl :&quot;, exception);</span>
<span class="nc" id="L636">	}</span>
	
	/**
	 * Log debug.
	 *
	 * @param exception the exception
	 */
	private void logDebug(Throwable exception) {
<span class="nc" id="L644">		LOG.debug(&quot;Error in class FraugsterServiceImpl :&quot;, exception);</span>
<span class="nc" id="L645">	}</span>
	
	/**
	 * Validate and check fraugster payments in.
	 *
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param contact the contact
	 * @return the fraugster payments in contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterPaymentsInContactResponse validateAndCheckFraugsterPaymentsIn(FraugsterPaymentsInRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken,
			FraugsterPaymentsInContactRequest contact)
			throws FraugsterException {
		 FraugsterPaymentsInContactResponse fraudDetectionResponse;
		 
<span class="nc bnc" id="L662" title="All 2 branches missed.">		 if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))){</span>
<span class="nc" id="L663">			 fraudDetectionResponse = iFraugsterProviderService.doFraugsterPaymentsInCheck(contact,</span>
					fraugsterProviderProperty, sessionToken);
		 }else {
<span class="nc" id="L666">			 fraudDetectionResponse = iFraudPredictProviderService.doFraudPredictPaymentsInCheck(request, contact,</span>
						fraugsterProviderProperty);
	     }
<span class="nc" id="L669">		return fraudDetectionResponse;</span>
	}
	
	/**
	 * Do payements in check for contact.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster payments in contact response
	 */
	private FraugsterPaymentsInContactResponse doPayementsInCheckForContact(FraugsterPaymentsInRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, final double score,
			FraugsterPaymentsInContactRequest contact) {
<span class="nc" id="L685">		FraugsterPaymentsInContactResponse fraudDetectionResponse = new FraugsterPaymentsInContactResponse();</span>
		
<span class="nc" id="L687">		FraugsterSessionToken reLoginSessionToken = null;</span>
		try {
<span class="nc" id="L689">			fraudDetectionResponse = validateAndCallFraugsterPaymentIn(request, fraugsterProviderProperty, sessionToken,</span>
					score, contact);
			
<span class="nc" id="L692">		} catch (FraugsterException e) {</span>
<span class="nc bnc" id="L693" title="All 2 branches missed.">			if(e.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.UNAUTHORIZED_EXCEPTION.getErrorCode())) {</span>
				try {
<span class="nc" id="L695">					reLoginSessionToken = fraugsterSessionHandler.repeatLogin();</span>
<span class="nc" id="L696">					fraudDetectionResponse = validateAndCallFraugsterPaymentIn(request, fraugsterProviderProperty,</span>
							reLoginSessionToken, score, contact);
					
<span class="nc" id="L699">				} catch (FraugsterException ex) {</span>
<span class="nc" id="L700">					handleFraugsterExceptionForPaymentIn(contact, fraudDetectionResponse, ex);</span>
<span class="nc" id="L701">				}</span>
				
			}else {
<span class="nc" id="L704">				handleFraugsterExceptionForPaymentIn(contact, fraudDetectionResponse, e);</span>
			}
<span class="nc" id="L706">		} catch (Exception e) {</span>
<span class="nc" id="L707">			logError(e);</span>
<span class="nc" id="L708">			fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L709">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L710">			fraudDetectionResponse.setErrorCode(&quot;0999&quot;);</span>
<span class="nc" id="L711">			fraudDetectionResponse.setErrorDescription(Constants.GENERIC_EXCEPTION);</span>
<span class="nc" id="L712">		}</span>
<span class="nc" id="L713">		return fraudDetectionResponse;</span>
	}

	/**
	 * Validate and call fraugster payment in.
	 *
	 * @param request the request
	 * @param fraugsterProviderProperty the fraugster provider property
	 * @param sessionToken the session token
	 * @param score the score
	 * @param contact the contact
	 * @return the fraugster payments in contact response
	 * @throws FraugsterException the fraugster exception
	 */
	private FraugsterPaymentsInContactResponse validateAndCallFraugsterPaymentIn(FraugsterPaymentsInRequest request,
			FraugsterProviderProperty fraugsterProviderProperty, FraugsterSessionToken sessionToken, final double score,
			FraugsterPaymentsInContactRequest contact) throws FraugsterException {
		FraugsterPaymentsInContactResponse fraudDetectionResponse;
<span class="nc" id="L731">		contact.setOrganizationCode(request.getOrgCode());</span>
<span class="nc" id="L732">		fraudDetectionResponse = validateAndCheckFraugsterPaymentsIn(request,fraugsterProviderProperty,</span>
				sessionToken, contact);
<span class="nc" id="L734">		generateFraugsterResponseStatus(score, fraudDetectionResponse);</span>
		
<span class="nc" id="L736">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L737">		return fraudDetectionResponse;</span>
	}

	/**
	 * Handle fraugster exception for payment in.
	 *
	 * @param contact the contact
	 * @param fraudDetectionResponse the fraud detection response
	 * @param ex the ex
	 */
	private void handleFraugsterExceptionForPaymentIn(FraugsterPaymentsInContactRequest contact,
			FraugsterPaymentsInContactResponse fraudDetectionResponse, FraugsterException ex) {
<span class="nc" id="L749">		logDebug(ex);</span>
<span class="nc bnc" id="L750" title="All 2 branches missed.">		if(ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.INVALID_REQUEST.getErrorCode())</span>
<span class="nc bnc" id="L751" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_REQUEST_TRANSFORMATION.getErrorCode())</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">				|| ex.getFraugsterErrors().getErrorCode().equals(FraugsterErrors.ERROR_WHILE_RESPONSE_TRANSFORMATION.getErrorCode())){</span>
<span class="nc" id="L753">			fraudDetectionResponse.setStatus(Constants.NOT_PERFORMED);</span>
		}else{
<span class="nc" id="L755">			fraudDetectionResponse.setStatus(Constants.SERVICE_FAILURE);</span>
		}
<span class="nc" id="L757">		fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L758">		fraudDetectionResponse.setErrorCode(ex.getFraugsterErrors().getErrorCode());</span>
<span class="nc" id="L759">		fraudDetectionResponse.setErrorDescription(ex.getFraugsterErrors().getErrorDescription());</span>
<span class="nc" id="L760">	}</span>
	
	/**
	 * Generate fraugster response status.
	 *
	 * @param score the score
	 * @param fraudDetectionResponse the fraud detection response
	 */
	private void generateFraugsterResponseStatus(final double score,
			FraugsterBaseResponse fraudDetectionResponse) {
		
<span class="nc bnc" id="L771" title="All 2 branches missed.">		if (Double.parseDouble(fraudDetectionResponse.getFraugsterApproved()) == 1.0) {</span>

<span class="nc" id="L773">			fraudDetectionResponse.setStatus(Constants.PASS);</span>

<span class="nc bnc" id="L775" title="All 2 branches missed.">		} else if (Double.parseDouble(fraudDetectionResponse.getFraugsterApproved()) == 0.0) {</span>

<span class="nc" id="L777">			fraudDetectionResponse.setStatus(Constants.WATCH_LIST);</span>
		} else {
                     
<span class="nc" id="L780">			fraudDetectionResponse.setStatus(Constants.FAIL);</span>
		}
<span class="nc" id="L782">	}</span>

	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.fraugster.core.IFraugsterService#doFraugsterCheckForPaymentsIn(FraugsterPaymentsInRequest)
	 */
	@Override
	public FraugsterPaymentsInResponse doFraugsterCheckForPaymentsIn(FraugsterPaymentsInRequest request)
			throws FraugsterException {

<span class="nc" id="L791">		List&lt;FraugsterPaymentsInContactRequest&gt; contacts = null;</span>
<span class="nc" id="L792">		List&lt;FraugsterPaymentsInContactResponse&gt; contactResponsesPaymentsIn = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L793">		FraugsterPaymentsInResponse responsePaymentsIn = new FraugsterPaymentsInResponse();</span>
<span class="nc" id="L794">		FraugsterProviderProperty fraugsterProviderProperty = null;</span>
<span class="nc" id="L795">		FraugsterSessionToken sessionToken = null;</span>
<span class="nc" id="L796">		double score = 0.00;</span>
		try {

<span class="nc bnc" id="L799" title="All 2 branches missed.">			if (System.getProperty(&quot;custType.toPerform.fraugster&quot;).contains(request.getCustType())) {</span>

<span class="nc bnc" id="L801" title="All 2 branches missed.">				if (FRAUGSTER.equals(System.getProperty(FRAUGSTER_SERVICE_PROVIDER))) {</span>
<span class="nc" id="L802">					fraugsterProviderProperty = concreteDataBuilder</span>
<span class="nc" id="L803">							.getProviderInitConfigProperty(Constants.TRANSACTION);</span>
<span class="nc" id="L804">					sessionToken = fraugsterSessionHandler.getSessionToken();</span>
<span class="nc" id="L805">					score = fraugsterProviderProperty.getPaymentInThreesholdScore();</span>
				}else {

<span class="nc" id="L808">					fraugsterProviderProperty = concreteDataBuilder</span>
<span class="nc" id="L809">							.getProviderInitConfigProperty(Constants.FRAUD_PREDICT_FUNDSIN);</span>
<span class="nc" id="L810">					score = fraugsterProviderProperty.getPaymentInThreesholdScore();</span>
					
				}

<span class="nc" id="L814">				contacts = request.getContactRequests();</span>
<span class="nc bnc" id="L815" title="All 2 branches missed.">				for (FraugsterPaymentsInContactRequest contact : contacts) {</span>
					FraugsterPaymentsInContactResponse fraudDetectionResponse;
<span class="nc" id="L817">					fraudDetectionResponse = doPayementsInCheckForContact(request, fraugsterProviderProperty,</span>
							sessionToken, score, contact);
<span class="nc" id="L819">					contactResponsesPaymentsIn.add(fraudDetectionResponse);</span>
<span class="nc" id="L820">				}</span>

<span class="nc" id="L822">				responsePaymentsIn.setContactResponses(contactResponsesPaymentsIn);</span>
<span class="nc" id="L823">				responsePaymentsIn.setOrgCode(request.getOrgCode());</span>
<span class="nc" id="L824">				responsePaymentsIn.setSourceApplication(request.getSourceApplication());</span>
<span class="nc" id="L825">				responsePaymentsIn.setStatus(&quot;Success&quot;);</span>
				
			} else {

<span class="nc" id="L829">				contacts = request.getContactRequests();</span>
<span class="nc bnc" id="L830" title="All 2 branches missed.">				for (FraugsterPaymentsInContactRequest contact : contacts) {</span>
<span class="nc" id="L831">					FraugsterPaymentsInContactResponse fraudDetectionResponse = new FraugsterPaymentsInContactResponse();</span>
<span class="nc" id="L832">					fraudDetectionResponse.setFraugsterApproved(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L833">					fraudDetectionResponse.setFraugsterId(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L834">					fraudDetectionResponse.setFrgTransId(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L835">					fraudDetectionResponse.setProviderResponse(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L836">					fraudDetectionResponse.setScore(Constants.NOT_REQUIRED);</span>
<span class="nc" id="L837">					fraudDetectionResponse.setStatus(NOT_REQUIRED);</span>
<span class="nc" id="L838">					fraudDetectionResponse.setId(contact.getId());</span>
<span class="nc" id="L839">					contactResponsesPaymentsIn.add(fraudDetectionResponse);</span>
<span class="nc" id="L840">				}</span>

<span class="nc" id="L842">				responsePaymentsIn.setStatus(NOT_REQUIRED);</span>
<span class="nc" id="L843">				responsePaymentsIn.setContactResponses(contactResponsesPaymentsIn);</span>
			}

<span class="nc" id="L846">		} catch (FraugsterException e) {</span>
<span class="nc" id="L847">			LOG.error(&quot;Error in doFraugsterCheckForPaymentsOut() : &quot;, e);</span>
<span class="nc" id="L848">			responsePaymentsIn.setStatus(Constants.SERVICE_FAILURE);</span>
<span class="nc" id="L849">		} catch (Exception e) {</span>
<span class="nc" id="L850">			LOG.error(&quot;Error in doFraugsterCheckFPaymentsOut() : &quot;, e);</span>
<span class="nc" id="L851">			throw new FraugsterException(FraugsterErrors.FAILED);</span>
<span class="nc" id="L852">		}</span>
<span class="nc" id="L853">		return responsePaymentsIn;</span>

	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>