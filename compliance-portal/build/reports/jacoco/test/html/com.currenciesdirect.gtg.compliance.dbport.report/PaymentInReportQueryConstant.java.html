<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentInReportQueryConstant.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.dbport.report</a> &gt; <span class="el_source">PaymentInReportQueryConstant.java</span></div><h1>PaymentInReportQueryConstant.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.dbport.report;

import com.currenciesdirect.gtg.compliance.util.SearchCriteriaUtil;

/**
 * The Enum PaymentInQueryConstant.
 *
 * @author Rajesh
 */
<span class="fc" id="L10">@SuppressWarnings({&quot;squid:S1192&quot;,&quot;squid:S1192&quot;})</span>
public enum PaymentInReportQueryConstant {	
	
<span class="fc" id="L13">	PAYMENTIN_REPORT_CONTACT_ATTRIBUTE_FILTER( &quot;SELECT   b.accountid , a.id contactid, Row_number() OVER (partition BY b.accountid ORDER BY b.updatedon) rnum &quot;</span>
			+ &quot;   FROM contactattribute A JOIN contact B ON a.id = b.id {WATCHLIST_CATEGORY_FILTER} {WATCHLIST_FILTER} {PAYMENTIN_REPORT_COUNTRY_OF_RESIDENCE_FILTER} &quot;),
	
<span class="fc" id="L16">	WATCHLIST_FILTER(&quot; EXISTS( SELECT 1 FROM ContactWatchList CL WHERE Reason IN(?) AND a.id = CL.contact ) &quot;),</span>
<span class="fc" id="L17">	WATCHLIST_CATEGORY_FILTER(&quot; LEFT JOIN ContactWatchList CL ON CL.contact=B.id JOIN watchlist W ON CL.reason=w.id AND w.category IN(?)  &quot;),</span>
	
<span class="fc" id="L19">	PAYMENTIN_REPORT_ACCOUNT_ATTRIBUTE_FILTER( &quot;  SELECT a.id accountid, b.organizationId as organization  &quot;</span>
			+ &quot; FROM   accountattribute A  JOIN account B  ON  a.id = b.id&quot;),
	
<span class="fc" id="L22">	PAYMENTIN_REPORT_ATTRIBUTE_FILTER(&quot; SELECT p.id AS paymentid  FROM   comp.paymentinattribute P &quot; </span>
			+ &quot;{COUNTRY_JOIN} &quot;),
	
<span class="fc" id="L25">	PAYMENTIN_REPORT_FILTER(&quot; SELECT  payin.id AS resourceid,  resourcetype, ur.createdby &quot;</span>
			/*
			 * +
			 * &quot; (SELECT	se.status FROM ServiceStatusEnum se WHERE se.ID = esl.Status) AS ESLRiskStatus &quot;
			 */
			+ &quot; FROM   paymentin payin &quot; //,  U.SsoUserId
			+ &quot; LEFT JOIN userresourcelock ur  ON  ur.resourceid = payin.id  AND resourcetype = 2 AND ur.lockReleasedOn is null &quot;
			/*
			 * +
			 * &quot; LEFT JOIN eventservicelog esl ON esl.EntityID = payin.ID AND esl.ServiceType = 11&quot;
			 */
			+ &quot; {CONTACT_FILTER_JOIN} {ACCOUNT_FILTER_JOIN} {ATTRIBUTE_FILTER_JOIN} {USER_JOIN} {ORG_TABLE_JOIN} {LEGAL_ENTITY_TABLE_JOIN} JOIN Account acc ON payin.accountid = acc.id &quot;), 
	
<span class="fc" id="L38">	PAYMENTIN_REPORT_CONTACT_FILTER_JOIN(&quot; LEFT JOIN  contactattributefilter CF ON payin.contactid = cf.contactid&quot;),</span>
	
<span class="fc" id="L40">	PAYMENTIN_REPORT_ACCOUNT_FILTER_JOIN(&quot; LEFT JOIN  accountattributefilter AF ON payin.accountid = af.accountid&quot;),</span>
	
<span class="fc" id="L42">	PAYMENTIN_REPORT_ATTRIBUTE_FILTER_JOIN(&quot; JOIN paymentattributefilter PF ON payin.id = PF.paymentid&quot;),</span>
	
<span class="fc" id="L44">	ORG_TABLE_JOIN(&quot;JOIN Organization org ON org.Id = payin.organizationID  &quot;),</span>
	
<span class="fc" id="L46">	LEGAL_ENTITY_TABLE_JOIN(&quot;JOIN LegalEntity le ON le.ID = payin.LegalEntityID&quot;),</span>
	
<span class="fc" id="L48">	USER_FILTER_JOIN(&quot;LEFT JOIN [USER] U ON U.id=ur.UserId &quot;),</span>
	
<span class="fc" id="L50">	COUNTRY_FILTER_JOIN(&quot;LEFT JOIN  country c ON c.code=P.vCountryOfPayment&quot;),</span>
	
<span class="fc" id="L52">	RG_FILTER_JOIN(&quot;LEFT JOIN eventservicelog esl ON esl.EntityID = payin.ID AND esl.ServiceType = 11&quot;),</span>

<span class="fc" id="L54">	REPORT_FILTER_NULL_CHECK(&quot; (CF.ContactId IS NOT NULL OR AF.AccountId IS NOT NULL) &quot;),</span>
	
<span class="fc" id="L56">	PAYMENTIN_REPORT_COUNTRY_OF_RESIDENCE_FILTER(&quot;JOIN country cor ON cor.id = b.country&quot;),</span>
	
<span class="fc" id="L58">	GET_PAYMENTIN_REPORT(&quot; DECLARE @Offset INT = ?,   @Rows   INT = ?;&quot;</span>
			+ &quot;  WITH &quot;
			+ &quot; contactattributefilter &quot;
			+ &quot; AS ( {PAYMENTIN_REPORT_CONTACT_FILTER} ), &quot;
			+ &quot; accountattributefilter &quot;
			+ &quot; AS ( {PAYMENTIN_REPORT_ACCOUNT_FILTER} ), &quot;
			+ &quot; paymentattributefilter &quot;
			+ &quot; AS ( {PAYMENTIN_ATTRIBUTE_FILTER} ), &quot;
			+ &quot; selectedid AS (  {PAYMENTIN_REPORT_FILTER} order by {SORT_FIELD_NAME} {ORDER_TYPE} offset @Offset rows  FETCH next @rows rows only ) &quot;
			+ &quot; SELECT    pina.attributes, &quot;
			+ &quot;          payin.id               AS paymentinid, &quot;
			+ &quot;          payin.accountid        AS accountid, &quot;
			+ &quot;          payin.contactid        AS contactid, &quot;
			+ &quot;          payin.compliancestatus AS compliancestatus, &quot;
			+ &quot;          payin.tradeContractNumber   AS transactions, &quot;
			+ &quot;          acc.tradeaccountnumber  AS client, &quot;
			+ &quot;          acc.crmaccountid        AS acsfid, &quot;
			+ &quot;          payin.transactiondate  AS [Date], &quot;
			+ &quot;          acc.[type] AS type, &quot;
			+ &quot;          CASE WHEN acc.[type] = 2 THEN con.NAME ELSE acc.NAME &quot;
			+ &quot;          END                                               AS clientname, &quot;
			+ &quot;          pina.vTransactionCurrency                         AS transactioncurrency, &quot;
			+ &quot;          pina.vTransactionAmount                           AS amount, &quot;
			+ &quot;          pina.vBaseCurrencyAmount                          AS basecurrencyamount, &quot;
			+ &quot;          pina.vPaymentMethod  AS paymentmethod, &quot;
			+ &quot;          pina.vThirdPartyPayment                           AS isthirdpartypayment, &quot;
			+ &quot;          resourceid, &quot;
			+ &quot;          us.ssouserid  AS lockedby, &quot;
			+ &quot;          org.NAME AS organization, &quot;
			+ &quot;          acc.LegalEntity, &quot;
			+ &quot;          pina.vCountryOfPayment  AS country, &quot;
			+ &quot;          coun.DisplayName                     AS countrydisplayname,&quot;
			+ &quot;          pcse.status  AS overallstatus, &quot;
			+ &quot;          CASE &quot;
			+ &quot;          WHEN acc.[type] = 2 THEN con.PayInwatchliststatus &quot;
			+ &quot;          ELSE acc.PayInwatchliststatus END AS WatchListStatus, &quot;//changes for 2986
			+ &quot;          payin.blackliststatus, &quot;
			+ &quot;          payin.fraugsterstatus, &quot;
			+ &quot;          payin.sanctionstatus, &quot;
			+ &quot;          payin.customcheckstatus, &quot;
			+ &quot;          payin.intuitionCheckStatus, &quot; // AT-4607
			+ &quot;          payin.debitCardFraudCheckStatus AS riskStatus&quot; //AT-3830
			+ &quot; FROM     paymentin payin &quot;
			+ &quot; JOIN     selectedid pq &quot;
			+ &quot; ON       pq.resourceid = payin.id &quot;
			+ &quot; JOIN     paymentinattribute pina &quot;
			+ &quot; ON       payin.id = pina.id &quot;
			+ &quot; JOIN     paymentcompliancestatusenum pcse &quot;
			+ &quot; ON       payin.compliancestatus = pcse.id &quot;
			+ &quot; JOIN     account acc &quot;
			+ &quot; ON       payin.accountid = acc.id &quot;
			+ &quot; JOIN     contact con &quot;
			+ &quot; ON       payin.contactid = con.id &quot;
			+ &quot; JOIN     organization org &quot;
			+ &quot; ON       org.id = acc.organizationid &quot;
			+ &quot; LEFT JOIN country coun &quot;
			+ &quot; ON       coun.code = pina.vcountryofpayment &quot;
			+ &quot; LEFT JOIN [user] us ON us.id = pq.createdby &quot;
			+ &quot; order by {SORT_FIELD_NAME} {ORDER_TYPE}&quot;),
	
<span class="fc" id="L118">	GET_PAYMENTIN_REPORT_DATA( &quot; WITH &quot;</span>
			+ &quot; contactattributefilter AS ( {PAYMENTIN_REPORT_CONTACT_FILTER} ), &quot;
			+ &quot; accountattributefilter AS ( {PAYMENTIN_REPORT_ACCOUNT_FILTER} ), &quot;
			+ &quot; paymentattributefilter AS ( {PAYMENTIN_ATTRIBUTE_FILTER} ), &quot;
			+ &quot; selectedid AS (  {PAYMENTIN_REPORT_FILTER} ) &quot;
			+ &quot; SELECT    pina.attributes, &quot;
			+ &quot;          payin.id               AS paymentinid, &quot;
			+ &quot;          payin.accountid        AS accountid, &quot;
			+ &quot;          payin.contactid        AS contactid, &quot;
			+ &quot;          payin.compliancestatus AS compliancestatus, &quot;
			+ &quot;          payin.tradeContractNumber   AS transactions, &quot;
			+&quot;            payin.initialStatus  AS initialStatus, &quot;
			+ &quot;          acc.tradeaccountnumber  AS client, &quot;
			+ &quot;          acc.crmaccountid        AS acsfid, &quot;
			+ &quot;          payin.transactiondate  AS [Date], &quot;
			+ &quot;          CASE &quot;
			+ &quot;                    WHEN acc.[type] = 2 THEN 'PFX' &quot;
			+ &quot;                    WHEN acc.[type] = 1 THEN 'CFX' &quot;
			+ &quot;                    ELSE 'CFX(Etailer)' &quot;
			+ &quot;          END AS type, &quot;
			+ &quot;          CASE &quot;
			+ &quot;                    WHEN acc.[type] = 2 THEN con.NAME &quot;
			+ &quot;                    ELSE acc.NAME &quot;
			+ &quot;          END                                               AS clientname, &quot;
			+ &quot;          pina.vTransactionCurrency                         AS transactioncurrency, &quot;
			+ &quot;          pina.vTransactionAmount                           AS amount, &quot;
			+ &quot;          pina.vBaseCurrencyAmount                          AS basecurrencyamount, &quot;
			+ &quot;          pina.vPaymentMethod   AS paymentmethod, &quot;
			+ &quot;          pina.vThirdPartyPayment                           AS isthirdpartypayment, &quot;
			+ &quot;          resourceid, &quot;
			+ &quot;          us.ssouserid  AS lockedby, &quot;
			+ &quot;          org.NAME  AS organization, &quot;
			+ &quot;          acc.LegalEntity, &quot; //added for AT-3011
			+ &quot;          pina.vCountryOfPayment  AS country, &quot;
			+ &quot;          coun.DisplayName                  AS countrydisplayname,&quot;
			+ &quot;          pcse.status  AS overallstatus, &quot;
			+ &quot;          acc.PayInwatchliststatus  AS watchliststatus, &quot;
			+ &quot;          payin.blackliststatus, &quot;
			+ &quot;          payin.fraugsterstatus, &quot;
			+ &quot;          payin.sanctionstatus, &quot;
			+ &quot;          payin.customcheckstatus ,&quot; 
			+ &quot;          payin.debitCardFraudCheckStatus AS riskStatus,&quot; //AT-3830
			+ &quot;          payin.IntuitionCheckStatus &quot; //AT-4717
			+ &quot; FROM      paymentin payin &quot;
			+ &quot; JOIN      selectedid pq &quot;
			+ &quot; ON        pq.resourceid = payin.id &quot;
			+ &quot; JOIN      paymentinattribute pina &quot;
			+ &quot; ON        payin.id = pina.id &quot;
			+ &quot; JOIN      paymentcompliancestatusenum pcse &quot;
			+ &quot; ON        payin.compliancestatus = pcse.id &quot;
			+ &quot; JOIN      account acc &quot;
			+ &quot; ON        payin.accountid = acc.id &quot;
			+ &quot; JOIN      contact con &quot;
			+ &quot; ON        payin.contactid = con.id &quot;
			+ &quot; JOIN      organization org &quot;
			+ &quot; ON        org.id = acc.organizationid &quot;
			+ &quot; LEFT JOIN country coun &quot;
			+ &quot; ON        coun.code = pina.vcountryofpayment &quot;
			+ &quot; LEFT JOIN [user] us &quot;
			+ &quot; ON        us.id = pq.createdby order by {SORT_FIELD_NAME} {ORDER_TYPE}&quot;),
	
<span class="fc" id="L179">	PAYMENTIN_REPORT_COUNT(&quot;WITH &quot;</span>
			+ &quot; contactattributefilter AS ( {PAYMENTIN_REPORT_CONTACT_FILTER} ), &quot;
			+ &quot; accountattributefilter AS ( {PAYMENTIN_REPORT_ACCOUNT_FILTER} ), &quot;
			+ &quot; paymentattributefilter AS ( {PAYMENTIN_ATTRIBUTE_FILTER} ), &quot;
			+ &quot; selectedid AS (  {PAYMENTIN_REPORT_FILTER}  ) &quot; //ORDER BY  payin.updatedon DESC offset @Offset rows  FETCH next @rows rows only
			+ &quot; SELECT   Count(payin.Id)              AS TotalRows &quot;
			+ &quot; FROM      paymentin payin &quot;
			+ &quot; JOIN      selectedid pq &quot;
			+ &quot; ON        pq.resourceid = payin.id &quot;
			+ &quot; JOIN      paymentinattribute pina &quot;
			+ &quot; ON        payin.id = pina.id &quot;
			+ &quot; JOIN      paymentcompliancestatusenum pcse &quot;
			+ &quot; ON        payin.compliancestatus = pcse.id &quot;
			+ &quot; JOIN      account acc &quot;
			+ &quot; ON        payin.accountid = acc.id &quot;
			+ &quot; JOIN      contact con &quot;
			+ &quot; ON        payin.contactid = con.id &quot;
			+ &quot; JOIN      organization org &quot;
			+ &quot; ON        org.id = acc.organizationid &quot;
			+ &quot; LEFT JOIN [user] us &quot;
			+ &quot; ON        us.id = pq.createdby&quot;),
	
<span class="fc" id="L201">	GET_PAYMENTIN_REPORT_PAGINATION(&quot;WITH pique AS( &quot;</span>
			+ &quot; SELECT &quot;
			+ &quot; Row_number() OVER(ORDER BY payin.id DESC) AS rownum, &quot;
			+ &quot; payin.id AS paymentinid, &quot;
			+ &quot; payin.accountid AS accountid, &quot;
			+ &quot; payin.contactid AS contactid, &quot;
			+ &quot; payin.compliancestatus AS compliancestatus, &quot;
			+ &quot; payin.deleted AS deleted, &quot;
			+ &quot; payin.tradecontractnumber AS Transactions, &quot;
			+ &quot; acc.tradeaccountnumber AS client, &quot;
			+ &quot; payinattri.transactiondate AS [Date], &quot;
			+ &quot; acc.[type] AS [type], &quot;
			+ &quot;         case when  acc.[type]='PFX' then con.NAME when acc.[type]='CFX' then acc.NAME &quot;
			+ &quot; END as clientname,&quot;
			+ &quot; payinattri.transactioncurrency AS sell, &quot;
			+ &quot; payinattri.transactionamount AS amount, &quot;
			+ &quot; payinattri.paymentmethod AS [method], &quot;
			+ &quot; ur.id AS resourceid, &quot;
			+ &quot; us.ssouserid AS lockedby, &quot;
			+ &quot; org.NAME AS organization, &quot;
			+ &quot; ( Select ','+(select wl.reason AS WatchListReason from WatchList wl where id=cw.Reason)  AS [text()] &quot;
			+ &quot; From contactwatchlist cw JOIN contact con ON cw.contact=con.id AND con.accountid = payin.accountid &quot;
			+ &quot; For XML PATH ('') ) AS WatchListReason, &quot;
			+ &quot; ctr.code AS country, &quot;
			+ &quot; pcse.status AS overallstatus, &quot;
			+ &quot; acc.WatchlistStatus AS watchliststatus, &quot;
			+ &quot; payin.BlacklistStatus AS blackliststatus, &quot;
			+ &quot; payin.FraugsterStatus AS fraugsterstatus, &quot;
			+ &quot; payin.SanctionStatus AS sanctionstatus, &quot;
			+ &quot; payin.CustomCheckStatus AS CustomCheckStatus &quot;
			+ &quot; FROM &quot;
			+ &quot; paymentin payIn &quot;
			+ &quot; JOIN paymentinattribute payInAttri ON payin.id = payinattri.id &quot;
			+ &quot; JOIN account acc ON payin.accountid = acc.id &quot;
			+ &quot; JOIN contact con ON payin.contactid = con.id &quot;
			+ &quot; JOIN paymentcompliancestatusenum pcse ON payin.compliancestatus = pcse.id &quot;
			+ &quot; JOIN Country ctr ON payInAttri.countryofpayment = ctr.id &quot;
			+ &quot; JOIN organization org ON org.id = acc.organizationid &quot;
			+ &quot; LEFT JOIN userresourcelock ur ON payin.id = ur.resourceid &quot;
			+ &quot; AND ur.resourcetype = 'PAYMENT_IN' &quot;
			+ &quot; LEFT JOIN [user] us ON us.id = ur.createdby &quot;
			+ &quot; WHERE &quot;
<span class="fc" id="L243">			+ &quot; payinattri.transactiondate &gt; DATEADD(day,-&quot; + SearchCriteriaUtil.getDefaultQueueRecordSize() + &quot;,GETDATE()) &quot;</span>
			+ &quot; AND payIn.deleted = 0 &quot;
			+ &quot;) &quot;
			+ &quot;SELECT *, (SELECT max(rownum) FROM pique) AS 'TotalRows' &quot;
			+ &quot;FROM &quot;
			+ &quot; pique &quot;
			+ &quot;WHERE &quot;
			+ &quot; rownum &gt;= ? &quot;
			+ &quot; AND rownum &lt;= ? &quot;),
	
<span class="fc" id="L253">	GET_PAYMENTIN_REPORT_COUNT(&quot;SELECT COUNT(*) as count FROM PaymentIn&quot;),</span>
	
<span class="fc" id="L255">	GET_PAYMENTIN_REPORT_WITHOUT_PAGINATION(&quot;SELECT Count(*) AS count from( SELECT * FROM &quot;</span>
			+ &quot;                      (SELECT payin.id AS paymentinid, &quot;
			+ &quot;                      payin.accountid  AS   accountid  , &quot;
			+ &quot;                      payin.contactid AS contactid, &quot;
			+ &quot;                       &quot;
			+ &quot;                      (select ssouserid from [user] where id=ur.userid) as username, &quot;
			+ &quot;                      payin.compliancestatus AS   compliancestatus, &quot;
			+ &quot;                      statusEnum.status AS compliancestatusenum, &quot;
			+ &quot;                      payin.deleted   AS  deleted, &quot;
			+ &quot;                      payin.tradecontractnumber   AS   Transactions, &quot;
			+ &quot;                      acc.tradeaccountnumber AS  client, &quot;
			+ &quot;                       acc.CRMAccountID AS ACSFID, &quot;
			+ &quot;                       conattrib.Attributes    AS ContactAttributes, &quot;
			+ &quot;                      payinattri.transactiondate AS [Date], &quot;
			+ &quot;                      acc.type  AS   type, &quot;
			+ &quot;                       case when  acc.[type]='PFX' then con.NAME when acc.[type]='CFX' then acc.NAME &quot;
			+ &quot;                       END as clientname,&quot;
			+ &quot;                      payinattri.transactioncurrency  AS  sell, &quot;
			+ &quot;                      payinattri.transactionamount  AS  amount, &quot;
			+ &quot;                      payinattri.paymentmethod AS   method, &quot;
			+ &quot;                        &quot;
			+ &quot;                      ur.id  AS  resourceid, &quot;
			+ &quot;                      (select ssouserid from [user] where id = ur.createdby)   AS    lockedby, &quot;
			+ &quot;                     ( Select ','+(select wl.reason AS WatchListReason from WatchList wl where id=cw.Reason)  AS [text()] &quot;
			+ &quot;                      From contactwatchlist cw JOIN contact con ON cw.contact=con.id AND con.accountid = payin.accountid &quot;
			+ &quot;                      For XML PATH ('') ) AS WatchListReason, &quot;
			+ &quot;   &quot;
			+ &quot;                      (SELECT NAME &quot;
			+ &quot;                       FROM   organization &quot;
			+ &quot;                       WHERE  id = acc.organizationid) AS organization, &quot;
			+ &quot;                      (SELECT code AS country &quot;
			+ &quot;                       FROM   country &quot;
			+ &quot;                       WHERE  id = (SELECT countryofpayment &quot;
			+ &quot;                                    FROM   paymentinattribute pa &quot;
			+ &quot;                                    WHERE  pa.id = payin.id)) &quot;
			+ &quot;                      AS country, &quot;
			+ &quot;                      (SELECT status &quot;
			+ &quot;                       FROM   paymentcompliancestatusenum &quot;
			+ &quot;                       WHERE  id = (SELECT compliancestatus &quot;
			+ &quot;                                    FROM   paymentin pyi &quot;
			+ &quot;                                    WHERE  payin.id = pyi.id)) &quot;
			+ &quot;                      AS overallstatus, &quot;
			+ &quot;                      acc.WatchlistStatus AS WatchListStatus AS &quot;
			+ &quot;                              watchliststatus, &quot;
			+ &quot;                      (SELECT &quot;
			+ &quot;                        TOP 1 status &quot;
			+ &quot;                       FROM   &quot;
			+ &quot;                         eventservicelog esl &quot;
			+ &quot;                       WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum &quot;
			+ &quot;                                                 WHERE  code = 'BLACKLIST') &quot;
			+ &quot;                              AND payin.id = (SELECT TOP 1 paymentinid FROM event &quot;
			+ &quot;                                              WHERE  id IN ( esl.eventid ) ORDER  BY id DESC)) AS blackliststatus, &quot;
			+ &quot;                      (SELECT TOP 1 status FROM   eventservicelog esl &quot;
			+ &quot;                       WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot;                                                 FROM compliance_servicetypeenum WHERE  code = 'FRAUGSTER') &quot;
			+ &quot;                              AND payin.id = (SELECT TOP 1 paymentinid &quot;
			+ &quot;                                              FROM   event WHERE  id IN ( esl.eventid ) ORDER  BY id DESC)) &quot;
			+ &quot;                      AS fraugsterstatus, &quot;
			+ &quot;                      (SELECT TOP 1 status &quot;
			+ &quot;                       FROM   eventservicelog esl &quot;
			+ &quot;                       WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot;                                                 FROM &quot;
			+ &quot;                              compliance_servicetypeenum &quot;
			+ &quot;                                                 WHERE  code = 'SANCTION') &quot;
			+ &quot;                              AND payin.id = (SELECT TOP 1 paymentinid &quot;
			+ &quot;                                              FROM   event &quot;
			+ &quot;                                              WHERE  id IN ( esl.eventid ) &quot;
			+ &quot;                                              ORDER  BY id DESC)) &quot;
			+ &quot;                      AS &quot;
			+ &quot;                              sanctionstatus , &quot;
			+ &quot;                    ( SELECT TOP 1 status  FROM     eventservicelog esl  WHERE    esl.servicetype = &quot;
			+ &quot;                    ( SELECT id FROM   compliance_servicetypeenum WHERE  code = 'VELOCITYCHECK') AND payin.id = &quot;
			+ &quot;                    (select top 1 paymentinid from event where id in (esl.eventid) order by id desc)) AS CustomCheckStatus &quot;
			+ &quot;                                &quot;
			+ &quot;               FROM   paymentin payIn &quot;
			+ &quot;                      JOIN paymentinattribute payinattri &quot;
			+ &quot;                        ON payin.id = payinattri.id &quot;
			+ &quot;                      JOIN account acc &quot;
			+ &quot;                        ON payin.accountid = acc.id &quot;
			+ &quot;                      JOIN contact con &quot;
			+ &quot;                        ON payin.contactid = con.id &quot;
			+ &quot;                         LEFT JOIN ContactAttribute conattrib &quot;
			+ &quot;                            ON        con.id = conattrib.id &quot;
			+ &quot;                      JOIN PaymentComplianceStatusEnum statusEnum &quot;
			+ &quot;                        ON payin.ComplianceStatus = statusEnum.id &quot;
			+ &quot;                     &quot;
			+ &quot;                      LEFT JOIN userresourcelock ur &quot;
			+ &quot;                             ON payin.id = ur.resourceid &quot;
			+ &quot;                                AND ur.resourcetype = 'PAYMENT_IN' &quot;
			+ &quot;                                AND ur.lockreleasedon IS NULL) AS pqueue &quot;
			+ &quot;                          where  deleted &lt;&gt; 1) AS pqueue2&quot;),
	
	
<span class="fc" id="L348">	GET_PAYMENTIN_REPORT_INNER_QUERY(&quot; SELECT Row_number() OVER ( ORDER BY {SORT_FIELD_NAME} {ORDER_TYPE}) AS rownum, pqueue2.* from &quot;</span>
						+ &quot;       ( SELECT pqueue.* FROM ( select&quot;
			+ &quot; payin.id AS paymentinid, &quot;
			+ &quot; payin.accountid AS accountid, &quot;
			+ &quot; payin.contactid AS contactid, &quot;
			+ &quot; payin.compliancestatus AS compliancestatus, &quot;
			+ &quot; payin.deleted AS deleted, &quot;
			+ &quot; payin.tradecontractnumber AS Transactions, &quot;
			+ &quot; acc.tradeaccountnumber AS client, &quot;
			+ &quot; payinattri.transactiondate AS [Date], &quot;
			+ &quot; acc.[type] AS [type], &quot;
			+ &quot; case when  acc.[type]='PFX' then con.NAME when acc.[type]='CFX' then acc.NAME &quot;
			+ &quot; END as clientname,&quot;
			+ &quot; acc.CRMAccountID AS ACSFID ,  conattrib.Attributes As  ContactAttributes, &quot;
			+ &quot; payinattri.transactioncurrency AS sell, &quot;
			+ &quot; payinattri.transactionamount AS amount, &quot;
			+ &quot; payinattri.paymentmethod AS [method], &quot;
			+ &quot; ur.id AS resourceid, &quot;
			+ &quot; us.ssouserid AS lockedby, &quot;
			+ &quot; org.NAME AS organization, &quot;
			+ &quot; ( Select ','+(select wl.reason AS WatchListReason from WatchList wl where id=cw.Reason)  AS [text()] &quot;
			+ &quot; From contactwatchlist cw JOIN contact con ON cw.contact=con.id AND con.accountid = payin.accountid &quot;
			+ &quot; For XML PATH ('') ) AS WatchListReason, &quot;
			+ &quot; ctr.code AS country, ctr.DisplayName AS CountryDisplayName, &quot;
			+ &quot; pcse.status AS overallstatus,  &quot;
			+ &quot; acc.WatchlistStatus AS watchliststatus ,&quot;
			+ &quot; payin.BlacklistStatus AS blackliststatus, &quot;
			+ &quot; payin.FraugsterStatus AS fraugsterstatus, &quot;
			+ &quot; payin.SanctionStatus AS sanctionstatus, &quot;
			+ &quot; payin.CustomCheckStatus AS CustomCheckStatus &quot;
			+ &quot; FROM &quot;
			+ &quot; paymentin payIn &quot;
			+ &quot; JOIN paymentinattribute payInAttri ON payin.id = payinattri.id &quot;
			+ &quot; JOIN account acc ON payin.accountid = acc.id &quot;
			+ &quot; JOIN contact con ON payin.contactid = con.id &quot;
			+ &quot; JOIN paymentcompliancestatusenum pcse ON payin.compliancestatus = pcse.id &quot;
			+ &quot; LEFT JOIN Country ctr ON payInAttri.countryofpayment = ctr.id &quot;
			+ &quot; JOIN organization org ON org.id = acc.organizationid &quot; 
			+ &quot; LEFT JOIN contactattribute conattrib  ON con.id = conattrib.id &quot;
			+ &quot; LEFT JOIN userresourcelock ur ON payin.id = ur.resourceid &quot;
			+ &quot; AND ur.resourcetype = 'PAYMENT_IN' AND ur.LockReleasedOn IS NULL &quot;
			+ &quot; LEFT JOIN [user] us ON us.id = ur.createdby &quot;
			+ &quot; WHERE &quot;
			+ &quot; {PAYMENTIN_DATETIME_CRITERIA} &quot;
			+ &quot; payIn.deleted = 0  )  As pqueue&quot;),
	
	
<span class="fc" id="L395">	GET_PAYMENTIN_REPORT_PAGINATION_WITH_CRITERIA(&quot;WITH pique  &quot;</span>
			+ &quot;AS &quot;
			+ &quot;( {INNER_QUERY} ) &quot;
			+ &quot;  As pqueue2 ) SELECT *, (SELECT max(rownum) FROM pique) AS 'TotalRows' &quot;
			+ &quot; FROM pique WHERE rownum &gt;= ? AND rownum &lt;= ?  &quot;),
	
<span class="fc" id="L401">	GET_PAYMENT_IN_DETAILS(&quot;SELECT pyi.id, &quot;</span>
			+ &quot; pyi.accountid, &quot;
			+ &quot; pyi.contactid, &quot;
			+ &quot; org.NAME                               AS Organisation, &quot;
			+ &quot; pyi.TradeContractNumber, &quot;
			+ &quot; (SELECT status FROM  paymentcompliancestatusenum &quot;
			+ &quot; WHERE  id = pyi.compliancestatus)   AS PaymentInStaus, &quot;
			+ &quot; pia.PaymentMethod, &quot;
			+ &quot;                                pia.ThirdPartyPayment, &quot;
			+ &quot; pia.DebitorName, &quot;
			+ &quot; pia.attributes                       AS PaymentInAttributes, &quot;
			+ &quot; (SELECT Code &quot;
			+ &quot; FROM   country &quot;
			+ &quot; WHERE  id = pia.CountryOfPayment)   AS Country, &quot;
			+ &quot; pia.TransactionAmount                AS Amount, &quot;
			+ &quot; pia.TransactionCurrency              AS SellCurrency, &quot;
			+ &quot; pia.TransactionDate                  AS DateOfPayment, &quot;
			+ &quot; co.NAME                              AS ContactName, &quot;
			+ &quot; co.compliancedoneon                  AS RegComplete, &quot;
			+ &quot; co.createdon                         AS RegIn, &quot;
			+ &quot; (SELECT status FROM  contactcompliancestatusenum &quot;
			+ &quot; WHERE  id = co.compliancestatus)    AS ContactComplianceStatus, &quot;
			+ &quot; co.tradecontactid                    AS TradeContactId, &quot;
			+ &quot; pyi.tradepaymentid, &quot;
			+ &quot; coa.attributes                       AS contactAttrib, &quot;
			+ &quot; (SELECT status FROM  accountcompliancestatusenum &quot;
			+ &quot; WHERE  id = acc.compliancestatus)   AS AccComplianceStatus, &quot;
			+ &quot; acc.crmaccountid, &quot;
			+ &quot; acc.tradeaccountnumber, &quot;
			+ &quot; accAttrib.attributes                 AS AccountAttrib, &quot;
			+ &quot; co.crmcontactid, &quot;
			+ &quot; ur.id                                AS userResourceLockId, &quot;
			+ &quot; ur.createdby                         AS LockedBy, &quot;
			+ &quot; esl.id                               AS EventServiceLogId, &quot;
			+ &quot; esl.entityid, &quot;
			+ &quot; (SELECT TOP 1 code &quot;
			+ &quot; FROM   compliance_servicetypeenum &quot;
			+ &quot; WHERE  id = esl.servicetype)        AS ServiceType, &quot;
			+ &quot; esl.entitytype, &quot;
			+ &quot; esl.eventid, &quot;
			+ &quot; esl.summary, &quot;
			+ &quot; esl.status                           AS EventServiceStatus, &quot;
			+ &quot; esl.updatedby                        AS EventServiceUpdatedBy, &quot;
			+ &quot; esl.updatedon                        AS EventServiceUpdatedOn &quot;
			+ &quot; FROM   (SELECT pyi.* &quot;
			+ &quot; FROM   paymentin pyi &quot;
			+ &quot; WHERE  id = ?) AS pyi &quot;
			+ &quot; LEFT JOIN organization org &quot;
			+ &quot; ON pyi.organizationid = org.id &quot;
			+ &quot; LEFT JOIN paymentinattribute pia &quot;
			+ &quot; ON pia.id = pyi.id &quot;
			+ &quot; LEFT JOIN contact co &quot;
			+ &quot; ON co.id = pyi.contactid &quot;
			+ &quot; LEFT JOIN contactattribute coa &quot;
			+ &quot; ON coa.id = pyi.contactid &quot;
			+ &quot; LEFT JOIN account acc &quot;
			+ &quot; ON acc.id = pyi.accountid &quot;
			+ &quot; LEFT JOIN accountattribute accAttrib &quot;
			+ &quot; ON accAttrib.id = pyi.accountid &quot;
			+ &quot; LEFT JOIN eventservicelog esl &quot;
			+ &quot; ON esl.id IN (SELECT ESL.id AS logid &quot;
			+ &quot; FROM   [eventservicelog] ESL &quot;
			+ &quot; JOIN event EV &quot;
			+ &quot; ON ESL.eventid = EV.id &quot;
			+ &quot; AND EV.paymentoutid IS NULL &quot;
			+ &quot; WHERE  EV.paymentinid = ?) &quot;
			+ &quot; LEFT JOIN userresourcelock ur &quot;
			+ &quot; ON pyi.id = ur.resourceid &quot;
			+ &quot; AND ur.lockreleasedon IS NULL &quot;
			+ &quot; AND ur.resourcetype = 'PAYMENT_IN' &quot;
			+ &quot; ORDER  BY esl.servicetype, &quot;
			+ &quot; ESL.updatedon DESC&quot;),
	
<span class="fc" id="L474">	 GET_PAYMNETIN_REPORT_WHOLE_DATA( &quot;select rc.* &quot;</span>
				+ &quot;from( {INNER_QUERY}&quot;
				+ &quot; )as pqueue2 )as rc&quot;
				);
	
	
	private String query;

<span class="fc" id="L482">	PaymentInReportQueryConstant(String query) {</span>
<span class="fc" id="L483">		this.query = query;</span>

<span class="fc" id="L485">	}</span>

	public String getQuery() {
<span class="fc" id="L488">		return this.query;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>