<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentInUpdateTransformer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.transformer</a> &gt; <span class="el_source">PaymentInUpdateTransformer.java</span></div><h1>PaymentInUpdateTransformer.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.transformer;

import java.sql.Timestamp;
import java.util.ArrayList;

import org.springframework.stereotype.Component;

import com.currenciesdirect.gtg.compliance.core.ITransform;
import com.currenciesdirect.gtg.compliance.commons.domain.activity.ActivityTemplateEnum;
import com.currenciesdirect.gtg.compliance.commons.domain.activity.ActivityType;
import com.currenciesdirect.gtg.compliance.commons.domain.activity.PaymentInActivityLogDetailDto;
import com.currenciesdirect.gtg.compliance.commons.domain.activity.PaymentInActivityLogDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentin.PaymentInUpdateDBDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentin.PaymentInUpdateRequest;
import com.currenciesdirect.gtg.compliance.dbport.enums.PaymentComplianceStatus;
import com.currenciesdirect.gtg.compliance.dbport.enums.ServiceStatusEnum;
import com.currenciesdirect.gtg.compliance.util.StringUtils;


@Component(&quot;paymentInUpdateTransformer&quot;)
<span class="fc" id="L21">public class PaymentInUpdateTransformer extends BaseUpdateTransformer implements ITransform&lt;PaymentInUpdateDBDto, PaymentInUpdateRequest&gt; {</span>

	@Override
	public PaymentInUpdateDBDto transform(PaymentInUpdateRequest request) {
		
<span class="fc" id="L26">		PaymentInUpdateDBDto paymentInUpdateDBDto = new PaymentInUpdateDBDto();</span>
<span class="fc" id="L27">		paymentInUpdateDBDto.setAccountId(request.getAccountId());</span>
<span class="fc" id="L28">		paymentInUpdateDBDto.setContactId(request.getContactId());</span>
<span class="fc" id="L29">		paymentInUpdateDBDto.setAccountSfId(request.getAccountSfId());</span>
<span class="fc" id="L30">		paymentInUpdateDBDto.setContactSfId(request.getContactSfId());</span>
<span class="fc" id="L31">		paymentInUpdateDBDto.setPaymentInId(request.getPaymentinId());</span>
<span class="fc" id="L32">		paymentInUpdateDBDto.setOrgCode(request.getOrgCode());</span>
<span class="fc" id="L33">		paymentInUpdateDBDto.setComment(request.getComment());</span>
<span class="fc" id="L34">		paymentInUpdateDBDto.setCreatedBy(getUserName(request));</span>
<span class="pc bpc" id="L35" title="1 of 2 branches missed.">		paymentInUpdateDBDto.setOverallPaymentInWatchlistStatus(Boolean.TRUE.equals(request.getOverallWatchlistStatus()) ? ServiceStatusEnum.PASS : ServiceStatusEnum.FAIL);</span>
<span class="fc" id="L36">		paymentInUpdateDBDto.setAddWatchlist(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L37">		paymentInUpdateDBDto.setDeletedWatchlist(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L38">		paymentInUpdateDBDto.setPreviousReason(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L39">		paymentInUpdateDBDto.setAddReasons(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L40">		paymentInUpdateDBDto.setDeletedReasons(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L41">		paymentInUpdateDBDto.setActivityLogs(new ArrayList&lt;PaymentInActivityLogDto&gt;());</span>
<span class="fc" id="L42">		paymentInUpdateDBDto.setTradeContactid(request.getTradeContactId());</span>
<span class="fc" id="L43">		paymentInUpdateDBDto.setTradeContractnumber(request.getTradeContractNumber());</span>
<span class="fc" id="L44">		paymentInUpdateDBDto.setTradePaymentid(request.getTradePaymentId());</span>
<span class="fc" id="L45">		paymentInUpdateDBDto.setWatchlist(request.getWatchlist());</span>
<span class="fc" id="L46">		paymentInUpdateDBDto.setCustType(request.getCustType());</span>
<span class="fc" id="L47">		paymentInUpdateDBDto.setIsPaymentOnQueue(getPaymentQueueStatus(request));</span>
<span class="fc" id="L48">		paymentInUpdateDBDto.setIsRequestFromQueue(request.getIsOnQueue());</span>
<span class="fc" id="L49">		paymentInUpdateDBDto.setFragusterEventServiceLogId(request.getFragusterEventServiceLogId());</span>
<span class="fc" id="L50">		paymentInUpdateDBDto.setUserResourceId(request.getUserResourceId());</span>
		
<span class="fc" id="L52">		handleWatchlistUpdateRequest(request.getWatchlist(), paymentInUpdateDBDto.getAddWatchlist(), //common</span>
<span class="fc" id="L53">				paymentInUpdateDBDto.getDeletedWatchlist());</span>
<span class="fc" id="L54">		handlePaymentStatusReasonUpdateRequest(request.getStatusReasons(), paymentInUpdateDBDto.getAddReasons(), //common</span>
<span class="fc" id="L55">				paymentInUpdateDBDto.getDeletedReasons(),paymentInUpdateDBDto.getPreviousReason());</span>
<span class="fc" id="L56">		paymentInUpdateDBDto.setPaymentInStatus(</span>
<span class="fc" id="L57">				handlePaymentInStatusRequest(request.getPrePaymentInStatus(), request.getUpdatedPaymentInStatus())); //common</span>
<span class="fc" id="L58">		PaymentInActivityLogDto contactStatusActivity = getPaymentInStatusUpdateActivityLog(request, paymentInUpdateDBDto);//this is different functionality.while all above are common functionality</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">		if (contactStatusActivity != null) {</span>
<span class="nc" id="L60">			paymentInUpdateDBDto.getActivityLogs().add(contactStatusActivity);</span>
		}
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">		if(contactStatusActivity==null)</span>
		{
<span class="fc" id="L64">			PaymentInActivityLogDto addCommentActivity =getAddCommentActivityLog(request);</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">			if(addCommentActivity!=null) {</span>
<span class="fc" id="L66">				paymentInUpdateDBDto.getActivityLogs().add(addCommentActivity);</span>
			}
		}
<span class="fc" id="L69">		return paymentInUpdateDBDto;</span>
	}

	private Boolean getPaymentQueueStatus(PaymentInUpdateRequest request) {
		
		Boolean isOnQueue;
		
<span class="pc bpc" id="L76" title="1 of 2 branches missed.">		if(Boolean.TRUE.equals(request.getIsOnQueue())){</span>
<span class="pc bpc" id="L77" title="1 of 2 branches missed.">			if(request.getUpdatedPaymentInStatus().equalsIgnoreCase(PaymentComplianceStatus.SEIZE.name())</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">					|| request.getUpdatedPaymentInStatus().equalsIgnoreCase(PaymentComplianceStatus.CLEAR.name())</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">					|| request.getUpdatedPaymentInStatus().equalsIgnoreCase(PaymentComplianceStatus.REJECT.name())</span>
<span class="pc bpc" id="L80" title="1 of 2 branches missed.">					|| !StringUtils.isNullOrEmpty(request.getComment())){</span>
<span class="fc" id="L81">				isOnQueue=Boolean.FALSE;</span>
			}else{
<span class="nc" id="L83">				isOnQueue=Boolean.TRUE;</span>
			}
		}else{
<span class="nc" id="L86">				isOnQueue=Boolean.FALSE;</span>
		}
<span class="fc" id="L88">		return isOnQueue;</span>
	}

	/**
	 * @param prePaymentInStatus
	 * @param updatedPaymentInStatus
	 * @return updatedPaymentInStatus
	 */
	private String handlePaymentInStatusRequest(String prePaymentInStatus, String updatedPaymentInStatus) {
	
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">		if (updatedPaymentInStatus == null) {</span>
<span class="nc" id="L99">			return null;</span>
		}

<span class="pc bpc" id="L102" title="2 of 4 branches missed.">		if (prePaymentInStatus != null &amp;&amp; prePaymentInStatus.equals(updatedPaymentInStatus)) {</span>
<span class="fc" id="L103">			return null;</span>
		}
<span class="nc" id="L105">		return updatedPaymentInStatus;</span>
	}

	private PaymentInActivityLogDto getPaymentInStatusUpdateActivityLog(PaymentInUpdateRequest request,PaymentInUpdateDBDto paymentInUpdateDBDto) {
<span class="fc" id="L109">		String log = getActivityLogsForPaymentInStatus(request.getPrePaymentInStatus(), paymentInUpdateDBDto.getPaymentInStatus());</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">		if (log != null) {</span>
<span class="nc" id="L111">			return getPaymentInActivityLog(request, log, ActivityType.PAYMENT_IN_STATUS_UPDATE);</span>
		}
<span class="fc" id="L113">		return null;</span>
	}

	private PaymentInActivityLogDto getPaymentInActivityLog(PaymentInUpdateRequest request, String log,ActivityType paymentInActivityUpdate) {
		
<span class="fc" id="L118">		PaymentInActivityLogDto activityLogDto = new PaymentInActivityLogDto();</span>
<span class="fc" id="L119">		activityLogDto.setAccountId(request.getAccountId());</span>
<span class="fc" id="L120">		activityLogDto.setPaymentInId(request.getPaymentinId());</span>
<span class="fc" id="L121">		activityLogDto.setOrgCode(request.getOrgCode());</span>
<span class="fc" id="L122">		activityLogDto.setComment(request.getComment());</span>
<span class="fc" id="L123">		activityLogDto.setActivityBy(getUserName(request));</span>
<span class="fc" id="L124">		activityLogDto.setCreatedBy(getUserName(request));</span>
<span class="fc" id="L125">		activityLogDto.setUpdatedBy(getUserName(request));</span>
<span class="fc" id="L126">		Timestamp timestamp = new Timestamp(System.currentTimeMillis());</span>
<span class="fc" id="L127">		activityLogDto.setCreatedOn(timestamp);</span>
<span class="fc" id="L128">		activityLogDto.setTimeStatmp(timestamp);</span>
<span class="fc" id="L129">		activityLogDto.setUpdatedOn(timestamp);</span>
<span class="fc" id="L130">		PaymentInActivityLogDetailDto activityLogDetailDto = new PaymentInActivityLogDetailDto();</span>
<span class="fc" id="L131">		activityLogDto.setActivityLogDetailDto(activityLogDetailDto);</span>
<span class="fc" id="L132">		activityLogDetailDto.setActivityType(paymentInActivityUpdate);</span>
<span class="fc" id="L133">		activityLogDetailDto.setLog(log);</span>
<span class="fc" id="L134">		activityLogDetailDto.setCreatedBy(getUserName(request));</span>
<span class="fc" id="L135">		activityLogDetailDto.setUpdatedBy(getUserName(request));</span>
<span class="fc" id="L136">		activityLogDetailDto.setCreatedOn(timestamp);</span>
<span class="fc" id="L137">		activityLogDetailDto.setUpdatedOn(timestamp);</span>
<span class="fc" id="L138">		return activityLogDto;</span>
	}

	private String getActivityLogsForPaymentInStatus(String prePaymentInStatus, String updatePaymentInStatus) {
<span class="fc" id="L142">		String updatePaymentOutFormat = null;</span>
<span class="pc bpc" id="L143" title="1 of 2 branches missed.">		if (updatePaymentInStatus != null) {</span>
<span class="nc" id="L144">			updatePaymentOutFormat = ActivityTemplateEnum.PAYMENT_IN_STATUS.getTemplate();</span>
<span class="nc" id="L145">			updatePaymentOutFormat = updatePaymentOutFormat.replace(&quot;{PRE_STATUS}&quot;, prePaymentInStatus).replace(&quot;{UPDATED_STATUS}&quot;,updatePaymentInStatus);</span>
		}
<span class="fc" id="L147">		return updatePaymentOutFormat;</span>
	}
	
	/**added by neelesh pant*/
	private PaymentInActivityLogDto getAddCommentActivityLog(PaymentInUpdateRequest request)
	{
<span class="fc" id="L153">		String log=getActivitiesLogsForAddComment(request.getComment());</span>
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">		if(log!=null)</span>
		{
<span class="fc" id="L156">			return getPaymentInActivityLog(request, log,ActivityType.PAYMENT_IN_ADD_COMMENT);</span>
		}
<span class="nc" id="L158">		return null;</span>
	}
	/**added by neelesh pant*/
	
	private String getActivitiesLogsForAddComment(String comment)
	{
<span class="fc" id="L164">		String updateContactFormat = null;</span>
<span class="pc bpc" id="L165" title="1 of 2 branches missed.">		if(comment!=null)</span>
<span class="fc" id="L166">		 updateContactFormat=ActivityTemplateEnum.ADD_COMMENT.getTemplate();</span>
		
<span class="fc" id="L168">		return updateContactFormat;</span>
			
		    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>