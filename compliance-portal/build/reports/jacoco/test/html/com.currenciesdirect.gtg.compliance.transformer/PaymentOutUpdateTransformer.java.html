<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentOutUpdateTransformer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.transformer</a> &gt; <span class="el_source">PaymentOutUpdateTransformer.java</span></div><h1>PaymentOutUpdateTransformer.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.transformer;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import org.springframework.stereotype.Component;

import com.currenciesdirect.gtg.compliance.core.ITransform;
import com.currenciesdirect.gtg.compliance.commons.domain.activity.ActivityTemplateEnum;
import com.currenciesdirect.gtg.compliance.commons.domain.activity.ActivityType;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutActivityLogDetailDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutActivityLogDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutUpdateDBDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutUpdateRequest;
import com.currenciesdirect.gtg.compliance.dbport.enums.PaymentComplianceStatus;
import com.currenciesdirect.gtg.compliance.dbport.enums.ServiceStatusEnum;
import com.currenciesdirect.gtg.compliance.util.StringUtils;

/**
 * The Class RegUpdateTransformer.
 */
@Component(&quot;paymentOutUpdateTransformer&quot;)
<span class="fc" id="L25">public class PaymentOutUpdateTransformer extends BaseUpdateTransformer implements ITransform&lt;PaymentOutUpdateDBDto, PaymentOutUpdateRequest&gt; {</span>

	public static final String PRE_WATCHLIST = &quot;{PRE_WATCHLIST}&quot;;
	public static final String CURRENT_WATCHLIST = &quot;{CURRENT_WATCHLIST}&quot;;

	@Override
	public PaymentOutUpdateDBDto transform(PaymentOutUpdateRequest request) {
<span class="fc" id="L32">		PaymentOutUpdateDBDto requestHandler = new PaymentOutUpdateDBDto();</span>
<span class="fc" id="L33">		requestHandler.setAccountId(request.getAccountId());</span>
<span class="fc" id="L34">		requestHandler.setContactId(request.getContactId());</span>
<span class="fc" id="L35">		requestHandler.setAccountSfId(request.getAccountSfId());</span>
<span class="fc" id="L36">		requestHandler.setContactSfId(request.getContactSfId());</span>
<span class="fc" id="L37">		requestHandler.setPaymentOutId(request.getPaymentOutId());</span>
<span class="fc" id="L38">		requestHandler.setOrgCode(request.getOrgCode());</span>
<span class="fc" id="L39">		requestHandler.setComment(request.getComment());</span>
<span class="fc" id="L40">		requestHandler.setCreatedBy(getUserName(request));</span>
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">		requestHandler.setOverallPaymentOutWatchlistStatus(Boolean.TRUE.equals(request.getOverallWatchlistStatus()) ? ServiceStatusEnum.PASS : ServiceStatusEnum.FAIL);</span>
<span class="fc" id="L42">		requestHandler.setAddWatchlist(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L43">		requestHandler.setDeletedWatchlist(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L44">		requestHandler.setPreviousReason(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L45">		requestHandler.setAddReasons(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L46">		requestHandler.setDeletedReasons(new ArrayList&lt;String&gt;());</span>
<span class="fc" id="L47">		requestHandler.setActivityLogs(new ArrayList&lt;PaymentOutActivityLogDto&gt;());</span>
<span class="fc" id="L48">		requestHandler.setTradeBeneficiayId(request.getTradeBeneficiayId());</span>
<span class="fc" id="L49">		requestHandler.setTradeContactid(request.getTradeContactId());</span>
<span class="fc" id="L50">		requestHandler.setTradeContractnumber(request.getTradeContractNumber());</span>
<span class="fc" id="L51">		requestHandler.setTradePaymentid(request.getTradePaymentId());</span>
<span class="fc" id="L52">		requestHandler.setWatchlist(request.getWatchlist());</span>
<span class="fc" id="L53">		requestHandler.setCustType(request.getCustType());</span>
<span class="fc" id="L54">		requestHandler.setIsPaymentOnQueue(getPaymentQueueStatus(request));</span>
<span class="fc" id="L55">		requestHandler.setIsRequestFromQueue(request.getIsOnQueue());</span>
<span class="fc" id="L56">		requestHandler.setFragusterEventServiceLogId(request.getFragusterEventServiceLogId());</span>
<span class="fc" id="L57">		requestHandler.setUserResourceId(request.getUserResourceId());</span>
		
<span class="fc" id="L59">		handleWatchlistUpdateRequest(request.getWatchlist(), requestHandler.getAddWatchlist(), //common</span>
<span class="fc" id="L60">				requestHandler.getDeletedWatchlist());</span>
<span class="fc" id="L61">		handlePaymentStatusReasonUpdateRequest(request.getStatusReasons(), requestHandler.getAddReasons(), //common</span>
<span class="fc" id="L62">				requestHandler.getDeletedReasons(),requestHandler.getPreviousReason());</span>
		
<span class="fc" id="L64">		requestHandler.setPaymentOutStatus(</span>
<span class="fc" id="L65">				handlePaymentOutStatusRequest(request.getPrePaymentOutStatus(), request.getUpdatedPaymentOutStatus())); //common</span>
<span class="fc" id="L66">		PaymentOutActivityLogDto contactStatusActivity = getPaymentOutStatusUpdateActivityLog(request, requestHandler);//this is different functionality.while all above are common functionality</span>
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">		if (contactStatusActivity != null) {</span>
<span class="nc" id="L68">			requestHandler.getActivityLogs().add(contactStatusActivity);</span>
		}
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">		if(contactStatusActivity == null){</span>
<span class="fc" id="L71">			PaymentOutActivityLogDto addCommentActivity =getAddCommentActivityLog(request);</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">			if(addCommentActivity!=null)</span>
<span class="fc" id="L73">				requestHandler.getActivityLogs().add(addCommentActivity);	</span>
		                }
<span class="fc" id="L75">		return requestHandler;</span>
	}

	private Boolean getPaymentQueueStatus(PaymentOutUpdateRequest request) {
		
		Boolean isOnQueue;
		
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">		if(Boolean.TRUE.equals(request.getIsOnQueue())){</span>
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">			if(request.getUpdatedPaymentOutStatus().equalsIgnoreCase(PaymentComplianceStatus.SEIZE.name())</span>
<span class="pc bpc" id="L84" title="1 of 2 branches missed.">					|| request.getUpdatedPaymentOutStatus().equalsIgnoreCase(PaymentComplianceStatus.CLEAR.name())</span>
<span class="pc bpc" id="L85" title="1 of 2 branches missed.">					|| request.getUpdatedPaymentOutStatus().equalsIgnoreCase(PaymentComplianceStatus.REJECT.name())</span>
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">					|| !StringUtils.isNullOrEmpty(request.getComment())){</span>
<span class="fc" id="L87">				isOnQueue=Boolean.FALSE;</span>
			}else{
<span class="nc" id="L89">				isOnQueue=Boolean.TRUE;</span>
			}
		}else{
<span class="nc" id="L92">				isOnQueue=Boolean.FALSE;</span>
		}
<span class="fc" id="L94">		return isOnQueue;</span>
	}

	/**
	 * Handle contact status request.
	 *
	 * @param preStatus
	 *            the pre status
	 * @param updatedStatus
	 *            the updated status
	 * @return the string
	 */
	private String handlePaymentOutStatusRequest(String preStatus, String updatedStatus) {

<span class="pc bpc" id="L108" title="1 of 2 branches missed.">		if (updatedStatus == null) {</span>
<span class="nc" id="L109">			return null;</span>
		}

<span class="pc bpc" id="L112" title="2 of 4 branches missed.">		if (preStatus != null &amp;&amp; preStatus.equals(updatedStatus)) {</span>
<span class="fc" id="L113">			return null;</span>
		}
<span class="nc" id="L115">		return updatedStatus;</span>
	}


	/**
	 * Gets the profile contact status update activity log.
	 *
	 * @param request
	 *            the request
	 * @param requestHandler
	 *            the request handler
	 * @return the profile contact status update activity log
	 */
	private PaymentOutActivityLogDto getPaymentOutStatusUpdateActivityLog(PaymentOutUpdateRequest request,
			PaymentOutUpdateDBDto requestHandler) {
<span class="fc" id="L130">		String log = getActivityLogsForPaymentOutStaus(request.getPrePaymentOutStatus(), requestHandler.getPaymentOutStatus());</span>
<span class="pc bpc" id="L131" title="1 of 2 branches missed.">		if (log != null) {</span>
<span class="nc" id="L132">			return getPaymentOutActivityLog(request, log, ActivityType.PAYMENT_OUT_STATUS_UPDATE);</span>
		}
<span class="fc" id="L134">		return null;</span>
	}

	/**
	 * Gets the profile activity log.
	 *
	 * @param request
	 *            the request
	 * @param log
	 *            the log
	 * @param activityType
	 *            the activity type
	 * @return the profile activity log
	 */
	private PaymentOutActivityLogDto getPaymentOutActivityLog(PaymentOutUpdateRequest request, String log,
			ActivityType activityType) {

<span class="fc" id="L151">		PaymentOutActivityLogDto activityLogDto = new PaymentOutActivityLogDto();</span>
<span class="fc" id="L152">		activityLogDto.setAccountId(request.getAccountId());</span>
<span class="fc" id="L153">		activityLogDto.setPaymentOutId(request.getPaymentOutId());</span>
<span class="fc" id="L154">		activityLogDto.setOrgCode(request.getOrgCode());</span>
<span class="fc" id="L155">		activityLogDto.setComment(request.getComment());</span>
<span class="fc" id="L156">		activityLogDto.setActivityBy(getUserName(request));</span>
<span class="fc" id="L157">		activityLogDto.setCreatedBy(getUserName(request));</span>
<span class="fc" id="L158">		activityLogDto.setUpdatedBy(getUserName(request));</span>
<span class="fc" id="L159">		Timestamp timestamp = new Timestamp(System.currentTimeMillis());</span>
<span class="fc" id="L160">		activityLogDto.setCreatedOn(timestamp);</span>
<span class="fc" id="L161">		activityLogDto.setTimeStatmp(timestamp);</span>
<span class="fc" id="L162">		activityLogDto.setUpdatedOn(timestamp);</span>
<span class="fc" id="L163">		PaymentOutActivityLogDetailDto activityLogDetailDto = new PaymentOutActivityLogDetailDto();</span>
<span class="fc" id="L164">		activityLogDto.setActivityLogDetailDto(activityLogDetailDto);</span>
<span class="fc" id="L165">		activityLogDetailDto.setActivityType(activityType);</span>
<span class="fc" id="L166">		activityLogDetailDto.setLog(log);</span>
<span class="fc" id="L167">		activityLogDetailDto.setCreatedBy(getUserName(request));</span>
<span class="fc" id="L168">		activityLogDetailDto.setUpdatedBy(getUserName(request));</span>
<span class="fc" id="L169">		activityLogDetailDto.setCreatedOn(timestamp);</span>
<span class="fc" id="L170">		activityLogDetailDto.setUpdatedOn(timestamp);</span>
<span class="fc" id="L171">		return activityLogDto;</span>
	}

	/**
	 * Gets the activity logs for deleted watchlist.
	 *
	 * @param preWatchlist
	 *            the pre watchlist
	 * @param deletedWatchlistList
	 *            the deleted watchlist list
	 * @return the activity logs for deleted watchlist
	 */
	public static String getActivityLogsForDeletedWatchlist(String preWatchlist, List&lt;String&gt; deletedWatchlistList) {
<span class="nc" id="L184">		ArrayList&lt;String&gt; arrayList = new ArrayList&lt;&gt;(Arrays.asList(preWatchlist.split(&quot;,&quot;)));</span>
<span class="nc" id="L185">		ArrayList&lt;String&gt; current = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">		for (String s : arrayList) {</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">			if (!deletedWatchlistList.contains(s)) {</span>
<span class="nc" id="L188">				current.add(s);</span>
			}
<span class="nc" id="L190">		}</span>
<span class="nc" id="L191">		String currents = current.toString();</span>
<span class="nc" id="L192">		currents = currents.substring(1, currents.length() - 1).replace(&quot;, &quot;, &quot;,&quot;);</span>
<span class="nc" id="L193">		return ActivityTemplateEnum.WATHCLIST.getTemplate().replace(PRE_WATCHLIST, preWatchlist)</span>
<span class="nc" id="L194">				.replace(CURRENT_WATCHLIST, currents);</span>
	}

	/**
	 * Gets the activity logs for contact staus.
	 *
	 * @param preStatus
	 *            the pre status
	 * @param updateStatus
	 *            the update status
	 * @return the activity logs for contact staus
	 */
	private String getActivityLogsForPaymentOutStaus(String preStatus, String updateStatus) {
<span class="fc" id="L207">		String updatePaymentOutFormat = null;</span>
<span class="pc bpc" id="L208" title="1 of 2 branches missed.">		if (updateStatus != null) {</span>
<span class="nc" id="L209">			updatePaymentOutFormat = ActivityTemplateEnum.PAYMENT_OUT_STATUS.getTemplate();</span>
<span class="nc" id="L210">			updatePaymentOutFormat = updatePaymentOutFormat.replace(&quot;{PRE_STATUS}&quot;, preStatus).replace(&quot;{UPDATED_STATUS}&quot;,</span>
					updateStatus);
		}
<span class="fc" id="L213">		return updatePaymentOutFormat;</span>
	}
	
	//added By Neelesh 
		private PaymentOutActivityLogDto getAddCommentActivityLog(PaymentOutUpdateRequest request)
		{
<span class="fc" id="L219">			String log=getActivitiesLogsForAddComment(request.getComment());</span>
<span class="pc bpc" id="L220" title="1 of 2 branches missed.">			if(log!=null)</span>
			{
<span class="fc" id="L222">				return getPaymentOutActivityLog(request, log,ActivityType.PAYMENT_OUT_ADD_COMMENT);</span>
			}
<span class="nc" id="L224">			return null;</span>
		}
		
		//added by neelesh pant
		private String getActivitiesLogsForAddComment(String comment)
		{
<span class="fc" id="L230">			String updateContactFormat = null;</span>
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">			if(comment!=null)</span>
<span class="fc" id="L232">			 updateContactFormat=ActivityTemplateEnum.ADD_COMMENT.getTemplate();</span>
			
<span class="fc" id="L234">			return updateContactFormat;</span>
				
			    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>