<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractRegistrationTransformer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.transformer</a> &gt; <span class="el_source">AbstractRegistrationTransformer.java</span></div><h1>AbstractRegistrationTransformer.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.transformer;

import java.util.ArrayList;
import java.util.List;
import java.util.TreeMap;

import com.currenciesdirect.gtg.compliance.core.domain.Blacklist;
import com.currenciesdirect.gtg.compliance.core.domain.Constants;
import com.currenciesdirect.gtg.compliance.core.domain.RegistrationContact;
import com.currenciesdirect.gtg.compliance.core.domain.WatchListData;
import com.currenciesdirect.gtg.compliance.core.domain.Watchlist;
import com.currenciesdirect.gtg.compliance.core.domain.internalrule.BlacklistSummary;
import com.currenciesdirect.gtg.compliance.commons.enums.LegalEntityEnum;

<span class="fc" id="L15">public abstract class AbstractRegistrationTransformer  {</span>
	
	protected void setBlacklistPassAndFailCount(Blacklist blacklist) {
<span class="fc" id="L18">		Integer passCount = 0;</span>
<span class="fc" id="L19">		Integer failCount = 0;</span>
		
<span class="fc bfc" id="L21" title="All 2 branches covered.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getName())) {</span>
<span class="fc" id="L22">			passCount++;</span>
<span class="pc bpc" id="L23" title="1 of 2 branches missed.">		} else if (Constants.TRUE.equalsIgnoreCase(blacklist.getName())) {</span>
<span class="fc" id="L24">			failCount++;</span>
		}
<span class="fc bfc" id="L26" title="All 2 branches covered.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getEmail())) {</span>
<span class="fc" id="L27">			passCount++;</span>
<span class="pc bpc" id="L28" title="1 of 2 branches missed.">		} else if(Constants.TRUE.equalsIgnoreCase(blacklist.getEmail())) {</span>
<span class="nc" id="L29">			failCount++;</span>
		}
		/**
		 * Condition changed by Vishal J to get PASS count or FAIL count of IP check
		 * */
<span class="fc bfc" id="L34" title="All 2 branches covered.">		if(Constants.FALSE.equalsIgnoreCase(blacklist.getIp())) {</span>
<span class="fc" id="L35">			passCount++;</span>
<span class="pc bpc" id="L36" title="1 of 2 branches missed.">		} else if(Constants.TRUE.equalsIgnoreCase(blacklist.getIp())) {</span>
<span class="nc" id="L37">			failCount++;</span>
		}
		
<span class="fc bfc" id="L40" title="All 2 branches covered.">		if (Boolean.TRUE.equals(blacklist.getPhone())) {</span>
<span class="fc" id="L41">			passCount++;</span>
		} else {
<span class="fc" id="L43">			failCount++;</span>
		}
		/**removed count of status because it is not necessary to consider 'overall status' count while showing
		indicator to resolve AT-338 by Vishal J*/
		
		/**
		 * Added by Saylee B to show count according to domain check
		 * */
<span class="pc bpc" id="L51" title="1 of 2 branches missed.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getDomain())) {</span>
<span class="fc" id="L52">			passCount++;</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">		} else if (Constants.TRUE.equalsIgnoreCase(blacklist.getDomain())) {</span>
<span class="nc" id="L54">			failCount++;</span>
		}
		

<span class="fc" id="L58">		blacklist.setPassCount(passCount);</span>
<span class="fc" id="L59">		blacklist.setFailCount(failCount);</span>
<span class="fc" id="L60">	}</span>
	
	protected void setBlacklistAccountPassAndFailCount(Blacklist blacklist) {
<span class="fc" id="L63">		Integer passCount = 0;</span>
<span class="fc" id="L64">		Integer failCount = 0;</span>
		
<span class="pc bpc" id="L66" title="1 of 2 branches missed.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getName())) {</span>
<span class="fc" id="L67">			passCount++;</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">		} else if (Constants.TRUE.equalsIgnoreCase(blacklist.getName())) {</span>
<span class="nc" id="L69">			failCount++;</span>
		}
<span class="pc bpc" id="L71" title="1 of 2 branches missed.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getWebSite())) {</span>
<span class="fc" id="L72">			passCount++;</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">		} else if (Constants.TRUE.equalsIgnoreCase(blacklist.getWebSite())) {</span>
<span class="nc" id="L74">			failCount++;</span>
		}
		/**removed count of status because it is not necessary to consider 'overall status' count while showing
		indicator to resolve AT-338 by Vishal J*/
		
<span class="fc" id="L79">		blacklist.setPassCount(passCount);</span>
<span class="fc" id="L80">		blacklist.setFailCount(failCount);</span>
<span class="fc" id="L81">	}</span>
	
	/**
	 * 1)Method added by Vishal J to show PASS count or FAIL count for Blacklist check (CFX Registration)
	 *   of entity type 'CONTACT'
	 * 2)For 'CONTACT' we need to check its IP, EMAIL, and PHONE 
	 *   so we are setting count from their response.
	 * */
	protected void setBlacklistContactPassAndFailCount(Blacklist blacklist) {
<span class="nc" id="L90">		Integer passCount = 0;</span>
<span class="nc" id="L91">		Integer failCount = 0;</span>
		
<span class="nc bnc" id="L93" title="All 2 branches missed.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getEmail())) {</span>
<span class="nc" id="L94">			passCount++;</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">		} else if(Constants.TRUE.equalsIgnoreCase(blacklist.getEmail())) {</span>
<span class="nc" id="L96">			failCount++;</span>
		}
		/**Method added to get Name count to resolve AT-322 by Vishal J*/
<span class="nc bnc" id="L99" title="All 2 branches missed.">		if (Constants.FALSE.equalsIgnoreCase(blacklist.getName())) {</span>
<span class="nc" id="L100">			passCount++;</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">		} else if (Constants.TRUE.equalsIgnoreCase(blacklist.getName())) {</span>
<span class="nc" id="L102">			failCount++;</span>
		}	
<span class="nc bnc" id="L104" title="All 2 branches missed.">		if (Boolean.TRUE.equals(blacklist.getPhone())) {</span>
<span class="nc" id="L105">			passCount++;</span>
		} else {
<span class="nc" id="L107">			failCount++;</span>
		}
		/**
		 * Removed count of overall status when showing passcount or failcount on blacklist check 
		 * to resolve AT-338 by Vishal J
		 * */
				
<span class="nc" id="L114">		blacklist.setPassCount(passCount);</span>
<span class="nc" id="L115">		blacklist.setFailCount(failCount);</span>
<span class="nc" id="L116">	}</span>
	//new method end
	
	// KYC is supported for 18 countries, so for rest, desable repeat check button
	// Same is applicable for E4F and CDSA orgs as well.
	// AT-3327 added one more condition for Legal Entity
	protected Boolean checkIsKycSupportedCountry(String country, List&lt;String&gt; kycSupportedCountryList, String orgName, String legalEntity) {
<span class="fc" id="L123">		boolean repeatButtonDisable = false;</span>
		
<span class="fc bfc" id="L125" title="All 2 branches covered.">		for (String kycSupportedCountry : kycSupportedCountryList) {</span>
<span class="pc bpc" id="L126" title="1 of 2 branches missed.">			if (country.equalsIgnoreCase(kycSupportedCountry)) {</span>
<span class="nc" id="L127">				repeatButtonDisable = true;</span>
			}
<span class="fc" id="L129">		}</span>
<span class="pc bpc" id="L130" title="2 of 4 branches missed.">		if(Constants.CD_SA.equals(orgName)|| Constants.E4F.equals(orgName) </span>
<span class="fc bfc" id="L131" title="All 2 branches covered.">				|| LegalEntityEnum.CDLEU.getLECode().equals(legalEntity)</span>
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">				|| LegalEntityEnum.FCGEU.getLECode().equals(legalEntity)</span>
<span class="pc bpc" id="L133" title="1 of 2 branches missed.">				|| LegalEntityEnum.TOREU.getLECode().equals(legalEntity)</span>
<span class="pc bpc" id="L134" title="1 of 2 branches missed.">				|| LegalEntityEnum.TORSG.getLECode().equals(legalEntity)) { // AT-4157 - For TORSG</span>
<span class="fc" id="L135">			repeatButtonDisable = false;</span>
		}
<span class="fc" id="L137">		return repeatButtonDisable;</span>
	}
	
	/**
	 * this function gives complete address as per input fields
	 * @author abhijeetg
	 * @param regContact
	 * @return
	 */
	protected String getCompleteAddress(RegistrationContact regContact) {
<span class="fc" id="L147">		List&lt;String&gt; list=new ArrayList&lt;&gt;();</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getAddress1())){</span>
<span class="fc" id="L149">			list.add(regContact.getAddress1());</span>
		}
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getUnitNumber())){</span>
<span class="nc" id="L152">			list.add(regContact.getUnitNumber());</span>
		}
<span class="fc bfc" id="L154" title="All 2 branches covered.">		if(!isNullOrEmpty(regContact.getStreetNumber())){</span>
<span class="fc" id="L155">			list.add(regContact.getStreetNumber());</span>
		}
<span class="pc bpc" id="L157" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getAreaNumber())){</span>
<span class="nc" id="L158">			list.add(regContact.getAreaNumber());</span>
		}
<span class="pc bpc" id="L160" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getCivicNumber())){</span>
<span class="nc" id="L161">			list.add(regContact.getCivicNumber());</span>
		}
<span class="pc bpc" id="L163" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getDistrict())){</span>
<span class="nc" id="L164">			list.add(regContact.getDistrict());</span>
		}
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getState())){</span>
<span class="fc" id="L167">			list.add(regContact.getState());</span>
		}
<span class="fc bfc" id="L169" title="All 2 branches covered.">		if(!isNullOrEmpty(regContact.getCity())){</span>
<span class="fc" id="L170">			list.add(regContact.getCity());	</span>
		}
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getPostCode())){</span>
<span class="fc" id="L173">			list.add(regContact.getPostCode());</span>
		}
<span class="pc bpc" id="L175" title="1 of 2 branches missed.">		if(!isNullOrEmpty(regContact.getCountry())){</span>
<span class="fc" id="L176">			list.add(regContact.getCountry());</span>
		}
<span class="fc" id="L178">		return String.join(&quot;, &quot;, list);</span>
	}

	protected static boolean isNullOrEmpty(String str) {
<span class="fc" id="L182">		boolean result = true;</span>
<span class="fc bfc" id="L183" title="All 4 branches covered.">		if (str != null &amp;&amp; !str.trim().isEmpty())</span>
<span class="fc" id="L184">			return false;</span>

<span class="fc" id="L186">		return result;</span>
	}
	
	protected void setBlacklistedMatchedData(BlacklistSummary blacklistSummary ,Blacklist blacklist){
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">		if(null != blacklistSummary ){</span>
<span class="fc" id="L191">			blacklist.setAccNumberMatchedData(blacklistSummary.getAccNumberMatchedData());</span>
<span class="fc" id="L192">			blacklist.setDomainMatchedData(blacklistSummary.getDomainMatchedData());</span>
<span class="fc" id="L193">			blacklist.setEmailMatchedData(blacklistSummary.getEmailMatchedData());</span>
<span class="fc" id="L194">			blacklist.setIpMatchedData(blacklistSummary.getIpMatchedData());</span>
<span class="fc" id="L195">			blacklist.setNameMatchedData(blacklistSummary.getNameMatchedData());</span>
<span class="fc" id="L196">			blacklist.setPhoneMatchedData(blacklistSummary.getPhoneMatchedData());</span>
<span class="fc" id="L197">			blacklist.setWebsiteMatchedData(blacklistSummary.getWebsiteMatchedData());</span>
		}
		
<span class="fc" id="L200">	}</span>
	
	protected Watchlist deleteDuplicateWatclist(Watchlist watchList) { //same function is present
<span class="fc" id="L203">		TreeMap&lt;String, WatchListData&gt; reasonMap = new TreeMap&lt;&gt;();</span>
<span class="fc" id="L204">		ArrayList&lt;WatchListData&gt; watchListDataList = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L206" title="All 2 branches covered.">		for (WatchListData watch : watchList.getWatchlistData()) {</span>
<span class="fc" id="L207">			reasonMap.put(watch.getName(), watch);</span>
<span class="fc" id="L208">		}</span>
<span class="fc" id="L209">		watchListDataList.addAll(reasonMap.values());</span>
<span class="fc" id="L210">		watchList.setWatchlistData(watchListDataList);</span>
<span class="fc" id="L211">		return watchList;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>