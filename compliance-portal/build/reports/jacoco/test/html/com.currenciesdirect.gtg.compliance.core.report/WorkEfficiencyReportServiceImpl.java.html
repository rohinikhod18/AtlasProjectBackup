<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WorkEfficiencyReportServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.core.report</a> &gt; <span class="el_source">WorkEfficiencyReportServiceImpl.java</span></div><h1>WorkEfficiencyReportServiceImpl.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.core.report;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Date;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Component;

import com.currenciesdirect.gtg.compliance.core.domain.report.WorkEfficiencyReportDto;
import com.currenciesdirect.gtg.compliance.core.domain.report.WorkEfficiencyReportFilter;
import com.currenciesdirect.gtg.compliance.core.domain.report.WorkEfficiencyReportSearchCriteria;
import com.currenciesdirect.gtg.compliance.exception.CompliancePortalException;
import com.currenciesdirect.gtg.compliance.util.SearchCriteriaUtil;

/**
 * The Class WorkEfficiencyReportServiceImpl.
 */
@Component(&quot;workEfficiencyReportServiceImpl&quot;)
<span class="fc" id="L26">public class WorkEfficiencyReportServiceImpl implements IWorkEfficiencyReportService{</span>

	/** The log. */
<span class="fc" id="L29">	private Logger log = LoggerFactory.getLogger(WorkEfficiencyReportServiceImpl.class);</span>
	
	/** The i work efficiency report DB service. */
	@Autowired
	@Qualifier(&quot;workEfficiencyReportDBServiceImpl&quot;)
	private IWorkEfficiencyReportDBService iWorkEfficiencyReportDBService;
	
	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.core.IWorkEfficiencyReportService#getWorkEfficiencyReport()
	 */
	@Override
	public WorkEfficiencyReportDto getWorkEfficiencyReport() throws CompliancePortalException{
<span class="nc" id="L41">		WorkEfficiencyReportSearchCriteria searchCriteria = new WorkEfficiencyReportSearchCriteria();</span>
<span class="nc" id="L42">		WorkEfficiencyReportFilter workEfficiencyReportFilter = new WorkEfficiencyReportFilter();</span>
<span class="nc" id="L43">		WorkEfficiencyReportDto workEfficiencyReportDto = new WorkEfficiencyReportDto();</span>
		try {
<span class="nc" id="L45">			String fromTo = null;</span>
<span class="nc" id="L46">			String dateFrom = null;</span>
<span class="nc" id="L47">			fromTo = getFromTo(fromTo);</span>
<span class="nc" id="L48">			dateFrom = getDateFrom(dateFrom);</span>
<span class="nc" id="L49">			workEfficiencyReportFilter.setFromTo(fromTo);</span>
<span class="nc" id="L50">			workEfficiencyReportFilter.setDateFrom(dateFrom);</span>
			
<span class="nc" id="L52">			Integer dateDifference=dateDifferenceInWorkEfficiencyReport(fromTo,dateFrom);</span>
			
<span class="nc" id="L54">			searchCriteria.setFilter(workEfficiencyReportFilter);</span>
<span class="nc" id="L55">			workEfficiencyReportDto = iWorkEfficiencyReportDBService.getWorkEfficiencyReport(searchCriteria);</span>
<span class="nc" id="L56">			workEfficiencyReportDto.setDateDifference(dateDifference);</span>
<span class="nc" id="L57">		    return workEfficiencyReportDto;</span>
<span class="nc" id="L58">		}catch(CompliancePortalException e){</span>
<span class="nc" id="L59">			log.error(&quot;{1}&quot;,e);</span>
<span class="nc" id="L60">			throw e;</span>
		}
		
		
	}
	
	/**
	 * Date difference in work efficiency report.
	 *
	 * @param to the to
	 * @param from the from
	 * @return the integer
	 */
	//This method is added to resolve sonar issue
	public Integer dateDifferenceInWorkEfficiencyReport(String to, String from) 
	{
<span class="nc" id="L76">		        Integer dateDifference = 0;</span>
		        try {
<span class="nc" id="L78">	                      dateDifference = getDateDifference(to,from); </span>
                 }
<span class="nc" id="L80">		        catch (ParseException e) {</span>
<span class="nc" id="L81">					log.error(&quot;Exception in getWorkEfficiencyReport() in WorkEfficiencyReportServiceImpl {1} &quot;,  e);</span>
<span class="nc" id="L82">				}</span>
<span class="nc" id="L83">		        return dateDifference;	</span>
     }
	
	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.core.IWorkEfficiencyReportService#getWorkEfficiencyReportWithCriteria(com.currenciesdirect.gtg.compliance.core.domain.report.WorkEfficiencyReportSearchCriteria)
	 */
	@Override
	public WorkEfficiencyReportDto getWorkEfficiencyReportWithCriteria(WorkEfficiencyReportSearchCriteria searchCriteria) throws CompliancePortalException{
<span class="nc" id="L91">		WorkEfficiencyReportDto workEfficiencyReportDto = new WorkEfficiencyReportDto();</span>
		try {
<span class="nc" id="L93">			String fromTo = getFromTo(searchCriteria.getFilter().getFromTo()); //currentDate</span>
<span class="nc" id="L94">			String dateFrom = getDateFrom(searchCriteria.getFilter().getDateFrom()); //pastdate</span>
<span class="nc" id="L95">			searchCriteria.getFilter().setFromTo(fromTo);</span>
<span class="nc" id="L96">			searchCriteria.getFilter().setDateFrom(dateFrom);</span>
			
<span class="nc" id="L98">			Integer dateDifference=dateDifferenceInWorkEfficiencyReport(fromTo,dateFrom);</span>
			
<span class="nc bnc" id="L100" title="All 6 branches missed.">			if(searchCriteria.getFilter().getQueueType() == null || searchCriteria.getFilter().getQueueType().length == 0  || Arrays.asList(searchCriteria.getFilter().getQueueType()).contains(&quot;All&quot;)){</span>
<span class="nc" id="L101">				workEfficiencyReportDto = iWorkEfficiencyReportDBService.getWorkEfficiencyReport(searchCriteria);</span>
			}else {
<span class="nc" id="L103">				workEfficiencyReportDto = iWorkEfficiencyReportDBService.getWorkEfficiencyReportWithCriteria(searchCriteria);</span>
			}
<span class="nc" id="L105">			workEfficiencyReportDto.setDateDifference(dateDifference);</span>
			
<span class="nc" id="L107">		return workEfficiencyReportDto;</span>
<span class="nc" id="L108">		}catch(CompliancePortalException e){</span>
<span class="nc" id="L109">			log.error(&quot;{1}&quot;,e);</span>
<span class="nc" id="L110">			throw e;</span>
		}
	}
	
	/**
	 * Gets the date from.
	 *
	 * @param dateFrom the date from
	 * @return the date from
	 */
	public String getDateFrom(String dateFrom){
<span class="fc" id="L121">		Integer pastDateSize = SearchCriteriaUtil.getPastDateSize();</span>
<span class="fc" id="L122">		SimpleDateFormat dt = new SimpleDateFormat(&quot;yyyy-MM-dd 00:00:00&quot;); </span>
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">		if (dateFrom != null ) {</span>
<span class="nc" id="L124">			return dateFrom;</span>
		}else {
<span class="fc" id="L126">			Calendar cal = Calendar.getInstance();</span>
<span class="fc" id="L127">			cal.add(Calendar.DATE, pastDateSize);</span>
<span class="fc" id="L128">			Date pastDate  =cal.getTime();</span>
<span class="fc" id="L129">			return dt.format(pastDate);</span>
		}
	}
	
	/**
	 * Gets the from to.
	 *
	 * @param fromTo the from to
	 * @return the from to
	 */
	public String getFromTo(String fromTo){
<span class="fc" id="L140">		SimpleDateFormat dt = new SimpleDateFormat(&quot;yyyy-MM-dd 23:59:59&quot;); </span>
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">		if (fromTo != null) {</span>
<span class="nc" id="L142">			return fromTo;</span>
		}else {
<span class="fc" id="L144">			Calendar cal = Calendar.getInstance();</span>
<span class="fc" id="L145">			Date currentDate  =cal.getTime();</span>
<span class="fc" id="L146">			return dt.format(currentDate);</span>
		}
	}
	
	/**
	 * Gets the date difference.
	 *
	 * @param fromTo the from to
	 * @param dateFrom the date from
	 * @return the date difference
	 * @throws ParseException the parse exception
	 */
	public static Integer getDateDifference(String fromTo,String dateFrom) throws ParseException{
		  
		Date convertedDate1 ;
		Date convertedDate2 ;
<span class="nc bnc" id="L162" title="All 2 branches missed.">		if (fromTo.contains(&quot;-&quot;)) {</span>
<span class="nc" id="L163">			DateFormat formatter =new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);</span>
<span class="nc" id="L164">	        convertedDate1 = formatter.parse(fromTo);</span>
<span class="nc" id="L165">	        convertedDate2 = formatter.parse(dateFrom);</span>
		
<span class="nc" id="L167">		} else {</span>
<span class="nc" id="L168">		     DateFormat formatter =new SimpleDateFormat(&quot;dd/MM/yyyy&quot;);</span>
<span class="nc" id="L169">	         convertedDate1 = formatter.parse(fromTo);</span>
<span class="nc" id="L170">	         convertedDate2 = formatter.parse(dateFrom);</span>
		}

<span class="nc" id="L173">        return daysBetween(convertedDate2 , convertedDate1);</span>
	}
	
	/**
	 * Days between.
	 *
	 * @param d1 the d 1
	 * @param d2 the d 2
	 * @return the int
	 */
	public static int daysBetween(Date d1, Date d2){
<span class="nc" id="L184">        return (int)( (d2.getTime() - d1.getTime()) / (1000 * 60 * 60 * 24));</span>
    }
	
	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.core.report.IWorkEfficiencyReportService#getWorkEfficiencyReportInExcelFormat()
	 */
	@Override
	public WorkEfficiencyReportDto getWorkEfficiencyReportInExcelFormat() throws CompliancePortalException{
<span class="nc" id="L192">		WorkEfficiencyReportSearchCriteria searchCriteriaForExcel = new WorkEfficiencyReportSearchCriteria();</span>
<span class="nc" id="L193">		WorkEfficiencyReportFilter workEfficiencyReportFilterForExcel = new WorkEfficiencyReportFilter();</span>
<span class="nc" id="L194">		WorkEfficiencyReportDto workEfficiencyReportDtoForExcel = new WorkEfficiencyReportDto();</span>
		try {
<span class="nc" id="L196">			String fromToForExcel = null;</span>
<span class="nc" id="L197">			String dateFromForExcel = null;</span>
<span class="nc" id="L198">			fromToForExcel = getFromTo(fromToForExcel);</span>
<span class="nc" id="L199">			dateFromForExcel = getDateFrom(dateFromForExcel);</span>
<span class="nc" id="L200">			workEfficiencyReportFilterForExcel.setFromTo(fromToForExcel);</span>
<span class="nc" id="L201">			workEfficiencyReportFilterForExcel.setDateFrom(dateFromForExcel);</span>
			
<span class="nc" id="L203">			Integer dateDifference=dateDifferenceInWorkEfficiencyReport(fromToForExcel,dateFromForExcel);</span>
			
<span class="nc" id="L205">			searchCriteriaForExcel.setFilter(workEfficiencyReportFilterForExcel);</span>
<span class="nc" id="L206">			workEfficiencyReportDtoForExcel = iWorkEfficiencyReportDBService.getWorkEfficiencyReportInExcelFormat(searchCriteriaForExcel);</span>
<span class="nc" id="L207">			workEfficiencyReportDtoForExcel.setDateDifference(dateDifference);</span>
<span class="nc" id="L208">		    return workEfficiencyReportDtoForExcel;</span>
<span class="nc" id="L209">		}catch(CompliancePortalException e){</span>
<span class="nc" id="L210">			log.error(&quot;{1}&quot;,e);</span>
<span class="nc" id="L211">			throw e;</span>
		}
	}
	
	/* (non-Javadoc)
	 * @see com.currenciesdirect.gtg.compliance.core.report.IWorkEfficiencyReportService#getWorkEfficiencyReportWithCriteriaInExcelFormat(com.currenciesdirect.gtg.compliance.core.domain.report.WorkEfficiencyReportSearchCriteria)
	 */
	@Override
	public WorkEfficiencyReportDto getWorkEfficiencyReportWithCriteriaInExcelFormat(WorkEfficiencyReportSearchCriteria searchCriteria) throws CompliancePortalException{
<span class="nc" id="L220">		WorkEfficiencyReportDto workEfficiencyReportDto = new WorkEfficiencyReportDto();</span>
		try {
<span class="nc" id="L222">			String fromTo = getFromTo(searchCriteria.getFilter().getFromTo()); //currentDate</span>
<span class="nc" id="L223">			String dateFrom = getDateFrom(searchCriteria.getFilter().getDateFrom()); //pastdate</span>
<span class="nc" id="L224">			searchCriteria.getFilter().setFromTo(fromTo);</span>
<span class="nc" id="L225">			searchCriteria.getFilter().setDateFrom(dateFrom);</span>
			
<span class="nc" id="L227">			Integer dateDifference=dateDifferenceInWorkEfficiencyReport(fromTo,dateFrom);</span>
			
<span class="nc bnc" id="L229" title="All 6 branches missed.">			if(searchCriteria.getFilter().getQueueType() == null || searchCriteria.getFilter().getQueueType().length == 0  || Arrays.asList(searchCriteria.getFilter().getQueueType()).contains(&quot;All&quot;)){</span>
<span class="nc" id="L230">				workEfficiencyReportDto = iWorkEfficiencyReportDBService.getWorkEfficiencyReportInExcelFormat(searchCriteria);</span>
			}else {
<span class="nc" id="L232">				workEfficiencyReportDto = iWorkEfficiencyReportDBService.getWorkEfficiencyReportWithCriteriaInExcelFormat(searchCriteria);</span>
			}
<span class="nc" id="L234">			workEfficiencyReportDto.setDateDifference(dateDifference);</span>
			
<span class="nc" id="L236">		return workEfficiencyReportDto;</span>
<span class="nc" id="L237">		}catch(CompliancePortalException e){</span>
<span class="nc" id="L238">			log.error(&quot;{1}&quot;,e);</span>
<span class="nc" id="L239">			throw e;</span>
		}
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>