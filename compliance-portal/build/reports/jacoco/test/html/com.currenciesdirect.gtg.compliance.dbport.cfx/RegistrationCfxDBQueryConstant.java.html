<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RegistrationCfxDBQueryConstant.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.dbport.cfx</a> &gt; <span class="el_source">RegistrationCfxDBQueryConstant.java</span></div><h1>RegistrationCfxDBQueryConstant.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.dbport.cfx;

/**
 * The Enum DBQueryConstant.
 *
 * @author Rajesh
 */
<span class="fc" id="L8">public enum RegistrationCfxDBQueryConstant {</span>

<span class="fc" id="L10">	GET_CFX_REGISTRATION_DETAILS_WITH_EVENT(&quot;SELECT &quot;</span>
			+ &quot; cr.ID, &quot;
			+ &quot; conStatus.Status as ContactComplianceStatus, &quot;
			+ &quot; accStatus.Status as AccountComplianceStatus, &quot; 
			+ &quot; cr.name, &quot;
			+ &quot; cr.AccountID AS AccountId, &quot;
			+ &quot; cr.CRMContactID, &quot;
			+ &quot; cr.TradeContactID, &quot;
			+ &quot; cr.complianceDoneOn As RegComplete, &quot;
			+ &quot; cr.createdOn AS RegIn, &quot;
			+ &quot; coun.DisplayName as countryFullName, &quot;
			+ &quot; acc.ComplianceDoneOn AS RegCompleteAcc, &quot;
			+ &quot; acc.CreatedOn AS RegistrationInDate, &quot;
			+ &quot; acc.ComplianceExpiry AS ComplianceExpiry, &quot;
			+ &quot; acc.CRMAccountID, acc.isOnQueue,&quot;
			+ &quot; acc.TradeAccountId, &quot;
			+ &quot; acc.TradeAccountNumber, &quot;
			+ &quot; acc.LegalEntity, &quot;
			+ &quot; org.code AS Organization, &quot;
			+ &quot; conAttrib.Attributes AS contactAttrib, &quot;
			+ &quot; accAttrib.Attributes AS AccountAttrib, &quot;
			+ &quot; ur.id AS userResourceLockId, &quot;
			+ &quot; Lock.ssouserid AS LockedBy, &quot;
			+ &quot; cste.code AS ServiceName, &quot;
			+ &quot; eslc.Id as EventServiceLogId, &quot;
			+ &quot; eslc.EventId as EventId, &quot;
			+ &quot; eslc.entityid, &quot;
			+ &quot; eslc.EntityType as EntityType, &quot;
			+ &quot; eslc.summary as EventSummary, &quot;
			+ &quot; eslc.Status as EventStatus, &quot;
			+ &quot; event.ssouserid AS EventUpdatedBy, &quot;
					+ &quot; eslc.updatedOn as EventUpdatedOn, &quot;
					+ &quot;    acc.DataAnonStatus     AS dataAnonStatus &quot;
			+ &quot;FROM Contact AS cr &quot;
					+ &quot; JOIN Account acc ON acc.id=cr.accountId &quot;
					+ &quot; JOIN Organization org ON org.id=cr.OrganizationID &quot;
					+ &quot; JOIN Country coun ON coun.id = cr.country &quot;
					+ &quot; JOIN ContactAttribute conAttrib ON conAttrib.ID = cr.ID &quot;
					+ &quot; JOIN AccountAttribute accAttrib ON accAttrib.ID=cr.AccountID &quot;
					+ &quot; JOIN ContactComplianceStatusEnum conStatus ON conStatus.ID=cr.ComplianceStatus &quot;
					+ &quot; LEFT JOIN Event eve ON eve.accountid=acc.id &quot;
			+ &quot; AND PaymentInID is null &quot;
			+ &quot; and PaymentOutID is null &quot;
					+ &quot; LEFT JOIN EventServiceLog eslc ON eslc.eventid=eve.id  &quot;
			+ &quot; LEFT JOIN compliance_servicetypeenum cste ON cste.id = eslc.servicetype &quot;
					+ &quot; LEFT JOIN AccountComplianceStatusEnum accStatus ON accStatus.ID=acc.ComplianceStatus &quot;
			+ &quot; LEFT JOIN UserResourceLock ur on acc.Id = ur.ResourceID  AND ur.LockReleasedOn IS NULL &quot;
			+ &quot; AND ur.ResourceType = 4 &quot;
			+ &quot; LEFT JOIN [user] Lock ON lock.id = ur.createdby &quot;
			+ &quot; LEFT JOIN [user] event ON event.id = eslc.updatedBy &quot;
			+ &quot;where acc.id = (SELECT accountid FROM Contact WHERE id = ?) AND (cr.Deleted = 0 OR cr.Deleted IS NULL)&quot;
					+ &quot; order by eslc.updatedOn desc&quot;),
	
	/*INSERT_USER_RESOURCE_LOCK_BY_ACCOUNT_ID(&quot;INSERT INTO UserResourceLock ([UserID], [ResourceType],&quot; 
			+ &quot; [ResourceID], [LockReleasedOn], [CreatedBy], [CreatedOn],[WorkflowTime]) &quot;
			+ &quot; SELECT (select Id from [user] where SSOUserID=?),?,?,?,(select Id from [user] where SSOUserID=?),?,? FROM Contact WHERE AccountId=?&quot;),*/
	
<span class="fc" id="L67">	INSERT_USER_RESOURCE_LOCK_BY_ACCOUNT_ID(&quot;INSERT INTO UserResourceLock ([UserID], [ResourceType], &quot;</span>
			+ &quot; [ResourceID], [LockReleasedOn], [CreatedBy], [CreatedOn],[WorkflowTime]) VALUES &quot;
			+ &quot;((select Id from [user] where SSOUserID= ?), &quot;
			+ &quot;?,?,?,(select Id from [user] where SSOUserID= ?) &quot;
			+ &quot;,?,?)&quot;),
				
<span class="fc" id="L73">	UPDATE_USER_RESOURCE_LOCK_BY_ACCOUNT_ID(</span>
			&quot;UPDATE [UserResourceLock] SET LockReleasedOn= ? &quot; 
			+ &quot;WHERE ResourceID IN (select ID from Account where ID=?) and LockReleasedOn is null&quot;),
	
<span class="fc" id="L77">	GET_RECORDLOCK_STATUS_BY_ACCOUNT_ID(&quot;select * from UserResourceLock  where ResourceID IN(select ID FROM Account WHERE ID=?) and ResourceType=? and LockReleasedOn is null&quot;),</span>
	
<span class="fc" id="L79">	GET_ACTIVITY_LOGS_OF_ACCOUNT_ID(&quot;SELECT (SELECT name FROM contact WHERE id=pal.contactid) As ContactName,&quot;</span>
			+ &quot;(SELECT name FROM account WHERE id=pal.AccountID) As AccountName,pal.contactId,(select SSOUserId from [user] where ID=pal.ActivityBy) As [User],&quot;
			+ &quot;pal.CreatedOn, pald.Log As [Activity], ate.module+' '+ate.type As [ActivityType], pal.Comments AS [Comment] &quot;
			+ &quot; FROM ProfileActivityLog  pal JOIN ProfileActivityLogDetail pald ON pal.id=pald.ActivityId AND pal.AccountID =?&quot;
			+ &quot; JOIN ActivityTypeEnum ate ON pald.ActivityType=ate.id ORDER BY pal.CreatedOn DESC&quot;),
	
<span class="fc" id="L85">	GET_PROFILE_STATUS_REASON_BY_ACCOUNT_ID(&quot;SELECT sur.Reason , ISNULL(psr.ContactID,-1) AS ContactID FROM StatusUpdateReason sur &quot;</span>
			+&quot; LEFT JOIN ProfileStatusReason psr ON psr.StatusUpdateReasonID=sur.id AND  psr.ContactID IN (SELECT ID FROM CONTACT WHERE AccountID=?) &quot;
			+&quot;WHERE  sur.Module IN ('CONTACT','ALL') order by sur.Reason&quot;),
	
<span class="fc" id="L89">	INSERT_WATCHLIST_BY_ACCOUNT_ID(&quot;INSERT INTO [ContactWatchList] ( [Reason], [Contact], [CreatedBy], [CreatedOn] ) &quot; </span>
			+ &quot;select (SELECT  [Id] FROM [Watchlist] WHERE Reason = ?), ID,(select Id from [user] where SSOUserID=?) , ? FROM CONTACT where AccountId=?&quot;),
	
<span class="fc" id="L92">	INSERT_REASON_ACCOUNT_ID(&quot; INSERT INTO [ProfileStatusReason] ([OrganizationID], [AccountID], [ContactID], [StatusUpdateReasonID], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn])&quot;</span>
			+ &quot;select (SELECT Id FROM Organization WHERE Code=?),?,ID,(SELECT Id FROM StatusUpdateReason WHERE Module IN ('CONTACT','ALL') AND Reason=?),(select Id from [user] where SSOUserID=?),?,(select Id from [user] where SSOUserID=?),? FROM CONTACT where AccountId=?&quot;),
	
<span class="fc" id="L95">	UPDATE_ACCOUNT_STATUS(</span>
			&quot;UPDATE [Account] SET ComplianceStatus=(SELECT Id FROM ContactComplianceStatusEnum WHERE Status=?), AccountStatus= ? , ComplianceDoneOn = ? , ComplianceExpiry = ? , isOnQueue= ? WHERE Id=?&quot;),
	
<span class="fc" id="L98">	GET_CFX_PROFILE_ACTIVITY_LOGS_BY_ROWS(&quot;SELECT  ac.* FROM (SELECT  Row_number() over (ORDER BY pal.createdon desc) AS rownum,(select SSOUserId from [user] where ID=pal.ActivityBy) AS [User], &quot;</span>
			+ &quot;pal.createdon, pald.log  AS [Activity], ate.module + ' ' + ate.type AS [ActivityType], pal.Comments AS [Comment] FROM   profileactivitylog pal &quot;
			+ &quot;JOIN profileactivitylogdetail pald  ON pal.id = pald.activityid AND pal.AccountId=? &quot; 
			+ &quot;JOIN activitytypeenum ate  ON pald.activitytype = ate.id ) as ac where rownum &gt;= ? and rownum &lt;= ?&quot;),
	
<span class="fc" id="L103">	GET_ACCOUNT_CONTACT_IDS_BY_ACCCOUNID(&quot;select top 1 c.TradeContactId, c.CRMContactID,a.CRMAccountID,a.TradeAccountID,a.TradeAccountNumber FROM Account a left join Contact c  on a.id=c.AccountID where a.id=? &quot;),</span>
	
<span class="fc" id="L105">	UPDATE_ACCOUNT_IS_ON_QUEUE_STATUS(&quot;UPDATE [Account] SET UpdatedBy=(select id  from [user] where SSOUserID=?),&quot;</span>
			+ &quot;  UpdatedOn = ? , isOnQueue= ? WHERE Id=?&quot;),
	
<span class="fc" id="L108">	UPDATE_CONTACT_STATUS(&quot;UPDATE [Contact] SET ComplianceStatus=(SELECT Id FROM ContactComplianceStatusEnum WHERE Status=?) &quot;</span>
			+&quot;WHERE AccountId=?&quot;),
	
<span class="fc" id="L111">	GET_CFX_DASHBOARD_ACCOUNT_CONTACT_DETAILS(&quot;SELECT c.ID, &quot; + </span>
			&quot; c.name, &quot; + 
			&quot; c.AccountID AS AccountId, &quot; + 
			&quot; c.CRMContactID, &quot; + 
			&quot; c.TradeContactID, &quot; + 
			&quot; c.complianceDoneOn As RegComplete, &quot; + 
			&quot; c.createdOn AS RegIn,&quot; + 
		    &quot; c.POIExists AS poiExists, &quot; +//AT-3391
			&quot; ca.[Attributes] AS contactAttrib,&quot; + 
			&quot; conStatus.Status as ContactComplianceStatus,  &quot; + 
			&quot; a.ComplianceDoneOn AS RegCompleteAcc, &quot; + 
			&quot; a.CreatedOn AS RegistrationInDate, &quot; + 
			&quot; a.ComplianceExpiry AS ComplianceExpiry, &quot; + 
			&quot; a.CRMAccountID, &quot; + 
			&quot; a.isOnQueue, &quot; + 
			&quot; a.TradeAccountId, &quot; + 
			&quot; a.TradeAccountNumber, &quot; + 
			&quot; a.LegalEntity, &quot; + 
			&quot; a.DataAnonStatus AS dataAnonStatus, &quot; + 
			&quot; a.AccountTMFlag AS accountTMFlag, &quot; +
			&quot; a.IntuitionRiskLevel AS riskLevel, &quot; + //Added for AT-4190
			&quot; a.Version AS AccountVersion, &quot; +
			&quot; aa.[Attributes] AS AccountAttrib, &quot; + 
			&quot; accStatus.Status as AccountComplianceStatus, &quot; + 
			&quot; coun.DisplayName as countryFullName, &quot; + 
			&quot; org.code AS Organization, &quot; + 
			&quot; ur.id AS userResourceLockId, &quot; + 
			&quot; usr.ssouserid AS LockedBy &quot; + 
			&quot;FROM Contact c &quot; + 
			&quot;JOIN ContactAttribute ca on ca.ID = c.ID &quot; + 
			&quot;JOIN ContactComplianceStatusEnum conStatus ON conStatus.ID = c.ComplianceStatus &quot; + 
			&quot;JOIN Account a on a.ID = c.AccountID &quot; + 
			&quot;JOIN AccountAttribute aa on aa.ID = a.ID &quot; + 
			&quot;JOIN AccountComplianceStatusEnum accStatus ON accStatus.ID = a.ComplianceStatus &quot; + 
			&quot;JOIN Organization org on org.ID = c.OrganizationID &quot; + 
			&quot;JOIN Country coun on coun.ID = c.Country &quot; + 
			&quot;LEFT JOIN UserResourceLock ur on a.Id = ur.ResourceID  AND ur.LockReleasedOn IS NULL AND ur.ResourceType = 4 &quot; + 
			&quot;LEFT JOIN [user] usr ON usr.id = ur.createdby &quot; + 
			&quot;Where a.ID = (SELECT accountid FROM Contact WHERE id = ?) AND (c.Deleted = 0 OR c.Deleted IS NULL)&quot;),
	
<span class="fc" id="L151">	GET_CFX_DASHBOARD_EVENTS_DETAILS(&quot;SELECT cste.code AS ServiceName, &quot; + </span>
			&quot; esl.Id as EventServiceLogId, &quot; + 
			&quot; esl.EventId as EventId, &quot; + 
			&quot; esl.Entityid, &quot; + 
			&quot; esl.EntityType as EntityType, &quot; + 
			&quot; esl.summary as EventSummary, &quot; + 
			&quot; esl.Status as EventStatus, &quot; + 
			&quot; esl.updatedOn as EventUpdatedOn,&quot; + 
			&quot; usr.ssouserid AS EventUpdatedBy&quot; + 
			&quot; FROM Event e &quot; + 
			&quot; Join EventServiceLog esl on esl.EventID = e.ID AND e.PaymentInID is null And e.PaymentOutID is null&quot; + 
			&quot; JOIN Compliance_ServiceTypeEnum cste on cste.ID = esl.ServiceType &quot; + 
			&quot; JOIN [User] usr on usr.ID = esl.UpdatedBy &quot; + 
			&quot; WHERE e.AccountID = ?&quot; + 
			&quot; ORDER BY esl.UpdatedOn desc&quot;);
	
	private String query;

<span class="fc" id="L169">	RegistrationCfxDBQueryConstant(String query) {</span>
<span class="fc" id="L170">		this.query = query;</span>

<span class="fc" id="L172">	}</span>

	public String getQuery() {
<span class="fc" id="L175">		return this.query;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>