<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractFilterQueryBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.dbport</a> &gt; <span class="el_source">AbstractFilterQueryBuilder.java</span></div><h1>AbstractFilterQueryBuilder.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.dbport;

import com.currenciesdirect.gtg.compliance.core.domain.KeywordConstants;

/**
 * The Class AbstractFilterQueryBuilder.
 */
public abstract class AbstractFilterQueryBuilder implements FilterQueryBuilder {

	/** The criteria builder. */
	private CriteriaBuilder criteriaBuilder;

	/**
	 * Instantiates a new abstract filter query builder.
	 */

	/**
	 * Adds the filer.
	 */
	protected abstract void addFilter();

	/**
	 * Instantiates a new abstract filter query builder.
	 *
	 * @param query the query
	 */
<span class="nc" id="L27">	public AbstractFilterQueryBuilder(String query) {</span>
<span class="nc" id="L28">		criteriaBuilder = new CriteriaBuilder(query);</span>
<span class="nc" id="L29">	}</span>

<span class="fc" id="L31">	public AbstractFilterQueryBuilder(String query, boolean addWhereCluase) {</span>
<span class="fc" id="L32">		criteriaBuilder = new CriteriaBuilder(query, addWhereCluase);</span>
<span class="fc" id="L33">	}</span>

	/**
	 * Adds the in criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addInCriteria(String field, String[] value, String conditionType) {
<span class="fc" id="L43">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.IN);</span>
<span class="fc" id="L44">	}</span>

	/**
	 * Adds the in criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addInCriteriaWithBracket(String field, String[] value, String conditionType) {
<span class="nc" id="L54">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.IN_WITH_BRACKET);</span>
<span class="nc" id="L55">	}</span>

	protected void addNotInCriteria(String field, String[] value, String conditionType) {
<span class="fc" id="L58">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_IN);</span>
<span class="fc" id="L59">	}</span>

	protected void addNotEqualCriteria2(String field, String value, String conditionType) {
<span class="nc" id="L62">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_EQUAL_2);</span>
<span class="nc" id="L63">	}</span>

	protected void addNotEqualCriteria3(String field, String value, String conditionType) {
<span class="nc" id="L66">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_EQUAL_3);</span>
<span class="nc" id="L67">	}</span>
	
	//Added for AT-4850
	protected void addNotEqualCriteria4(String field, String value, String conditionType) {
<span class="nc" id="L71">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_EQUAL_4);</span>
<span class="nc" id="L72">	}</span>
	//Added for AT-4850
	protected void addNotEqualCriteria5(String field, String value, String conditionType) {
<span class="nc" id="L75">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_EQUAL_5);</span>
<span class="nc" id="L76">	}</span>

	// Added for AT-4850
	protected void addNotEqualCriteria6(String field, String value, String conditionType) {
<span class="nc" id="L80">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_EQUAL_6);</span>
<span class="nc" id="L81">	}</span>

	
	// Added for AT-4850
	protected void addEqualCriteria1(String field, String value, String conditionType) {
<span class="nc" id="L86">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.EQUAL1);</span>
<span class="nc" id="L87">	}</span>
	
	// Added for AT-4850
		protected void addEqualCriteria2(String field, String value, String conditionType) {
<span class="nc" id="L91">			criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.EQUAL2);</span>
<span class="nc" id="L92">		}</span>
	
	
	/**
	 * Adds the equal criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addEqualCriteria(String field, String value, String conditionType) {
<span class="fc" id="L103">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.EQUAL);</span>
<span class="fc" id="L104">	}</span>

	/**
	 * Adds the is null criteria.
	 *
	 * @param field         the field
	 * 
	 * @param conditionType the condition type
	 */
	protected void addISNullCriteria(String field, String conditionType) {
<span class="fc" id="L114">		criteriaBuilder.addCriteria(field, null, conditionType, ClauseType.ISNULL);</span>
<span class="fc" id="L115">	}</span>

	/**
	 * Adds the not equal criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addNotEqualCriteria(String field, String value, String conditionType) {
<span class="nc" id="L125">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.NOT_EQUAL);</span>
<span class="nc" id="L126">	}</span>

	/**
	 * Adds the date time criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addDateTimeCriteria(String field, String value, String conditionType) {
<span class="nc" id="L136">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.DATETIME);</span>
<span class="nc" id="L137">	}</span>

	/**
	 * Adds the date time criteria.
	 *
	 * @param field         the field
	 * @param value1        the value 1
	 * @param value2        the value 2
	 * @param replaceString the replace string
	 */
	protected void addDateTimeCriteria(String field, String value1, String value2, String replaceString,
			Boolean isFilterAppy) {
<span class="nc bnc" id="L149" title="All 8 branches missed.">		if (value1 != null &amp;&amp; value2 != null &amp;&amp; !value1.isEmpty() &amp;&amp; !value2.isEmpty()) {</span>

<span class="nc" id="L151">			criteriaBuilder.addDateTimeCriteria(field, value1, value2, ClauseType.DATETIME, replaceString);</span>

<span class="nc bnc" id="L153" title="All 4 branches missed.">		} else if (value1 != null &amp;&amp; !value1.isEmpty()) {</span>

<span class="nc" id="L155">			criteriaBuilder.addDateTimeCriteria(field, value1, null, ClauseType.GREATER_EQUAL, replaceString);</span>

<span class="nc bnc" id="L157" title="All 4 branches missed.">		} else if (value2 != null &amp;&amp; !value2.isEmpty()) {</span>

<span class="nc" id="L159">			criteriaBuilder.addDateTimeCriteria(field, null, value2, ClauseType.LESS_EQUAL, replaceString);</span>

		} else {
<span class="nc" id="L162">			addDateTimeCriteriaIfNoFilterApplied(field, value1, value2, replaceString, isFilterAppy);</span>
		}
<span class="nc" id="L164">	}</span>

	private void addDateTimeCriteriaIfNoFilterApplied(String field, String value1, String value2, String replaceString,
			Boolean isFilterAppy) {
<span class="nc bnc" id="L168" title="All 6 branches missed.">		if (Boolean.FALSE.equals(isFilterAppy) &amp;&amp; value1 == null &amp;&amp; value2 == null) {</span>

<span class="nc" id="L170">			criteriaBuilder.addDateTimeCriteria(field, null, null, null, replaceString);</span>

		} else {
<span class="nc" id="L173">			criteriaBuilder.removeDateTimeCriteriaFromQuery(&quot;&quot;, replaceString);</span>
		}
<span class="nc" id="L175">	}</span>

	protected void addDateTimeCriteria(String field, String value1, String value2, String conditionType) {
<span class="pc bpc" id="L178" title="7 of 8 branches missed.">		if (value1 != null &amp;&amp; value2 != null &amp;&amp; !value1.isEmpty() &amp;&amp; !value2.isEmpty()) {</span>
<span class="nc" id="L179">			addDateTimeBetweenCriteria(field, value1, value2, conditionType);</span>
<span class="pc bpc" id="L180" title="3 of 4 branches missed.">		} else if (value1 != null &amp;&amp; !value1.isEmpty()) {</span>
<span class="nc" id="L181">			criteriaBuilder.addGreaterEqualDateCriteria(field, value1, conditionType);</span>
<span class="pc bpc" id="L182" title="3 of 4 branches missed.">		} else if (value2 != null &amp;&amp; !value2.isEmpty()) {</span>
<span class="nc" id="L183">			criteriaBuilder.addLessEqualDateCriteria(field, value2, conditionType);</span>
		}
<span class="fc" id="L185">	}</span>

	/**
	 * Adds the date time between criteria.
	 *
	 * @param field         the field
	 * @param value1        the value 1
	 * @param value2        the value 2
	 * @param conditionType the condition type
	 */
	protected void addDateTimeBetweenCriteria(String field, String value1, String value2, String conditionType) {
<span class="nc" id="L196">		criteriaBuilder.addBetweenCriteria(field, conditionType, value1, value2, ClauseType.DATETIME);</span>
<span class="nc" id="L197">	}</span>

	/**
	 * Adds the between criteria.
	 *
	 * @param field         the field
	 * @param value1        the value 1
	 * @param value2        the value 2
	 * @param conditionType the condition type
	 */
	protected void addBetweenCriteria(String field, String value1, String value2, String conditionType) {
<span class="nc" id="L208">		criteriaBuilder.addBetweenCriteria(field, conditionType, value1, value2, ClauseType.BETWEEN);</span>
<span class="nc" id="L209">	}</span>

	/**
	 * Validate service status.
	 *
	 * @param status the status
	 * @return the boolean
	 */
	protected Boolean validateServiceStatus(String[] status) {
<span class="pc bpc" id="L218" title="5 of 6 branches missed.">		return status == null || status.length == 0 || status.length &gt;= 2;</span>

	}

	/**
	 * Adds the like criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addLikeCriteria(String field, String value, String conditionType) {
<span class="nc" id="L230">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.LIKE);</span>
<span class="nc" id="L231">	}</span>

	/**
	 * Adds the order by criteria.
	 *
	 * @param field the field
	 * @param value the value
	 */
	protected void addOrderByCriteria(String field, Boolean value) {
<span class="nc" id="L240">		criteriaBuilder.addOrderByCriteria(field, value);</span>
<span class="nc" id="L241">	}</span>

	/**
	 * Adds the sort.
	 *
	 * @param sort          the sort
	 * @param defaultColumn the default column
	 */
	protected void addSort(String columnName, boolean isAsc) {
<span class="nc" id="L250">		String query = criteriaBuilder.build();</span>
<span class="nc" id="L251">		String orderByCon = &quot;{ORDER_TYPE}&quot;;</span>
<span class="nc bnc" id="L252" title="All 2 branches missed.">		if (columnName != null) {</span>
<span class="nc" id="L253">			query = query.replace(&quot;{SORT_FIELD_NAME}&quot;, columnName);</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">			if (isAsc) {</span>
<span class="nc" id="L255">				query = query.replace(orderByCon, &quot;ASC&quot;);</span>
			} else {
<span class="nc" id="L257">				query = query.replace(orderByCon, &quot;DESC&quot;);</span>
			}
		}
<span class="nc" id="L260">		criteriaBuilder.setQuery(new StringBuilder(query));</span>
<span class="nc" id="L261">	}</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.currenciesdirect.gtg.compliance.dbport.FilterQueryBuilder#getQuery()
	 */
	@Override
	public String getQuery() {
<span class="fc" id="L270">		addFilter();</span>
<span class="fc" id="L271">		return this.criteriaBuilder.build();</span>
	}

	/**
	 * Adds the contains criteria. CONTAINS ({field},'NEAR( ({attribute},{value})
	 * ,{maxdistance}, {strictmatch})') AND
	 * 
	 * @return the string
	 */
	public void addContainsCriteria(String field, String attribute, String value, Integer maxDisctance,
			Boolean strictMatch, String conditionType) {
<span class="fc" id="L282">		criteriaBuilder.addContainsCriteria(field, attribute, value, maxDisctance, strictMatch, conditionType);</span>
<span class="fc" id="L283">	}</span>

	/**
	 * Adds the greater criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addGreaterCriteria(String field, String value, String conditionType) {
<span class="nc" id="L293">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.GREATER);</span>
<span class="nc" id="L294">	}</span>

	/**
	 * Adds the like for Digits criteria.
	 *
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 */
	protected void addBeforePercentLikeCriteria(String field, String value, String conditionType) {
<span class="nc" id="L304">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.BEFORE_PERCENT_LIKE);</span>
<span class="nc" id="L305">	}</span>

	protected void addPercentLikeCriteria(String field, String value, String conditionType) {
<span class="fc" id="L308">		criteriaBuilder.addCriteria(field, value, conditionType, ClauseType.LIKE_AT_ANY_POSITION);</span>
<span class="fc" id="L309">	}</span>

	/**
	 * The method parseKeyword Bussiness: 1.Check validation on keyword and parsing
	 * the default value of keyword Implementation: 1.Get the keyword from UI in any
	 * case(ie Upper or Lower),change that keyword case to lower and check that
	 * keyword is in particular format or not? 2.If that keyword matches with format
	 * then return that keyword type 3.Else return nothing
	 *
	 * @param keyword the keyword
	 * @return the string
	 */
	protected String parseKeyword(String keyword) {
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">		if (keyword.matches(KeywordConstants.REGEX_EMAIL)) {</span>
<span class="nc" id="L323">			return KeywordConstants.EMAIL;</span>
		}
<span class="pc bpc" id="L325" title="1 of 2 branches missed.">		if (keyword.matches(KeywordConstants.REGEX_CLIENT_ID_WITH_SIX_DIGITS_ONLY)) {</span>
<span class="nc" id="L326">			return KeywordConstants.CLIENT_ID_WITH_SIX_DIGITS_ONLY;</span>
		}
<span class="fc bfc" id="L328" title="All 2 branches covered.">		if (keyword.matches(KeywordConstants.REGEX_CLIENT_ID)</span>
<span class="pc bpc" id="L329" title="1 of 2 branches missed.">				|| keyword.matches(KeywordConstants.REGEX_CLIENT_ID_LEGACY)) {</span>
<span class="fc" id="L330">			return KeywordConstants.CLIENT_ID;</span>
		}
<span class="pc bpc" id="L332" title="1 of 2 branches missed.">		if (keyword.matches(KeywordConstants.REGEX_CONTRACT_NO)) {</span>
<span class="fc" id="L333">			return KeywordConstants.CONTRACT_NO;</span>
		}
<span class="nc bnc" id="L335" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_ACSF_ID)) {</span>
<span class="nc" id="L336">			return KeywordConstants.ACSF_ID;</span>
		}
<span class="nc bnc" id="L338" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_COUNTRY_OF_RESIDENCE)) {</span>
<span class="nc" id="L339">			return KeywordConstants.COUNTRY_OF_RESIDENCE;</span>
		}
<span class="nc bnc" id="L341" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_ADDRESS)) {</span>
<span class="nc" id="L342">			return KeywordConstants.ADDRESS;</span>
		}
<span class="nc bnc" id="L344" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_OCCUPATION)) {</span>
<span class="nc" id="L345">			return KeywordConstants.OCCUPATION;</span>
		}
<span class="nc bnc" id="L347" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_PAYMENT_METHOD)) {</span>
<span class="nc" id="L348">			return KeywordConstants.PAYMENT_METHOD;</span>
		}
<span class="nc bnc" id="L350" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_AMOUNT)) {</span>
<span class="nc" id="L351">			return KeywordConstants.AMOUNT;</span>
		}
<span class="nc bnc" id="L353" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_REASON_OF_TRANSFER)) {</span>
<span class="nc" id="L354">			return KeywordConstants.REASON_OF_TRANSFER;</span>
		}
<span class="nc bnc" id="L356" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_BENEFICIARY)) {</span>
<span class="nc" id="L357">			return KeywordConstants.BENEFICIARY;</span>
		}
<span class="nc bnc" id="L359" title="All 2 branches missed.">		if (keyword.toLowerCase().startsWith(KeywordConstants.REGEX_TELEPHONE)) {</span>
<span class="nc" id="L360">			return KeywordConstants.TELEPHONE;</span>
		}

<span class="nc" id="L363">		return KeywordConstants.CLIENT_NAME;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>