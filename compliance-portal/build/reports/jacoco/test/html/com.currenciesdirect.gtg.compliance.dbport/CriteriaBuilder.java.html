<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CriteriaBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.dbport</a> &gt; <span class="el_source">CriteriaBuilder.java</span></div><h1>CriteriaBuilder.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.dbport;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

import com.currenciesdirect.gtg.compliance.util.SearchCriteriaUtil;

/**
 * The Class CriteriaBuilder.
 */
public class CriteriaBuilder {

	/** The Constant FIELD. */
	private static final String FIELD = &quot;{field}&quot;;

	/** The Constant WHERE. */
	private static final String WHERE = &quot; WHERE &quot;;

	/** The Constant VALUE. */
	private static final String VALUE = &quot;{value}&quot;;

	/** The Constant ATTRIBUTE. */
	private static final String ATTRIBUTE = &quot;{attribute}&quot;;

	/** The Constant MAXDISTANCE. */
	private static final String MAXDISTANCE = &quot;{maxdistance}&quot;;

	/** The Constant STRICTMATCH. */
	private static final String STRICTMATCH = &quot;{strictmatch}&quot;;

	/** The is first condition. */
	private Boolean isFirstCondition;

	/** The query. */
	private StringBuilder query;

	/** The Constant AND. */
	public static final String AND = &quot; AND &quot;;

	/** The Constant OR. */
	public static final String OR = &quot; OR &quot;;

	/**
	 * Instantiates a new criteria builder.
	 *
	 * @param query the query
	 */
<span class="nc" id="L49">	public CriteriaBuilder(String query) {</span>
<span class="nc" id="L50">		this.query = new StringBuilder(query);</span>
<span class="nc" id="L51">		isFirstCondition = Boolean.TRUE;</span>
<span class="nc" id="L52">	}</span>

<span class="fc" id="L54">	public CriteriaBuilder(String query, boolean isFirstCondition) {</span>
<span class="fc" id="L55">		this.query = new StringBuilder(query);</span>
<span class="fc" id="L56">		this.isFirstCondition = isFirstCondition;</span>
<span class="fc" id="L57">	}</span>

	/**
	 * Adds the criteria.
	 *
	 * @param &lt;T&gt;           the generic type
	 * @param field         the field
	 * @param value         the value
	 * @param conditionType the condition type
	 * @param clauseType    the clause type
	 * @return the criteria builder
	 */
	public &lt;T&gt; CriteriaBuilder addCriteria(String field, T value, String conditionType, ClauseType clauseType) {
<span class="fc" id="L70">		String criteria = null;</span>
<span class="pc bpc" id="L71" title="16 of 21 branches missed.">		switch (clauseType) {</span>
		case EQUAL:
<span class="fc" id="L73">			criteria = addEqualCriteria(field, (String) value);</span>
<span class="fc" id="L74">			break;</span>
		case ISNULL:
<span class="fc" id="L76">			criteria = addISNullCriteria(field);</span>
<span class="fc" id="L77">			break;</span>
		case NOT_EQUAL:
<span class="nc" id="L79">			criteria = addNotEqualCriteria(field, (String) value);</span>
<span class="nc" id="L80">			break;</span>

		case NOT_EQUAL_2:
<span class="nc" id="L83">			criteria = addNotEqualCriteria2(field, (String) value);</span>
<span class="nc" id="L84">			break;</span>
		case NOT_EQUAL_3:
<span class="nc" id="L86">			criteria = addNotEqualCriteria3(field, (String) value);</span>
<span class="nc" id="L87">			break;</span>

		// Added for AT-4850
		case NOT_EQUAL_4:
<span class="nc" id="L91">			criteria = addNotEqualCriteria4(field, (String) value);</span>
<span class="nc" id="L92">			break;</span>

		// Added for AT-4850
		case NOT_EQUAL_5:
<span class="nc" id="L96">			criteria = addNotEqualCriteria5(field, (String) value);</span>
<span class="nc" id="L97">			break;</span>

		// Added for AT-4850
		case NOT_EQUAL_6:
<span class="nc" id="L101">			criteria = addNotEqualCriteria6(field, (String) value);</span>
<span class="nc" id="L102">			break;</span>

		// Added for AT-4850
		case EQUAL1:
<span class="nc" id="L106">			criteria = addEqualCriteria1(field, (String) value);</span>
<span class="nc" id="L107">			break;</span>

		// Added for AT-4850
		case EQUAL2:
<span class="nc" id="L111">			criteria = addEqualCriteria2(field, (String) value);</span>
<span class="nc" id="L112">			break;</span>

		case IN:
<span class="fc" id="L115">			criteria = addInCriteria(field, (String[]) value);</span>
<span class="fc" id="L116">			break;</span>
		case NOT_IN:
<span class="fc" id="L118">			criteria = addNotInCriteria(field, (String[]) value);</span>
<span class="fc" id="L119">			break;</span>
		case DATETIME:
<span class="nc" id="L121">			criteria = addDateTimeCriteria(field, (String) value);</span>
<span class="nc" id="L122">			break;</span>
		case LIKE:
<span class="nc" id="L124">			criteria = addLikeCriteria(field, (String) value);</span>
<span class="nc" id="L125">			break;</span>
		case LESS_EQUAL:
<span class="nc" id="L127">			criteria = addLessEqualCriteria(field, (String) value);</span>
<span class="nc" id="L128">			break;</span>
		case GREATER_EQUAL:
<span class="nc" id="L130">			criteria = addGreaterEqualCriteria(field, (String) value);</span>
<span class="nc" id="L131">			break;</span>
		case GREATER:
<span class="nc" id="L133">			criteria = addGreaterCriteria(field, (String) value);</span>
<span class="nc" id="L134">			break;</span>
		case BEFORE_PERCENT_LIKE:
<span class="nc" id="L136">			criteria = addBeforePercentLikeCriteria(field, (String) value);</span>
<span class="nc" id="L137">			break;</span>
		case IN_WITH_BRACKET:
<span class="nc" id="L139">			criteria = addInWithBracketCriteria(field, (String[]) value);</span>
<span class="nc" id="L140">			break;</span>
		case LIKE_AT_ANY_POSITION:
<span class="fc" id="L142">			criteria = addLikeCriteriaAtAnyPosition(field, (String) value);</span>
<span class="fc" id="L143">			break;</span>
		default:
			break;
		}
<span class="fc" id="L147">		addCriteriaInQuery(criteria, conditionType);</span>
<span class="fc" id="L148">		return this;</span>
	}

	/**
	 * Adds the like criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addLikeCriteria(String field, String value) {
<span class="nc bnc" id="L159" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L160">			return null;</span>
		}

<span class="nc" id="L163">		String clause = ClauseType.LIKE.getCondition();</span>
<span class="nc" id="L164">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L165">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L166">		return clause;</span>
	}

	private String addLikeCriteriaAtAnyPosition(String field, String value) {
<span class="pc bpc" id="L170" title="2 of 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L171">			return null;</span>
		}

<span class="fc" id="L174">		String clause = ClauseType.LIKE_AT_ANY_POSITION.getCondition();</span>
<span class="fc" id="L175">		clause = clause.replace(FIELD, field);</span>
<span class="fc" id="L176">		clause = clause.replace(VALUE, value);</span>
<span class="fc" id="L177">		return clause;</span>
	}

	/**
	 * Adds the criteria in query.
	 *
	 * @param criteria      the criteria
	 * @param conditionType the condition type
	 */
	private void addCriteriaInQuery(String criteria, String conditionType) {
<span class="pc bpc" id="L187" title="3 of 6 branches missed.">		if (this.query != null &amp;&amp; criteria != null &amp;&amp; criteria.isEmpty()) {</span>
<span class="nc" id="L188">			return;</span>
		}

<span class="pc bpc" id="L191" title="1 of 4 branches missed.">		if (Boolean.TRUE.equals(isFirstCondition) &amp;&amp; null != this.query) {</span>
<span class="fc" id="L192">			isFirstCondition = Boolean.FALSE;</span>
<span class="fc" id="L193">			query.append(WHERE).append(criteria);</span>
<span class="pc bpc" id="L194" title="4 of 8 branches missed.">		} else if (this.query != null &amp;&amp; criteria != null &amp;&amp; !criteria.isEmpty() &amp;&amp; conditionType != null) {</span>
<span class="fc" id="L195">			this.query.append(conditionType).append(criteria);</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">		} else if (null != this.query) {</span>
<span class="nc" id="L197">			this.query.append(&quot;  &quot;).append(criteria).append(&quot;   &quot;);</span>
		}
<span class="fc" id="L199">	}</span>

	/**
	 * Adds the date time criteria in query.
	 *
	 * @param criteria the criteria
	 */
	public void addDateTimeCriteriaInQuery(String criteria, String replaceString) {
<span class="nc bnc" id="L207" title="All 6 branches missed.">		if (this.query != null &amp;&amp; criteria != null &amp;&amp; criteria.isEmpty()) {</span>
<span class="nc" id="L208">			return;</span>
		}
<span class="nc bnc" id="L210" title="All 2 branches missed.">		if (null != this.query) {</span>
<span class="nc" id="L211">			this.query = new StringBuilder(this.query.toString().replace(replaceString, criteria));</span>
		}
<span class="nc" id="L213">	}</span>

	public void removeDateTimeCriteriaFromQuery(String criteria, String replaceString) {
<span class="nc bnc" id="L216" title="All 6 branches missed.">		if (this.query != null &amp;&amp; replaceString != null &amp;&amp; replaceString.isEmpty()) {</span>
<span class="nc" id="L217">			return;</span>
		}
<span class="nc bnc" id="L219" title="All 2 branches missed.">		if (null != this.query) {</span>
<span class="nc" id="L220">			this.query = new StringBuilder(this.query.toString().replace(replaceString, criteria));</span>
		}
<span class="nc" id="L222">	}</span>

	/**
	 * Adds the equal criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addEqualCriteria(String field, String value) {
<span class="pc bpc" id="L232" title="2 of 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L233">			return null;</span>
		}
<span class="fc" id="L235">		String clause = ClauseType.EQUAL.getCondition();</span>
<span class="fc" id="L236">		clause = clause.replace(FIELD, field);</span>
<span class="fc" id="L237">		clause = clause.replace(VALUE, value);</span>
<span class="fc" id="L238">		return clause;</span>
	}

	/**
	 * Adds the IS null criteria.
	 *
	 * @param field the field
	 * @return the string
	 */
	private String addISNullCriteria(String field) {
<span class="pc bpc" id="L248" title="1 of 2 branches missed.">		if (field != null) {</span>
<span class="fc" id="L249">			String clause = ClauseType.ISNULL.getCondition();</span>
<span class="fc" id="L250">			clause = clause.replace(FIELD, field);</span>

<span class="fc" id="L252">			return clause;</span>
		}
<span class="nc" id="L254">		return null;</span>
	}

	/**
	 * Adds the less equal criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addLessEqualCriteria(String field, String value) {
<span class="nc bnc" id="L265" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L266">			return null;</span>
		}
<span class="nc" id="L268">		String clause = ClauseType.LESS_EQUAL.getCondition();</span>
<span class="nc" id="L269">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L270">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L271">		return clause;</span>
	}

	/**
	 * Adds the greater equal criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addGreaterEqualCriteria(String field, String value) {
<span class="nc bnc" id="L282" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L283">			return null;</span>
		}
<span class="nc" id="L285">		String clause = ClauseType.GREATER_EQUAL.getCondition();</span>
<span class="nc" id="L286">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L287">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L288">		return clause;</span>
	}

	/**
	 * Adds the not equal criteria.
	 *
	 * @param field the field
	 * @param value the value(field, value)EqualCriteria
	 * @return the string
	 */
	private String addNotEqualCriteria(String field, String value) {
<span class="nc bnc" id="L299" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L300">			return null;</span>
		}
<span class="nc" id="L302">		String clause = ClauseType.NOT_EQUAL.getCondition();</span>
<span class="nc" id="L303">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L304">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L305">		return clause;</span>
	}

	private String addNotEqualCriteria2(String field, String value) {
<span class="nc bnc" id="L309" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L310">			return null;</span>
		}
<span class="nc" id="L312">		String clause = ClauseType.NOT_EQUAL_2.getCondition();</span>
<span class="nc" id="L313">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L314">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L315">		return clause;</span>
	}

	private String addNotEqualCriteria3(String field, String value) {
<span class="nc bnc" id="L319" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L320">			return null;</span>
		}
<span class="nc" id="L322">		String clause = ClauseType.NOT_EQUAL_3.getCondition();</span>
<span class="nc" id="L323">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L324">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L325">		return clause;</span>
	}

	// Added for AT-4850
	private String addNotEqualCriteria4(String field, String value) {
<span class="nc bnc" id="L330" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L331">			return null;</span>
		}
<span class="nc" id="L333">		String clause = ClauseType.NOT_EQUAL_4.getCondition();</span>
<span class="nc" id="L334">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L335">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L336">		return clause;</span>
	}

	// Added for AT-4850
	private String addNotEqualCriteria5(String field, String value) {
<span class="nc bnc" id="L341" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L342">			return null;</span>
		}
<span class="nc" id="L344">		String clause = ClauseType.NOT_EQUAL_5.getCondition();</span>
<span class="nc" id="L345">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L346">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L347">		return clause;</span>
	}

	// Added for AT-4850
	private String addNotEqualCriteria6(String field, String value) {
<span class="nc bnc" id="L352" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L353">			return null;</span>
		}
<span class="nc" id="L355">		String clause = ClauseType.NOT_EQUAL_6.getCondition();</span>
<span class="nc" id="L356">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L357">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L358">		return clause;</span>
	}

	// Added for AT-4850
	private String addEqualCriteria1(String field, String value) {
<span class="nc bnc" id="L363" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L364">			return null;</span>
		}
<span class="nc" id="L366">		String clause = ClauseType.EQUAL1.getCondition();</span>
<span class="nc" id="L367">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L368">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L369">		return clause;</span>
	}

	// Added for AT-4850
	private String addEqualCriteria2(String field, String value) {
<span class="nc bnc" id="L374" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L375">			return null;</span>
		}
<span class="nc" id="L377">		String clause = ClauseType.EQUAL2.getCondition();</span>
<span class="nc" id="L378">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L379">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L380">		return clause;</span>
	}

	/**
	 * Adds the in criteria.
	 *
	 * @param field  the field
	 * @param values the values
	 * @return the string
	 */
	private String addInCriteria(String field, String[] values) {
<span class="pc bpc" id="L391" title="2 of 4 branches missed.">		if (values == null || values.length == 0) {</span>
<span class="nc" id="L392">			return null;</span>
		}
<span class="fc" id="L394">		String value = appendAllValues(values);</span>
<span class="pc bpc" id="L395" title="2 of 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L396">			return null;</span>
		}
<span class="fc" id="L398">		String clause = ClauseType.IN.getCondition();</span>
<span class="fc" id="L399">		clause = clause.replace(FIELD, field);</span>
<span class="fc" id="L400">		clause = clause.replace(VALUE, value);</span>
<span class="fc" id="L401">		return clause;</span>
	}

	/**
	 * Adds the in criteria.
	 *
	 * @param field  the field
	 * @param values the values
	 * @return the string
	 */
	private String addInWithBracketCriteria(String field, String[] values) {
<span class="nc bnc" id="L412" title="All 4 branches missed.">		if (values == null || values.length == 0) {</span>
<span class="nc" id="L413">			return null;</span>
		}
<span class="nc" id="L415">		String value = appendAllValues(values);</span>
<span class="nc bnc" id="L416" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L417">			return null;</span>
		}
<span class="nc" id="L419">		String clause = ClauseType.IN_WITH_BRACKET.getCondition();</span>
<span class="nc" id="L420">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L421">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L422">		return clause;</span>
	}

	private String addNotInCriteria(String field, String[] values) {
<span class="pc bpc" id="L426" title="2 of 4 branches missed.">		if (values == null || values.length == 0) {</span>
<span class="nc" id="L427">			return null;</span>
		}
<span class="fc" id="L429">		String value = appendAllValues(values);</span>
<span class="pc bpc" id="L430" title="2 of 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L431">			return null;</span>
		}
<span class="fc" id="L433">		String clause = ClauseType.NOT_IN.getCondition();</span>
<span class="fc" id="L434">		clause = clause.replace(FIELD, field);</span>
<span class="fc" id="L435">		clause = clause.replace(VALUE, value);</span>
<span class="fc" id="L436">		return clause;</span>
	}

	/**
	 * Adds the date time criteria.
	 *
	 * @param field the field
	 * @param date  the date
	 * @return the string
	 */
	private String addDateTimeCriteria(String field, String date) {
<span class="nc bnc" id="L447" title="All 4 branches missed.">		if (date == null || date.isEmpty()) {</span>
<span class="nc" id="L448">			return null;</span>
		}
<span class="nc" id="L450">		String parsedate = parseDate(date);</span>
<span class="nc bnc" id="L451" title="All 2 branches missed.">		if (parsedate == null) {</span>
<span class="nc" id="L452">			return null;</span>
		}
<span class="nc" id="L454">		String clause = ClauseType.DATETIME.getCondition();</span>
<span class="nc" id="L455">		clause = clause.replace(FIELD, field).replace(VALUE, parsedate);</span>
<span class="nc" id="L456">		return clause;</span>
	}

	/**
	 * Adds the default date time criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addDefaultDateTimeCriteria(String field, String value) {
<span class="nc bnc" id="L467" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L468">			return null;</span>
		}

<span class="nc" id="L471">		String clause = ClauseType.DEFAULT_DATETIME.getCondition();</span>
<span class="nc" id="L472">		clause = clause.replace(FIELD, field).replace(VALUE, value);</span>
<span class="nc" id="L473">		return clause;</span>
	}

	/**
	 * Adds the between criteria.
	 *
	 * @param field         the field
	 * @param conditionType the condition type
	 * @param value1        the value 1
	 * @param value2        the value 2
	 * @param clauseType    the clause type
	 * @return the string
	 */
	public CriteriaBuilder addBetweenCriteria(String field, String conditionType, String value1, String value2,
			ClauseType clauseType) {
		String criteria;
<span class="nc bnc" id="L489" title="All 8 branches missed.">		if (value1 == null || value1.isEmpty() || value2 == null || value2.isEmpty()) {</span>
<span class="nc" id="L490">			return null;</span>
		}
<span class="nc bnc" id="L492" title="All 2 branches missed.">		if (clauseType == ClauseType.DATETIME) {</span>
<span class="nc" id="L493">			criteria = addBetweenForDateCriteria(field, value1, value2);</span>
		} else {
<span class="nc" id="L495">			criteria = defaultBetweenCriteria(field, value1, value2);</span>
		}

<span class="nc" id="L498">		addCriteriaInQuery(criteria, conditionType);</span>

<span class="nc" id="L500">		return this;</span>
	}

	/**
	 * Adds the between for date criteria.
	 *
	 * @param field  the field
	 * @param value1 the value 1
	 * @param value2 the value 2
	 * @return the string
	 */
	private String addBetweenForDateCriteria(String field, String value1, String value2) {
<span class="nc bnc" id="L512" title="All 8 branches missed.">		if (value1 == null || value1.isEmpty() || value2 == null || value2.isEmpty()) {</span>
<span class="nc" id="L513">			return null;</span>
		}
<span class="nc" id="L515">		String parsedate1 = parseDate(value1);</span>
<span class="nc bnc" id="L516" title="All 2 branches missed.">		if (parsedate1 == null) {</span>
<span class="nc" id="L517">			return null;</span>
		}

<span class="nc" id="L520">		String parsedate2 = parseDate(value2);</span>
<span class="nc bnc" id="L521" title="All 2 branches missed.">		if (parsedate2 == null) {</span>
<span class="nc" id="L522">			return null;</span>
		}
<span class="nc" id="L524">		return ClauseType.DATETIME_BETWEEN.getCondition().replace(FIELD, field).replace(&quot;{value1}&quot;, parsedate1)</span>
<span class="nc" id="L525">				.replace(&quot;{value2}&quot;, parsedate2);</span>

	}

	/**
	 * Default between criteria.
	 *
	 * @param field  the field
	 * @param value1 the value 1
	 * @param value2 the value 2
	 * @return the string
	 */
	private String defaultBetweenCriteria(String field, String value1, String value2) {
<span class="nc" id="L538">		return ClauseType.BETWEEN.getCondition().replace(FIELD, field).replace(&quot;{value1}&quot;, value1).replace(&quot;{value2}&quot;,</span>
				value2);
	}

	/**
	 * Append all values.
	 *
	 * @param values the values
	 * @return the string
	 */
	private String appendAllValues(String[] values) {
<span class="fc" id="L549">		StringBuilder s = new StringBuilder();</span>
<span class="fc bfc" id="L550" title="All 2 branches covered.">		for (String value : values) {</span>
<span class="pc bpc" id="L551" title="2 of 4 branches missed.">			if (value != null &amp;&amp; !value.isEmpty()) {</span>
<span class="fc" id="L552">				s.append(&quot;'&quot;).append(value).append(&quot;'&quot;).append(',');</span>
			}
		}
<span class="pc bpc" id="L555" title="1 of 2 branches missed.">		if (s.length() &gt; 1) {</span>
<span class="fc" id="L556">			s.setLength(s.length() - 1);</span>
<span class="fc" id="L557">			return s.toString();</span>
		}
<span class="nc" id="L559">		return null;</span>

	}

	/**
	 * Adds the date time criteria.
	 *
	 * @param field         the field
	 * @param value1        the value 1
	 * @param value2        the value 2
	 * @param clauseType    the clause type
	 * @param replaceString the replace string
	 * @return the criteria builder
	 */
	public CriteriaBuilder addDateTimeCriteria(String field, String value1, String value2, ClauseType clauseType,
			String replaceString) {
		String criteria;
<span class="nc bnc" id="L576" title="All 2 branches missed.">		if (ClauseType.DATETIME == clauseType) {</span>

<span class="nc" id="L578">			criteria = addBetweenForDateCriteria(field, value1, value2);</span>

<span class="nc bnc" id="L580" title="All 2 branches missed.">		} else if (ClauseType.GREATER_EQUAL == clauseType) {</span>

<span class="nc" id="L582">			criteria = getGreaterEqualDateCriteria(field, value1);</span>

<span class="nc bnc" id="L584" title="All 2 branches missed.">		} else if (ClauseType.LESS_EQUAL == clauseType) {</span>

<span class="nc" id="L586">			criteria = getLessEqualDateCriteria(field, value2);</span>

		} else {

<span class="nc" id="L590">			criteria = addDefaultDateTimeCriteria(field, &quot;-&quot; + SearchCriteriaUtil.getDefaultQueueRecordSize());</span>

		}

<span class="nc" id="L594">		addDateTimeCriteriaInQuery(criteria, replaceString);</span>

<span class="nc" id="L596">		return this;</span>
	}

	/**
	 * Builds the.
	 *
	 * @return the string
	 */
	public String build() {
<span class="pc bpc" id="L605" title="1 of 2 branches missed.">		if (this.query != null) {</span>
<span class="fc" id="L606">			return this.query.toString();</span>
		}
<span class="nc" id="L608">		return null;</span>
	}

	/**
	 * Parses the date.
	 *
	 * @param date the date
	 * @return the string
	 */
	private String parseDate(String date) {
<span class="nc" id="L618">		SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd/mm/yyyy&quot;);</span>
		Date dateO;
		try {
<span class="nc" id="L621">			dateO = sdf.parse(date);</span>
<span class="nc" id="L622">		} catch (ParseException e) {</span>
<span class="nc" id="L623">			return null;</span>
<span class="nc" id="L624">		}</span>
<span class="nc" id="L625">		sdf = new SimpleDateFormat(&quot;yyyy-mm-dd&quot;);</span>
<span class="nc" id="L626">		return sdf.format(dateO);</span>
	}

	/**
	 * Adds the between criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	public CriteriaBuilder addOrderByCriteria(String field, Boolean value) {
		String criteria;
<span class="nc bnc" id="L638" title="All 2 branches missed.">		if (value == null) {</span>
<span class="nc" id="L639">			return null;</span>
		}
<span class="nc bnc" id="L641" title="All 2 branches missed.">		if (Boolean.FALSE.equals(value)) {</span>
<span class="nc" id="L642">			criteria = ClauseType.ORDER_BY_DESC.getCondition().replace(FIELD, field);</span>
		} else {
<span class="nc" id="L644">			criteria = ClauseType.ORDER_BY_ASC.getCondition().replace(FIELD, field);</span>
		}
<span class="nc" id="L646">		this.query.append(&quot;  &quot; + criteria + &quot;   &quot;);</span>
<span class="nc" id="L647">		return this;</span>
	}

	/**
	 * Sets the query.
	 *
	 * @param query the new query
	 */
	public void setQuery(StringBuilder query) {
<span class="nc" id="L656">		this.query = query;</span>
<span class="nc" id="L657">	}</span>

	/**
	 * added to parse date into database readable format when filter is applied for
	 * (date from/registered from) - Neelesh Pant
	 */

	public String getGreaterEqualDateCriteria(String field, String value) {
<span class="nc bnc" id="L665" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L666">			return null;</span>
		}
<span class="nc" id="L668">		String parsedatefrom = parseDate(value);</span>
<span class="nc bnc" id="L669" title="All 2 branches missed.">		if (parsedatefrom == null) {</span>
<span class="nc" id="L670">			return null;</span>
		}
<span class="nc" id="L672">		return addGreaterEqualCriteria(field, parsedatefrom);</span>

	}

	public void addGreaterEqualDateCriteria(String field, String value, String conditionType) {
<span class="nc bnc" id="L677" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L678">			return;</span>
		}
<span class="nc" id="L680">		String parsedatefrom = parseDate(value);</span>
<span class="nc bnc" id="L681" title="All 2 branches missed.">		if (parsedatefrom == null) {</span>
<span class="nc" id="L682">			return;</span>
		}
<span class="nc" id="L684">		addCriteriaInQuery(addGreaterEqualCriteria(field, parsedatefrom), conditionType);</span>

<span class="nc" id="L686">	}</span>

	/**
	 * added to parse date into database readable format when filter is applied for
	 * (date to) -Neelesh Pant
	 */

	public String getLessEqualDateCriteria(String field, String value) {
<span class="nc bnc" id="L694" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L695">			return null;</span>
		}
<span class="nc" id="L697">		String parsedateto = parseDate(value);</span>
<span class="nc bnc" id="L698" title="All 2 branches missed.">		if (parsedateto == null) {</span>
<span class="nc" id="L699">			return null;</span>
		}
<span class="nc" id="L701">		return addLessEqualCriteria(field, parsedateto);</span>

	}

	public void addLessEqualDateCriteria(String field, String value, String conditionType) {
<span class="nc bnc" id="L706" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L707">			return;</span>
		}
<span class="nc" id="L709">		String parsedateto = parseDate(value);</span>
<span class="nc bnc" id="L710" title="All 2 branches missed.">		if (parsedateto == null) {</span>
<span class="nc" id="L711">			return;</span>
		}
<span class="nc" id="L713">		addCriteriaInQuery(addLessEqualCriteria(field, parsedateto), conditionType);</span>

<span class="nc" id="L715">	}</span>

	/**
	 * Adds the contains criteria. CONTAINS ({field},'NEAR( ({attribute},{value})
	 * ,{maxdistance}, {strictmatch})') AND
	 * 
	 * @return the string
	 */
	public void addContainsCriteria(String field, String attribute, String value, Integer maxDisctance,
			Boolean strictMatch, String conditionType) {
<span class="fc" id="L725">		String criteria = ClauseType.CONTAINS.getCondition().replace(FIELD, field).replace(ATTRIBUTE, attribute)</span>
<span class="fc" id="L726">				.replace(VALUE, value).replace(MAXDISTANCE, maxDisctance.toString())</span>
<span class="fc" id="L727">				.replace(STRICTMATCH, strictMatch.toString());</span>

<span class="fc" id="L729">		addCriteriaInQuery(criteria, conditionType);</span>
<span class="fc" id="L730">	}</span>

	/**
	 * Adds the greater criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addGreaterCriteria(String field, String value) {
<span class="nc bnc" id="L740" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L741">			return null;</span>
		}
<span class="nc" id="L743">		String clause = ClauseType.GREATER.getCondition();</span>
<span class="nc" id="L744">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L745">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L746">		return clause;</span>
	}

	/**
	 * Adds the like for digits (TradeAccountNumber and Contract No.) criteria.
	 *
	 * @param field the field
	 * @param value the value
	 * @return the string
	 */
	private String addBeforePercentLikeCriteria(String field, String value) {
<span class="nc bnc" id="L757" title="All 4 branches missed.">		if (value == null || value.isEmpty()) {</span>
<span class="nc" id="L758">			return null;</span>
		}

<span class="nc" id="L761">		String clause = ClauseType.BEFORE_PERCENT_LIKE.getCondition();</span>
<span class="nc" id="L762">		clause = clause.replace(FIELD, field);</span>
<span class="nc" id="L763">		clause = clause.replace(VALUE, value);</span>
<span class="nc" id="L764">		return clause;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>