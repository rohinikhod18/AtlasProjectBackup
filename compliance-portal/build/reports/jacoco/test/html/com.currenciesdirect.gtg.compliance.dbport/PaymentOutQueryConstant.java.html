<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentOutQueryConstant.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.dbport</a> &gt; <span class="el_source">PaymentOutQueryConstant.java</span></div><h1>PaymentOutQueryConstant.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.dbport;

import com.currenciesdirect.gtg.compliance.util.SearchCriteriaUtil;

/**
 * The Enum PaymentOutQueryConstant.
 *
 * @author Rajesh
 */
<span class="fc" id="L10">@SuppressWarnings(&quot;squid:S1192&quot;)</span>
public enum PaymentOutQueryConstant {
	
<span class="fc" id="L13">	GET_PAYMENT_OUT_DETAILS(&quot;select &quot;</span>
			+ &quot; por.Id, &quot;
			+ &quot; por.Accountid, &quot;
			+ &quot; por.ContactId, por.isOnQueue, &quot;
			+ &quot; por.Deleted,&quot;
			+ &quot; por.UpdatedOn,&quot;
			+ &quot; por.initialStatus, &quot;
			+ &quot; o.name as Organisation, &quot;
			+ &quot; por.ContractNumber, &quot;
			+ &quot; ( &quot;
			+ &quot; select &quot;
			+ &quot; status &quot;
			+ &quot; from &quot;
			+ &quot; PaymentComplianceStatusEnum &quot;
			+ &quot; where &quot;
			+ &quot; id = por.ComplianceStatus &quot;
			+ &quot; ) as PaymentOutStaus, &quot;
			+ &quot; poa.vBeneficiaryFirstName, &quot;
			+ &quot; poa.vBeneficiaryLastName, &quot;
			+ &quot; poa.vReasonoftransfer, &quot;
			+ &quot; poa.attributes as PaymentOutAttributes, &quot;
			+ &quot; poa.vtradeBeneficiaryId, poa.vTradeBankID,&quot;
			+ &quot; poa.vBeneficiaryCountry as country, &quot;
			+ &quot; JSON_VALUE(poa.ATTRIBUTES, '$.trade.customer_legal_entity') AS LegalEntity, &quot;
			+ &quot; coun.displayName   AS CountryOfBeneficiaryFullName, &quot;
			+ &quot; poa.vSellingAmount, &quot;
			+ &quot; poa.vBuyingAmount, &quot;
			+ &quot; poa.BeneAmount, &quot;
			+ &quot; poa.vBuyingCurrency as BuyCurrency, &quot;
			+ &quot; poa.vBeneficiaryCountry as BeneficiaryCounry, &quot;
			+ &quot; por.TransactionDate as DateOfPayment, &quot;
			+ &quot; co.name as ContactName, &quot;
			+ &quot;     co.POIExists AS poiExists, &quot; //AT-3450
			+ &quot; acc.complianceDoneOn As RegComplete, &quot;
			+&quot; por.IntuitionClientRiskLevel AS IntuitionRiskLevel, &quot; //AT-4187
			+&quot; acc.AccountTMFlag, &quot; //AT-4451
			+&quot; acc.Version, &quot; //AT-4451
			+ &quot; co.createdOn as RegIn, &quot;
			+ &quot; ( &quot;
			+ &quot; select status from ContactComplianceStatusEnum &quot;
			+ &quot; where id = co.ComplianceStatus &quot;
			+ &quot; ) as ContactComplianceStatus, &quot;
			+ &quot; co.TradeContactId as TradeContactId, &quot;
			+ &quot;                                                           por.TradePaymentId,&quot;
			+ &quot; coa.Attributes AS contactAttrib, &quot;
			+ &quot; ( &quot;
			+ &quot; select &quot;
			+ &quot; status &quot;
			+ &quot; from AccountComplianceStatusEnum &quot;
			+ &quot; where id = acc.ComplianceStatus &quot;
			+ &quot; ) as AccComplianceStatus, &quot;
			+ &quot; acc.CRMAccountID, &quot;
			+ &quot; acc.TradeAccountNumber, &quot;
			+ &quot; accAttrib.Attributes AS AccountAttrib, &quot;
			+ &quot; co.CRMContactID, &quot;
			+ &quot; ur.id AS userResourceLockId, &quot;
			+ &quot; ( &quot;
			+ &quot; SELECT SSOUserId FROM [USER] &quot;
			+ &quot; where id = ur.createdBy &quot;
			+ &quot; ) AS LockedBy, &quot;
			+ &quot; esl.id AS EventServiceLogId, &quot;
			+ &quot; esl.entityid, &quot;
			+ &quot; ( &quot;
			+ &quot; Select &quot;
			+ &quot; top 1 Code &quot;
			+ &quot; from &quot;
			+ &quot; Compliance_ServiceTypeEnum &quot;
			+ &quot; where id = esl.serviceType &quot;
			+ &quot; ) AS ServiceType, &quot;
			+ &quot; esl.entityType, &quot;
			+ &quot; esl.eventId, &quot;
			+ &quot; esl.summary, &quot;
			+ &quot; JSON_VALUE(esl.ProviderResponse, '$.Action') AS intuitionCurrentAction, &quot; //AT-4962
			+ &quot; esl.Status as EventServiceStatus, &quot;
			+ &quot; ( &quot;
			+ &quot; SELECT &quot;
			+ &quot; SSOUserId &quot;
			+ &quot; FROM &quot;
			+ &quot; [USER] &quot;
			+ &quot; where &quot;
			+ &quot; id = esl.UpdatedBy &quot;
			+ &quot; ) as EventServiceUpdatedBy, &quot;
			+ &quot; esl.UpdatedOn as EventServiceUpdatedOn &quot;
			+ &quot; from &quot;
			+ &quot; ( &quot;
			+ &quot; select &quot;
			+ &quot; po.* &quot;
			+ &quot; from &quot;
			+ &quot; PaymentOut po &quot;
			+ &quot; where &quot;
			+ &quot; ID = ? &quot;
			+ &quot; ) as por &quot;
			+ &quot; LEFT JOIN Organization o on &quot;
			+ &quot; por.OrganizationID = o.id &quot;
			+ &quot; LEFT JOIN PaymentOutAttribute poa on &quot;
			+ &quot; poa.ID = por.id &quot;
			+ &quot; LEFT JOIN Contact co on &quot;
			+ &quot; co.id = por.contactId &quot;
			+ &quot; LEFT JOIN ContactAttribute coa on &quot;
			+ &quot; coa.id = por.ContactId &quot;
			+ &quot; LEFT JOIN Account acc on &quot;
			+ &quot; acc.id = por.Accountid &quot;
			+ &quot; LEFT JOIN AccountAttribute accAttrib on &quot;
			+ &quot; accAttrib.id = por.Accountid &quot;
			+ &quot; LEFT JOIN country coun&quot;
			+ &quot;     ON coun.code = poa.vBeneficiaryCountry&quot;
			+ &quot; LEFT JOIN EventServiceLog esl on &quot;
			+ &quot; esl.id in( &quot;
			+ &quot; SELECT &quot;
			+ &quot; ESL.ID as logid &quot;
			+ &quot; FROM &quot;
			+ &quot; [EventServiceLog] ESL &quot;
			+ &quot; JOIN Event EV on &quot;
			+ &quot; ESL.EventID = EV.ID &quot;
			+ &quot; and EV.PaymentInID is null &quot;
			+ &quot; WHERE &quot;
			+ &quot; EV.paymentoutid = por.id &quot;
			+ &quot; ) &quot;
			+ &quot; LEFT JOIN UserResourceLock ur on &quot;
			+ &quot; por.Id = ur.ResourceID &quot;
			+ &quot; AND ur.LockReleasedOn IS NULL &quot;
			+ &quot; AND ur.ResourceType = 1 &quot;
			+ &quot; order by &quot;
			+ &quot; esl.serviceType, &quot;
			+ &quot; ESL.updatedon desc&quot;),
	
<span class="fc" id="L139">	PAYMENT_OUT_QUEUE_CONTACT_FILTER( &quot;SELECT B.AccountId , A.Id ContactId, ROW_NUMBER() OVER (PARTITION BY B.AccountId ORDER BY B.UpdatedOn) RNum &quot;</span>
			+ &quot; FROM ContactAttribute A JOIN Contact B ON A.Id = B.ID {PAYMENTOUT_QUEUE_COUNTRY_OF_RESIDENCE_FILTER} {WATCHLIST_CATEGORY_FILTER}&quot;),
	
<span class="fc" id="L142">	PAYMENT_OUT_QUEUE_ACCOUNT_FILTER( &quot;SELECT A.Id AccountId&quot;</span>
			+ &quot; FROM AccountAttribute A JOIN ACCOUNT B ON A.id = B.id&quot;),
	
<span class="fc" id="L145">	PAYMENT_OUT_QUEUE_PAYMENT_FILTER( &quot;SELECT P.Id AS PaymentId&quot;</span>
			+ &quot; FROM Comp.PaymentOutAttribute P {COUNTRY_JOIN}  &quot;),
	
<span class="fc" id="L148">	CONTACT_FILTER_JOIN(&quot; LEFT JOIN ContactAttributeFilter CF ON Payout.ContactId = CF.ContactId&quot;),</span>
<span class="fc" id="L149">	ACCOUNT_FILTER_JOIN(&quot; LEFT JOIN AccountAttributeFilter AF ON Payout.AccountId = AF.AccountId &quot;),</span>
<span class="fc" id="L150">	WATCHLIST_CATEGORY_FILTER(&quot; LEFT JOIN ContactWatchList CL ON CL.contact=B.id JOIN watchlist W ON CL.reason=w.id AND w.category IN(?) &quot;),</span>
<span class="fc" id="L151">	PAYMENT_FILTER_JOIN(&quot; JOIN PaymentAttributeFilter PF ON PF.PaymentId = payOut.id &quot;),</span>
<span class="fc" id="L152">	ORG_FILTER_JOIN(&quot;JOIN Organization org  ON org.Id = payout.organizationID&quot;),</span>
<span class="fc" id="L153">	LEGEL_ENTITY_TABLE_JOIN(&quot;JOIN LegalEntity le ON payout.LegalEntityID = le.ID&quot;),</span>
<span class="fc" id="L154">	COUNTRY_FILTER_JOIN(&quot;LEFT JOIN  country c ON c.code=P.vBeneficiaryCountry&quot;),</span>
<span class="fc" id="L155">	REPORT_FILTER_NULL_CHECK(&quot; (CF.ContactId IS NOT NULL OR AF.AccountId IS NOT NULL) &quot;),</span>
<span class="fc" id="L156">	PAYMENTOUT_QUEUE_COUNTRY_OF_RESIDENCE_FILTER(&quot;JOIN country cor ON cor.id = B.country&quot;),</span>
	
<span class="fc" id="L158">	PAYMENT_QUEUE_FILTER(&quot;SELECT payOut.id AS resourceID, resourceType, ur.createdby  &quot;</span>
			+ &quot;FROM paymentout payOut LEFT JOIN  userresourcelock ur ON ur.resourceID = payOut.id and ur.Lockreleasedon is NULL AND resourceType = 1 AND ur.LockReleasedOn IS NULL  &quot;
			+ &quot; {CONTACT_FILTER_JOIN} {ACCOUNT_FILTER_JOIN} {PAYMENT_TABLE_JOIN} {ORG_JOIN} {USER_JOIN} {LEGAL_ENTITY_JOIN} JOIN PaymentOutAttribute poa ON poa.id = payOut.id JOIN Account acc ON payout.accountid = acc.id &quot;
			+ &quot; WHERE payOut.ComplianceStatus=4 AND payOut.deleted = 0 AND payOut.isOnQueue = 1&quot;),
	
<span class="fc" id="L163">	GET_PAYMENTOUT_QUEUE(&quot;DECLARE @Offset int = ?, @Rows int = ?;&quot;</span>
			+ &quot;WITH &quot;
			+ &quot;ContactAttributeFilter AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_OUT_QUEUE_CONTACT_FILTER} &quot;
			+ &quot;), &quot;
			+ &quot;AccountAttributeFilter AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_OUT_QUEUE_ACCOUNT_FILTER} &quot;
			+ &quot;), &quot;
			+ &quot;PaymentAttributeFilter AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_OUT_QUEUE_PAYMENT_FILTER} &quot;
			+ &quot;), &quot;
			+ &quot;SelectedId AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_QUEUE_FILTER} &quot;
			+ &quot;    Order BY {SORT_FIELD_NAME} {ORDER_TYPE} OFFSET @Offset ROWS FETCH NEXT @rows ROWS ONLY &quot;
			+ &quot;) &quot;
			+ &quot;SELECT payout.id AS PaymentOutID, &quot;
			+ &quot;    payout.accountid AS AccountId, &quot;
			+ &quot;    payout.contactid AS ContactId, &quot;
			+ &quot;    payout.compliancestatus AS ComplianceStatus, &quot;
			+ &quot;    payOut.contractnumber AS Transactions, &quot;
			+ &quot;    acc.tradeaccountnumber AS Client, &quot;
			+ &quot;     acc.crmaccountid        AS ACSFID, &quot;
			+ &quot;    payOut.transactiondate AS [Date], &quot;
			+ &quot;        acc.[type] &quot;
			+ &quot;     AS Type, &quot;
			+ &quot;    CASE &quot;
			+ &quot;        WHEN acc.[type] = 2 THEN con.NAME &quot;
			+ &quot;        ELSE acc.NAME &quot;
			+ &quot;    END AS clientname, &quot;
			+ &quot;    poa.vbuyingcurrency AS Buy, &quot;
			+ &quot;    poa.vbuyingamount AS Amount, &quot;
			+ &quot;    poa.vBeneficiaryAmount AS BeneficiaryAmount, &quot;
			+ &quot;    concat(poa.vBeneficiaryFirstName,' ', poa.vBeneficiaryLastName) AS Beneficiary,  &quot;
			+ &quot;    poa.vReasonOfTransfer  AS ReasonOfTransfer, &quot;
			+ &quot;    ResourceId, &quot;
			+ &quot;    us.ssouserid AS LockedBy, &quot;
			+ &quot;    org.NAME AS Organization, &quot;
			+ &quot;    acc.LegalEntity, &quot;	
			+ &quot;    poa.vvalueDate AS valueDate, &quot;
			+ &quot;    poa.vMaturityDate AS maturityDate,&quot;
			+ &quot;    c.DisplayName AS Country, &quot;
			+ &quot;    c.Code AS IsoCountry, &quot;
			+ &quot;    pcse.status AS OverAllStatus, &quot;
			+ &quot;    CASE &quot;
			+ &quot;    WHEN acc.[type] = 2 THEN con.PayOutWatchListStatus  &quot;
			+ &quot;   ELSE acc.PayOutWatchListStatus  END AS WatchListStatus, &quot;//Changes for 2986
			+ &quot;    payOut.blackliststatus, &quot;
			+ &quot;    payOut.fraugsterstatus, &quot;
			+ &quot;    payOut.sanctionstatus, &quot;
			+ &quot;    payOut.customcheckstatus, &quot;
			+ &quot;    payOut.intuitionCheckStatus, &quot; // AT-4607
			+ &quot;    payOut.PaymentReferenceStatus &quot;//changes for AT-3854
			+ &quot;FROM paymentout payOut &quot;
			+ &quot;JOIN SelectedId pq ON pq.resourceID = payOut.id &quot;
			+ &quot;JOIN paymentoutattribute poa ON &quot;
			+ &quot;    payout.id = poa.id &quot;
			+ &quot;JOIN paymentcompliancestatusenum pcse ON &quot;
			+ &quot;    payout.compliancestatus = pcse.id &quot;
			+ &quot;JOIN account acc ON &quot;
			+ &quot;    payOut.accountid = acc.id &quot;
			+ &quot;JOIN contact con ON &quot;
			+ &quot;    payOut.contactid = con.id &quot;
			+ &quot;JOIN organization org ON &quot;
			+ &quot;    org.id = acc.organizationid &quot;
			+ &quot; LEFT JOIN  country c ON c.code=poa.vBeneficiaryCountry  &quot;
			+ &quot;LEFT JOIN [user] us ON &quot;
			+ &quot;    us.id = pq.createdby order by {SORT_FIELD_NAME} {ORDER_TYPE}&quot;),
	
	
<span class="fc" id="L236">	GET_PAYMENTOUT_REPORT_COUNT(</span>
			&quot;WITH &quot;
			+ &quot;ContactAttributeFilter AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_OUT_QUEUE_CONTACT_FILTER} &quot;
			+ &quot;), &quot;
			+ &quot;AccountAttributeFilter AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_OUT_QUEUE_ACCOUNT_FILTER} &quot;
			+ &quot;), &quot;
			+ &quot;PaymentAttributeFilter AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_OUT_QUEUE_PAYMENT_FILTER} &quot;
			+ &quot;), &quot;
			+ &quot;SelectedId AS &quot;
			+ &quot;( &quot;
			+ &quot;    {PAYMENT_QUEUE_FILTER} &quot;
			+ &quot;) &quot;
			+ &quot;SELECT count(payout.id) as TotalRows  &quot;
			+ &quot;FROM &quot;
			+ &quot;    paymentout payOut &quot;
			+ &quot;JOIN SelectedId pq ON pq.resourceID = payOut.id &quot;
			+ &quot;JOIN paymentoutattribute poa ON &quot;
			+ &quot;    payout.id = poa.id &quot;
			+ &quot;JOIN paymentcompliancestatusenum pcse ON &quot;
			+ &quot;    payout.compliancestatus = pcse.id &quot;
			+ &quot;JOIN account acc ON &quot;
			+ &quot;    payOut.accountid = acc.id &quot;
			+ &quot;JOIN contact con ON &quot;
			+ &quot;    payOut.contactid = con.id &quot;
			+ &quot;JOIN organization org ON &quot;
			+ &quot;    org.id = acc.organizationid &quot;
			+ &quot;LEFT JOIN [user] us ON &quot;
			+ &quot;    us.id = pq.createdby&quot;),
	
<span class="fc" id="L271">	GET_PAYMENTOUT_QUEUE_WITHOUT_PAGINATION(&quot;SELECT Count(*) AS count from( SELECT * FROM &quot;</span>
		+ &quot; (SELECT payout.id                                AS PaymentOutID, &quot;
		+ &quot; payout.accountid                         AS AccountId, &quot;
		+ &quot; payout.contactid                         AS ContactId, &quot;
		+ &quot; payout.compliancestatus                  AS ComplianceStatus, &quot;
		+ &quot; payOut.deleted                           AS Deleted, &quot;
		+ &quot; payOut.contractnumber                    AS Transactions, &quot;
		+ &quot; acc.tradeaccountnumber                   AS Client, &quot;
		+ &quot; payOutAttri.transactiondate              AS [Date], &quot;
		+ &quot; con.NAME                                 AS ClientName, &quot;
		+ &quot; acc.Type                                 AS Type, &quot;
		+ &quot; payOutAttri.buyingcurrency               AS Buy, &quot;
		+ &quot; payOutAttri.buyingamount                 AS Amount, &quot;
		+ &quot; payOutAttri.beneficiaryfirstname &quot;
		+ &quot; + payOutAttri.beneficiarylastname        AS Beneficiary, &quot;
		+ &quot; ur.id                                    AS ResourceId, &quot;
		+ &quot; ur.createdBy as LockedBy, &quot;
		+ &quot; (SELECT name FROM Organization WHERE Id = acc.OrganizationID) AS Organization, &quot;
		+ &quot; (SELECT code AS Country &quot;
		+ &quot; FROM   country &quot;
		+ &quot; WHERE  id = (SELECT beneficiarycountry &quot;
		+ &quot; FROM   paymentoutattribute pa &quot;
		+ &quot; WHERE  pa.id = payOut.id)) AS Country, &quot;
		+ &quot; (SELECT status &quot;
		+ &quot; FROM   paymentcompliancestatusenum &quot;
		+ &quot; WHERE  id = (SELECT compliancestatus &quot;
		+ &quot; FROM   paymentout po &quot;
		+ &quot; WHERE  payOut.id = po.id)) AS OverAllStatus &quot;
		+ &quot; , &quot;
		+ &quot; (SELECT Count(*) &quot;
		+ &quot; FROM   contactwatchlist cw &quot;
		+ &quot; WHERE  cw.contact IN ( select id  from contact where accountid=payOut.accountid))   AS &quot;
		+ &quot; WatchListStatus, &quot;
		+ &quot; (SELECT TOP 1 status FROM   eventservicelog esl &quot;
		+ &quot; WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum &quot;
		+ &quot; WHERE  code = 'BLACKLIST') &quot;
		+ &quot; AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)) AS  BlackListStatus, &quot;
		+ &quot; (SELECT &quot;
		+ &quot; TOP 1 status FROM   eventservicelog esl &quot;
		+ &quot; WHERE  &quot;
		+ &quot; esl.servicetype = (SELECT id &quot;
		+ &quot; FROM compliance_servicetypeenum &quot;
		+ &quot; WHERE  code = 'FRAUGSTER') &quot;
		+ &quot; AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)) AS FraugsterStatus, &quot;
		+ &quot; (SELECT TOP 1 status &quot;
		+ &quot;                             FROM   &quot;
		+ &quot; eventservicelog esl &quot;
		+ &quot;                             WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum  WHERE  code = 'SANCTION' ) &quot;
		+ &quot;                                    and esl.EntityType = 'CONTACT' AND &quot;
		+ &quot; payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)order by esl.id desc) &quot;
		+ &quot;                            AS SanctionConStatus , &quot;
		+ &quot;                            (SELECT TOP 1 status FROM   eventservicelog esl WHERE  esl.servicetype = (SELECT id &quot;
		+ &quot;                                                       FROM compliance_servicetypeenum  WHERE  code = 'SANCTION' ) &quot;
		+ &quot; and esl.EntityType = 'BENEFICIARY' AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)order by esl.id desc) &quot;
		+ &quot;                            AS SanctionBeneStatus , &quot;
		+ &quot;                            (SELECT TOP 1 status FROM   eventservicelog esl WHERE  esl.servicetype = (SELECT id &quot;
		+ &quot;                                                       FROM compliance_servicetypeenum WHERE  code = 'SANCTION' ) and esl.EntityType = 'BANK' &quot;
		+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)order by esl.id desc) &quot;
		+ &quot;                            AS SanctionBankStatus &quot;
		+ &quot; FROM   paymentout payOut &quot;
		+ &quot; &quot;
		+ &quot; JOIN paymentoutattribute payOutAttri &quot;
		+ &quot; ON payout.id = payOutAttri.id &quot;
		+ &quot; JOIN account acc &quot;
		+ &quot; ON payOut.accountid = acc.id &quot;
		+ &quot; JOIN contact con &quot;
		+ &quot; ON payOut.contactid = con.id &quot;
		+ &quot; LEFT JOIN userresourcelock ur &quot;
		+ &quot; ON payout.id = ur.resourceid &quot;
		+ &quot; AND ur.lockreleasedon IS NULL AND ur.resourcetype = 'PAYMENT_OUT') AS PQueue &quot;
		+ &quot; WHERE  compliancestatus &lt;&gt; 1 &quot;
		+ &quot; AND Deleted &lt;&gt; 1)AS PQueue2&quot;),
				
<span class="fc" id="L344">	GET_PAYMENTOUT_QUEUE_PAGINATION_WITH_CRITERIA(&quot;Select * from ({INNER_QUERY}) AS pqueue3 &quot;</span>
			+ &quot;WHERE  rownum &gt;= ? &quot;
			+ &quot;AND    rownum &lt;= ?&quot;),
	
<span class="fc" id="L348">	GET_PAYMENTOUT_QUEUE_PAGINATION_WITH_CRITERIA_SELECT(&quot;WITH poque AS &quot; </span>
			+ &quot; ( &quot;
			+&quot; {INNER_QUERY}&quot;
			+ &quot;  ) &quot;
			+ &quot;    SELECT &quot;
			+ &quot;    *, ( SELECT max (rownum) FROM poque) AS 'TotalRows' &quot;
			+ &quot; FROM poque &quot;
			+ &quot; WHERE rownum &gt;= ? &quot;
			+ &quot;  AND rownum &lt;= ? &quot;),
	
<span class="fc" id="L358">	GET_PAYMENTOUT_QUEUE_FOR_PAGINATION_FILTER(&quot;Select pqueue3.* from ({INNER_QUERY} ) as pqueue2 ) AS pqueue3 &quot;</span>
			+ &quot;WHERE  rownum IN (?,?,?,?) &quot;),
			    
<span class="fc" id="L361">	GET_PAYMENTOUT_ID_PAGINATION_WITH_CRITERIA(&quot;Select pqueue3.paymentOutId from ({INNER_QUERY}) AS pqueue3 &quot;</span>
			+ &quot;WHERE  rownum &gt;= ? &quot;
			+ &quot;AND    rownum &lt;= ?&quot;),
	
<span class="fc" id="L365">	GET_PAYMENTOUT_QUEUE_COUNT(&quot;SELECT COUNT(*) as count FROM PaymentOut WHERE complianceStatus&lt;&gt;1&quot;),</span>
	
<span class="fc" id="L367">	GET_PAYMENTOUT_QUEUE_PAGINATION(&quot;SELECT * &quot;</span>
			+ &quot;     FROM   (SELECT Row_number() &quot;
			+ &quot;     OVER ( &quot;
			+ &quot;            ORDER BY paymentoutid DESC) AS rownum, &quot;
			+ &quot;        PQueue.* &quot;
			+ &quot;             FROM   (SELECT payout.id                                AS PaymentOutID, &quot;
			+ &quot;              payout.accountid                         AS AccountId, &quot;
			+ &quot;                            payout.contactid                         AS ContactId, &quot;
			+ &quot;                            payout.compliancestatus                  AS ComplianceStatus, &quot;
			+ &quot;                            payOut.deleted                           AS Deleted, &quot;
			+ &quot;                            payOut.contractnumber                    AS Transactions, &quot;
			+ &quot;                            acc.tradeaccountnumber                   AS Client, &quot;
			+ &quot;                            payOutAttri.transactiondate              AS [Date], &quot;
			+ &quot;                            con.NAME                                 AS ClientName, &quot;
			+ &quot;                            acc.Type                                 AS Type, &quot;
			+ &quot;                            payOutAttri.buyingcurrency               AS Buy, &quot;
			+ &quot;                            payOutAttri.buyingamount                 AS Amount, &quot;
			+ &quot;                            payOutAttri.beneficiaryfirstname &quot;
			+ &quot;                             +' '+  payOutAttri.beneficiarylastname        AS Beneficiary, &quot;
			+ &quot;                            ur.id                                    AS ResourceId, &quot;
			+ &quot;                            ur.createdBy as LockedBy, &quot;
			+ &quot;                            (SELECT name FROM Organization WHERE Id = acc.OrganizationID) AS Organization, &quot;
			+ &quot;                            (SELECT code AS Country &quot;
			+ &quot;                             FROM   country &quot;
			+ &quot;                             WHERE  id = (SELECT beneficiarycountry &quot;
			+ &quot;                                          FROM   paymentoutattribute pa &quot;
			+ &quot;                                          WHERE  pa.id = payOut.id)) AS Country, &quot;
			+ &quot;                            (SELECT status &quot;
			+ &quot;                             FROM   paymentcompliancestatusenum &quot;
			+ &quot;                             WHERE  id = (SELECT compliancestatus &quot;
			+ &quot;                                          FROM   paymentout po &quot;
			+ &quot;                                          WHERE  payOut.id = po.id)) AS OverAllStatus &quot;
			+ &quot;                            , &quot;
			+ &quot;                            (SELECT Count(*) &quot;
			+ &quot;                             FROM   contactwatchlist cw &quot;
			+ &quot;                             WHERE  cw.contact IN ( select id  from contact where accountid=payOut.accountid))   AS &quot;
			+ &quot;                            WatchListStatus, &quot;
			+ &quot;                            (SELECT &quot;
			+ &quot;                                 TOP 1 status &quot;
			+ &quot;                             FROM   &quot;
			+ &quot;                                 eventservicelog esl &quot;
			+ &quot;                             WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum  WHERE  code = 'BLACKLIST') &quot;
			+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)) &quot;
			+ &quot;                                  AS &quot;
			+ &quot;                            BlackListStatus, &quot;
			+ &quot;                            (SELECT TOP 1 status FROM  eventservicelog esl &quot;
			+ &quot;                             WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum WHERE  code = 'FRAUGSTER') AND &quot;
			+ &quot;                             payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)) &quot;
			+ &quot;                                       AS &quot;
			+ &quot;                            FraugsterStatus, &quot;
			+ &quot;                            (SELECT TOP 1 status FROM   eventservicelog esl &quot;
			+ &quot;                             WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum WHERE  code = 'SANCTION' ) &quot;
			+ &quot;                                    and esl.EntityType = 'CONTACT' &quot;
			+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc) order by esl.id desc) AS SanctionConStatus , &quot;
			+ &quot;                            (SELECT TOP 1 status FROM   eventservicelog esl WHERE  esl.servicetype = (SELECT id FROM &quot;
			+ &quot;                                    compliance_servicetypeenum WHERE  &quot;
			+ &quot;                                         code = 'SANCTION' ) &quot;
			+ &quot;                                    and esl.EntityType = 'BENEFICIARY' &quot;
			+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc) order by esl.id desc) AS SanctionBeneStatus , &quot;
			+ &quot;                            (SELECT TOP 1 status FROM   eventservicelog esl  WHERE  esl.servicetype = (SELECT id FROM compliance_servicetypeenum   WHERE  code = 'SANCTION' ) &quot;
			+ &quot;                                    and esl.EntityType = 'BANK' &quot;
			+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc) order by esl.id desc) AS SanctionBankStatus &quot;
			+ &quot;                     FROM   paymentout payOut &quot;
			+ &quot; &quot;
			+ &quot;                            JOIN paymentoutattribute payOutAttri &quot;
			+ &quot;                              ON payout.id = payOutAttri.id &quot;
			+ &quot;                            JOIN account acc &quot;
			+ &quot;                              ON payOut.accountid = acc.id &quot;
			+ &quot;                            JOIN contact con &quot;
			+ &quot;                              ON payOut.contactid = con.id &quot;
			+ &quot;                            LEFT JOIN userresourcelock ur &quot;
			+ &quot;                                   ON payout.id = ur.resourceid &quot;
			+ &quot;                                      AND ur.lockreleasedon IS NULL AND ur.resourcetype = 'PAYMENT_OUT') AS PQueue &quot;
			+ &quot;             WHERE  compliancestatus &lt;&gt; 1 &quot;
			+ &quot;                    AND Deleted &lt;&gt; 1)AS PQueue2 &quot;
			+ &quot;     WHERE  rownum &gt;= ? &quot;
			+ &quot;            AND rownum &lt;= ?&quot;),
	
	//Beneficiary first name and last name are fetched again to set them separately on UI
<span class="fc" id="L446">	GET_PAYMENTOUT_QUEUE_PAGINATION_WITH_SELECT(&quot;WITH poque AS( &quot;</span>
+ &quot; SELECT &quot;
+ &quot; Row_number() OVER( ORDER BY payout.id DESC ) AS rownum, &quot;
+ &quot; payout.id AS PaymentOutID, &quot;
+ &quot; payout.accountid AS AccountId, &quot;
+ &quot; payout.contactid AS ContactId, &quot;
+ &quot; payout.compliancestatus AS ComplianceStatus, &quot;
+ &quot; payOut.contractnumber AS Transactions, &quot;
+ &quot; acc.tradeaccountnumber AS Client, &quot;
+ &quot; poa.transactiondate AS [Date], &quot;
+ &quot; acc.[type] AS Type, &quot;
+ &quot; case when  acc.[type]='PFX' then con.NAME &quot;
+ &quot;     when acc.[type]='CFX' then acc.NAME &quot;
+ &quot;     END as clientname,&quot;
+ &quot; poa.buyingcurrency AS Buy, &quot;
+ &quot; poa.buyingamount AS Amount, &quot;
+ &quot;     poa.Attributes AS Attributes,  poa.BeneAmount AS BeneficiaryAmount, &quot;
+ &quot;     poa.beneficiaryfirstname AS BeneficiaryFirstName, &quot;
+ &quot;     poa.beneficiarylastname AS BeneficiaryLastName, &quot;
+ &quot; ur.id AS ResourceId, &quot;
+ &quot; us.SSOUserId AS LockedBy, &quot;
+ &quot; org.NAME AS Organization, &quot;
+ &quot; ctr.code AS Country, &quot;
+ &quot; pcse.status AS OverAllStatus, &quot;
+ &quot; acc.WatchlistStatus AS WatchListStatus, &quot;
+ &quot; payOut.BlacklistStatus, &quot;
+ &quot; payOut.FraugsterStatus, &quot;
+ &quot; payOut.SanctionStatus, &quot;
+ &quot; payOut.CustomCheckStatus &quot;
+ &quot; FROM paymentout payOut &quot;
+ &quot; JOIN paymentoutattribute poa ON payout.id = poa.id &quot;
+ &quot; JOIN paymentcompliancestatusenum pcse ON  payout.compliancestatus = pcse.id &quot;
+ &quot; JOIN account acc ON payOut.accountid = acc.id &quot;
+ &quot; JOIN contact con ON payOut.contactid = con.id &quot;
+ &quot; JOIN Country ctr ON poa.beneficiarycountry = ctr.id &quot;
+ &quot; JOIN organization org ON org.id = acc.organizationid &quot;
+ &quot; LEFT JOIN userresourcelock ur ON  payout.id = ur.resourceid &quot;
+ &quot; AND ur.resourcetype = 'PAYMENT_OUT' &quot;
+ &quot; LEFT JOIN [user] us ON us.id = ur.createdby &quot;
+ &quot; WHERE &quot;
<span class="fc" id="L486">+ &quot; poa.transactiondate &gt; DATEADD(day,-&quot; + SearchCriteriaUtil.getDefaultQueueRecordSize() + &quot;,GETDATE()) &quot;</span>
+ &quot; and payOut.ComplianceStatus = 4 &quot;
+ &quot; AND payOut.deleted = 0 &quot;
+ &quot; AND ur.lockreleasedon IS NULL &quot;
+ &quot;) SELECT *, (SELECT max( rownum ) FROM poque ) AS 'TotalRows' &quot;
+ &quot;FROM poque &quot;
+ &quot;WHERE &quot;
+ &quot; rownum &gt;= ? &quot;
+ &quot; AND rownum &lt;= ? &quot;),
	
<span class="fc" id="L496">	GET_PAYMENTOUT_QUEUE_INNER_QUERY(&quot;SELECT Row_number() OVER ( ORDER BY {SORT_FIELD_NAME} {ORDER_TYPE}) AS rownum, &quot;</span>
			+ &quot; PQueue2.* &quot;
			+ &quot; FROM (select pqueue.* from &quot;
			+ &quot; (SELECT payout.id                                AS PaymentOutID, &quot;
			+ &quot; payout.accountid                         AS AccountId, &quot;
			+ &quot; payout.contactid                         AS ContactId, &quot;
			+ &quot; payout.compliancestatus                  AS ComplianceStatus, &quot;
			+ &quot; payOut.deleted                           AS Deleted, &quot;
			+ &quot; payOut.contractnumber                    AS Transactions, &quot;
			+ &quot; acc.tradeaccountnumber                   AS Client, &quot;
			+ &quot; payOutAttri.transactiondate              AS [Date], &quot;
			+ &quot; con.NAME                                 AS ClientName, &quot;
			+ &quot; acc.Type                                 AS Type, &quot;
			+ &quot; payOutAttri.buyingcurrency               AS Buy, &quot;
			+ &quot; payOutAttri.buyingamount                 AS Amount, &quot;
			+ &quot; payOutAttri.beneficiaryfirstname &quot;
			+ &quot; +' '+  payOutAttri.beneficiarylastname        AS Beneficiary, &quot;
			+ &quot; ur.id                                    AS ResourceId, &quot;
			+ &quot; ur.createdBy as LockedBy, &quot;
			+ &quot; (SELECT name FROM Organization WHERE Id = acc.OrganizationID) AS Organization, &quot;
			+ &quot; (SELECT code AS Country &quot;
			+ &quot; FROM   country &quot;
			+ &quot; WHERE  id = (SELECT beneficiarycountry &quot;
			+ &quot; FROM   paymentoutattribute pa &quot;
			+ &quot; WHERE  pa.id = payOut.id)) AS Country, &quot;
			+ &quot; (SELECT status &quot;
			+ &quot; FROM   paymentcompliancestatusenum &quot;
			+ &quot; WHERE  id = (SELECT compliancestatus &quot;
			+ &quot; FROM   paymentout po &quot;
			+ &quot; WHERE  payOut.id = po.id)) AS OverAllStatus &quot;
			+ &quot; , &quot;
			+ &quot; (SELECT Count(*) &quot;
			+ &quot; FROM   contactwatchlist cw &quot;
			+ &quot; WHERE  cw.contact IN ( select id  from contact where accountid=payOut.accountid))   AS &quot;
			+ &quot; WatchListStatus, &quot;
			+ &quot; (SELECT TOP 1 status &quot;
			+ &quot; FROM   eventservicelog esl &quot;
			+ &quot; WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot; FROM &quot;
			+ &quot; compliance_servicetypeenum &quot;
			+ &quot; WHERE  code = 'BLACKLIST') &quot;
			+ &quot; AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)) &quot;
			+ &quot; AS &quot;
			+ &quot; BlackListStatus, &quot;
			+ &quot; (SELECT TOP 1 status &quot;
			+ &quot; FROM   eventservicelog esl &quot;
			+ &quot; WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot; FROM &quot;
			+ &quot; compliance_servicetypeenum &quot;
			+ &quot; WHERE  code = 'FRAUGSTER') &quot;
			+ &quot; AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc)) &quot;
			+ &quot; AS &quot;
			+ &quot; FraugsterStatus, &quot;
			+ &quot; (SELECT TOP 1 status FROM   eventservicelog esl WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot;                                                       FROM  compliance_servicetypeenum &quot;
			+ &quot;                                                       WHERE  code = 'SANCTION' ) and esl.EntityType = 'CONTACT' &quot;
			+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc) order by esl.id desc) &quot;
			+ &quot;                            AS SanctionConStatus , &quot;
			+ &quot;                            (SELECT TOP 1 status &quot;
			+ &quot;                             FROM   eventservicelog esl &quot;
			+ &quot;                             WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot;                                                       FROM &quot;
			+ &quot;                                    compliance_servicetypeenum &quot;
			+ &quot;                                                       WHERE  code = 'SANCTION' ) &quot;
			+ &quot;                                    and esl.EntityType = 'BENEFICIARY' &quot;
			+ &quot;                                    AND &quot;
			+ &quot; payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc) order by esl.id desc) &quot;
			+ &quot;                            AS SanctionBeneStatus , &quot;
			+ &quot;                            (SELECT TOP 1 status &quot;
			+ &quot;                             FROM   eventservicelog esl &quot;
			+ &quot;                             WHERE  esl.servicetype = (SELECT id &quot;
			+ &quot;                                                       FROM &quot;
			+ &quot;                                    compliance_servicetypeenum &quot;
			+ &quot;                                                       WHERE  code = 'SANCTION' ) &quot;
			+ &quot;                                    and esl.EntityType = 'BANK' &quot;
			+ &quot;                                    AND payOut.id = (select top 1 paymentoutid from event where id in (esl.eventid) order by id desc) &quot;
			+ &quot; order by esl.id desc) &quot;
			+ &quot;                            AS SanctionBankStatus &quot;
			+ &quot; FROM   paymentout payOut &quot;
			+ &quot; &quot;
			+ &quot; JOIN paymentoutattribute payOutAttri &quot;
			+ &quot; ON payout.id = payOutAttri.id &quot;
			+ &quot; JOIN account acc &quot;
			+ &quot; ON payOut.accountid = acc.id &quot;
			+ &quot; JOIN contact con &quot;
			+ &quot; ON payOut.contactid = con.id &quot;
			+ &quot; LEFT JOIN userresourcelock ur &quot;
			+ &quot; ON payout.id = ur.resourceid &quot;
			+ &quot; AND ur.lockreleasedon IS NULL AND ur.resourcetype = 'PAYMENT_OUT') AS PQueue &quot;
			+ &quot; WHERE  compliancestatus &lt;&gt; 1 &quot;
			+ &quot; AND Deleted &lt;&gt; 1)AS PQueue2&quot;),
	
<span class="fc" id="L588">	GET_PAYMENTOUT_QUEUE_INNER_QUERY_SELECT(&quot;select Row_number() OVER ( ORDER BY PaymentOutID DESC) AS rownum,PQ.* from ( &quot;</span>
			+ &quot; select payout.id AS PaymentOutID, &quot;
			+ &quot; payout.accountid AS AccountId, &quot;
			+ &quot; payout.contactid AS ContactId, &quot;
			+ &quot; payout.compliancestatus AS ComplianceStatus, &quot;
			+ &quot; payOut.contractnumber AS Transactions, &quot;
			+ &quot; acc.tradeaccountnumber AS Client, &quot;
			+ &quot; case when  acc.[type]=2 then 'PFX' &quot;
			+ &quot; when acc.[type]=1 then 'CFX' &quot;
			+ &quot; END  AS [Type], &quot;
			+ &quot; case when  acc.[type]=2 then con.NAME &quot;
			+ &quot; when acc.[type]=1 then acc.NAME &quot;
			+ &quot;     END as clientname,&quot;
			+ &quot; payout.TransactionDate AS [Date], &quot;
			+ &quot; poa.vbuyingcurrency AS Buy, &quot;
			+ &quot; poa.vbuyingamount AS Amount, &quot;
			+ &quot;     poa.Attributes AS Attributes,  poa.BeneAmount AS BeneficiaryAmount, &quot;
			+ &quot; poa.vbeneficiaryfirstname AS BeneficiaryFirstName, &quot;
			+ &quot; poa.vbeneficiarylastname AS BeneficiaryLastName, &quot;
			+ &quot; ur.id AS ResourceId, &quot;
			+ &quot; us.SSOUserId AS LockedBy, &quot;
			+ &quot; org.NAME AS Organization, &quot;
			+ &quot; poa.vbeneficiarycountry AS Country, &quot;
			+ &quot; ctr.displayName AS CountryDisplayName , &quot;
			+ &quot; pcse.status AS OverAllStatus, &quot;
			+ &quot; acc.WatchlistStatus AS WatchListStatus, &quot;
			+ &quot; payOut.BlacklistStatus AS BlacklistStatus, &quot;
			+ &quot; payOut.FraugsterStatus, &quot;
			+ &quot; payOut.SanctionStatus, &quot;
			+ &quot; payOut.CustomCheckStatus &quot;
			+ &quot; FROM paymentout payOut &quot;
			+ &quot; JOIN paymentoutattribute poa ON payout.id = poa.id &quot;
			+ &quot; JOIN paymentcompliancestatusenum pcse ON  payout.compliancestatus = pcse.id &quot;
			+ &quot; JOIN account acc ON payOut.accountid = acc.id &quot;
			+ &quot; JOIN contact con ON payOut.contactid = con.id &quot;
			+ &quot; JOIN organization org ON org.id = acc.organizationid &quot;
			+ &quot; LEFT JOIN Country ctr ON ctr.code = poa.vbeneficiarycountry &quot;
			+ &quot; LEFT JOIN userresourcelock ur ON  payout.id = ur.resourceid &quot;
			+ &quot; AND ur.resourcetype = 1 AND ur.lockreleasedon IS NULL &quot;
			+ &quot; LEFT JOIN [user] us ON us.id = ur.createdby &quot;
			+ &quot; WHERE &quot;
			+ &quot; payOut.complianceStatus= 4 ) as PQ&quot;),
						    
<span class="fc" id="L631">	GET_PAYMENTOUT_DETAILS_BY_RECORD_NUM(&quot;SELECT por.id, &quot;</span>
			+ &quot;       por.accountid, &quot;
			+ &quot;       por.contactid, &quot;
			+ &quot;       o.NAME                               AS Organisation, &quot;
			+ &quot;       por.contractnumber, &quot;
			+ &quot;       (SELECT status FROM   paymentcompliancestatusenum &quot;
			+ &quot;        WHERE  id = por.compliancestatus)   AS PaymentOutStaus, &quot;
			+ &quot;       poa.beneficiaryfirstname, &quot;
			+ &quot;       poa.beneficiarylastname, &quot;
			+ &quot;       poa.reasonoftransfer, &quot;
			+ &quot;       poa.attributes                       AS PaymentOutAttributes, &quot;
			+ &quot;       (SELECT displayname FROM   country &quot;
			+ &quot;        WHERE  id = poa.beneficiarycountry) AS country, &quot;
			+ &quot;       poa.sellingamount, &quot;
			+ &quot;       poa.buyingamount, &quot;
			+ &quot;       poa.buyingcurrency                   AS BuyCurrency, &quot;
			+ &quot;       (SELECT code FROM   country &quot;
			+ &quot;        WHERE  id = poa.beneficiarycountry) AS BeneficiaryCounry, &quot;
			+ &quot;       poa.transactiondate                  AS DateOfPayment, &quot;
			+ &quot;       co.NAME                              AS ContactName, &quot;
			+ &quot;       co.createdon                         AS RegIn, &quot;
			+ &quot;       (SELECT status FROM   contactcompliancestatusenum &quot;
			+ &quot;        WHERE  id = co.compliancestatus)    AS ContactComplianceStatus, &quot;
			+ &quot;       co.tradecontactid                    AS TradeContactId, &quot;
			+ &quot;       coa.attributes                       AS contactAttrib, &quot;
			+ &quot;       (SELECT status FROM   accountcompliancestatusenum &quot;
			+ &quot;        WHERE  id = acc.compliancestatus)   AS AccComplianceStatus, &quot;
			+ &quot;       acc.crmaccountid, &quot;
			+ &quot;       acc.tradeaccountnumber, &quot;
			+ &quot;       accAttrib.attributes                 AS AccountAttrib, &quot;
			+ &quot;       co.CRMContactID, co.complianceDoneOn As RegComplete,&quot;
			+ &quot;       ur.id                                AS userResourceLockId, &quot;
			+ &quot;       ur.createdby                         AS LockedBy, &quot;
			+ &quot;       esl.id                               AS EventServiceLogId, &quot;
			+ &quot;       esl.entityid, &quot;
			+ &quot;       (SELECT TOP 1 code &quot;
			+ &quot;        FROM   compliance_servicetypeenum &quot;
			+ &quot;        WHERE  id = esl.servicetype)        AS ServiceType, &quot;
			+ &quot;       esl.entitytype, &quot;
			+ &quot;       esl.eventid, &quot;
			+ &quot;       esl.summary, &quot;
			+ &quot;       esl.status                           AS EventServiceStatus, &quot;
			+ &quot;       esl.updatedby                        AS EventServiceUpdatedBy, &quot;
			+ &quot;       esl.updatedon                        AS EventServiceUpdatedOn &quot;
			+ &quot;FROM   (SELECT po.* &quot;
			+ &quot;        FROM   paymentout po &quot;
			+ &quot;        WHERE  id = (select paymentoutid from(SELECT ROW_NUMBER() OVER (ORDER BY ID DESC)AS RowNum,id AS paymentoutid &quot;
			+ &quot;            from PaymentOut WHERE ComplianceStatus&lt;&gt;1)AS RowConstrainedResult WHERE RowNum=?)) AS por &quot;
			+ &quot;       LEFT JOIN organization o &quot;
			+ &quot;              ON por.organizationid = o.id &quot;
			+ &quot;       LEFT JOIN paymentoutattribute poa &quot;
			+ &quot;              ON poa.id = por.id &quot;
			+ &quot;       LEFT JOIN contact co &quot;
			+ &quot;              ON co.id = por.contactid &quot;
			+ &quot;       LEFT JOIN contactattribute coa &quot;
			+ &quot;              ON coa.id = por.contactid &quot;
			+ &quot;       LEFT JOIN account acc &quot;
			+ &quot;              ON acc.id = por.accountid &quot;
			+ &quot;       LEFT JOIN accountattribute accAttrib &quot;
			+ &quot;              ON accAttrib.id = por.accountid &quot;
			+ &quot;       LEFT JOIN eventservicelog esl &quot;
			+ &quot;              ON esl.id IN (SELECT Max(ESL.id) AS logid &quot;
			+ &quot;                            FROM   [eventservicelog] ESL &quot;
			+ &quot;                                   JOIN event EV &quot;
			+ &quot;                                     ON ESL.eventid = EV.id &quot;
			+ &quot;                            WHERE  EV.paymentoutid = por.id &quot;
			+ &quot;                            GROUP  BY esl.servicetype, &quot;
			+ &quot;                                      esl.entitytype) &quot;
			+ &quot;       LEFT JOIN userresourcelock ur &quot;
			+ &quot;              ON por.id = ur.resourceid &quot;
			+ &quot;                 AND ur.lockreleasedon IS NULL &quot;
			+ &quot;                 AND ur.resourcetype = 'PAYMENT_OUT' &quot;
			+ &quot;ORDER  BY esl.servicetype&quot;),
				
				
<span class="fc" id="L706">	GET_PAYMENTOUT_DETAILS_BY_PAYMENTOUTID(&quot;SELECT por.id, &quot;</span>
			+ &quot;       por.accountid, &quot;
			+ &quot;       por.contactid, &quot;
			+ &quot;       o.NAME                               AS Organisation, &quot;
			+ &quot;       por.contractnumber, &quot;
			+ &quot;       (SELECT &quot;
			+ &quot;          status &quot;
			+ &quot;        FROM   paymentcompliancestatusenum &quot;
			+ &quot;        WHERE  id = por.compliancestatus)   AS PaymentOutStaus, &quot;
			+ &quot;       poa.beneficiaryfirstname, &quot;
			+ &quot;       poa.beneficiarylastname, &quot;
			+ &quot;       poa.reasonoftransfer, &quot;
			+ &quot;       poa.attributes                       AS PaymentOutAttributes, &quot;
			+ &quot;       poa.tradeBeneficiaryId,&quot;	
			+ &quot;       por.TradePaymentId,&quot;
			+ &quot;       (SELECT displayname &quot;
			+ &quot;        FROM   country WHERE  id = poa.beneficiarycountry) AS country, &quot;
			+ &quot;       poa.sellingamount, &quot;
			+ &quot;       poa.buyingamount, &quot;
			+ &quot;       poa.buyingcurrency                   AS BuyCurrency, &quot;
			+ &quot;       (SELECT code &quot;
			+ &quot;        FROM   country &quot;
			+ &quot;        WHERE  id = poa.beneficiarycountry) AS BeneficiaryCounry, &quot;
			+ &quot;       poa.transactiondate                  AS DateOfPayment, &quot;
			+ &quot;       co.NAME                              AS ContactName, &quot;
			+ &quot;       co.createdon                         AS RegIn, &quot;
			+ &quot;       (SELECT status &quot;
			+ &quot;        FROM   contactcompliancestatusenum &quot;
			+ &quot;        WHERE  id = co.compliancestatus)    AS ContactComplianceStatus, &quot;
			+ &quot;       co.tradecontactid                    AS TradeContactId, &quot;
			+ &quot;       coa.attributes                       AS contactAttrib, &quot;
			+ &quot;       (SELECT status &quot;
			+ &quot;        FROM   &quot;
			+ &quot;        accountcompliancestatusenum &quot;
			+ &quot;        WHERE  id = acc.compliancestatus)   AS AccComplianceStatus, &quot;
			+ &quot;       acc.crmaccountid, &quot;
			+ &quot;       acc.tradeaccountnumber, &quot;
			+ &quot;       accAttrib.attributes                 AS AccountAttrib, &quot;
			+ &quot;       co.CRMContactID, co.complianceDoneOn As RegComplete,&quot;
			+ &quot;       ur.id                                AS userResourceLockId, &quot;
			+ &quot;       ur.createdby                         AS LockedBy, &quot;
			+ &quot;       esl.id                               AS EventServiceLogId, &quot;
			+ &quot;       (SELECT TOP 1 code &quot;
			+ &quot;        FROM   compliance_servicetypeenum &quot;
			+ &quot;        WHERE  id = esl.servicetype)        AS ServiceType, &quot;
			+ &quot;       esl.entitytype, &quot;
			+ &quot;       esl.eventid,  esl.entityid,&quot;
			+ &quot;       esl.summary, &quot;
			+ &quot;       esl.status                           AS EventServiceStatus, &quot;
			+ &quot;       esl.updatedby                        AS EventServiceUpdatedBy, &quot;
			+ &quot;       esl.updatedon                        AS EventServiceUpdatedOn &quot;
			+ &quot;FROM   (SELECT po.* &quot;
			+ &quot;        FROM   paymentout po &quot;
<span class="fc" id="L759">			+ &quot;        WHERE  id = (&quot;+GET_PAYMENTOUT_ID_PAGINATION_WITH_CRITERIA.getQuery()+&quot;)) AS por &quot;</span>
			+ &quot;       LEFT JOIN organization o &quot;
			+ &quot;              ON por.organizationid = o.id &quot;
			+ &quot;       LEFT JOIN paymentoutattribute poa &quot;
			+ &quot;              ON poa.id = por.id &quot;
			+ &quot;       LEFT JOIN contact co &quot;
			+ &quot;              ON co.id = por.contactid &quot;
			+ &quot;       LEFT JOIN contactattribute coa &quot;
			+ &quot;              ON coa.id = por.contactid &quot;
			+ &quot;       LEFT JOIN account acc &quot;
			+ &quot;              ON acc.id = por.accountid &quot;
			+ &quot;       LEFT JOIN accountattribute accAttrib &quot;
			+ &quot;              ON accAttrib.id = por.accountid &quot;
			+ &quot;       LEFT JOIN eventservicelog esl &quot;
			+ &quot;              ON esl.id IN (SELECT ESL.id AS logid &quot;
			+ &quot;                            FROM   [eventservicelog] ESL &quot;
			+ &quot;                                   JOIN event EV &quot;
			+ &quot;                                     ON ESL.eventid = EV.id  and EV.PaymentInID is null&quot;
			+ &quot;                            WHERE  EV.paymentoutid = por.id &quot;
			+ &quot;                           ) &quot;
			+ &quot;       LEFT JOIN userresourcelock ur &quot;
			+ &quot;              ON por.id = ur.resourceid &quot;
			+ &quot;                 AND ur.lockreleasedon IS NULL &quot;
			+ &quot;                 AND ur.resourcetype = 'PAYMENT_OUT' &quot;
			+ &quot;ORDER  BY esl.servicetype,ESL.updatedon desc&quot;),
				
<span class="fc" id="L785">	GET_PAYMENTOUT_STATUS_REASON(&quot;SELECT sur.Reason , ISNULL(psr.PaymentOutID,-1) AS PaymentOutID FROM StatusUpdateReason sur &quot;</span>
			+ &quot;LEFT JOIN PaymentOutStatusReason psr ON psr.StatusUpdateReasonID=sur.id AND  psr.PaymentOutID=? &quot;
			+ &quot;WHERE  sur.Module IN ('PAYMENT_OUT','ALL') order by sur.Reason&quot;),
	
<span class="fc" id="L789">	INSERT_PAYMENT_OUT_ACTIVITY_LOG_DETAIL(&quot;INSERT INTO [PaymentOutActivityLogDetail]([ActivityID], [ActivityType], [Log], [CreatedBy], [CreatedOn]) VALUES(?, (SELECT Id FROM ActivityTypeEnum WHERE Module=? and Type=?), ?, (select Id from [user] where SSOUserID=?), ?)&quot;),</span>
	
<span class="fc" id="L791">	INSERT_PAYMENT_OUT_ACTIVITY_LOG(&quot;INSERT INTO [PaymentOutActivityLog]  ( PaymentOutID, ActivityBy, [Timestamp], Comments, CreatedBy, CreatedOn, UserLockID) &quot;</span>
			+ &quot; VALUES(?, (select Id from [user] where SSOUserID=?), &quot;
			+ &quot;?, ?, (select Id from [user] where SSOUserID=?), ?, &quot;
			+ &quot;(SELECT ID FROM UserResourceLock WHERE ResourceType = 1 AND ResourceID = ? AND LockReleasedOn IS NULL) )&quot;),
	
<span class="fc" id="L796">	GET_PAYMENTOUT_STATUS_WITH_OHTER_STATUS(&quot;SELECT PCSE.Status, PO.Id FROM PaymentOut PO RIGHT JOIN PaymentComplianceStatusEnum PCSE ON PO.ComplianceStatus = PCSE.Id and PO.Id = ?&quot;),</span>
	
<span class="fc" id="L798">	GET_PAYMENTOUT_ACTIVITY_LOGS_BY_ROWS(&quot;WITH SELECTedID AS ( &quot;</span>
			+ &quot; &quot;
			+ &quot; SELECT ( &quot;
			+ &quot; select SSOUserId from [user] where ID=pal.ActivityBy)  AS [User], &quot;
			+ &quot; pal.createdon, &quot;
			+ &quot; pald.log                    AS [Activity], &quot;
			+ &quot; ate.module  +' '+ ate.type AS [ActivityType], &quot;
			+ &quot; pal.Comments AS [Comment] &quot;
			+ &quot; FROM  PaymentOutActivitylog pal &quot;
			+ &quot; JOIN PaymentOutActivitylogdetail pald &quot;
			+ &quot; ON pal.id = pald.activityid &quot;
			+ &quot; AND pal.paymentOutId = ? &quot;
			+ &quot; JOIN activitytypeenum ate &quot;
			+ &quot; ON pald.activitytype = ate.id ) &quot;
			+ &quot;SELECT * FROM SELECTedID &quot;
			+ &quot;ORDER BY &quot;
			+ &quot; SELECTedID.CreatedOn desc  offset ? rows  FETCH next ? rows only&quot;),
	
<span class="fc" id="L816">	GET_VIEWMORE_PAYMENTOUT_DETAILS(&quot;Select * from (SELECT Row_number() &quot;</span>
			+ &quot;OVER (ORDER BY id DESC) AS rownum, PQueue.* from (select esl.id, &quot;
			+ &quot;       esl.eventId, &quot;
			+ &quot;      eve.PaymentOutID, &quot;
			+ &quot;       esl.entitytype, esl.entityid, &quot;
			+ &quot;      esl.createdon, &quot;
			+ &quot;      esl.updatedon, &quot;
			+ &quot;      esl.Summary, &quot;
			+ &quot;     (select SSOUserId from [user] where ID=esl.UpdatedBy) As UpdatedBy ,esl.status &quot;
			+ &quot;from Event eve Join EventServiceLog esl ON eve.id = esl.eventId &quot;
			+ &quot;where servicetype = (SELECT id &quot;
			+ &quot;        FROM   compliance_servicetypeenum &quot;
			+ &quot;           WHERE  code = ? ) &quot;
			+ &quot;and EntityType = ? &quot;
			+ &quot;and eve.PaymentOutID = ? &quot;
			+ &quot;and eve.PaymentInID is null )AS PQueue ) AS PQueue2   WHERE  rownum &gt;= ? &quot;
			+ &quot; AND rownum &lt;= ? ORDER  BY updatedon DESC&quot;), 
	
	
<span class="fc" id="L835">	GET_ACTIVITY_LOGS_OF_PAYMENT_OUT(&quot;WITH SELECTedID AS ( &quot;</span>
			+ &quot;SELECT ( &quot;
			+ &quot; select &quot;
			+ &quot; SSOUserId &quot;
			+ &quot; from &quot;
			+ &quot; [user] &quot;
			+ &quot; where &quot;
			+ &quot; ID = pal.ActivityBy &quot;
			+ &quot; ) As [User], &quot;
			+ &quot; pal.CreatedOn, &quot;
			+ &quot; pald.Log As [Activity], &quot;
			+ &quot; ate.module + ' ' + ate.type As [ActivityType], &quot;
			+ &quot; pal.Comments AS [Comment] &quot;
			+ &quot;FROM PaymentOutActivityLog pal &quot;
			+ &quot;JOIN PaymentOutActivityLogDetail pald ON &quot;
			+ &quot; pal.id = pald.ActivityId &quot;
			+ &quot; AND pal.paymentOutId = ? &quot;
			+ &quot;JOIN ActivityTypeEnum ate ON &quot;
			+ &quot; pald.ActivityType = ate.id ) &quot;
			+ &quot;SELECT * FROM SELECTedID &quot;
			+ &quot;ORDER BY &quot;
			+ &quot; SELECTedID.CreatedOn desc &quot;),
	
<span class="fc" id="L858">	INSERT_PAYMENT_OUT_REASON(&quot;INSERT INTO [PaymentOutStatusReason]([PaymentOutID], [StatusUpdateReasonID], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn]) VALUES(?, (SELECT Id FROM StatusUpdateReason WHERE Module IN ('PAYMENT_OUT','ALL') AND Reason=?), (select Id from [user] where SSOUserID=?), ?, (select Id from [user] where SSOUserID=?), ?)&quot;),</span>
	
<span class="fc" id="L860">	UPDATE_PAYMENT_OUT_STATUS(&quot;UPDATE [PaymentOut] SET ComplianceStatus=(SELECT Id FROM PaymentComplianceStatusEnum WHERE Status=?),UpdatedBy=(select id  from [user] where SSOUserID=?),UpdatedOn=?, isOnQueue=? WHERE Id=?&quot;),</span>
//added by neelesh pant
<span class="fc" id="L862">	VALIDATE_ACCOUNT_AND_CONTACT_FOR_PAYMENTSOUT( &quot;select a.id,a.Accountstatus,a.Sanctionstatus,b.ComplianceStatus &quot;</span>
			+ &quot;as ContactCompliancestatus  from Account a  join contact b &quot;
			+ &quot;on a.Id = b.accountid where a.id=6&quot;),
	
<span class="fc" id="L866">	GET_PAYMENT_OUT_NATIONALITY_DISPLAY_NAME(&quot;select coun.displayName AS NationalityFullName from contactattribute conattri Join Country coun &quot; </span>
	+ &quot;ON JSON_Value(ATTRIBUTES,'$.country_of_nationality') = coun.code where conattri.id = ? &quot;),
	
<span class="fc" id="L869">	GET_NO_OF_CONTACTS_FOR_ACCOUNT(&quot;select count(*) from Contact where AccountID = ?&quot;),</span>
	
<span class="fc" id="L871">	UPDATE_PAYMENT_OUT_IS_ON_QUEUE_STATUS(&quot;UPDATE [PaymentOut] SET  UpdatedBy=(select id  from [user] where SSOUserID=?), &quot;</span>
			+ &quot; UpdatedOn=?, isOnQueue=? WHERE Id=?&quot;),
	
<span class="fc" id="L874">	ORG_TABLE_JOIN(&quot;JOIN Organization org ON org.Id = payin.organizationID  &quot;),</span>
<span class="fc" id="L875">	PAYMENTIN_QUEUE_ATTRIBUTE_FILTER(&quot; SELECT p.id AS paymentid  FROM   comp.paymentinattribute P &quot; </span>
			+ &quot;{COUNTRY_JOIN} &quot;),
	
<span class="fc" id="L878">	GET_MOST_RECENT_PAYMENTOUT(&quot;SELECT MAX(poa.id) as id, A.type FROM PaymentOut P JOIN PaymentOutAttribute poa ON P.id=poa.id &quot; + </span>
			&quot; JOIN Account A ON P.accountid= A.id&quot; + 
			&quot; WHERE A.TradeAccountnumber=?&quot; + 
			&quot; AND (JSON_VALUE(ATTRIBUTES, '$.beneficiary.account_number'))=? group by A.type&quot;),
	
<span class="fc" id="L883">	USER_FILTER_JOIN(&quot; JOIN [USER] usr ON usr.id = ur.createdby&quot;),</span>
	
<span class="fc" id="L885">	GET_SERVICE_FAILURE_PAYMENT_OUT_DETAILS(&quot;SELECT po.id AS paymentID, &quot;</span>
			+ &quot; po.[ContractNumber], &quot;
			+ &quot; po.TradePaymentID, &quot;
			+ &quot; o.Code AS orgCode, &quot;
			+ &quot; o.id AS orgID, &quot;
			+ &quot; po.AccountID, &quot;
			+ &quot; po.ContactID, &quot;
			+ &quot; po.compliancestatus &quot;
			+ &quot;FROM PaymentOut po &quot;
			+ &quot;JOIN Organization o ON po.OrganizationID = o.id &quot;
			+ &quot;JOIN Account ac ON po.accountid = ac.id &quot;
			+ &quot;WHERE &quot;
			+ &quot; po.ComplianceStatus = 4 &quot;
			+ &quot; AND (po.fraugsterstatus IN(8) &quot;
			+ &quot; OR po.SanctionStatus IN(8) &quot;
			+ &quot; OR po.BlacklistStatus IN(8) &quot;
			+ &quot; OR po.CustomCheckStatus IN(8)) &quot;
			+ &quot; AND po.createdon BETWEEN ? AND ? &quot;),
	
<span class="fc" id="L904">	GET_SERVICE_FAILURE_PAYMENT_OUT_COUNT(&quot;SELECT &quot;</span>
			+ &quot; Count(CASE WHEN po.FraugsterStatus IN (8) THEN 1 ELSE NULL END) AS Fraugster_Fail,&quot; 
			+ &quot; Count(CASE WHEN po.SanctionStatus IN (8) THEN 1 ELSE NULL END) AS Sanction_Fail, &quot;
			+ &quot; Count(CASE WHEN po.BlacklistStatus IN (8) THEN 1 ELSE NULL END) AS Blacklist_Fail, &quot;
			+ &quot; Count(CASE WHEN po.CustomCheckStatus IN (8) THEN 1 ELSE NULL END) AS CustomCheck_Fail &quot;
			+ &quot;FROM PaymentOut po &quot;
			+ &quot;WHERE&quot;
			+ &quot; po.ComplianceStatus = 4 &quot;
			+ &quot; AND po.createdon BETWEEN ? AND ? &quot;
			),
	
<span class="fc" id="L915">	INSERT_INTO_REPROCESS_FAILED (&quot;INSERT INTO ReproccessFailed &quot; </span>
            + &quot; (TransType, BatchId, TransId, Status, RetryCount, CreatedBy, CreatedOn)&quot;
            + &quot; VALUES(?, ?, ?, ?, ?, ?, ?)&quot; 
            ),
	
<span class="fc" id="L920">	GET_FIRST_FAILED_RECORD(&quot;select TOP 1 * from ReproccessFailed where BatchId = ? and TransType = ?&quot;),</span>
	
<span class="fc" id="L922">	UPDATE_FAILED_PAYMENT_OUT(&quot;UPDATE ReproccessFailed set Status = ? where id = ?&quot;),</span>
	
<span class="fc" id="L924">	GET_REPROCESS_STATUS_FOR_FAILED_RECORD(&quot;SELECT Status from ReproccessFailed where TransId = ? AND TransType = ? &quot;), </span>
	
<span class="fc" id="L926">	DELETE_REPROCESS_FAILED(&quot;DELETE from ReproccessFailed where Status = 3&quot;), //AT-4289 - delete pass check records</span>
	
<span class="fc" id="L928">	RESEED_REPROCESS_FAILED_AFTER_DELETE(&quot;DBCC CHECKIDENT ('ReproccessFailed', RESEED, 0)&quot;),</span>
	
<span class="fc" id="L930">	GET_REPROCESS_ELIGIBLE_PAYMENTS(&quot;SELECT * FROM ReproccessFailed where BatchId = ? and TransType = ? &quot;),</span>
	
<span class="fc" id="L932">	GET_MAX_BATCH_ID_FROM_REPROCESS_FAILED(&quot;SELECT Max(BatchId) AS MaxBatchId FROM ReproccessFailed&quot;),</span>
	
	//GET_REPROCCESS_STATUS(&quot;SELECT COUNT(Status) as Status FROM ReproccessFailed WHERE Status = ? AND BatchId = ?&quot;),
<span class="fc" id="L935">	GET_REPROCCESS_STATUS(&quot;SELECT COUNT(Status) as Status FROM ReproccessFailed WHERE RetryCount = 1 AND BatchId = ?&quot;), //AT-4289</span>
	
	//Add for AT-3161
<span class="fc" id="L938">	GET_FRAUD_PREDICT_FLAG_FOR_CUSTOM_RULE(&quot;SELECT JSON_VALUE(a.[Attribute], '$.fraudPredictCustomCheckEnabled') AS alwaysPass, b.Code FROM compliance_ServiceProviderAttribute a &quot;</span>
			+ &quot; LEFT JOIN compliance_ServiceProvider b on a.ID = b.ID where b.Code = 'FRAUD_PREDICT_SIGNUP'&quot;),
	
<span class="fc" id="L941">	UPDATE_CONTACT_POI_EXISTS_FLAG(&quot;update Contact set POIExists = 1 where CRMContactID = ?&quot;),//AT-3450</span>
	
	//Add for AT-4289
<span class="fc" id="L944">	COUNT_REPROCESS_FAILED(&quot;With Count AS( &quot;</span>
			+ &quot;SELECT &quot;
			+ &quot;Count(CASE WHEN Status=1 THEN 1 ELSE null END) AS FailC, &quot;
			+ &quot;Count(CASE WHEN Status=2 THEN 1 ELSE null END) AS InPro, &quot;
			+ &quot;Count(CASE WHEN Status=3 THEN 1 ELSE null END) AS PASS &quot;
			+ &quot;FROM ReproccessFailed WHERE BatchId = ? GROUP BY status &quot;
			+ &quot;) &quot;
			+ &quot;SELECT SUM(PASS) 'Pass', SUM(FailC) 'Fail', SUM(InPro) 'Inprogress' &quot;
			+ &quot;FROM Count&quot;),
	
<span class="fc" id="L954">	CLEAR_REPROCESS_FAILED(&quot;DELETE from ReproccessFailed&quot;);</span>
	
	private String query;

<span class="fc" id="L958">	PaymentOutQueryConstant(String query) {</span>
<span class="fc" id="L959">		this.query = query;</span>

<span class="fc" id="L961">	}</span>

	public String getQuery() {
<span class="fc" id="L964">		return this.query;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>