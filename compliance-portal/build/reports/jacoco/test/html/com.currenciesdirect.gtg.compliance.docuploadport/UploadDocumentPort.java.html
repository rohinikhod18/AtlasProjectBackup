<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadDocumentPort.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.docuploadport</a> &gt; <span class="el_source">UploadDocumentPort.java</span></div><h1>UploadDocumentPort.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.docuploadport;

import java.util.ArrayList;
import java.util.List;

import javax.ws.rs.core.MediaType;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.currenciesdirect.gtg.compliance.core.domain.docupload.Document;
import com.currenciesdirect.gtg.compliance.core.domain.docupload.DocumentDetails;
import com.currenciesdirect.gtg.compliance.core.domain.docupload.DocumentDto;
import com.currenciesdirect.gtg.compliance.core.domain.docupload.DocumentRequest;
import com.currenciesdirect.gtg.compliance.exception.CompliancePortalException;
import com.currenciesdirect.gtg.compliance.util.DateTimeFormatter;
import com.currenciesdirect.gtg.compliance.util.HttpClientPool;
import com.currenciesdirect.gtg.compliance.util.JsonConverterUtil;

/**
 * The Class UploadDocumentPort.
 */
public class UploadDocumentPort {

	/** The log. */
<span class="nc" id="L26">	private static Logger log = LoggerFactory.getLogger(UploadDocumentPort.class);</span>

	/**
	 * Instantiates a new upload document port.
	 */
	private UploadDocumentPort() {
	}

	/**
	 * Gets the attached document.
	 *
	 * @param crmAccountId
	 *            the crm account id
	 * @param crmContactId
	 *            the crm contact id
	 * @param orgCode
	 *            the org code
	 * @param source
	 *            the source
	 * @return the attached document
	 * @throws CompliancePortalException
	 *             the compliance portal exception
	 */
	public static List&lt;Document&gt; getAttachedDocument(String crmAccountId, String crmContactId, String orgCode,
			String source) throws CompliancePortalException {
<span class="nc" id="L51">		DocumentRequest documentRequest = getDocumentRequest(crmAccountId, crmContactId, orgCode, source);</span>
<span class="nc" id="L52">		HttpClientPool clientPool = HttpClientPool.getInstance();</span>
		try {
<span class="nc" id="L54">			String baseUrl = System.getProperty(&quot;baseEnterpriseUrl&quot;);</span>
<span class="nc" id="L55">			List&lt;Document&gt; documents = clientPool</span>
<span class="nc" id="L56">					.sendRequest(baseUrl + &quot;/es-restfulinterface/rest/documentService/acquireFiles&quot;, &quot;POST&quot;,</span>
<span class="nc" id="L57">							JsonConverterUtil.convertToJsonWithoutNull(documentRequest), DocumentDetails.class, null,</span>
							MediaType.TEXT_PLAIN_TYPE)
<span class="nc" id="L59">					.getDocumentList();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">			if (documents == null) {</span>
<span class="nc" id="L61">				return new ArrayList&lt;&gt;();</span>
			}
<span class="nc" id="L63">			return documents;</span>
<span class="nc" id="L64">		} catch (Exception e) {</span>
<span class="nc" id="L65">			log.error(&quot;Exception: {1} &quot;, e);</span>
		}
<span class="nc" id="L67">		return new ArrayList&lt;&gt;();</span>
	}

	/**
	 * Gets the document request.
	 *
	 * @param crmAccountId
	 *            the crm account id
	 * @param crmContactId
	 *            the crm contact id
	 * @param orgCode
	 *            the org code
	 * @param source
	 *            the source
	 * @return the document request
	 */
	private static DocumentRequest getDocumentRequest(String crmAccountId, String crmContactId, String orgCode,
			String source) {
<span class="nc bnc" id="L85" title="All 8 branches missed.">		if (crmAccountId == null || crmContactId == null || orgCode == null || source == null) {</span>
<span class="nc" id="L86">			return null;</span>
		}
<span class="nc" id="L88">		DocumentRequest documentRequest = new DocumentRequest();</span>
<span class="nc" id="L89">		documentRequest.setCrmAccountID(crmAccountId);</span>
<span class="nc" id="L90">		documentRequest.setCrmContactID(crmContactId);</span>
<span class="nc" id="L91">		documentRequest.setOrgCode(orgCode);</span>
<span class="nc" id="L92">		documentRequest.setWithDetails(Boolean.FALSE);</span>
<span class="nc" id="L93">		documentRequest.setSource(source);</span>
<span class="nc" id="L94">		return documentRequest;</span>
	}

	/**
	 * Update document date format.
	 *
	 * @param documents
	 *            the documents
	 * @return the list
	 */
	public static List&lt;DocumentDto&gt; updateDocumentDateFormat(List&lt;Document&gt; documents) {

<span class="nc" id="L106">		List&lt;DocumentDto&gt; documentList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L107" title="All 2 branches missed.">		for (Document document : documents) {</span>
<span class="nc" id="L108">			DocumentDto documentDto = new DocumentDto();</span>
<span class="nc" id="L109">			documentDto.setCreatedBy(document.getCreatedBy());</span>
<span class="nc" id="L110">			documentDto.setDocumentName(document.getDocumentName());</span>
<span class="nc bnc" id="L111" title="All 2 branches missed.">			if (isNullOrEmpty(document.getDocumentType())) {</span>
<span class="nc" id="L112">				documentDto.setDocumentType(&quot;-&quot;);</span>
			} else {
<span class="nc" id="L114">				documentDto.setDocumentType(document.getDocumentType());</span>
			}
<span class="nc bnc" id="L116" title="All 2 branches missed.">			if (isNullOrEmpty(document.getNote())) {</span>
<span class="nc" id="L117">				documentDto.setNote(&quot;-&quot;);</span>
			} else {
<span class="nc" id="L119">				documentDto.setNote(document.getNote());</span>
			}
<span class="nc" id="L121">			documentDto.setUrl(document.getUrl());</span>
<span class="nc" id="L122">			documentDto.setCreatedOn(DateTimeFormatter.dateTimeFormatter(document.getCreatedOn()));</span>
<span class="nc" id="L123">			documentDto.setAuthorized(document.getAuthorized());</span>
<span class="nc" id="L124">			documentDto.setCategory(document.getCategory());</span>
<span class="nc" id="L125">			documentDto.setDocumentId(document.getDocumentId());</span>
<span class="nc" id="L126">			documentList.add(documentDto);</span>
<span class="nc" id="L127">		}</span>

<span class="nc" id="L129">		return documentList;</span>
	}

	/**
	 * Checks if is null or empty.
	 *
	 * @param str
	 *            the str
	 * @return true, if is null or empty
	 */
	private static boolean isNullOrEmpty(String str) {
<span class="nc" id="L140">		boolean result = true;</span>
<span class="nc bnc" id="L141" title="All 4 branches missed.">		if (str != null &amp;&amp; !str.isEmpty())</span>
<span class="nc" id="L142">			return false;</span>

<span class="nc" id="L144">		return result;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>