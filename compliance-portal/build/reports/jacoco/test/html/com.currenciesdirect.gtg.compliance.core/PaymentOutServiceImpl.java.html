<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PaymentOutServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.core</a> &gt; <span class="el_source">PaymentOutServiceImpl.java</span></div><h1>PaymentOutServiceImpl.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.core;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.MultivaluedHashMap;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Component;

import com.currenciesdirect.gtg.compliance.commons.domain.commhub.request.EmailHeader;
import com.currenciesdirect.gtg.compliance.commons.domain.commhub.request.EmailPayload;
import com.currenciesdirect.gtg.compliance.commons.domain.commhub.request.SendEmailRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.profile.request.Contact;
import com.currenciesdirect.gtg.compliance.commons.externalservice.commhubport.ICommHubServiceImpl;
import com.currenciesdirect.gtg.compliance.core.domain.ActivityLogRequest;
import com.currenciesdirect.gtg.compliance.core.domain.ActivityLogs;
import com.currenciesdirect.gtg.compliance.core.domain.Constants;
import com.currenciesdirect.gtg.compliance.core.domain.CustomUpdateRequest;
import com.currenciesdirect.gtg.compliance.core.domain.CustomUpdateResponse;
import com.currenciesdirect.gtg.compliance.core.domain.PaymentOutViewMoreRequest;
import com.currenciesdirect.gtg.compliance.core.domain.ViewMoreResponse;
import com.currenciesdirect.gtg.compliance.core.domain.docupload.Document;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutDetailsDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutQueueDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutSearchCriteria;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutUpdateDBDto;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.PaymentOutUpdateRequest;
import com.currenciesdirect.gtg.compliance.core.domain.paymentout.RecentPaymentOutDetails;
import com.currenciesdirect.gtg.compliance.docuploadport.UploadDocumentPort;
import com.currenciesdirect.gtg.compliance.exception.CompliancePortalErrors;
import com.currenciesdirect.gtg.compliance.exception.CompliancePortalException;
import com.currenciesdirect.gtg.compliance.iam.core.domain.UserProfile;
import com.currenciesdirect.gtg.compliance.util.DateTimeFormatter;
import com.currenciesdirect.gtg.compliance.util.HttpClientPool;
import com.currenciesdirect.gtg.compliance.util.JsonConverterUtil;


@Component(&quot;paymentOutServiceImpl&quot;)
<span class="fc" id="L48">public class PaymentOutServiceImpl implements IPaymentOutService{</span>

<span class="fc" id="L50">	private Logger log = LoggerFactory.getLogger(PaymentOutServiceImpl.class);</span>
	
	@Autowired
	@Qualifier(&quot;commHubServiceImpl&quot;)
	private ICommHubServiceImpl iCommHubServiceImpl;
	
	@Autowired
	@Qualifier(&quot;paymentOutDBServiceImpl&quot;)
	private IPaymentOutDBService iPaymentOutDBService;
	
	@Autowired
	@Qualifier(&quot;paymentOutUpdateTransformer&quot;)
	private ITransform&lt;PaymentOutUpdateDBDto, PaymentOutUpdateRequest&gt; paymentOutUpdateTransformer;
	
	@Override
	public PaymentOutQueueDto getPaymentOutQueueWithCriteria(PaymentOutSearchCriteria searchCriteria)
			throws CompliancePortalException {
		try {
<span class="fc" id="L68">			return iPaymentOutDBService.getPaymentOutQueueWithCriteria(searchCriteria);</span>
<span class="fc" id="L69">		} catch (CompliancePortalException e) {</span>
<span class="fc" id="L70">			logError(e.getOrgException());</span>
<span class="fc" id="L71">			throw e;</span>
		}

	}

	@Override
	public PaymentOutDetailsDto getPaymentOutDetails(Integer paymentOutId, String custType, PaymentOutSearchCriteria searchCriteria) throws CompliancePortalException {
		
		try {
<span class="nc" id="L80">			PaymentOutDetailsDto paymentOutDetailDto = iPaymentOutDBService.getPaymentOutDetails(paymentOutId, custType, searchCriteria);</span>
<span class="nc" id="L81">			addDocuments(paymentOutDetailDto);</span>
<span class="nc bnc" id="L82" title="All 4 branches missed.">			if (searchCriteria != null &amp;&amp; searchCriteria.getPage() != null) {</span>
<span class="nc" id="L83">				paymentOutDetailDto.setCurrentRecord(searchCriteria.getPage().getCurrentRecord());</span>
<span class="nc" id="L84">				paymentOutDetailDto.setTotalRecords(searchCriteria.getPage().getTotalRecords());</span>
			}
<span class="nc" id="L86">			return paymentOutDetailDto;</span>
<span class="nc" id="L87">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L88">			logError(e.getOrgException());</span>
<span class="nc" id="L89">			throw e;</span>
		}
	}
	
  @Override
	public  RecentPaymentOutDetails getMostRecentPaymentOutId(String tradeAccountNumber,String beneAccountNumber) throws CompliancePortalException {
		try {
<span class="nc" id="L96">			   return iPaymentOutDBService.getMostRecentPaymentOutId(tradeAccountNumber, beneAccountNumber);</span>
			} 
<span class="nc" id="L98">		catch (CompliancePortalException e) {</span>
<span class="nc" id="L99">			   logError(e.getOrgException());</span>
<span class="nc" id="L100">			   throw e;</span>
		   }
	}

	@Override
	public PaymentOutDetailsDto getPaymentOutDetailsWithCriteria(PaymentOutSearchCriteria searchCriteria) throws CompliancePortalException {
		try {
<span class="nc" id="L107">			PaymentOutDetailsDto paymentOutDetailDto = iPaymentOutDBService.getPaymentOutDetailsWithCriteria(searchCriteria);</span>
<span class="nc" id="L108">			addDocuments(paymentOutDetailDto);</span>
<span class="nc bnc" id="L109" title="All 4 branches missed.">			if (searchCriteria != null &amp;&amp; searchCriteria.getPage() != null) {</span>
<span class="nc" id="L110">				paymentOutDetailDto.setSearchCriteria(JsonConverterUtil.convertToJsonWithNull(searchCriteria));</span>
<span class="nc" id="L111">				paymentOutDetailDto.setCurrentRecord(searchCriteria.getPage().getCurrentRecord());</span>
<span class="nc" id="L112">				paymentOutDetailDto.setTotalRecords(searchCriteria.getPage().getTotalRecords());</span>
			}
<span class="nc" id="L114">			return paymentOutDetailDto;</span>
<span class="nc" id="L115">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L116">			logError(e.getOrgException());</span>
<span class="nc" id="L117">			throw e;</span>
		}
	}

	@Override
	public ActivityLogs getActivityLogs(ActivityLogRequest request) throws CompliancePortalException {
		try {
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">			if (request == null) {</span>
<span class="nc" id="L125">				throw new CompliancePortalException(CompliancePortalErrors.INVALID_REQUEST);</span>
			} else 	{
<span class="fc" id="L127">				return iPaymentOutDBService.getActivityLogs(request);</span>
			}
			
<span class="fc" id="L130">		}catch (CompliancePortalException e) {</span>
<span class="fc" id="L131">			logError(e);</span>
<span class="fc" id="L132">			throw e;</span>

<span class="nc" id="L134">		} catch (Exception e) {</span>
<span class="nc" id="L135">			logError(e);</span>
<span class="nc" id="L136">			throw new CompliancePortalException(CompliancePortalErrors.DATABASE_GENERIC_ERROR, e);</span>
		}
	}
	
	private void logError(Throwable t) {
<span class="fc" id="L141">		log.error(&quot;Exception: &quot;, t);</span>
<span class="fc" id="L142">	}</span>

	@Override
	public ActivityLogs updatePaymentOut(PaymentOutUpdateRequest request) throws CompliancePortalException {
		
		try {
<span class="nc" id="L148">			PaymentOutUpdateDBDto paymentOutUpdateDBDto = paymentOutUpdateTransformer.transform(request);</span>
<span class="nc" id="L149">			String paymentOutRequest = JsonConverterUtil.convertToJsonWithoutNull(paymentOutUpdateDBDto);</span>
<span class="nc" id="L150">			log.info(&quot;\n Payment Out Status Change on UI request : \n{}&quot;,paymentOutRequest);</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">			if(Constants.CLEAR.equalsIgnoreCase(request.getUpdatedPaymentOutStatus())){</span>
				CustomUpdateResponse customUpdateResponse ;
<span class="nc" id="L153">				customUpdateResponse=customUpdateService(request.getOrgCode(),request.getPaymentOutId(),</span>
<span class="nc" id="L154">						JsonConverterUtil.convertToJsonWithNull(request.getUser()), </span>
<span class="nc" id="L155">						request.getCountry(),request.getCountryRiskLevel(), request.getBeneCheckStatus());</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">				if(Constants.PASS.equalsIgnoreCase(customUpdateResponse.getOverallStatus())){					</span>
<span class="nc" id="L157">					return iPaymentOutDBService.updatePaymentOut(paymentOutUpdateDBDto);</span>
				}
<span class="nc" id="L159">			}</span>
			else {
<span class="nc" id="L161">				ActivityLogs activityLogs =  iPaymentOutDBService.updatePaymentOut(paymentOutUpdateDBDto);</span>
				//Add code comment for jira AT-4519
				//sendEmailOnRejectOrSeizeByCommhub(request);
<span class="nc" id="L164">				return activityLogs;</span>
			}
			
<span class="nc" id="L167">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L168">			logError(e);</span>
<span class="nc" id="L169">			throw e;</span>

<span class="nc" id="L171">		} catch (Exception e) {</span>
<span class="nc" id="L172">			logError(e);</span>
<span class="nc" id="L173">			throw new CompliancePortalException(CompliancePortalErrors.ERROR_WHILE_UPDATING_DATA, e);</span>
<span class="nc" id="L174">		}</span>
<span class="nc" id="L175">		return null;</span>
	}


	/**
	 * Send email on reject or seize by commhub.
	 *
	 * @param paymentOutUpdateDBDto the payment out update DB dto
	 */
	
	//Code add for AT-1999 Commhub API
	private void sendEmailOnRejectOrSeizeByCommhub(PaymentOutUpdateRequest paymentOutUpdateDBDto) {
		try {
<span class="nc" id="L188">			Timestamp timestamp = new Timestamp(System.currentTimeMillis());</span>
<span class="nc bnc" id="L189" title="All 2 branches missed.">			if (Constants.REJECT.equalsIgnoreCase(paymentOutUpdateDBDto.getUpdatedPaymentOutStatus())</span>
<span class="nc bnc" id="L190" title="All 2 branches missed.">					|| Constants.SEIZE.equalsIgnoreCase(paymentOutUpdateDBDto.getUpdatedPaymentOutStatus())) {</span>
<span class="nc" id="L191">				SendEmailRequest emailrequest = new SendEmailRequest();</span>
<span class="nc" id="L192">				EmailHeader header =  new EmailHeader();</span>
<span class="nc" id="L193">				header.setOrgCode(paymentOutUpdateDBDto.getOrgCode());</span>
<span class="nc" id="L194">				header.setLegalEntity(paymentOutUpdateDBDto.getLegalEntity());</span>
<span class="nc" id="L195">				header.setCustomerType(paymentOutUpdateDBDto.getCustType());</span>
<span class="nc" id="L196">				header.setCustNumber(paymentOutUpdateDBDto.getClientNumber());</span>
<span class="nc" id="L197">				String[] notification = {&quot;Email&quot;};</span>
<span class="nc" id="L198">	 			header.setNotificationType(notification);	</span>
<span class="nc" id="L199">				header.setEvent(Constants.PAYMENT_OUT_REJECT_EVENT);</span>
<span class="nc" id="L200">				header.setLocale(Constants.LOCALE_EN);</span>
<span class="nc" id="L201">				header.setSourceSystem(&quot;Atlas&quot;);</span>
<span class="nc" id="L202">				header.setRetryTimeout(&quot;60000&quot;);</span>
<span class="nc" id="L203">				header.setOsrId(UUID.randomUUID().toString());</span>
				
<span class="nc" id="L205">				EmailPayload payload = new EmailPayload();</span>
<span class="nc" id="L206">				payload.setEmailId(System.getProperty(paymentOutUpdateDBDto.getOrgCode().replaceAll(&quot;\\s+&quot;, &quot;&quot;).toLowerCase()+Constants.EAMIL_SENDTO));</span>
<span class="nc" id="L207">				payload.setSubject(&quot;Payment Out Rejected/Seized&quot;);</span>
<span class="nc" id="L208">					Map&lt;String,String&gt; attributes = new HashMap&lt;&gt;();</span>
<span class="nc" id="L209">					attributes.put(&quot;#updated_payment_status&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getUpdatedPaymentOutStatus()));</span>
<span class="nc" id="L210">					attributes.put(&quot;#customer_number&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getClientNumber()));</span>
<span class="nc" id="L211">					attributes.put(&quot;#trade_contractId&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getTradeContractNumber()));</span>
<span class="nc" id="L212">					attributes.put(&quot;#beneficiary_amount&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getBeneficiaryAmount()));</span>
<span class="nc" id="L213">					attributes.put(&quot;#currency&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getBuyCurrency()));</span>
<span class="nc" id="L214">					attributes.put(&quot;#payment_status&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getPrePaymentOutStatus()));</span>
<span class="nc" id="L215">					attributes.put(&quot;#today_date&quot;, DateTimeFormatter.dateTimeFormatter(timestamp));</span>
<span class="nc" id="L216">					attributes.put(&quot;#username&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getUserName()));</span>
<span class="nc" id="L217">					attributes.put(&quot;#status_reason&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getStatusReason()));</span>
<span class="nc" id="L218">					attributes.put(&quot;#comment&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getComment()));</span>
<span class="nc" id="L219">					attributes.put(&quot;#beneficiary_name&quot;, getPlaceholdersValue(paymentOutUpdateDBDto.getBeneficiaryName()));</span>
<span class="nc" id="L220">				payload.setPlaceHolder(attributes);</span>
					
<span class="nc" id="L222">				emailrequest.setHeader(header);</span>
<span class="nc" id="L223">				emailrequest.setPayload(payload);</span>

<span class="nc" id="L225">				iCommHubServiceImpl.sendEmail(emailrequest,true);</span>
			}
<span class="nc" id="L227">		}catch(Exception e) {</span>
<span class="nc" id="L228">			logError(e);</span>
<span class="nc" id="L229">		}</span>
<span class="nc" id="L230">	}</span>

	private CustomUpdateResponse customUpdateService(String orgCode, Integer paymentOutId, String userProfile,
			String country, String countryRiskLevel, String beneCheckStatus) throws CompliancePortalException {
<span class="nc" id="L234">		Integer paymentInId = null;</span>
<span class="nc" id="L235">		CustomUpdateRequest customUpdateRequest = getCustomUpdateRequest(orgCode, paymentOutId, paymentInId, country,</span>
				countryRiskLevel, beneCheckStatus);
<span class="nc" id="L237">		HttpClientPool clientPool = HttpClientPool.getInstance();</span>
<span class="nc" id="L238">		MultivaluedHashMap&lt;String, Object&gt; headers = new MultivaluedHashMap&lt;&gt;();</span>
<span class="nc" id="L239">		ArrayList&lt;Object&gt; list = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L240">		list.add(userProfile);</span>
<span class="nc" id="L241">		headers.put(&quot;user&quot;, list);</span>
<span class="nc" id="L242">		String baseUrl = System.getProperty(&quot;baseComplianceServiceUrl&quot;);</span>
<span class="nc" id="L243">		return clientPool.sendRequest(baseUrl + &quot;/compliance-service/services-internal/repeatcheck/updateWhiteListData&quot;,</span>
				&quot;POST&quot;, customUpdateRequest, CustomUpdateResponse.class, headers, MediaType.APPLICATION_JSON_TYPE);

	}

	private CustomUpdateRequest getCustomUpdateRequest(String orgCode, Integer paymentOutId, Integer paymentInId,
			String country, String countryRiskLevel, String beneCheckStatus) {
<span class="nc" id="L250">		CustomUpdateRequest customUpdateRequest = new CustomUpdateRequest();</span>
<span class="nc" id="L251">		customUpdateRequest.setOrgCode(orgCode);</span>
<span class="nc" id="L252">		customUpdateRequest.setPaymentOutId(paymentOutId);</span>
<span class="nc" id="L253">		customUpdateRequest.setPaymentInId(paymentInId);</span>
<span class="nc" id="L254">		customUpdateRequest.setCountry(country);</span>
<span class="nc" id="L255">		customUpdateRequest.setCountryRiskLevel(countryRiskLevel);</span>
<span class="nc" id="L256">		customUpdateRequest.setBeneCheckStatus(beneCheckStatus);</span>
<span class="nc" id="L257">		return customUpdateRequest;</span>
	}

	private void addDocuments(PaymentOutDetailsDto paymentOutDetailDto) throws CompliancePortalException {
<span class="nc bnc" id="L261" title="All 4 branches missed.">		if (paymentOutDetailDto.getAccount() != null &amp;&amp; paymentOutDetailDto.getCurrentContact() != null) {</span>
<span class="nc" id="L262">			List&lt;Document&gt; documents = UploadDocumentPort.getAttachedDocument(</span>
<span class="nc" id="L263">					paymentOutDetailDto.getCurrentContact().getCrmAccountId(),</span>
<span class="nc" id="L264">					paymentOutDetailDto.getCurrentContact().getCrmContactId(),</span>
<span class="nc" id="L265">					paymentOutDetailDto.getAccount().getOrgCode(),Constants.SOURCE_SALESFORCE);</span>
<span class="nc" id="L266">					paymentOutDetailDto.setDocuments(UploadDocumentPort.updateDocumentDateFormat(documents));</span>
		}
		
<span class="nc" id="L269">	}</span>
	
	@Override
	public ViewMoreResponse viewMoreDetails(PaymentOutViewMoreRequest viewMoreRequest) throws CompliancePortalException {
<span class="fc" id="L273">		ViewMoreResponse viewMoreResponse = null;</span>
		try {
			
<span class="pc bpc" id="L276" title="1 of 2 branches missed.">			if (&quot;KYC&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){</span>
				
<span class="nc" id="L278">				viewMoreResponse = iPaymentOutDBService.getMoreKycDetails(viewMoreRequest);</span>
			    
<span class="pc bpc" id="L280" title="1 of 2 branches missed.">			}else if (&quot;SANCTION&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){</span>
				
<span class="nc" id="L282">				viewMoreResponse = iPaymentOutDBService.getMoreSanctionDetails(viewMoreRequest);</span>
			    
<span class="pc bpc" id="L284" title="1 of 2 branches missed.">			}else if (&quot;VELOCITYCHECK&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){ </span>
				
<span class="fc" id="L286">				viewMoreResponse = iPaymentOutDBService.getMoreCustomCheckDetails(viewMoreRequest);</span>

<span class="nc bnc" id="L288" title="All 2 branches missed.">			}else if (&quot;FRAUGSTER&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){</span>
				
<span class="nc" id="L290">				viewMoreResponse = iPaymentOutDBService.getMoreFraugsterDetails(viewMoreRequest);</span>
				
<span class="nc bnc" id="L292" title="All 2 branches missed.">			}else if (&quot;COUNTRYCHECK&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){</span>
				
<span class="nc" id="L294">				viewMoreResponse = iPaymentOutDBService.getMoreCountryCheckDetails(viewMoreRequest);</span>
<span class="nc bnc" id="L295" title="All 2 branches missed.">			}else if (&quot;BLACKLIST_PAY_REF&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){</span>
				
<span class="nc" id="L297">				viewMoreResponse = iPaymentOutDBService.getMorePaymentReferenceCheckDetails(viewMoreRequest);</span>
				
<span class="nc bnc" id="L299" title="All 2 branches missed.">			} else if (&quot;TRANSACTION_MONITORING&quot;.equalsIgnoreCase(viewMoreRequest.getServiceType())){</span>
				
<span class="nc" id="L301">				viewMoreResponse = iPaymentOutDBService.getMoreIntuitionCheckDetails(viewMoreRequest); //AT-4306</span>
				
			}
<span class="fc" id="L304">		} catch (CompliancePortalException e) {</span>
<span class="fc" id="L305">			logError(e);</span>
<span class="fc" id="L306">			throw e;</span>
<span class="nc" id="L307">		} catch (Exception e) {</span>
<span class="nc" id="L308">			logError(e);</span>
<span class="nc" id="L309">			throw new CompliancePortalException(CompliancePortalErrors.DATABASE_GENERIC_ERROR, e);</span>
<span class="fc" id="L310">		}</span>
<span class="fc" id="L311">		return viewMoreResponse;</span>
	}

	@Override
	public ViewMoreResponse getFurtherPaymentOutDetails(PaymentOutViewMoreRequest request) throws CompliancePortalException {
<span class="fc" id="L316">		ViewMoreResponse viewMoreResponse = null;</span>
		try {
<span class="pc bpc" id="L318" title="1 of 2 branches missed.">			if (&quot;PAYMENT_IN&quot;.equalsIgnoreCase(request.getServiceType())){</span>
				
<span class="fc" id="L320">				viewMoreResponse = iPaymentOutDBService.getViewMoreFurtherPaymentInDetails(request);</span>
			    
<span class="nc bnc" id="L322" title="All 2 branches missed.">			}else if (&quot;PAYMENT_OUT&quot;.equalsIgnoreCase(request.getServiceType())){</span>
				
<span class="nc" id="L324">				viewMoreResponse = iPaymentOutDBService.getFurtherPaymentOutDetails(request);</span>
			    
			}
<span class="fc" id="L327">		} catch (CompliancePortalException e) {</span>
<span class="fc" id="L328">			logError(e);</span>
<span class="fc" id="L329">			throw e;</span>

<span class="nc" id="L331">		} catch (Exception e) {</span>
<span class="nc" id="L332">			logError(e);</span>
<span class="nc" id="L333">			throw new CompliancePortalException(CompliancePortalErrors.ERROR_WHILE_UPDATING_DATA, e);</span>
<span class="fc" id="L334">		}</span>
<span class="fc" id="L335">		return viewMoreResponse;</span>
	}
	
	/**
	 * Gets the placeholders value.
	 *
	 * @param placeholders the placeholders
	 * @return the placeholders value
	 */
	private String getPlaceholdersValue(String placeholders) {
<span class="nc bnc" id="L345" title="All 4 branches missed.">		if(null != placeholders &amp;&amp; !placeholders.isEmpty())</span>
<span class="nc" id="L346">			return placeholders;</span>
<span class="nc" id="L347">		return &quot; &quot;;</span>
	}

	@Override
	public boolean setPoiExistsFlagForPaymentOut(UserProfile user, Contact contact) throws CompliancePortalException {
<span class="nc" id="L352">		boolean poiExists = false;</span>
		try {
<span class="nc" id="L354">			poiExists = iPaymentOutDBService.setPoiExistsFlagForPaymentOut(user,contact);</span>
<span class="nc" id="L355">		}catch (Exception e) {</span>
<span class="nc" id="L356">			throw new CompliancePortalException(CompliancePortalErrors.INVALID_REQUEST, e);</span>
<span class="nc" id="L357">		}</span>
<span class="nc" id="L358">		return poiExists;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>