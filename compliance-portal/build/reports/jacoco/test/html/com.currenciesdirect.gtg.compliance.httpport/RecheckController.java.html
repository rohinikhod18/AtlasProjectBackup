<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RecheckController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-portal</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.httpport</a> &gt; <span class="el_source">RecheckController.java</span></div><h1>RecheckController.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.httpport;

import javax.servlet.http.HttpServletRequest;
import javax.ws.rs.Consumes;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestAttribute;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import com.currenciesdirect.gtg.compliance.commons.util.JsonConverterUtil;
import com.currenciesdirect.gtg.compliance.core.IRecheckService;
import com.currenciesdirect.gtg.compliance.core.domain.BaseRepeatCheckRequest;
import com.currenciesdirect.gtg.compliance.core.domain.BaseRepeatCheckResponse;
import com.currenciesdirect.gtg.compliance.exception.CompliancePortalException;
import com.currenciesdirect.gtg.compliance.iam.core.domain.FunctionsAllowed;
import com.currenciesdirect.gtg.compliance.iam.core.domain.UserProfile;

/**
 * The Class RecheckController.
 */
@Controller
<span class="fc" id="L32">public class RecheckController extends BaseController {</span>

	/** The log. */
<span class="fc" id="L35">	private Logger log = LoggerFactory.getLogger(RecheckController.class);</span>

	/** The i recheck service. */
	@Autowired
	@Qualifier(&quot;recheckServiceImpl&quot;)
	private IRecheckService iRecheckService;

	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
	@PostMapping(value = &quot;/recheckRegistration&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse repeatCheckRegistrationFailures(@RequestAttribute(&quot;user&quot;) UserProfile user,
			@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L49">		BaseRepeatCheckResponse response = null;</span>

		try {
<span class="fc" id="L52">			response = iRecheckService.repeatCheckRegistrationFailures(user, request);</span>
<span class="nc" id="L53">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L54">			log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L56">		}</span>
<span class="fc" id="L57">		return response;</span>
	}

	/**
	 * Repeat check funds out failures.
	 *
	 * @param user
	 *            the user
	 * @param request
	 *            the request
	 * @return the base repeat check response
	 */
	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
	@PostMapping(value = &quot;/recheckFundsOut&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse repeatCheckFundsOutFailures(HttpServletRequest httpRequest, @RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L75">		BaseRepeatCheckResponse baseRepeatCheckResponse = null;</span>
		try {
<span class="fc" id="L77">			UserProfile user = JsonConverterUtil.convertToObject(UserProfile.class, httpRequest.getHeader(&quot;user&quot;));</span>
<span class="fc" id="L78">			baseRepeatCheckResponse = iRecheckService.repeatCheckFundsOutFailures(user, request);</span>
<span class="nc" id="L79">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L80">			log.debug(&quot;&quot;, e);</span>
<span class="fc" id="L81">		}</span>
<span class="fc" id="L82">		return baseRepeatCheckResponse;</span>
	}

	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
	@PostMapping(value = &quot;/recheckFundsIn&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse repeatCheckFundsInFailures(HttpServletRequest httpRequest,
			@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L92">		BaseRepeatCheckResponse baseRepeatCheckResponse = null;</span>

		try {
<span class="fc" id="L95">			UserProfile user = JsonConverterUtil.convertToObject(UserProfile.class, httpRequest.getHeader(&quot;user&quot;));</span>
<span class="fc" id="L96">			baseRepeatCheckResponse = iRecheckService.repeatCheckFundsInFailures(user, request);</span>
<span class="nc" id="L97">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L98">			log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L100">		}</span>
<span class="fc" id="L101">		return baseRepeatCheckResponse;</span>
	}

	/**
	 * Gets the registration service failure count.
	 *
	 * @param user
	 *            the user
	 * @param request
	 *            the request
	 * @return the registration service failure count
	 */
	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
	@PostMapping(value = &quot;/registrationServiceFailureCount&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse getRegistrationServiceFailureCount(@RequestAttribute(&quot;user&quot;) UserProfile user,
			@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L120">		BaseRepeatCheckResponse response = null;</span>

		try {
<span class="fc" id="L123">			response = iRecheckService.getRegistrationServiceFailureCount(user, request);</span>
<span class="nc" id="L124">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L125">			log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L127">		}</span>
<span class="fc" id="L128">		return response;</span>
	}

	/**
	 * Gets the funds in service failure count.
	 *
	 * @param user
	 *            the user
	 * @param request
	 *            the request
	 * @return the funds in service failure count
	 */
	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
	@PostMapping(value = &quot;/fundsInServiceFailureCount&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse getFundsInServiceFailureCount(@RequestAttribute(&quot;user&quot;) UserProfile user,
			@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L147">		BaseRepeatCheckResponse response = null;</span>

		try {
<span class="fc" id="L150">			response = iRecheckService.getFundsInServiceFailureCount(user, request);</span>
<span class="nc" id="L151">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L152">			log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L154">		}</span>
<span class="fc" id="L155">		return response;</span>
	}

	/**
	 * Gets the funds out service failure count.
	 *
	 * @param user
	 *            the user
	 * @param request
	 *            the request
	 * @return the funds out service failure count
	 */
	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
    @PostMapping(value = &quot;/fundsOutServiceFailureCount&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse getFundsOutServiceFailureCount(@RequestAttribute(&quot;user&quot;) UserProfile user,
			@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L174">		BaseRepeatCheckResponse response = null;</span>

		try {
<span class="fc" id="L177">			response = iRecheckService.getFundsOutServiceFailureCount(user, request);</span>
<span class="nc" id="L178">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L179">			log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L181">		}</span>
<span class="fc" id="L182">		return response;</span>
	}
	
	/**
	 * @param user
	 * @param request
	 * @return repeat check response
	 */
	@FunctionsAllowed(functions = { ViewControllerConstant.CAN_DO_ADMINISTRATION })
    @PostMapping(value = &quot;/forceClearFundsOuts&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
    @Produces(MediaType.APPLICATION_JSON)
    @ResponseBody
    public BaseRepeatCheckResponse forceClearFundsOuts(@RequestAttribute(&quot;user&quot;) UserProfile user,
            @RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L197">        BaseRepeatCheckResponse response = null;</span>

        try {
<span class="fc" id="L200">            response = iRecheckService.forceClearFundsOuts(user, request);</span>
<span class="nc" id="L201">        } catch (CompliancePortalException e) {</span>
<span class="nc" id="L202">            log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L204">        }</span>
<span class="fc" id="L205">        return response;</span>
    }

	@PostMapping(value = &quot;/repeatCheckProgressBar&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public Integer getRepeatCheckProgressBar(@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L213">		Integer response = null;</span>
		try {
<span class="fc" id="L215">			response = iRecheckService.getRepeatCheckProgressBar(request);</span>
		}
<span class="nc" id="L217">		catch(CompliancePortalException e) {</span>
<span class="nc" id="L218">			log.debug(&quot;&quot;,e);</span>
<span class="fc" id="L219">		}</span>
<span class="fc" id="L220">		return response;</span>
	}
	
	
	/**
	 * @param user
	 * @param request
	 * @return repeat check response
	 */
	@PostMapping(value = &quot;/forceClearFundsIn&quot;)
	@Consumes(MediaType.APPLICATION_JSON)
	@Produces(MediaType.APPLICATION_JSON)
	@ResponseBody
	public BaseRepeatCheckResponse forceClearFundsIn(@RequestAttribute(&quot;user&quot;) UserProfile user,
			@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L235">		BaseRepeatCheckResponse response = null;</span>

		try {
<span class="fc" id="L238">			response = iRecheckService.forceClearFundsIn(user, request);</span>
<span class="nc" id="L239">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L240">			log.debug(&quot;&quot;, e);</span>

<span class="fc" id="L242">		}</span>
<span class="fc" id="L243">		return response;</span>
	}
	
	/**
	 * Delete reprocess failed.
	 *
	 * @param request the request
	 * @return the integer
	 */
	@PostMapping(value = &quot;/deleteReprocessFailed&quot;)
	@ResponseBody
	public Integer deleteReprocessFailed(@RequestBody BaseRepeatCheckRequest request) {
<span class="fc" id="L255">		Integer result = 0;</span>
		try {
<span class="fc" id="L257">			result = iRecheckService.deleteReprocessFailed(request);</span>
<span class="nc" id="L258">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L259">			log.debug(&quot;&quot;, e);</span>
<span class="fc" id="L260">		}</span>
<span class="fc" id="L261">		return result;</span>
	}
	
	/**
	 * Update TMMQ retry count.
	 *
	 * @return true, if successful
	 */
	//Add For AT-4185
	@PostMapping(value = &quot;/updateTMMQRetryCount&quot;)
	@ResponseBody
	public boolean updateTMMQRetryCount() {
<span class="nc" id="L273">		boolean retryCount = false;</span>
		try {
<span class="nc" id="L275">			retryCount = iRecheckService.updateTMMQRetryCount();</span>
		}
<span class="nc" id="L277">		catch(Exception e) {</span>
<span class="nc" id="L278">			log.debug(&quot;Exception in RecheckController in updateTMMQRetryCount() {1}&quot;, e);</span>
<span class="nc" id="L279">		}</span>
<span class="nc" id="L280">		return retryCount;</span>
	}
	
	/**
	 * Show count reprocess failed.
	 *
	 * @param batchId the batch id
	 * @return the string
	 */ //AT-4355
	@GetMapping(value = &quot;/showCountReprocessFailed&quot;)
	@ResponseBody
	public String showCountReprocessFailed(@RequestParam(&quot;batchId&quot;) int batchId) {
<span class="nc" id="L292">		String result = null;</span>
		try {
<span class="nc" id="L294">			result = iRecheckService.showCountReprocessFailed(batchId);</span>
<span class="nc" id="L295">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L296">			log.debug(&quot;&quot;, e);</span>
<span class="nc" id="L297">		}</span>
<span class="nc" id="L298">		return result;</span>
	}

	/**
	 * Clear reprocess failed.
	 *
	 * @return the integer
	 */ //AT-4355
	@GetMapping(value = &quot;/clearReprocessFailed&quot;)
	@ResponseBody
	public Integer clearReprocessFailed() {
<span class="nc" id="L309">		Integer result = 0;</span>
		try {
<span class="nc" id="L311">			result = iRecheckService.clearReprocessFailed();</span>
<span class="nc" id="L312">		} catch (CompliancePortalException e) {</span>
<span class="nc" id="L313">			log.debug(&quot;&quot;, e);</span>
<span class="nc" id="L314">		}</span>
<span class="nc" id="L315">		return result;</span>
	}
	
	/**
	 * Update post card TMMQ retry count.
	 *
	 * @return true, if successful
	 */
	// Add For AT-5023
	@PostMapping(value = &quot;/updatePostCardTMMQRetryCount&quot;)
	@ResponseBody
	public boolean updatePostCardTMMQRetryCount() {
<span class="nc" id="L327">		boolean retryCount = false;</span>
		try {
<span class="nc" id="L329">			retryCount = iRecheckService.updatePostCardTMMQRetryCount();</span>
<span class="nc" id="L330">		} catch (Exception e) {</span>
<span class="nc" id="L331">			log.debug(&quot;Exception in RecheckController in updatePCMQRetryCount() {1}&quot;, e);</span>
<span class="nc" id="L332">		}</span>
<span class="nc" id="L333">		return retryCount;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>