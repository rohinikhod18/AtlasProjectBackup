<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DBQueryConstant.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.compliancesrv.dbport</a> &gt; <span class="el_source">DBQueryConstant.java</span></div><h1>DBQueryConstant.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.compliancesrv.dbport;

/**
 * The Enum DBQueryConstant.
 *
 * @author Rajesh
 */
<span class="fc" id="L8">@SuppressWarnings(&quot;squid:S1192&quot;)</span>
public enum DBQueryConstant {
	
<span class="fc" id="L11">	GET_ACCOUNT_CONTACT_DETAILS (&quot;WITH CTE AS( &quot;</span>
			+ &quot; SELECT A.Id AS AccountID &quot;
			+ &quot; FROM Account A &quot;
			+ &quot; WHERE crmaccountid = ? &quot;
			+ &quot; UNION SELECT AccountID AS AccountID &quot;
			+ &quot; FROM Contact B &quot;
			+ &quot; WHERE crmcontactid IN({CONTACT_SF_ID}) &quot;
			+ &quot;) SELECT * FROM &quot;
			+ &quot; ( SELECT &quot;
			+ &quot; (SELECT id FROM organization WHERE code = ? ) AS RequestOrgID, &quot;
			+ &quot; (SELECT id FROM country WHERE code = ? ) AS CountryID, &quot;
			+ &quot; (SELECT id FROM currency WHERE code = ? ) AS BuyCurrencyId, &quot;
			+ &quot; (SELECT id FROM currency WHERE code = ? ) AS SellCurrencyId &quot;
			+ &quot; FROM (SELECT 1 AS t ) DUMMY) mt &quot;
			+ &quot; LEFT JOIN(SELECT (SELECT Count( cc.id ) FROM contact cc WHERE cc.accountid = ac.id ) AS contacts, &quot;
			+ &quot; ac.id AS AccountId, &quot;
			+ &quot; ac.EIDStatus AS AEIDStatus, &quot;
			+ &quot; ac.FraugsterStatus AS AFraugsterStatus, &quot;
			+ &quot; ac.SanctionStatus AS ASanctionStatus, &quot;
			+ &quot; ac.BlacklistStatus AS ABlacklistStatus, &quot;
			+ &quot; ac.PayInWatchListStatus AS PayInWatchlistStatus, &quot;
			+ &quot; ac.PayOutWatchListStatus AS PayOutWatchlistStatus, &quot;
			+ &quot; ac.isOnQueue AS AccOnQueue, &quot;
			+ &quot; ac.LegalEntity AS ACLegalEntity, &quot;//Add for AT-3327
			+ &quot; ac.OldOrganizationID, &quot;
			+ &quot; (SELECT Status from AccountComplianceStatusEnum acs where acs.id = ac.compliancestatus ) AS ACStatus, &quot;
			+ &quot; AC.createdon AS RegistrationInTime, &quot;
			+ &quot; AC.ComplianceDoneOn AS RegisteredTime, &quot;
			+ &quot; AC.ComplianceExpiry AS ComplianceExpiry, &quot;
			+ &quot; ACA.attributes AS ACAttrib, &quot;
			+ &quot; ACA.version AS ACVersion, &quot;
			+ &quot; c.id AS ContactId, &quot;
			+ &quot; c.CRMContactID AS CRMContactID, &quot;
			+ &quot; (select status from ContactComplianceStatusEnum ccs where ccs.id = c.ComplianceStatus ) AS CoStatus, &quot;
			+ &quot; c.[primary] AS PrimaryContact, &quot;
			+ &quot; c.EIDStatus AS CEIDStatus, &quot;
			+ &quot; c.FraugsterStatus AS CFraugsterStatus, &quot;
			+ &quot; c.SanctionStatus AS CSanctionStatus, &quot;
			+ &quot; c.BlacklistStatus AS CBlacklistStatus, &quot;
			+ &quot; c.CustomCheckStatus AS CCustomCheckStatus, &quot;
			+ &quot; c.PayInWatchListStatus AS CPayInWatchlistStatus, &quot;//Add for AT-2986
			+ &quot; c.PayOutWatchListStatus AS CPayOutWatchlistStatus, &quot;//Add for AT-2986
			+ &quot; c.isOnQueue AS ContactOnQueue, &quot;
			+ &quot; CA.attributes AS CAttrib, &quot;
			+ &quot; CA.version AS CAVersion, &quot;
			+ &quot; org.id AS ACOrgID, &quot;
			+ &quot; org.code AS ACOrgName, &quot;
			+ &quot; ac.AccountTMFlag,&quot; //Add For AT-4169
			+ &quot; ac.IntuitionRiskLevel&quot; //Added for AT-4190
			+ &quot; FROM account AC &quot;
			+ &quot; JOIN CTE AcS ON &quot;
			+ &quot; Acs.accountid = AC.Id &quot;
			+ &quot; JOIN accountattribute ACA ON AC.id = ACA.id &quot;
			+ &quot; RIGHT JOIN contact C ON c.accountid = AC.id &quot;
			+ &quot; JOIN contactattribute CA ON c.id = CA.id &quot;
			+ &quot; JOIN organization org ON AC.organizationid = org.id ) details ON 1 = 1&quot;),

<span class="fc" id="L68">	INSERT_INTO_ACCOUNT(&quot;INSERT INTO Account([OrganizationID], [Name], [CRMAccountID], [TradeAccountID], [TradeAccountNumber], [Type], [AccountStatus], [ComplianceStatus], [ComplianceDoneOn], [ComplianceExpiry],[CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn] ,[Version]  , [EIDStatus], [FraugsterStatus], [SanctionStatus], [BlacklistStatus], [PayInWatchListStatus], [PayOutWatchListStatus],[LegalEntity],[isOnQueue],[STPFlag],[LegalEntityID],[FirstFundsInEDDCheck]) VALUES((select id from Organization where code=?), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?,?,(select id from LegalEntity where code=?),?)&quot;),</span>
	
	//[ComplianceDoneOn]=?, [ComplianceExpiry]=?, [CreatedBy]=?, [CreatedOn]=?, 
<span class="fc" id="L71">	UPDATE_INTO_ACCOUNT(&quot;UPDATE Account SET [OrganizationID]=(SELECT [ID] FROM Organization WHERE CODE=?), [Name]=?, [CRMAccountID]=?, [TradeAccountID]=?, [TradeAccountNumber]=?, [Type]=?, [AccountStatus]=?, [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=? ,[Version]=? ,[LegalEntity]=? ,[ComplianceDoneOn] = ?, [ComplianceExpiry]= ?, [LegalEntityID]=(SELECT [ID] FROM LegalEntity WHERE CODE=?) WHERE ID=?&quot;),</span>
	
	//For CDSA migration AT-4474
<span class="fc" id="L74">	UPDATE_INTO_ACCOUNT_FOR_LEGACY_NUMBER(&quot;UPDATE Account SET [UpdatedBy]=?, [UpdatedOn]=?, [LegacyTradeAccountNumber]=?, [legacyTradeAccountID]=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L76">	UPDATE_ACCOUNT_VERSION(&quot;UPDATE Account SET [UpdatedBy]=?, [UpdatedOn]=? ,[Version]=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L78">	UPDATE_ACCOUNT_WITHOUT_KYC_COMPLIANCE_STATUS(&quot;UPDATE Account SET [ComplianceStatus]=(SELECT [ID] FROM [AccountComplianceStatusEnum ] WHERE Status = ?), [AccountStatus]=?, [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,BlacklistStatus=?,PayInWatchListStatus=?, PayOutWatchListStatus=?,ComplianceDoneOn=? ,ComplianceExpiry = ? , isOnQueue = ?, SanctionStatus=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L80">	UPDATE_ACCOUNT_WITHOUT_SANCTION_COMPLIANCE_STATUS(&quot;UPDATE Account SET [ComplianceStatus]=(SELECT [ID] FROM [AccountComplianceStatusEnum ] WHERE Status = ?), [AccountStatus]=?, [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,BlacklistStatus=?,PayInWatchListStatus=?, PayOutWatchListStatus=? ,ComplianceDoneOn=? ,ComplianceExpiry = ? , isOnQueue = ?, EIDStatus=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L82">	UPDATE_ACCOUNT_WITHOUT_SANCTION_AND_KYC_COMPLIANCE_STATUS(&quot;UPDATE Account SET [ComplianceStatus]=(SELECT [ID] FROM [AccountComplianceStatusEnum ] WHERE Status = ?), [AccountStatus]=?, [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,BlacklistStatus=?,PayInWatchListStatus=?, PayOutWatchListStatus=? ,ComplianceDoneOn=? ,ComplianceExpiry = ? , isOnQueue = ? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L84">	UPDATE_ACCOUNT_COMPLIANCE_STATUS(&quot;UPDATE Account SET [ComplianceStatus]=(SELECT [ID] FROM [AccountComplianceStatusEnum ] WHERE Status = ?), [AccountStatus]=?, [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,BlacklistStatus=?,PayInWatchListStatus=?, PayOutWatchListStatus=? ,ComplianceDoneOn=? ,ComplianceExpiry = ? , isOnQueue = ?, EIDStatus=?, SanctionStatus=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L86">	UPDATE_ACCOUNT_COMPLIANCE_STATUS_STP(&quot;UPDATE Account SET [ComplianceStatus]=(SELECT [ID] FROM [AccountComplianceStatusEnum ] WHERE Status = ?), [AccountStatus]=?, [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,BlacklistStatus=?,PayInWatchListStatus=?, PayOutWatchListStatus=? ,ComplianceDoneOn=? ,ComplianceExpiry = ? , isOnQueue = ?, EIDStatus=?,SanctionStatus=?, STPFlag = ? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L88">	INSERT_INTO_ACCOUNT_ATTRIBUTE(&quot;INSERT INTO AccountAttribute([ID], [Attributes], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn], [Version])&quot;+</span>
	&quot; VALUES(?, ?, ?, ?, ?, ?, ?)&quot;),
	
	//UPDATE_INTO_ACCOUNT_ATTRIBUTE(&quot;UPDATE AccountAttribute SET [Attributes]=?, [UpdatedBy]=?, [UpdatedOn]=?, [Type]=?, [BuyCurrency]=?, [SellCurrency]=?, [Source]=?, [TransactionValue]=?,[Version]=?, [Country]=(SELECT [ID] FROM [Country] WHERE DisplayName=?) WHERE ID=?&quot;),
<span class="fc" id="L92">	UPDATE_INTO_ACCOUNT_ATTRIBUTE(&quot;UPDATE AccountAttribute SET [Attributes]=?, [UpdatedBy]=?, [UpdatedOn]=?, [Version]=? &quot;+</span>
	&quot;  WHERE ID=?&quot;),
	
<span class="fc" id="L95">	UPDATE_INTO_ACCOUNT_ATTRIBUTE_STATUS(&quot;UPDATE AccountAttribute SET [Attributes]=?, [UpdatedBy]=?, [UpdatedOn]=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L97">	INSERT_INTO_ACCOUNT_ATTRIBUTE_HISTORY(&quot;INSERT INTO AccountAttributeHistory ([AccountID], [Attributes], [CreatedBy], [CreatedOn],[Version]) VALUES(?, ?, ?, ?, ?)&quot;),</span>
	
	//Add paymentIN/OUTwatchliststatus for AT-2986
<span class="fc" id="L100">	INSERT_INTO_CONTACT(&quot;INSERT INTO Contact([OrganizationID], [AccountID], [Name], [CRMContactID], [TradeContactID], [Primary], [ComplianceStatus], [ComplianceDoneOn], [ComplianceExpiry], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn], &quot;</span>
			+ &quot; [Version], [Country] , [EIDStatus], [FraugsterStatus], [SanctionStatus], [BlacklistStatus] ,[CustomCheckStatus],[PayInWatchListStatus], [PayOutWatchListStatus], [isOnQueue],[STPFlag] )&quot; +
	&quot; VALUES((select id from Organization where code=?), ?, ?, ?, ?, ?, (select id from ContactComplianceStatusEnum  where STATUS=?), ?, ?, ?, ?, ?, ?, ?, (SELECT [ID] FROM [Country] WHERE code=?),?,?, ? ,?,?,?,?,?,?)&quot;),
	
<span class="fc" id="L104">	UPDATE_CONTACT_BY_ID(&quot;UPDATE Contact SET [Name]=?, [CRMContactID]=?, [TradeContactID]=?, [Primary]=?, [UpdatedBy]=?, [UpdatedOn]=?,[Version]=?,[Country]=(SELECT [ID] FROM [Country] WHERE code=?) WHERE Id=?&quot;),</span>
	
	//For CDSA migration AT-4474
<span class="fc" id="L107">	UPDATE_CONTACT_BY_ID_FOR_LEGACY_NUMBER(&quot;UPDATE Contact SET [UpdatedBy]=?, [UpdatedOn]=?, [LegacyTradeContactID]=? WHERE Id=?&quot;),</span>
	
<span class="fc" id="L109">	UPDATE_CONTACT_WITHOUT_SANCTION_AND_KYC_AND_FRAUDPREDICT_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ?, PayInWatchListStatus=?, PayOutWatchListStatus=?  WHERE Id=?&quot;),</span>
	
<span class="fc" id="L111">	UPDATE_CONTACT_WITHOUT_SANCTION_AND_FRAUDPREDICT_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,EIDStatus=?,BlacklistStatus=? ,CustomCheckStatus=?, isOnQueue = ? , PayInWatchListStatus=?, PayOutWatchListStatus=?  WHERE Id=?&quot;),</span>
	
<span class="fc" id="L113">	UPDATE_CONTACT_WITHOUT_KYC_AND_FRAUDPREDICT_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,SanctionStatus=?,BlacklistStatus=?, CustomCheckStatus=?,isOnQueue = ?, PayInWatchListStatus=?, PayOutWatchListStatus=?  WHERE Id=?&quot;),</span>
	
<span class="fc" id="L115">	UPDATE_CONTACT_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,EIDStatus=?,FraugsterStatus=?,SanctionStatus=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ? , PayInWatchListStatus=?, PayOutWatchListStatus=? WHERE Id=?&quot;),</span>
	
<span class="fc" id="L117">	UPDATE_CONTACT_COMPLIANCE_STATUS_STP(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,EIDStatus=?,FraugsterStatus=?,SanctionStatus=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ?, STPFlag=?, POI_NEEDED=?, PayInWatchListStatus=?, PayOutWatchListStatus=?  WHERE Id=?&quot;),</span>
	
	//Add For AT-2986 update contact payment IN/OUT watchlist status
<span class="fc" id="L120">	UPDATE_CONTACT_PAYMENTS_WATCHLIST_STATUS(&quot;UPDATE Contact SET [UpdatedBy]=?, [UpdatedOn]=?, [PayInWatchListStatus]=?, [PayOutWatchListStatus]=?  WHERE Id = ? &quot;),</span>
		
<span class="fc" id="L122">	INSERT_INTO_CONTACT_ATTRIBUTE(&quot;INSERT INTO ContactAttribute([ID],[Attributes], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn],[Version]) VALUES(?, ?, ?, ?, ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L124">	UPDATE_INTO_CONTACT_ATTRIBUTE(&quot;UPDATE ContactAttribute SET [Attributes]=?,[UpdatedBy]=?, [UpdatedOn]=?,[Version]=? WHERE ID=?&quot;),</span>
	
<span class="fc" id="L126">	INSERT_INTO_CONTACT_ATTRIBUTE_HISTORY(&quot;INSERT INTO ContactAttributeHistory ([ContactID], [Attributes], [CreatedBy], [CreatedOn],[Version]) VALUES(?, ?, ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L128">	INSERT_INTO_EVENT_REGISTRATION(&quot;INSERT INTO Event([OrganizationID], [EventType], [AccountID], [AccountVersion], [PaymentInID], [PaymentOutID], [CreatedBy], [CreatedOn]) VALUES(( SELECT [ID] FROM Organization WHERE CODE=?), (SELECT [ID] FROM EventTypeEnum WHERE Type=?), ?, ?, ?, ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L130">	UPDATE_EVENT_REGISTRATION(&quot;UPDATE Event SET [Status]=?, [Summary]=? WHERE [ID]=?&quot;),</span>
	
<span class="fc" id="L132">	INSERT_INTO_EVENT_SERVICE_LOG(&quot;INSERT INTO EventServiceLog([EventID], [EntityType], [EntityID], [EntityVersion], [ServiceProvider], [ServiceType], [ProviderResponse], [Status], [Summary],[CreatedBy],[CreatedOn], [UpdatedBy], [UpdatedOn]) &quot;</span>
			+ &quot;VALUES( ?, ?, ?, ?, (SELECT [ID] FROM Compliance_ServiceProvider WHERE Code =?) , (SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code=?), ?, ?, ?, ?, ?, ?, ?)&quot;),
	
<span class="fc" id="L135">	GET_PROVIDER_INFO(&quot;select a.Attribute,b.Code FROM compliance_ServiceProviderAttribute a LEFT JOIN compliance_ServiceProvider b on a.ID = b.ID where b.internal=1&quot;),</span>
	
<span class="fc" id="L137">	UPDATE_DOCUMENT_KYC_CONTACT_STATUS(&quot;UPDATE Account SET [AccountStatus]=? WHERE [OrganizationID]=? , [CRMAccountID]=?&quot;),</span>

<span class="fc" id="L139">	GET_ACCOUNTID_FROM_CRMACCOUNTID(&quot;SELECT ID FROM Account WHERE CRMAccountID=?&quot;),</span>
	
<span class="fc" id="L141">	GET_ATTRIBUTES_FROM_CONTACTID(&quot;SELECT [Attributes] FROM ContactAttribute where ID=?&quot;),</span>
	
<span class="fc" id="L143">	GET_ATTRIBUTES_FROM_ACCOUNTID(&quot;SELECT [Attributes] FROM AccountAttribute where ID=?&quot;),</span>
	
<span class="fc" id="L145">	GET_CONTACTID_FROM_CRMCONTACTID(&quot;SELECT ID FROM Contact WHERE CRMContactID=?&quot;),</span>
	
	/*GET_CONTACTWATCHLIST_BY_ACCOUNTID(&quot; SELECT * FROM Contactwatchlist WHERE Contact IN (SELECT id FROM Contact WHERE AccountId= ? ) &quot;),*/
	
<span class="fc" id="L149">	GET_CONTACTWATCHLIST_BY_ACCOUNTID(&quot; SELECT * FROM Contactwatchlist cw JOIN watchlist w ON (w.id=cw.Reason AND w.StopPaymentIn =1 AND w.StopPaymentOut = 1) WHERE Contact &quot;</span>
			+ &quot; IN (SELECT id FROM Contact &quot;
			+ &quot; WHERE AccountId= ? )&quot;),
	
<span class="fc" id="L153">	GET_CONTACTWATCHLIST_BY_ACCOUNTID_FOR_PAYMENTIN(&quot; SELECT *  FROM Contactwatchlist cw JOIN watchlist w ON (w.id=cw.Reason AND w.StopPaymentIn =1) WHERE Contact &quot;</span>
			+ &quot; IN (SELECT id &quot;
			+ &quot; FROM Contact WHERE AccountId= ? )&quot;),
	
<span class="fc" id="L157">	GET_CONTACTWATCHLIST_BY_ACCOUNTID_FOR_PAYMENTOUT(&quot; SELECT *  FROM Contactwatchlist cw JOIN watchlist w ON (w.id=cw.Reason AND w.StopPaymentOut =1) WHERE Contact &quot;</span>
			+ &quot; IN (SELECT id FROM Contact WHERE AccountId= ? )&quot;),
	
<span class="fc" id="L160">	INSERT_INTO_CONTACT_WATCHLIST(&quot;INSERT INTO ContactWatchList([Reason], [Contact], [CreatedBy], [CreatedOn]) VALUES((SELECT [ID] FROM WatchList WHERE Reason=?), ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L162">	CHECK_ACCOUNT_ID_EXIST(&quot;select * from Account where CRMAccountID=?&quot;),</span>
	
<span class="fc" id="L164">	GET_ACCOUNT_BY_TRADE_ACCOUNT_NUMBER(&quot;select acc.ID, acc.AccountStatus, acc.version, acc.LEUpdateDate, att.attributes from Account acc join AccountAttribute att on acc.id = att.id where TradeAccountNumber=? and acc.OrganizationID= &quot;</span>
				+ &quot; (SELECT id from Organization where code=?)&quot;),//Add for AT-3349
	
<span class="fc" id="L167">	CHECK_CONTACT_ID_EXIST(&quot;select * from Contact where CRMContactID=?&quot;),</span>
	
<span class="fc" id="L169">	CHECK_TRADE_CONTACT_ID_EXIST(&quot;select c.id, c.version, att.attributes from Contact c join ContactAttribute att on c.id=att.id &quot;</span>
		+ &quot;join account acc on acc.id = c.accountid &quot;
		+ &quot;where TradeContactID=? and acc.OrganizationID= &quot;
		+ &quot; (SELECT id from Organization where code=?)&quot;),
	
<span class="fc" id="L174">	INSERT_INTO_DEVICEINFO(&quot;INSERT INTO DeviceInfo([EventID], [UserAgent], [DeviceType], [DeviceName], [DeviceVersion], [DeviceID], [DeviceManufacturer], [OSType], [BrowserName], [BrowserVersion], [BrowserLanguage], [BrowserOnline], [OSTimestamp], [CDAppID], [CDAppVersion], [CreatedBy], [CreatedOn], [ScreenResolution]) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)&quot;),</span>
	
<span class="fc" id="L176">	CHECK_ACCOUNT_ID_EXIST_FOR_REPEAT_CHECK(&quot;select * from Account where ID=?&quot;),</span>
	
<span class="fc" id="L178">	CHECK_CONTACT_ID_EXIST_FOR_REPEAT_CHECK(&quot;select * from Contact where ID=?&quot;),</span>
	
<span class="fc" id="L180">	CHECK_TRADE_ACCOUNT_ID_EXIST_FOR_REPEAT_CHECK(&quot;SELECT TradeAccountID FROM ACCOUNT WHERE ID=?&quot;),</span>
	
<span class="fc" id="L182">	GET_EVENT_BY_ID(&quot;SELECT * FROM EventServiceLog WHERE EventId=?&quot;),</span>
	
<span class="fc" id="L184">	GET_EVENT_BY_ID_AND_SERVICE_TYPE(&quot;SELECT * FROM EventServiceLog WHERE EventId=? AND ServiceType=(SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code=?)&quot;),</span>
	
<span class="fc" id="L186">	UPDATE_EVENT_BY_EVENT_SERVICE_ID_AND_SERVICE_TYPE(&quot;UPDATE EventServiceLog SET ProviderResponse=?,Status=?,Summary=?,UpdatedBy=?,UpdatedOn=? WHERE Id=? AND ServiceType=(SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code=?)&quot;),</span>
	
<span class="fc" id="L188">	GET_EVENT_LOGS_BY_EVENT_IDS_AND_SERVICE_TYPE(&quot;SELECT * FROM EventServiceLog WHERE EventId IN ({EVENT_IDS}) AND EntityID= ? AND ServiceType=(SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code=?)&quot;),</span>

<span class="fc" id="L190">	INSERT_PROFILE_ACTIVITY_LOG(&quot;INSERT INTO [ProfileActivityLog] ([Timestamp], ActivityBy, OrganizationID, AccountID, ContactID, Comments, CreatedBy, CreatedOn, UpdatedBy, UpdatedOn, UserLockID) &quot;</span>
			+ &quot;VALUES( ?, (SELECT id FROM [USER] WHERE SSOUserID=?), &quot;
			+ &quot;(SELECT Id FROM Organization WHERE Code= ? ), ?, ?, ?, &quot;
			+ &quot;(SELECT id FROM [USER] WHERE SSOUserID=?), ?, &quot;
			+ &quot;(SELECT id FROM [USER] WHERE SSOUserID=?), ?, &quot;
			+ &quot;(SELECT ID FROM UserResourceLock WHERE ResourceType = ? AND ResourceID = ? AND LockReleasedOn IS NULL))&quot;),
	
<span class="fc" id="L197">	INSERT_PROFILE_ACTIVITY_LOG_DETAIL(&quot;INSERT INTO [ProfileActivityLogDetail] VALUES(?, (SELECT Id FROM ActivityTypeEnum WHERE Module=? and Type=?), ?, (SELECT id FROM [USER] WHERE SSOUserID=?), ?, (SELECT id FROM [USER] WHERE SSOUserID=?), ?)&quot;),</span>

<span class="fc" id="L199">	INSERT_PAYMENT_OUT_ACTIVITY_LOG(&quot;INSERT INTO [PaymentOutActivityLog] ( PaymentOutID, ActivityBy, [Timestamp], Comments, CreatedBy, CreatedOn, UserLockID)&quot;</span>
			+ &quot; VALUES(?, (SELECT id FROM [USER] WHERE SSOUserID=?), &quot;
			+ &quot;?, ?, (SELECT id FROM [USER] WHERE SSOUserID=?), ?,&quot;
			+ &quot;(SELECT ID FROM UserResourceLock WHERE ResourceType = 1 AND ResourceID = ? AND LockReleasedOn IS NULL) )&quot;),
	
<span class="fc" id="L204">	INSERT_PAYMENT_OUT_ACTIVITY_LOG_DETAIL(&quot;INSERT INTO [PaymentOutActivityLogDetail]([ActivityID], [ActivityType], [Log], [CreatedBy], [CreatedOn]) VALUES(?, (SELECT Id FROM ActivityTypeEnum WHERE Module=? and Type=?), ?, (SELECT id FROM [USER] WHERE SSOUserID=?), ?)&quot;),</span>
	
<span class="fc" id="L206">	INSERT_PAYMENT_IN_ACTIVITY_LOG(&quot;INSERT INTO [PaymentInActivityLog] (PaymentInID, ActivityBy, [Timestamp], Comments, CreatedBy, CreatedOn, UserLockID)&quot;</span>
			+ &quot; VALUES(?, (SELECT id FROM [USER] WHERE SSOUserID=?), &quot;
			+ &quot;?, ?, (SELECT id FROM [USER] WHERE SSOUserID=?), ?,&quot;
			+ &quot;(SELECT ID FROM UserResourceLock WHERE ResourceType = 2 AND ResourceID = ? AND LockReleasedOn IS NULL) )&quot;),
	
<span class="fc" id="L211">	INSERT_PAYMENT_IN_ACTIVITY_LOG_DETAIL(&quot;INSERT INTO [PaymentInActivityLogDetail]([ActivityID], [ActivityType], [Log], [CreatedBy], [CreatedOn]) VALUES(?, (SELECT Id FROM ActivityTypeEnum WHERE Module=? and Type=?), ?, (SELECT id FROM [USER] WHERE SSOUserID=?), ?)&quot;),</span>
	
<span class="fc" id="L213">	CHECK_COUNTRY_ENUM(&quot;select * from Country where code=?&quot;),</span>
	
<span class="fc" id="L215">	INSERT_INTO_PROFILE_STATUS_REASON(&quot;INSERT INTO [ProfileStatusReason]([OrganizationID], [AccountID], [ContactID], [StatusUpdateReasonID], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn]) VALUES( (select id from Organization where code=?), ?, ?, (SELECT [ID] FROM [StatusUpdateReason] WHERE [Module]=? AND [Reason]=?), ?, ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L217">	INSERT_INTO_ACCOUNT_COMPLIANCE_HISTORY(&quot;INSERT INTO [AccountComplianceHistory]([AccountID], [Status], [CreatedBy], [CreatedOn],[Version]) VALUES(?, (SELECT [ID] FROM [AccountComplianceStatusEnum] WHERE Status = ?), ?, ?, ?)&quot;),</span>

<span class="fc" id="L219">	INSERT_INTO_CONTACT_COMPLIANCE_HISTORY(&quot;INSERT INTO [ContactComplianceHistory]([ContactID], [Status], [CreatedBy], [CreatedOn],[Version]) VALUES(?, (SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L221">	GET_ACCOUNT_VERSION(&quot;SELECT Version FROM Account WHERE CRMAccountID= ?&quot;),</span>
	
<span class="fc" id="L223">	GET_CONTACT_VERSION(&quot;SELECT Version FROM Contact WHERE CRMContactID= ?&quot;),</span>
	
<span class="fc" id="L225">	GET_ACCOUNT_AND_CONTACT_ATTRIBUTE_BY_CONTACTID(&quot;Select acc.Attributes as AccAttrib,con.Attributes as ConAttrib,og.Code as Org,a.OldOrganizationId from ContactAttribute con join AccountAttribute acc on acc.ID=? and con.id=? join Organization og on og.ID=(select OrganizationID from Contact where id=?) join Account a ON acc.id = a.id&quot;),</span>
	
<span class="fc" id="L227">	GET_ACCOUNT_ATTRIBUTE_BY_ACCOUNT_ID(&quot;Select a.OldOrganizationId, aa.Attributes from Account a JOIN AccountAttribute aa ON a.id = aa.id where aa.id=?&quot;),</span>
	
<span class="fc" id="L229">	GET_DEVICE_INFO(&quot;SELECT TOP 1 d.BrowserLanguage, d.BrowserVersion, d.BrowserName, d.BrowserOnline, d.CDAppID,&quot;</span>
			+ &quot; d.CDAppVersion, d.DeviceID, d.DeviceManufacturer, d.DeviceName, d.OSType, d.DeviceType, &quot;
			+ &quot; d.DeviceVersion, d.OSTimestamp, d.UserAgent, d.ScreenResolution&quot;
			+ &quot; FROM DeviceInfo d JOIN Event e on d.eventid=e.id WHERE e.accountid=? and e.eventtype&lt;=3 ORDER BY e.id DESC&quot;),
	
<span class="fc" id="L234">	GET_ACCOUNT_BY_TRADEACCOUNTID_AND_ORG(&quot;Select id from Account where TradeAccountId=? And OrganizationID=(Select id from Organization where code=?)&quot;),</span>
	
<span class="fc" id="L236">	INSERT_INTO_PAYMENTS_OUT(&quot;INSERT INTO [PaymentOut]([OrganizationID], [AccountID], [ContactID], [ContractNumber], [TradePaymentID], [ComplianceStatus], [ComplianceDoneOn], [Deleted], [CreatedBy],&quot;</span>
			+ &quot; [CreatedOn], [UpdatedBy], [UpdatedOn] , [FraugsterStatus] , [SanctionStatus], [BlacklistStatus], [CustomCheckStatus], [TransactionDate] , [isOnQueue],[STPFlag],[LegalEntityId], [IntuitionCheckStatus])&quot;+
			    &quot;VALUES((select id from Organization where code=?), ?, ?, ?, ?, (select id from PaymentComplianceStatusEnum where status=?), ?, ?, ?, ?, ?, ? , ? ,? ,?,?,?,?,?,(select id from legalEntity where code=?),?)&quot;),
	
<span class="fc" id="L240">	INSERT_INTO_PAYMENTS_OUT_ATTRIBUTE(&quot;INSERT INTO [PaymentOutAttribute]([ID], [Version], [Attributes], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn],[BeneAmount])&quot;+ </span>
			&quot;VALUES(?, ?, ?, ?, ?, ?, ?, ? )&quot;),
	
<span class="fc" id="L243">	INSERT_INTO_PAYMENTS_OUT_ATTRIBUTE_HISTORY(&quot;INSERT INTO [PaymentOutAttributeHistory]([PaymentOutID], [Version], [Attributes], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn])&quot;+ </span>
			&quot;VALUES(?, (SELECT version from PaymentOutAttribute where ID =?), (SELECT Attributes from PaymentOutAttribute where ID =?), ?, ?, ?, ?)&quot;),
	
<span class="fc" id="L246">	UPDATE_PAYMENT_OUT(&quot;UPDATE [PaymentOut] SET [UpdatedBy]=?, [UpdatedOn]=?  WHERE id = ?&quot;),</span>
<span class="fc" id="L247">	UPDATE_PAYMENT_OUT_STATUS (&quot;UPDATE [PaymentOut] SET [UpdatedBy]=?, [UpdatedOn]=? , [ComplianceStatus] = ? WHERE id = ?&quot;),</span>
	
<span class="fc" id="L249">	UPDATE_PAYMENT_OUT_ATTRIBUTE(&quot;UPDATE [PaymentOutAttribute] SET [Version]= [Version]+1, [Attributes]=?, [UpdatedBy]=?, [UpdatedOn]=?, [BeneAmount]=? WHERE id = ?&quot;),</span>
	
<span class="fc" id="L251">	UPDATE_CONTACT_ATTRIBUTE(&quot;update ContactAttribute set Attributes = ? where id=?&quot;),</span>
	
<span class="fc" id="L253">	GET_SERVICE_STATUS_BY_ENTITY_ID(&quot; SELECT TOP 1 providerResponse,summary,Status,(SELECT Name FROM Account WHERE id=entityid) As AccountName, &quot;</span>
			+ &quot; (SELECT Name From contact WHERE id=entityid) As ContactName  FROM eventservicelog &quot;
			+ &quot; WHERE eventid IN (SELECT id FROM event WHERE PaymentInID IS null AND PaymentOutID IS null) &quot;
			+ &quot; AND ServiceType= (SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code= ?) &quot;
			+ &quot; AND entityid=? and entitytype=? AND (status='PASS' OR status='FAIL' OR status='PENDING') ORDER BY id DESC &quot;),
	
<span class="fc" id="L259">	GET_PREVIOUS_SANCTION_DETAILS_BY_ENTITY_ID(&quot;SELECT id,entityid,providerResponse,summary,Status &quot;</span>
			+ &quot; FROM eventservicelog WHERE ServiceType= 7 AND entityid=? and entitytype=? ORDER BY id DESC &quot;),
	

<span class="fc" id="L263">	GET_PREVIOUS_FRAUGSTER_DETAILS_BY_ENTITY_ID(&quot;SELECT id,entityid,providerResponse,summary,Status&quot; </span>
	        + &quot; FROM eventservicelog WHERE ServiceType= 6 AND entityid=? and entitytype=? ORDER BY id DESC &quot;),
	
<span class="fc" id="L266">	GET_PREVIOUS_BLACKLIST_DETAILS_BY_ENTITY_ID(&quot;SELECT id,entityid,providerResponse,summary,Status&quot; </span>
	        + &quot; FROM eventservicelog WHERE ServiceType= 3 AND entityid=? and entitytype=? ORDER BY id DESC &quot;),
	
<span class="fc" id="L269">	GET_KYC_SERVICE_STATUS_BY_ENTITY_ID(&quot; SELECT TOP 1 id,providerResponse,summary,Status, &quot;</span>
			+ &quot; (SELECT Name From contact WHERE id=entityid) As ContactName  FROM eventservicelog &quot;
			+ &quot; WHERE ServiceType= 1 AND entityid=? and entitytype=? ORDER BY id DESC &quot;),
	
<span class="fc" id="L273">	GET_FUNDS_OUT_SERVICE_STATUS_BY_ENTITY_ID(&quot;SELECT TOP 1 providerResponse,summary,status FROM  eventservicelog WHERE  servicetype = &quot;</span>
			+ &quot;(SELECT [ID] FROM compliance_servicetypeenum WHERE code = ?) AND entityid = ? AND entitytype = ? &quot;
			+ &quot;AND (status='PASS' OR status='FAIL' OR status='PENDING') ORDER  BY id DESC&quot;),
	
<span class="fc" id="L277">	GET_FUNDS_IN_SERVICE_STATUS_BY_ENTITY_ID(&quot;SELECT TOP 1 Status  FROM eventservicelog &quot;</span>
			+ &quot; WHERE eventid IN (SELECT id FROM event WHERE PaymentOutID IS null AND PaymentInID=?) &quot;
			+ &quot; AND ServiceType= (SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code= ?)  &quot;
			+ &quot; AND entityid=? AND entitytype=? ORDER BY id DESC &quot;),
	
<span class="fc" id="L282">	GET_FUNDS_IN_CUSTOMCHECK_SERVICE_STATUS_BY_ENTITY_ID(&quot;SELECT TOP 1  * FROM Eventservicelog eventLog &quot;</span>
			+ &quot; WHERE ServiceType= (SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code= ?) &quot;
			+ &quot; AND EventId IN (SELECT id FROM Event WHERE PaymentInId=? AND PaymentoutId IS NULL ) ORDER BY ID DESC&quot;),
	
<span class="fc" id="L286">	GET_FUNDS_OUT_CUSTOMCHECK_SERVICE_STATUS_BY_ENTITY_ID(&quot;SELECT TOP 1  * FROM Eventservicelog eventLog &quot;</span>
			+ &quot; WHERE ServiceType= (SELECT [ID] FROM Compliance_ServiceTypeEnum WHERE code= ? ) &quot;
			+ &quot; AND EventId IN (SELECT id FROM Event WHERE PaymentoutId=? AND PaymentInId IS NULL ) ORDER BY ID DESC&quot;),
	
<span class="fc" id="L290">	GET_NUMBER_OF_CONTACT_IN_ACCOUNT(&quot;SELECT count(id) FROM CONTACT WHERE AccountID = ?&quot;),</span>
	
<span class="fc" id="L292">	IS_CONTACT_ON_WATCHLIST(&quot;SELECT StopPaymentOut,StopPaymentIn FROM ContactWatchList cw JOIN WatchList wl ON wl.id = cw.reason WHERE cw.contact = ?&quot;),</span>
	
<span class="fc" id="L294">	IS_BENE_USED_BY_OTHER_CONTACT(&quot;SELECT p.contactID FROM [PaymentOut] p JOIN [PaymentOutAttribute] pa ON p.ID = pa.ID &quot;+</span>
			&quot;WHERE p.ContactID &lt;&gt; ? AND [BeneficiaryFirstName]= ? AND [BeneficiaryLastName] = ? AND [BeneficiaryCountry] = ?&quot;),
	
<span class="fc" id="L297">	UPDATE_FUNDS_OUT_STATUS(&quot;UPDATE [PaymentOut] SET [ComplianceStatus]=(SELECT [ID] FROM [PaymentComplianceStatusEnum] WHERE [Status]=?), [BlacklistStatus]=?, [FraugsterStatus]=?, &quot;</span>
			+ &quot; [SanctionStatus]=?,[CustomCheckStatus]=?,  [ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=?, [isOnQueue]=?, [STPFlag]=?, [InitialStatus]=?, [PaymentReferenceStatus]=?, [IntuitionClientRiskLevel]=?, [IntuitionCheckStatus]=? WHERE id=?&quot;), //IntuitionRiskLevel added for AT-4451
	
<span class="fc" id="L300">	UPDATE_FUNDS_OUT_STATUS_FOR_UPDATE_DELETE_API(&quot;UPDATE [PaymentOut] SET [ComplianceStatus]=(SELECT [ID] FROM [PaymentComplianceStatusEnum] WHERE [Status]= ? ),&quot;</span>
			+ &quot; [BlacklistStatus]=(select BlacklistStatus from [PaymentOut] where id= ? ), [FraugsterStatus]=(select FraugsterStatus from [PaymentOut] where id=? ), [SanctionStatus]= &quot;
			+ &quot; (select SanctionStatus from [PaymentOut] where id= ? ),[CustomCheckStatus]=(select CustomCheckStatus from [PaymentOut] where id= ? ),&quot;
			+ &quot; [ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=? WHERE id=?&quot;),
	
<span class="fc" id="L305">	INSERT_INTO_FUNDS_OUT_STATUS_REASON(&quot;INSERT INTO [PaymentOutStatusReason]([PaymentOutID], [StatusUpdateReasonID], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn])&quot;+ </span>
		    &quot;VALUES(?, ((SELECT [ID] FROM [StatusUpdateReason] WHERE [Module]=? AND [Reason]=?)), ?, ?,?, ?)&quot;), 
<span class="fc" id="L307">	GET_ORG_ID(&quot;SELECT [ID] FROM [Organization] WHERE [code]=?&quot;),</span>
	
<span class="fc" id="L309">	GET_EVENT_SERVICE_LOG_ID(&quot;SELECT * FROM EventServiceLog WHERE ID=?&quot;),</span>
	
<span class="fc" id="L311">	PROFILE_GET_EVENT_SERVICE_LOG_ID_AND_SERVICE(&quot;SELECT *, (SELECT  acc.Name FROM Account acc WHERE id =(SELECT AccountId FROM Event  WHERE id=EventID)) As AccountName, &quot;</span>
			+ &quot;(SELECT con.Name FROM Contact con WHERE id=EntityId) As ContactName &quot;
			+ &quot;FROM EventServiceLog eventLog WHERE ID=? AND ServiceType = (SELECT [ID] &quot;
			+ &quot;FROM Compliance_ServiceTypeEnum WHERE code= ?) AND  eventid &quot;
			+ &quot;IN (SELECT id FROM event WHERE PaymentInID IS null AND PaymentOutID IS null) &quot;),
	
<span class="fc" id="L317">	FUNDS_OUT_GET_EVENT_SERVICE_LOG_ID_AND_SERVICE(&quot;select esl.*,acc.Name as AccountName,con.Name as ContactName,poa.vBankName as BankName, &quot;</span>
			+ &quot; concat(poa.vBeneficiaryFirstName,' ', poa.vBeneficiaryLastName) As BeneficiaryName from EventServiceLog esl &quot;
			+ &quot; Left Join Event eve On eve.id=esl.eventid &quot;
			+ &quot; Left Join Account acc On acc.id=eve.accountid&quot;
           	+ &quot; Left Join Contact con On con.id=esl.entityId &quot;
           	+ &quot; Left Join PaymentOutAttribute poa On poa.id= eve.paymentoutid &quot;
           	+ &quot; where esl.id=? AND ServiceType = (SELECT [ID] &quot;
            + &quot; FROM Compliance_ServiceTypeEnum WHERE code= ?) AND  eventid  &quot;
			+ &quot; IN (SELECT id FROM event WHERE PaymentInID IS null AND PaymentOutID IS NOT null) &quot;),
	
<span class="fc" id="L327">	FUNDS_IN_GET_EVENT_SERVICE_LOG_ID_AND_SERVICE(&quot;select esl.*,acc.Name as AccountName,con.Name as ContactName &quot;</span>
			+ &quot; from EventServiceLog esl &quot;
			+ &quot; Left Join Event eve On eve.id=esl.eventid &quot;
			+ &quot; Left Join Account acc On acc.id=eve.accountid &quot;
			+ &quot; LEFT JOIN PaymentIn p ON eve.PaymentInID = p.id &quot;
			+ &quot; Left Join Contact con On con.id=p.contactid &quot;
			+ &quot; where esl.id=? AND ServiceType = (SELECT [ID] &quot;
			+ &quot; FROM Compliance_ServiceTypeEnum WHERE code= ?)&quot;),
	
<span class="fc" id="L336">	DOES_FUNDS_OUT_EXIST(&quot;SELECT [ID] FROM [PaymentOut] WHERE [TradePaymentID]=?&quot;),</span>
	
<span class="fc" id="L338">	GET_FUNDS_IN_DETAILS(&quot;SELECT ac.id              AS accountid, &quot;</span>
			+ &quot;       aa.attributes                 AS acattrib, &quot;
			+ &quot;       acs.status                    AS accountStatus, &quot;
			+ &quot;       c.tradecontactid              AS TradeContactID, &quot;
			+ &quot;       c.id                          AS contactid, &quot;
			+ &quot;       ca.attributes                 AS contactattrib, &quot;
			+ &quot;       ccs.status                    AS ContactStatus, &quot;
			+ &quot;       cw.id                         AS watchlistid, &quot;
			+ &quot;       (SELECT Count(id) FROM   contact cc WHERE  cc.accountid = ac.id) AS contacts, &quot;
			+ &quot;       (SELECT id from Organization where code=?) AS OrgID, &quot;
			+ &quot;       PIDetails.* &quot;
			+ &quot;FROM   (SELECT po.id          AS fundsinId, &quot;
			+ &quot;               poa.attributes AS PIAttrib, &quot;
			+ &quot;               pcs.status     AS PIComplianceStatus, &quot;
			+ &quot;               accountid &quot;
			+ &quot;        FROM   paymentin po &quot;
			+ &quot;               JOIN paymentinattribute poa &quot;
			+ &quot;                 ON po.id = poa.id &quot;
			+ &quot;               JOIN [paymentcompliancestatusenum] pcs &quot;
			+ &quot;                 ON po.compliancestatus = pcs.id &quot;
			+ &quot;        WHERE  po.tradepaymentid = ?) AS PIDetails &quot;
			+ &quot;       RIGHT JOIN [account] ac &quot;
			+ &quot;               ON ac.id = PIDetails.accountid &quot;
			+ &quot;       JOIN [accountattribute] aa &quot;
			+ &quot;         ON ac.id = aa.id &quot;
			+ &quot;       JOIN [accountcompliancestatusenum] acs &quot;
			+ &quot;         ON ac.compliancestatus = acs.id &quot;
			+ &quot;       JOIN [contact] c &quot;
			+ &quot;         ON c.accountid = ac.id &quot;
			+ &quot;       JOIN [contactattribute] ca &quot;
			+ &quot;         ON c.id = ca.id &quot;
			+ &quot;       JOIN [contactcompliancestatusenum] ccs &quot;
			+ &quot;         ON c.compliancestatus = ccs.id &quot;
			+ &quot;       LEFT JOIN [contactwatchlist] cw &quot;
			+ &quot;              ON c.id = cw.contact &quot;
			+ &quot;WHERE  tradeaccountnumber = ?&quot;),
	
	
<span class="fc" id="L376">	GET_FUNDS_OUT_ACCOUNT_CONTACT_DETAILS(&quot;SELECT ac.id       AS accountid, &quot;</span>
+ &quot; ac.AccountTMFlag, &quot;
+ &quot; ac.DormantFlag, &quot;
+ &quot; aa.attributes AS acattrib, &quot;
+ &quot;ac.type AS custType, &quot;
+ &quot; acs.status AS accountStatus, &quot;
+ &quot; c.tradecontactid AS TradeContactID, &quot;
+ &quot; c.id AS contactid, &quot;
+ &quot; ca.attributes AS contactattrib, &quot;
+ &quot; ccs.status AS ContactStatus, &quot;
+ &quot; cw.id AS watchlistid, &quot;
+ &quot; ac.LEUpdateDate AS leupdatedate,&quot;//Add for AT-3349
+ &quot; c.POIExists AS poiexists,&quot;//Add for AT-3349
+ &quot; cw.reason AS watchlistreason, &quot;
+ &quot; watch.reason AS watchlistreasonname, &quot;
+ &quot; (SELECT id from Organization where code=?) AS requestOrgID,&quot;
+ &quot; (SELECT Count(id) &quot;
+ &quot; FROM   contact cc &quot;
+ &quot; WHERE  cc.accountid = ac.id) AS contacts &quot;
+ &quot; FROM &quot;
+ &quot; [account] ac &quot;
+ &quot; &quot;
+ &quot; JOIN [accountattribute] aa &quot;
+ &quot; ON ac.id = aa.id &quot;
+ &quot; JOIN [accountcompliancestatusenum] acs &quot;
+ &quot; ON ac.compliancestatus = acs.id &quot;
+ &quot; JOIN [contact] c &quot;
+ &quot; ON c.accountid = ac.id &quot;
+ &quot; JOIN [contactattribute] ca &quot;
+ &quot; ON c.id = ca.id &quot;
+ &quot; JOIN [contactcompliancestatusenum] ccs &quot;
+ &quot; ON c.compliancestatus = ccs.id &quot;
+ &quot; LEFT JOIN [contactwatchlist] cw &quot;
+ &quot; ON c.id = cw.contact &quot;
+ &quot; LEFT Join WatchList watch &quot;
+ &quot; ON  (watch.id = cw.reason   AND watch.StopPaymentOut = 1) &quot;
+ &quot; WHERE  tradeaccountnumber = ? and ac.OrganizationID= &quot;
+ &quot; (SELECT id from Organization where code=?) ORDER BY  watch.id DESC &quot;),
	
<span class="fc" id="L415">	GET_FUNDS_IN_ACCOUNT_CONTACT_DETAILS(&quot;SELECT  ac.id       AS accountid, &quot;</span>
+ &quot; ac.AccountTMFlag  , &quot;
+ &quot; ac.DormantFlag  , &quot;
+ &quot; ac.type AS custType, &quot;
+ &quot; ac.OldOrganizationId, &quot;
+ &quot; aa.attributes AS acattrib, &quot;
+ &quot; acs.status AS accountStatus, &quot;
+ &quot; c.tradecontactid AS TradeContactID, &quot;
+ &quot; c.id AS contactid, &quot;
+ &quot; ca.attributes AS contactattrib, &quot;
+ &quot; ccs.status AS ContactStatus, &quot;
+ &quot; cw.id AS watchlistid, &quot;
+ &quot; cw.reason AS watchlistreason, &quot;
+ &quot; watch.reason AS watchlistreasonname, &quot;
+ &quot; (SELECT id from Organization where code=?) AS requestOrgID,&quot;
+ &quot; (SELECT Count(id) &quot;
+ &quot; FROM contact cc &quot;
+ &quot; WHERE  cc.accountid = ac.id) AS contacts, &quot;
+ &quot; ac.LEUpdateDate AS leUpdateDate,&quot;
+ &quot; c.POIExists AS poiExists&quot;
+ &quot; FROM &quot;
+ &quot; [account] ac &quot;
+ &quot; &quot;
+ &quot; JOIN [accountattribute] aa &quot;
+ &quot; ON ac.id = aa.id &quot;
+ &quot; JOIN [accountcompliancestatusenum] acs &quot;
+ &quot; ON ac.compliancestatus = acs.id &quot;
+ &quot; JOIN [contact] c &quot;
+ &quot; ON c.accountid = ac.id &quot;
+ &quot; JOIN [contactattribute] ca &quot;
+ &quot; ON c.id = ca.id &quot;
+ &quot; JOIN [contactcompliancestatusenum] ccs &quot;
+ &quot; ON c.compliancestatus = ccs.id &quot;
+ &quot; LEFT JOIN [contactwatchlist] cw &quot;
+ &quot; ON c.id = cw.contact &quot;
+ &quot; LEFT Join WatchList watch &quot;
+ &quot; ON (watch.id = cw.reason   AND watch.StopPaymentIn = 1) &quot;
+ &quot; WHERE  tradeaccountnumber = ? and ac.OrganizationID= &quot;
+ &quot; (SELECT id from Organization where code=?)&quot;),
	
<span class="fc" id="L455">	DELETE_FUNDS_OUT(&quot;UPDATE [PaymentOut] SET [ComplianceStatus]=(SELECT ID FROM PaymentComplianceStatusEnum WHERE status=?), [Deleted]=1, [UpdatedBy]=?, [UpdatedOn]=? WHERE [TradePaymentID]=?&quot;),</span>
	
<span class="fc" id="L457">	GET_ACCOUNT_CREATION_TIME(&quot;SELECT [CreatedOn] FROM Account where id=?&quot;),</span>
	//AT-3830
<span class="fc" id="L459">	INSERT_INTO_PAYMENTS_IN(&quot;INSERT INTO [PaymentIn]([OrganizationID], [AccountID], [ContactID], [TradeContractNumber], &quot;</span>
			+ &quot; [TradePaymentID], [ComplianceStatus], [ComplianceDoneOn], [Deleted], [CreatedBy], [CreatedOn], [UpdatedBy], &quot;
			+ &quot; [UpdatedOn], [FraugsterStatus] , [SanctionStatus], [BlacklistStatus], [CustomCheckStatus], [TransactionDate] , [isOnQueue],[STPFlag],[LegalEntityId],[DebitCardFraudCheckStatus], [IntuitionCheckStatus] ) &quot;
			+ &quot; VALUES((select id from Organization where code=?), ?, ?, ?, ?, (select id from PaymentComplianceStatusEnum where status=?), ?, ?, ?, ?, ?, ?,?,?,?,?,?,?,?,(select id from legalEntity where code=?),?,?)&quot;),
	
<span class="fc" id="L464">	INSERT_INTO_PAYMENTS_IN_ATTRIBUTE(&quot;INSERT INTO [PaymentInAttribute]([ID], [Version],[Attributes], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn]) VALUES(?,?,?,?,?,?,?)&quot;),</span>
	//AT-3830
<span class="fc" id="L466">	UPDATE_FUNDS_IN_STATUS(&quot;UPDATE [PaymentIn] SET [ComplianceStatus]=(SELECT [ID] FROM [PaymentComplianceStatusEnum] WHERE [Status]=?), [FraugsterStatus]= ?, [SanctionStatus]= ?, &quot;</span>
			+ &quot; [BlacklistStatus] = ?, [CustomCheckStatus] = ?,[ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=? , [isOnQueue] = ?, [STPFlag] = ?, [InitialStatus] = ?,[DebitCardFraudCheckStatus]=?, [IntuitionClientRiskLevel]=?, [IntuitionCheckStatus]=? WHERE id=?&quot;), //IntuitionRiskLevel added for AT-4451
	
<span class="fc" id="L469">	INSERT_INTO_FUNDS_IN_STATUS_REASON(&quot;INSERT INTO [PaymentInStatusReason]([PaymentInID], [StatusUpdateReasonID], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn])&quot;+ </span>
		    &quot;VALUES(?, ((SELECT [ID] FROM [StatusUpdateReason] WHERE [Module]=? AND [Reason]=?)), ?, ?,?, ?)&quot;),
	
<span class="fc" id="L472">	DOES_FUNDS_IN_EXIST(&quot;SELECT [ID] FROM [PaymentIn] WHERE [TradePaymentID]=?&quot;),</span>
	
<span class="fc" id="L474">	GET_FUNDSOUT_REQUEST_BY_PAYMENTOUTID(&quot;SELECT [AccountID], [ContactID], [Attributes] FROM [PaymentOut] po JOIN [PaymentOutAttribute] poa ON po.id=poa.id WHERE po.id= ?&quot;),</span>
	
<span class="fc" id="L476">	GET_FUNDSIN_REQUEST_BY_PAYMENTINID(&quot;SELECT [AccountID], [ContactID], [Attributes] FROM [PaymentIn] pi JOIN [PaymentInAttribute] pia ON pi.id=pia.id WHERE pi.id= ?&quot;),</span>
	
<span class="fc" id="L478">	GET_SANCTION_FIRST_SUMMARY(&quot;select Top 1 Summary from EventServiceLog where EntityType = ? and EntityID = ? and ServiceProvider=(select id from Compliance_ServiceProvider where Code='SANCTION_SERVICE') and [Status] in(4,1,2) order by ID asc &quot;),</span>
	
<span class="fc" id="L480">	GET_FRAUGSTER_FIRST_SUMMARY(&quot;select Top 1 Summary from EventServiceLog where EntityType = ? and EntityID = ? and ServiceProvider=(select id from Compliance_ServiceProvider where Code='FRAUGSTER_ONUPDATE_SERVICE') and [Status] in(4,1,2) order by ID asc &quot;),</span>
	
<span class="fc" id="L482">	GET_FRAUGSTER_FIRST_SIGNUP_SUMMARY(&quot;select Top 1 Summary from EventServiceLog where EntityType = ? and EntityID = ? and ServiceProvider=(select id from Compliance_ServiceProvider where Code='FRAUGSTER_SIGNUP_SERVICE') and [Status] in(1,2) order by ID asc&quot;),</span>
	
	//ADD for AT-3161
<span class="fc" id="L485">	GET_FRAUGSTER_SIGNUP_DETAILS(&quot;select JSON_VALUE([ProviderResponse], '$.fraugsterApproved') As fraugsterApprovedScore, UpdatedOn from EventServiceLog where EntityType = ? and EntityID = ? and ServiceProvider IN (10, 11) order by UpdatedOn DESC&quot;),</span>
	
<span class="fc" id="L487">	GET_ISO_COUNTRY_CODE_AND_NAMES(&quot;select code,displayname from country&quot;),</span>
	
	/**Query change for AT-2524*/
<span class="fc" id="L490">	GET_BROADCAST_MESSAGE_FROM_DB(&quot;declare @Id int &quot;</span>
			+ &quot; select TOP 1 @Id=Id from comp.StatusBroadCastQueue where DeliveryStatus in (1,3) and RetryCount&lt;3 order by id asc &quot;
			+ &quot; Select * from comp.StatusBroadCastQueue where id = @Id&quot;),
	
<span class="fc" id="L494">	UPDATE_BROADCAST_STATUS_TO_DB(&quot;update StatusBroadCastQueue set DeliveryStatus=?,RetryCount=?,DeliveredOn=? where id=?&quot;),</span>
	
	/**Query added to fetch user ID by SSOUserID from User table - Vishal J*/
<span class="fc" id="L497">	GET_USER_ID_BY_SSOUSERID(&quot;SELECT id FROM [USER] WHERE SSOUserID=?&quot;),</span>
	
<span class="fc" id="L499">	  SAVE_INTO_BROADCAST_QUEUE(&quot;INSERT INTO [StatusBroadCastQueue]([OrganizationID], [EntityType], [AccountID], [ContactID], [PaymentInID], [PaymentOutID], [StatusJson], [DeliveryStatus], [DeliverOn], [CreatedBy], [CreatedOn]) &quot;</span>
	    		+ &quot;    VALUES((SELECT ID FROM Organization WHERE code=?), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;),
	  
<span class="fc" id="L502">	UPDATE_FUNDS_IN_SANCTION_STATUS(&quot;UPDATE [PaymentIn] SET  [SanctionStatus]= ?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L504">	UPDATE_FUNDS_IN_CUSTOMCHECK_STATUS(&quot;UPDATE [PaymentIn] SET  [CustomCheckStatus]= ?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L506">	UPDATE_FUNDS_IN_FRAUGSTER_STATUS(&quot;UPDATE [PaymentIn] SET  [FraugsterStatus]= ?, [ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L508">	UPDATE_FUNDS_IN_BLACKLIST_STATUS(&quot;UPDATE [PaymentIn] SET  [BlacklistStatus]= ?, [ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L510">	UPDATE_FUNDS_OUT_CUSTOMCHECK_STATUS(&quot;UPDATE [PaymentOut] SET  [CustomCheckStatus]= ?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L512">	UPDATE_FUNDS_OUT_SANCTION_STATUS(&quot;UPDATE [PaymentOut] SET  [SanctionStatus]= ?,  [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L514">	UPDATE_FUNDS_OUT_FRAUGSTER_STATUS(&quot;UPDATE [PaymentOut] SET  [FraugsterStatus]= ?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L516">	UPDATE_FUNDS_OUT_BLACKLIST_STATUS(&quot;UPDATE [PaymentOut] SET  [BlacklistStatus]= ?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
	
<span class="fc" id="L518">	GET_ACCOUNT_CONTACT_EXISTING_ID(&quot;select acc.CRMAccountID As CRMAccountID, &quot;</span>
			+ &quot; acc.TradeAccountNumber As TradeAccountNumber, &quot;
			+ &quot; acc.TradeAccountID As TradeAccountID , &quot;
			+ &quot; id as accountid, &quot;
			+ &quot; NULL As CRMContactID, &quot;
			+ &quot; NULL As TradeContactID &quot;
			+ &quot; from Account acc &quot;
			+ &quot; WHERE (acc.CRMAccountID = ? OR acc.TradeAccountID= ? OR acc.TradeAccountNumber= ?  ) &quot;
			+ &quot; AND    acc.OrganizationID=(select id from Organization where code= ? ) &quot;
			+ &quot; UNION ALL  &quot;
			+ &quot; SELECT  NULL As CRMAccountID, &quot;
			+ &quot; NULL As TradeAccountNumber,  &quot;
			+ &quot; NULL As TradeAccountID , &quot;
			+ &quot; accountid, &quot;
			+ &quot; cc.CRMContactID As CRMContactID, &quot;
			+ &quot; cc.TradeContactID  As TradeContactID &quot;
			+ &quot; FROM  Contact cc  &quot;
			+ &quot; where ( cc.CRMContactID IN({CONTACT_SF_ID}) OR  cc.TradeContactID IN({TRADE_CONTACT_ID})) &quot;
			+ &quot; AND  cc.OrganizationID=(select id from Organization where code= ? ) &quot;),
	
<span class="fc" id="L538">	GET_INTERNAL_RULE_SERVICE_CONTACT_STATUS(&quot;SELECT ID As contactId, BlacklistStatus, SanctionStatus, ComplianceStatus From Contact  WHERE ComplianceStatus &lt;&gt;1&quot;</span>
			+ &quot;and ACCOUNTID= ?&quot;),
	
<span class="fc" id="L541">	DELETE_FROM_CONTACT_WATCHLIST(&quot;DELETE FROM ContactWatchList WHERE [Reason]=(SELECT [ID] FROM WatchList WHERE Reason= ? ) AND [Contact]= ? &quot;),</span>
	

<span class="fc" id="L544">	GET_FUNDS_OUT_ID(&quot;SELECT po.id AS fundsoutId, poa.attributes AS POAttrib, &quot;</span>
			+ &quot; pcs.status AS POComplianceStatus, po.FraugsterStatus, &quot;
			+ &quot; po.accountid, po.ContactID, UserAgent, &quot;
			+ &quot; DeviceType, DeviceName, DeviceVersion, DeviceID, &quot;
			+ &quot; DeviceManufacturer, OSType, BrowserName, &quot;
			+ &quot; BrowserVersion, BrowserLanguage, &quot;
			+ &quot; BrowserOnline, OSTimestamp, &quot;
			+ &quot; CDAppID, CDAppVersion,ScreenResolution,acc.TradeAccountNumber &quot;
			+ &quot;FROM paymentout po &quot;
			+ &quot;JOIN paymentoutattribute poa ON po.id = poa.id &quot;
			+ &quot;JOIN [paymentcompliancestatusenum] pcs ON po.compliancestatus = pcs.id &quot;
			+ &quot;LEFT JOIN Event e ON e.paymentoutid = po.id &quot;
			+ &quot;LEFT JOIN DeviceInfo d ON e.id = d.eventid &quot;
			+ &quot;JOIN Account acc ON po.accountid = acc.id &quot;
			+ &quot;WHERE &quot;
			+ &quot; po.tradepaymentid =? &quot;
			+ &quot; and po.OrganizationID =(SELECT id from Organization where code=?)&quot;),
	
<span class="fc" id="L562">	GET_FUNDS_OUT_ID_FOR_BLACKLIST(&quot;SELECT po.id AS fundsoutId, &quot;</span>
			+ &quot; poa.attributes AS POAttrib, &quot;
			+ &quot; pcs.status AS POComplianceStatus, BlacklistStatus, &quot;
			+ &quot; po.accountid, po.ContactID&quot;
			+ &quot; FROM paymentout po &quot;
			+ &quot; JOIN paymentoutattribute poa ON po.id = poa.id &quot;
			+ &quot; JOIN [paymentcompliancestatusenum] pcs ON po.compliancestatus = pcs.id &quot;
			+ &quot; LEFT JOIN Event e ON e.paymentoutid = po.id &quot;
			+ &quot; WHERE po.tradepaymentid =? &quot;
			+ &quot; and po.OrganizationID =(SELECT id from Organization where code=?)&quot;),
	
<span class="fc" id="L573">	UPDATE_SANCTION_STATUS_FOR_CONTACT(&quot;UPDATE Contact SET [SanctionStatus]= ? where ID=?&quot;),</span>
	
<span class="fc" id="L575">	UPDATE_SANCTION_STATUS_FOR_ACCOUNT(&quot;UPDATE Account SET [SanctionStatus]= ? where ID=?&quot;),</span>
	
<span class="fc" id="L577">	UPDATE_BLACKLIST_STATUS_FOR_CONTACT(&quot;UPDATE Contact SET [BlacklistStatus]= ? where ID=?&quot;),</span>
	
<span class="fc" id="L579">	UPDATE_BLACKLIST_STATUS_FOR_ACCOUNT(&quot;UPDATE Account SET [BlacklistStatus]= ? where ID=?&quot;),</span>
	
<span class="fc" id="L581">	UPDATE_KYC_STATUS_FOR_CONTACT(&quot;UPDATE Contact SET [EIDStatus]= ? where ID=?&quot;),</span>
	
<span class="fc" id="L583">	UPDATE_FRAUGSTER_STATUS_FOR_CONTACT(&quot;UPDATE Contact SET [FraugsterStatus]= ? where ID=?&quot;),</span>
	
<span class="fc" id="L585">	GET_SANCTION_STATUS_BY_ENTITY_ID(&quot;SELECT TOP 1 providerResponse,summary,status FROM  eventservicelog WHERE  servicetype = 7 &quot;</span>
			+ &quot; AND entityid =? AND entitytype = ? &quot;
			+ &quot; AND (status=1 OR status= 2 OR status=4) ORDER  BY id DESC&quot;),

<span class="fc" id="L589">	INSERT_USER_RESOURCE_LOCK(</span>
			&quot;INSERT INTO [UserResourceLock] (UserID, ResourceType, ResourceID, LockReleasedOn, CreatedBy, CreatedOn, WorkflowTime ) &quot;
			+ &quot; VALUES ((select Id from [user] where SSOUserID=?),?,?,?,(select Id from [user] where SSOUserID=?),?,?)&quot;),
	
<span class="fc" id="L593">	GET_FUNDS_IN_ID_FOR_FRAUGSTER(&quot;SELECT pi.id AS fundsinId, &quot;</span>
			+ &quot; pia.attributes AS PIAttrib, &quot;
			+ &quot; pcs.status AS PIComplianceStatus, FraugsterStatus, &quot;
			+ &quot; pi.accountid, pi.ContactID, UserAgent, DeviceType, &quot;
			+ &quot; DeviceName, DeviceVersion, DeviceID, DeviceManufacturer,&quot;
			+ &quot; OSType, BrowserName, BrowserVersion, BrowserLanguage, &quot;
			+ &quot; BrowserOnline, OSTimestamp, &quot;
			+ &quot; CDAppID, CDAppVersion,ScreenResolution&quot;
			+ &quot; FROM paymentin pi &quot;
			+ &quot; JOIN paymentinattribute pia ON pi.id = pia.id &quot;
			+ &quot; JOIN [paymentcompliancestatusenum] pcs ON pi.compliancestatus = pcs.id &quot;
			+ &quot; LEFT JOIN Event e ON e.paymentinid = pi.id &quot;
			+ &quot; LEFT JOIN DeviceInfo d ON e.id = d.eventid &quot;
			+ &quot; WHERE pi.tradepaymentid =? &quot;
			+ &quot; and pi.OrganizationID =(SELECT id from Organization where code=?)&quot;),
	
<span class="fc" id="L609">	GET_FUNDS_IN_ID(&quot;SELECT pin.id AS fundsinId, &quot;</span>
			+ &quot; pia.attributes AS PIAttrib, &quot;
			+ &quot; pcs.status AS PIComplianceStatus, &quot;
			+ &quot; accountid &quot;
			+ &quot; FROM paymentin pin &quot;
			+ &quot; JOIN paymentinattribute pia &quot;
			+ &quot; ON pin.id = pia.id &quot;
			+ &quot; JOIN [paymentcompliancestatusenum] pcs &quot;
			+ &quot; ON pin.compliancestatus = pcs.id &quot;
			+ &quot; WHERE  pin.tradepaymentid = ? &quot;
			+ &quot; AND pin.organizationid = (SELECT id &quot;
			+ &quot; FROM organization &quot;
			+ &quot; WHERE code = ?)&quot;),
	
<span class="fc" id="L623">	GET_FUNDS_IN_ID_FOR_BLACKLIST(&quot;SELECT  pi.id AS fundsinId, &quot;</span>
			+ &quot; pia.attributes AS PIAttrib, &quot;
			+ &quot; pcs.status AS PIComplianceStatus, BlacklistStatus, &quot;
			+ &quot; pi.accountid, pi.ContactID&quot;
			+ &quot; FROM paymentin pi &quot;
			+ &quot; JOIN paymentinattribute pia ON pi.id = pia.id &quot;
			+ &quot; JOIN [paymentcompliancestatusenum] pcs ON pi.compliancestatus = pcs.id &quot;
			+ &quot; LEFT JOIN Event e ON e.paymentinid = pi.id &quot;
			+ &quot; WHERE &quot;
			+ &quot; pi.tradepaymentid =? &quot;
			+ &quot; and pi.OrganizationID = (SELECT id from Organization where code=?)&quot;),
	
<span class="fc" id="L635">	GET_COUNTRY_DISPLAY_NAME(&quot;SELECT DisplayName From Country WHERE Code=?&quot;),</span>
	/*GET_SANCTION_FAILED_RECORDS(&quot;WITH SelectedIDs AS (SELECT &quot;
			+ &quot;		payOut.id AS pID, payOut.OrganizationID,  ContractNumber, contactid,TradePaymentID &quot;
			+ &quot;	FROM &quot;
			+ &quot;		paymentout payOut JOIN Account a ON payOut.accountid=a.id &quot;
			+ &quot;	JOIN userresourcelock ur ON &quot;
			+ &quot;		ur.resourceID = payOut.id &quot;
			+ &quot;		and ur.lockreleasedon is NULL &quot;
			+ &quot;		AND resourceType = 1 &quot;
			+ &quot;		 &quot;
			+ &quot;	WHERE &quot;
			+ &quot;		payOut.deleted = 0 AND payOut.ComplianceStatus = 4 AND payOut.sanctionstatus&lt;&gt;1 &quot;
			+ &quot;		AND payOut.FraugsterStatus = 1 AND payOut.BlacklistStatus = 1 AND payOut.CustomCheckStatus = 1 &quot;
			+ &quot; AND a.WatchListStatus=1 ) &quot;
			+ &quot;select &quot;
			+ &quot;	EventID, accountid, c.EntityID,c.EntityType, paymentOutId, c.ID ESLid, org.Code,ContractNumber, contactid, TradePaymentID, c.status &quot;
			+ &quot;from &quot;
			+ &quot;SelectedIDs si JOIN Event e ON e.paymentOutId=si.pID &quot;
			+ &quot;JOIN EventServiceLog c ON c.eventid = e.id &quot;
			+ &quot;JOIN Organization org ON si.OrganizationID = org.id &quot;
			+ &quot;where &quot;
			+ &quot; c.ServiceType=7 AND c.Status IN (1,2,4) AND paymentOutId &gt; ? &quot; 
			+ &quot; order by  EventID DESC&quot;),*/
	
	
<span class="fc" id="L660">	GET_SANCTION_FAILED_RECORDS(&quot;WITH SelectedIDs AS (SELECT {BATCH_SIZE} &quot;</span>
			+ &quot; payOut.id AS pID, payOut.OrganizationID, ContractNumber, contactid ,TradePaymentID &quot;
			+ &quot; FROM &quot;
			+ &quot; paymentout payOut JOIN Account a ON payOut.accountid=a.id &quot;
			+ &quot; WHERE &quot;
			+ &quot; payOut.deleted = 0 AND payOut.ComplianceStatus = 4 AND payOut.sanctionstatus&lt;&gt;1 &quot;
			+ &quot; AND payOut.FraugsterStatus = 1 AND payOut.BlacklistStatus = 1 AND payOut.CustomCheckStatus = 1 AND a.PayOutWatchListStatus=1  &quot;
			+ &quot; {CREATEDON} {PAYMENT_OUT_ID} &quot;
			+ &quot; ), &quot;
			+ &quot; uData AS( select &quot;
			+ &quot; cc.EventID, accountid, cc.EntityID, 3 AS EntityType, paymentOutId, cc.ID ESLid, org.Code,ContractNumber, contactid,TradePaymentID, cc.status, cc.updatedon , &quot;
			+ &quot; ROW_NUMBER() OVER (PARTITION BY cc.EntityType ORDER BY cc.updatedon DESC) ROWNUM &quot;
			+ &quot; from SelectedIDs si JOIN Event e ON e.paymentOutId=si.pID &quot;
			+ &quot; LEFT JOIN EventServiceLog cc ON cc.eventid = e.id AND cc.ServiceType=7 AND cc.entityType=3 &quot;
			+ &quot; JOIN Organization org &quot;
			+ &quot; ON si.OrganizationID = org.id &quot;
			+ &quot; &quot;
			+ &quot; UNION &quot;
			+ &quot; select bn.EventID, accountid, bn.EntityID, 2 AS EntityType, paymentOutId, &quot;
			+ &quot; bn.ID ESLid, org.Code,ContractNumber, contactid,TradePaymentID, bn.status, bn.updatedon , &quot;
			+ &quot; ROW_NUMBER() OVER (PARTITION BY bn.EntityType ORDER BY bn.updatedon DESC) ROWNUM &quot;
			+ &quot; from SelectedIDs si &quot;
			+ &quot; JOIN Event e ON e.paymentOutId=si.pID &quot;
			+ &quot; LEFT JOIN EventServiceLog bn ON bn.eventid = e.id AND bn.ServiceType=7 AND bn.entityType=2 &quot;
			+ &quot; JOIN Organization org ON si.OrganizationID = org.id &quot;
			+ &quot; &quot;
			+ &quot; UNION &quot;
			+ &quot; select &quot;
			+ &quot; bk.EventID, accountid, bk.EntityID, 4 AS EntityType, paymentOutId, bk.ID ESLid, org.Code,ContractNumber, contactid,TradePaymentID, bk.status, bk.updatedon, &quot;
			+ &quot; ROW_NUMBER() OVER (PARTITION BY bk.EntityType ORDER BY bk.updatedon DESC) ROWNUM &quot;
			+ &quot; from &quot;
			+ &quot; SelectedIDs si JOIN Event e ON e.paymentOutId=si.pID &quot;
			+ &quot; LEFT JOIN EventServiceLog bk ON bk.eventid = e.id AND bk.ServiceType=7 AND bk.entityType=4 &quot;
			+ &quot; JOIN Organization org ON si.OrganizationID = org.id &quot;
			+ &quot; &quot;
			+ &quot;) &quot;
			+ &quot;SELECT u.*, pa.vTradeBeneficiaryID, pa.vTradeBankID From Udata u JOIN PaymentOutAttribute pa ON u.paymentoutid=pa.id &quot;
			+ &quot;WHERE ROWNUM=1 &quot;
			+ &quot;ORDER BY ContractNumber&quot;),
	
<span class="fc" id="L700">	GET_OTHER_ENTITY_STATUS(&quot;SELECT status, EntityType FROM EventServiceLog c JOIN Event E ON C.eventid=e.id WHERE paymentOutId = ? AND EntityType &lt;&gt; ? AND ServiceType=7 ORDER BY c.EntityType, c.id DESC&quot;),</span>
	
<span class="fc" id="L702">	GET_SANCTION_STATUS(&quot;SELECT sanctionstatus, sb.PaymentOutID FROM paymentout po LEFT JOIN StatusBroadCastQueue sb ON po.id=sb.PaymentOutID  WHERE po.id = ? AND sb.PaymentOutID IS NULL &quot;),</span>
	
<span class="fc" id="L704">	GET_WATCHLIST_REASON_LIST_FOR_PAYMENTOUT_AND_PAYMENTIN(&quot;SELECT MAX(category) AS Category, MAX(CAST(StopPaymentIn AS INT)) AS StopPaymentIn, MAX(CAST(StopPaymentOut AS INT)) AS StopPaymentOut&quot;</span>
			+ &quot; FROM WatchList w JOIN ContactWatchList cw ON w.id=cw.reason JOIN Contact c ON cw.contact=c.id &quot;
			+ &quot; WHERE c.accountid= ? OR w.Reason IN(#) &quot;),
	
	//new for AT-2986
<span class="fc" id="L709">	GET_WATCHLIST_REASON_LIST_FOR_PAYMENTOUT_AND_PAYMENTIN_WITH_CON(&quot;SELECT MAX(category) AS Category, MAX(CAST(StopPaymentIn AS INT)) AS StopPaymentIn, MAX(CAST(StopPaymentOut AS INT)) AS StopPaymentOut&quot;</span>
				+ &quot; FROM WatchList w JOIN ContactWatchList cw ON w.id=cw.reason JOIN Contact c ON cw.contact=c.id &quot;
				+ &quot; WHERE c.id = ? &quot;),
	
<span class="fc" id="L713">	GET_FRAUGSTERSCHEDULAR_DATA_FROM_DB(&quot;select ID,AtlasID,FraugsterTransactionID,Status,AsyncStatus,AsyncStatusDate,SyncStatus from FraugsterSchedularData where Delivered is NULL&quot;),</span>
	
<span class="fc" id="L715">	UPDATE_FRAUGSTER_DATA(&quot;UPDATE FraugsterSchedularData SET Delivered=? where ID = ?&quot;),</span>
	
<span class="fc" id="L717">	DELETE_FUNDS_IN(&quot;UPDATE [PaymentIn] SET [ComplianceStatus]=(SELECT ID FROM PaymentComplianceStatusEnum WHERE status=?), [UpdatedBy]=?, [UpdatedOn]=?,[Deleted]=1 WHERE [TradePaymentID]=? AND OrganizationID= (SELECT ID FROM Organization WHERE Code=?)&quot;),</span>
	
<span class="fc" id="L719">	GET_IS_LOCK_RELEASED_ON(&quot;SELECT LockReleasedOn FROM UserResourceLock WHERE ResourceType=2 AND ResourceID = (SELECT ID FROM PaymentIn WHERE TradePaymentID=? AND OrganizationID= (SELECT ID FROM Organization WHERE Code=?))&quot;),</span>
	 
<span class="fc" id="L721">	UPDATE_LOCK_RELEASED_ON(&quot;UPDATE UserResourceLock SET LockReleasedOn=? WHERE ResourceType=2 AND ResourceID = (SELECT ID FROM PaymentIn WHERE TradePaymentID=? AND OrganizationID= (SELECT ID FROM Organization WHERE Code=?))&quot;),</span>
	
<span class="fc" id="L723">	INSERT_FRAUGSTER_SCHEDULAR_DATA(&quot;INSERT INTO FraugsterSchedularData (AtlasID, FraugsterTransactionID, Status, &quot;</span>
			+ &quot;AsyncStatus, SyncStatus, AsyncStatusDate, CreatedBy) VALUES(?,?,?,?,?,?,?)&quot;),
	
<span class="fc" id="L726">	GET_PREVIOUS_CONTACT_INACTIVE_REASON(&quot;SELECT TOP 1 sur.Reason from ProfileStatusReason psr JOIN StatusUpdateReason sur ON sur.id = psr.StatusUpdateReasonID &quot; </span>
	+ &quot;and psr.contactid = ? order by psr.id DESC&quot;),
	
<span class="fc" id="L729">	INSERT_PAYMENT_IN_ACTIVITY_LOG_STP(&quot;INSERT INTO [PaymentInActivityLog] (PaymentInID, ActivityBy, [Timestamp], CreatedBy, CreatedOn)&quot;</span>
			+ &quot; VALUES(?,?,?,?,?)&quot;),
	
<span class="fc" id="L732">	INSERT_PAYMENT_IN_ACTIVITY_LOG_DETAIL_STP(&quot;INSERT INTO [PaymentInActivityLogDetail]([ActivityID], [ActivityType], [Log], [CreatedBy], [CreatedOn]) VALUES(?, (SELECT id FROM ActivityTypeEnum WHERE Module = ? AND Type = ?), ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L734">	INSERT_PAYMENT_OUT_ACTIVITY_LOG_STP(&quot;INSERT INTO [PaymentOutActivityLog] (PaymentOutID, ActivityBy, [Timestamp], CreatedBy, CreatedOn)&quot;</span>
			+ &quot; VALUES(?,?,?,?,?)&quot;),
	
<span class="fc" id="L737">	INSERT_PAYMENT_OUT_ACTIVITY_LOG_DETAIL_STP(&quot;INSERT INTO [PaymentOutActivityLogDetail]([ActivityID], [ActivityType], [Log], [CreatedBy], [CreatedOn]) VALUES(?, (SELECT id FROM ActivityTypeEnum WHERE Module = ? AND Type = ?), ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L739">	INSERT_PROFILE_ACTIVITY_LOG_STP(&quot;INSERT INTO [ProfileActivityLog] ([Timestamp], ActivityBy, OrganizationID, AccountID, ContactID, CreatedBy, CreatedOn, UpdatedBy, UpdatedOn) &quot;</span>
			+ &quot; VALUES( ?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;),
	
<span class="fc" id="L742">	INSERT_PROFILE_ACTIVITY_LOG_DETAIL_STP(&quot;INSERT INTO [ProfileActivityLogDetail] VALUES(?, (SELECT id FROM ActivityTypeEnum WHERE Module = ? AND Type = ?), ?, ?, ?, ?, ?)&quot;),</span>
	
<span class="fc" id="L744">	GET_WATCHLIST_REASONS(&quot;SELECT w.reason FROM WatchList w JOIN ContactWatchList cw ON w.id=cw.reason JOIN Contact c ON cw.contact=c.id WHERE Accountid = ?&quot;), </span>
	
<span class="fc" id="L746">	GET_DETAILS_FOR_SERVICE_FAILED_REG_CFX (&quot; WITH se AS( &quot;</span>
			+&quot; SELECT MAX(id) eventid, accountid FROM Event WHERE EventType&lt;4 AND accountid=? &quot;
			+&quot; GROUP BY accountid &quot;
			+&quot; ) &quot;
			+&quot; SELECT &quot;
			+&quot; acc.id AS accountId, acc.AccountTMFlag, &quot; //AT-4288 (AccountTMFlag)
			+&quot; accattr.attributes AS AccountAttrib, &quot; 
			+&quot; conattr.attributes AS ContactAttrib,  &quot;
			+&quot; se.eventid AS EventID, &quot;
			+&quot; acc.OrganizationID as OrgId, &quot;
			+&quot; (SELECT code from Comp.Organization where id = acc.OrganizationID) as OrgCode, &quot;
			+&quot; (SELECT Status from ContactComplianceStatusEnum acs where acs.id = con.compliancestatus )  AS ContactComplianceStatus, &quot;
			+&quot; (SELECT Status from AccountComplianceStatusEnum acs where acs.id = acc.compliancestatus )  AS AccountComplianceStatus, &quot;
			+&quot; acc.FraugsterStatus, con.FraugsterStatus AS ContactFraugsterStatus, acc.SanctionStatus,&quot;
			+ &quot; acc.BlacklistStatus, con.BlacklistStatus AS ContactBlacklistStatus, &quot;
			+ &quot; acc.EidStatus, con.EidStatus AS ContactEidStatus, acc.PayInWatchListStatus, acc.PayOutWatchListStatus, &quot; 
			+&quot; acc.id, acc.tradeaccountnumber AS TradeAccNo, UserAgent,con.id AS contactid , DeviceType,  &quot;
			+&quot; DeviceName, DeviceVersion,&quot;
			+&quot; DeviceID, DeviceManufacturer, &quot;
			+&quot; OSType, BrowserName, BrowserVersion, BrowserLanguage, BrowserOnline, OSTimestamp,  &quot;
			+&quot; CDAppID, CDAppVersion, se.eventid  &quot;
			+&quot; FROM account acc  &quot;
			+&quot; JOIN accountattribute accattr ON acc.id = accattr.id &quot; 
			+&quot; JOIN contact con ON acc.id = con.accountid  &quot;
			+&quot; JOIN contactattribute conattr ON con.id = conattr.id &quot; 
			+&quot; LEFT JOIN se ON acc.id=se.accountid &quot;
			+&quot; LEFT JOIN DeviceInfo d ON se.eventid = d.eventid &quot; 
			+&quot; LEFT JOIN EventServiceLog esl on esl.id = d.eventid &quot;
			+&quot; WHERE acc.id = ? &quot;),
	
<span class="fc" id="L776">	GET_DETAILS_FOR_SERVICE_FAILED_REG_PFX (&quot; WITH se AS( &quot; </span>
			 +&quot; SELECT MAX(id) eventid, accountid FROM Event WHERE EventType&lt;4 AND accountid= ? &quot; 
			 +&quot; GROUP BY accountid &quot;
			 +&quot; ) &quot; 
			 +&quot; SELECT &quot; 
			 +&quot; con.id AS contactId, &quot; 
			 +&quot; accattr.attributes AS AccountAttrib, &quot; 
			 +&quot; conattr.attributes AS ContactAttrib, &quot;  
			 +&quot; se.eventid AS EventID, &quot; 
			 +&quot; acc.OrganizationID as OrgId, acc.AccountTMFlag, &quot; //AT-4288 (AccountTMFlag)
			+&quot; (SELECT code from Comp.Organization where id = acc.OrganizationID) as OrgCode, &quot;
			 +&quot; (SELECT Status from ContactComplianceStatusEnum acs where acs.id = con.compliancestatus )  AS ContactComplianceStatus, &quot;
			 +&quot; (SELECT Status from AccountComplianceStatusEnum acs where acs.id = acc.compliancestatus )  AS AccountComplianceStatus, &quot;
			 + &quot; con.FraugsterStatus, &quot;
			 +&quot; con.SanctionStatus, con.BlacklistStatus, con.EidStatus,  con.PayInWatchListStatus, con.PayOutWatchListStatus,&quot; //get contact pay IN/OUT watchlist status for AT-2986
			 +&quot; acc.tradeaccountnumber AS TradeAccNo, UserAgent,acc.id AS accountid , DeviceType, &quot;  
			 +&quot; DeviceName, DeviceVersion, &quot;
			 +&quot; DeviceID, DeviceManufacturer, &quot;
			 +&quot; OSType, BrowserName, &quot;  
			 +&quot; BrowserVersion, BrowserLanguage, BrowserOnline, &quot;
			 +&quot; OSTimestamp, CDAppID, CDAppVersion &quot; 
			 +&quot; FROM  contact con&quot;
			 +&quot; JOIN account acc ON con.accountid  =acc.id &quot; 
			 +&quot; JOIN accountattribute accattr ON acc.id = accattr.id &quot; 
			 +&quot; JOIN contactattribute conattr ON con.id = conattr.id &quot; 
			 +&quot; LEFT JOIN se ON acc.id=se.accountid &quot; 
			 +&quot; LEFT JOIN DeviceInfo d ON se.eventid = d.eventid &quot; 
			 +&quot; WHERE con.id = ?&quot;),//change where clause (accountId -&gt; contactId)- for AT-4289
	
<span class="fc" id="L805">	GET_DETAILS_FOR_FAILED_FUNDS_OUT(&quot;SELECT &quot;</span>
			+ &quot; po.id AS fundsoutId, &quot;
			+ &quot; poa.attributes AS POAttrib, &quot;
			+ &quot; po.Compliancestatus AS POComplianceStatus, po.FraugsterStatus, po.SanctionStatus, po.BlacklistStatus, po.CustomCheckStatus, po.PaymentReferenceStatus, &quot;
			+ &quot; po.accountid, acc.tradeaccountnumber, po.ContactID, UserAgent, DeviceType, &quot;
			+ &quot; DeviceName, DeviceVersion, DeviceID, &quot;
			+ &quot; DeviceManufacturer, OSType, BrowserName, &quot;
			+ &quot; BrowserVersion, BrowserLanguage, &quot;
			+ &quot; BrowserOnline, OSTimestamp, CDAppID, CDAppVersion, ScreenResolution &quot;
			+ &quot;FROM paymentout po &quot;
			+ &quot;JOIN paymentoutattribute poa ON po.id = poa.id &quot;
			+ &quot;LEFT JOIN Event e ON e.paymentoutid = po.id &quot;
			+ &quot;LEFT JOIN DeviceInfo d ON e.id = d.eventid &quot;
			+ &quot;JOIN Account acc ON po.accountid = acc.id &quot;
			+ &quot;WHERE po.id = ? and e.eventType = 7&quot; ),
	
	
<span class="fc" id="L822">	GET_ESL_FOR_SERVICE_FAILED_FUNDSOUT(&quot;SELECT es.EntityType, es.ServiceType, es.ProviderResponse, &quot;</span>
			+ &quot; es.Status, es.summary, &quot;
			+ &quot; es.EntityID, es.EntityVersion, es.eventID &quot;
			+ &quot; FROM EventServiceLog es &quot;
			+ &quot; JOIN Event e On es.eventid=e.id &quot;
			+ &quot; AND e.eventtype=7 WHERE e.paymentoutid=?&quot;),
	
<span class="fc" id="L829">	GET_ESL_FOR_SERVICE_FAILED_REG(&quot;SELECT es.EntityType, es.ServiceType, es.ProviderResponse, es.Status, es.summary, es.EntityID, es.EntityVersion, es.eventID &quot;</span>
			+ &quot;FROM EventServiceLog es WHERE EventID = ?&quot;),
	
	//UPDATE_FAILED_RECHECK(&quot;UPDATE ReproccessFailed set Status = ? where TransId = ? and TransType = ? &quot;),
<span class="fc" id="L833">	UPDATE_FAILED_RECHECK(&quot;UPDATE ReproccessFailed set Status = ?, RetryCount = 1 where TransId = ? and TransType = ? &quot;),//AT-4289</span>
	
<span class="fc" id="L835">	GET_DETAILS_FOR_FAILED_FUNDS_IN(&quot;SELECT &quot; </span>
			+ &quot; pin.id AS fundsinId, &quot;
			+ &quot; pina.attributes AS PIAttrib, &quot;
			+ &quot; pin.Compliancestatus AS PIComplianceStatus, pin.FraugsterStatus, pin.SanctionStatus, pin.BlacklistStatus, pin.CustomCheckStatus, &quot;
			+ &quot; pin.accountid, acc.tradeaccountnumber, pin.ContactID, UserAgent, DeviceType, &quot;
			+ &quot; DeviceName, DeviceVersion, DeviceID, &quot;
			+ &quot; DeviceManufacturer, OSType, &quot;
			+ &quot; BrowserName, BrowserVersion, BrowserLanguage, BrowserOnline, OSTimestamp, &quot;
			+ &quot; CDAppID, CDAppVersion, ScreenResolution &quot;
			+ &quot; FROM paymentin pin &quot;
			+ &quot; JOIN paymentinattribute pina ON pin.id = pina.id &quot;
			+ &quot; LEFT JOIN Event e ON e.paymentinid = pin.id &quot;
			+ &quot; LEFT JOIN DeviceInfo d ON e.id = d.eventid &quot;
			+ &quot; JOIN Account acc ON pin.accountid = acc.id &quot;
			+ &quot; WHERE pin.id = ? &quot;),
	
<span class="fc" id="L851">	GET_ESL_FOR_SERVICE_FAILED_FUNDSIN(&quot;SELECT es.EntityType, es.ServiceType, es.ProviderResponse, &quot;</span>
			+ &quot;es.Status, es.summary, es.EntityID, es.EntityVersion, es.eventID &quot;
			+ &quot;FROM EventServiceLog es &quot;
			+ &quot;JOIN Event e On es.eventid=e.id &quot;
			+ &quot;AND e.eventtype=6 WHERE e.paymentinid=?&quot;),
	
<span class="fc" id="L857">	GET_ESL_FOR_SERVICE_FAILURE_OF_CONTACT(&quot;SELECT TOP 1 es.entitytype, &quot;</span>
			+ &quot;             es.servicetype, &quot;
			+ &quot;             es.providerresponse, &quot;
			+ &quot;             es.status, &quot;
			+ &quot;             es.summary, &quot;
			+ &quot;             es.entityid, &quot;
			+ &quot;             es.entityversion, &quot;
			+ &quot;             es.eventid &quot;
			+ &quot;FROM   eventservicelog es &quot;
			+ &quot;       JOIN event e &quot;
			+ &quot;         ON e.id = es.eventid &quot;
			+ &quot;WHERE  es.servicetype = (SELECT id &quot;
			+ &quot;                         FROM   compliance_servicetypeenum &quot;
			+ &quot;                         WHERE  code = ?) &quot;
			//+ &quot;       AND es.eventid = ? &quot; //commented for AT-4289
			+ &quot;       AND e.accountid = ? &quot;
			+ &quot;       AND es.entitytype = 3 &quot;
			//+ &quot;       AND e.eventtype &lt; 4 &quot; //commented for AT-5436
			+ &quot; AND e.eventtype IN (1,2,3,4,5,15,19,22) &quot;
			+ &quot;       AND es.entityid = ? &quot;
			+ &quot;ORDER  BY es.id DESC&quot;),
	
<span class="fc" id="L879">	GET_ESL_FOR_SERVICE_FAILURE_OF_ACCOUNT(&quot;SELECT TOP 1 es.entitytype, &quot;</span>
			+ &quot;             es.servicetype, &quot;
			+ &quot;             es.providerresponse, &quot;
			+ &quot;             es.status, &quot;
			+ &quot;             es.summary, &quot;
			+ &quot;             es.entityid, &quot;
			+ &quot;             es.entityversion, &quot;
			+ &quot;             es.eventid &quot;
			+ &quot;FROM   eventservicelog es &quot;
			+ &quot;       JOIN event e &quot;
			+ &quot;         ON e.id = es.eventid &quot;
			+ &quot;WHERE  es.servicetype = (SELECT id &quot;
			+ &quot;                         FROM   compliance_servicetypeenum &quot;
			+ &quot;                         WHERE  code = ?) &quot;
			//+ &quot;       AND es.eventid = ? &quot; //commented for AT-4289
			+ &quot;       AND e.accountid = ? &quot;
			+ &quot;       AND es.entitytype = 1 &quot;
			//+ &quot;       AND e.eventtype &lt; 4 &quot; //commented for AT-5436
			+ &quot; AND e.eventtype IN (1,2,3,4,5,15,19,22) &quot;
			+ &quot;ORDER  BY es.id DESC&quot;),
	
<span class="fc" id="L900">	GET_ACCOUNT_DETAILS_FROM_CONTACTID(&quot;select accountid AS AccountId , a.type from contact c JOIN Account a on a.ID = c.AccountID where c.id = ?&quot;),</span>
	
<span class="fc" id="L902">	GET_ACCOUNT_DETAILS_FROM_ACCOUNTID(&quot;SELECT id AS AccountId ,type from Account where id = ?&quot;),</span>
	
<span class="fc" id="L904">	UPDATE_CONTACT_STATUS_FOR_CFX(&quot;UPDATE [Contact] SET ComplianceStatus=(SELECT Id FROM ContactComplianceStatusEnum WHERE Status=?) &quot;</span>
			+&quot;WHERE ID=?&quot;),
	
<span class="fc" id="L907">	GET_ACCOUNT_DETAILS_BY_ACC_SF_ID(&quot;select acc.id AS AccountId, acc.Name AS AccountName, acc.CreatedOn AS ARegisteredDate, acc.ComplianceDoneOn AS ARegistrationInDate, acc.ComplianceExpiry AS AComplianceExpiry,&quot;</span>
			+ &quot;acc.crmAccountID AS AccountSFId, acc.Version AS Version, acc.OrganizationID AS OrgID, c.id as ContactID, c.ComplianceDoneOn AS CRegisteredDate, c.CreatedOn AS CRegistrationInDate, acc.ComplianceExpiry AS CComplianceExpiry,&quot; + 
			&quot;CASE acc.[Type] WHEN 2 THEN 'PFX' WHEN 1 THEN 'CFX' ELSE 'CFX (Etailer)' END AS CustType, &quot; + 
			&quot;acc.ComplianceStatus AS AccountComplianceStatus, acc.TradeAccountID AS TradeAccountId, &quot; + 
			&quot;ca.Attributes AS contactAttributes, c.crmcontactid as ContactSFID, C.EIDSTATUS, c.SanctionStatus, c.FraugsterStatus, &quot;+
			&quot;c.BlacklistStatus, c.CustomCheckStatus, c.ComplianceStatus AS ContactComplianceStatus, c.POI_NEEDED &quot; + 
			&quot;FROM Account acc JOIN contact c ON acc.id=c.accountid JOIN ContactAttribute ca ON c.id=ca.id &quot; + 
			&quot;where acc.crmAccountid = ? &quot;),
	
<span class="fc" id="L916">	UPDATE_ACCOUNT_STATUS(&quot;UPDATE Account SET AccountStatus=?, ComplianceStatus=?, ComplianceDoneOn=?, ComplianceExpiry=?, UpdatedBy=?, UpdatedOn=?, PayInWatchListStatus=?, PayOutWatchListStatus=?, DocumentVerifiedStatus=? where CRMAccountID = ?&quot;),</span>
	
<span class="fc" id="L918">	UPDATE_CONTACT_STATUS(&quot;UPDATE Contact SET ComplianceStatus=?, ComplianceDoneOn=?, ComplianceExpiry=?, UpdatedBy=?, UpdatedOn=?,  PayInWatchListStatus=?, PayOutWatchListStatus=? where CRMContactID = ?&quot;),//ADD Pay IN/OUT watchlist status for AT-2986</span>
	
<span class="fc" id="L920">	INSERT_PROFILE_ACTIVITY_LOG_WITH_ORG_ID(&quot;INSERT INTO [ProfileActivityLog] ([Timestamp], ActivityBy, OrganizationID, AccountID, ContactID, CreatedBy, CreatedOn, UpdatedBy, UpdatedOn) &quot;</span>
			+ &quot; VALUES( ?, ?, (select id from Organization where Code =? ), ?, ?, ?, ?, ?, ?)&quot;),
	
<span class="fc" id="L923">	GET_CONTACT_DETAILS_FOR_DELETE(&quot;SELECT con.ID AS ContactID, con.CRMContactID,ca.[Attributes] AS ConAttrib, pin.id AS PaymentInId, &quot;</span>
			+ &quot; po.id AS PaymentOutId, con.TradeContactID, acc.CrmAccountID, acc.TradeAccountID, acc.ID AS AccountID, acc.Version, &quot;
			+ &quot;acc.Type AS custType, (SELECT ID from Organization where Name = ?) AS OrgID &quot;
			+ &quot; FROM Contact con &quot;
			+ &quot; JOIN ContactAttribute ca ON con.id = ca.id &quot;
			+ &quot; JOIN Account acc ON con.AccountID = acc.id &quot;
			+ &quot; LEFT JOIN PaymentIn pin ON con.id = pin.ContactID &quot;
			+ &quot; LEFT JOIN PaymentOut po ON con.id = po.ContactID &quot;
			+ &quot; WHERE con.CRMContactID = ? AND con.TradeContactID = ? &quot;
			+ &quot; AND con.AccountID = (SELECT ID FROM ACCOUNT a WHERE a.CRMAccountID = ? &quot;
			+ &quot; AND a.TradeAccountID = ?)&quot;),
	
<span class="fc" id="L935">	DELETE_CONTACT(&quot;UPDATE [Contact] SET [Deleted]=1, [UpdatedBy]=?, [UpdatedOn]=? WHERE [ID]=?&quot;),</span>
	
<span class="fc" id="L937">	GET_CONTACT_DETAILS_FOR_STATUSBROADCAST_IN_MQ(&quot;select c.CRMContactID as ContactSFID,c.TradeContactID from Contact c JOIN account a on a.ID = c.AccountID WHERE a.CRMAccountID = ?&quot;),</span>
	
<span class="fc" id="L939">	GET_OLD_ORG_ID(&quot;SELECT OldOrganizationId FROM Account WHERE Id = ?&quot;),</span>
	
<span class="fc" id="L941">	UPDATE_ONFIDO_STATUS_FOR_ACCOUNT(&quot;UPDATE Account SET [DocumentVerifiedStatus] = ? WHERE ID = (SELECT AccountID FROM Comp.Event WHERE ID = ?)&quot;),</span>
	
<span class="fc" id="L943">	GET_CURRENT_OPERATION_RECENT_DATA_FROM_EVENT_SERVICE_LOG(&quot;SELECT esl.ID as 'EventServiceLogID',esl.EntityType,esl.ServiceType,esl.Status,e.EventType,esl.EntityVersion,e.AccountID,esl.EntityID &quot; + </span>
			&quot;FROM Event e join EventServiceLog esl on e.ID = esl.EventID WHERE e.ID = ?&quot;),
	
<span class="fc" id="L946">	INSERT_UPDATE_INTO_EVENT_SERVICE_LOG_SUMMARY(&quot;DECLARE @EntityId bigint;\n&quot; + </span>
			&quot;DECLARE @EntityType smallint;\n&quot; + 
			&quot;DECLARE @ServiceType smallint;\n&quot; + 
			&quot;DECLARE @ServiceStatus smallint;\n&quot; + 
			&quot;DECLARE @EventServiceLogID bigint;\n&quot; + 
			&quot;SET @EntityId = ?;\n&quot; + 
			&quot;SET @EntityType = ?;\n&quot; + 
			&quot;SET @ServiceType = ?;\n&quot; + 
			&quot;SET @EventServiceLogID = ?;\n&quot; + 
			&quot;SET @ServiceStatus = ?;\n&quot; + 
			&quot;MERGE INTO Comp.EventServiceLogSummary WITH (HOLDLOCK) AS Dst &quot; + 
			&quot;USING ( SELECT @EntityId * 10000 + @EntityType * 100 + @ServiceType AS EntityServiceHash ) AS Src &quot; + 
			&quot;ON Src.EntityServiceHash = Dst.[EntityServiceHash] &quot; + 
			&quot;WHEN MATCHED THEN &quot; + 
			&quot;UPDATE SET EventServiceLogID = @EventServiceLogID, Status = @ServiceStatus &quot; + 
			&quot;WHEN NOT MATCHED THEN &quot; + 
			&quot;INSERT (EntityServiceHash,Status,EventServiceLogID) &quot; + 
			&quot;VALUES (EntityServiceHash,@ServiceStatus,@EventServiceLogID);&quot;),
	
<span class="fc" id="L965">	GET_RECENT_SPECIFIC_EVENT_SERVICE_DATA(&quot;With Selected AS (SELECT EventServiceLogID , Status, EntityServiceHash &quot; + </span>
			&quot;FROM Comp.EventServiceLogSummary &quot; + 
			&quot;WHERE EntityServiceHash= ?) &quot; + 
			&quot;SELECT s.EntityServiceHash, esl.Summary , esl.Status , esl.ProviderResponse &quot; + 
			&quot;FROM Comp.EventServiceLog esl JOIN Selected s ON esl.ID = s.EventServiceLogID;&quot;),
	
<span class="fc" id="L971">	GET_USER_TABLE_IDS_NAMES(&quot;SELECT ID,SSOUserID AS UserName FROM [User];&quot;),</span>
	
<span class="fc" id="L973">	GET_COUNTRY_STATE_DATA(&quot;SELECT DisplayName AS StateName, Code FROM CountryState &quot;),//AT-3719</span>
	
<span class="fc" id="L975">	UPDATE_CONTACT_WITHOUT_KYC_AND_SANCTION_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ? , PayInWatchListStatus=?, PayOutWatchListStatus=? WHERE Id=?&quot;),</span>
	
<span class="fc" id="L977">	UPDATE_CONTACT_WITHOUT_KYC_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,FraugsterStatus=?,SanctionStatus=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ? , PayInWatchListStatus=?, PayOutWatchListStatus=? WHERE Id=?&quot;),</span>
	
<span class="fc" id="L979">	UPDATE_CONTACT_WITHOUT_SANCTION_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,EIDStatus=?,FraugsterStatus=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ? , PayInWatchListStatus=?, PayOutWatchListStatus=? WHERE Id=?&quot;),</span>
	
<span class="fc" id="L981">	UPDATE_CONTACT_WITHOUT_FRAUDPREDICT_COMPLIANCE_STATUS(&quot;UPDATE Contact SET [ComplianceStatus]=(SELECT [ID] FROM [ContactComplianceStatusEnum ] WHERE Status = ?), [UpdatedBy]=?, [UpdatedOn]=?,EIDStatus=?,SanctionStatus=?,BlacklistStatus=? , CustomCheckStatus=?,isOnQueue = ? , PayInWatchListStatus=?, PayOutWatchListStatus=? WHERE Id=?&quot;),</span>

<span class="fc" id="L983">	GET_ZERO_CLEAR_FUNDSIN_FOR_ACCOUNT(&quot;SELECT acc.FirstFundsInEDDCheck as FirstCreditCheck, &quot; + </span>
			&quot;(SELECT Count(pin.id)  FROM PaymentIn pin JOIN Account a on a.id = pin.AccountID  &quot; + 
			&quot;where a.TradeAccountNumber = ? and pin.ComplianceStatus = 1) As NumOfFundsInClear &quot; + 
			&quot;from Account acc where acc.TradeAccountNumber = ?&quot;),//AT-3346
	
<span class="fc" id="L988">	GET_EDD_COUNTRIES(&quot;SELECT cou.Code,cou.EUFirstPayInEDD from Country cou;&quot;),//AT-3346</span>
	
<span class="fc" id="L990">	GET_NUMBER_OF_FI_CLEAR_AFTER_LEDATE(&quot;SELECT Count(pin.id) as NumOfFundsInClear FROM PaymentIn pin &quot; + </span>
			&quot;JOIN Account a on a.id = pin.AccountID &quot; + 
			&quot;Join Contact c on c.id = pin.ContactID &quot; + 
			&quot;where a.TradeAccountNumber = ? and c.TradeContactID = ? &quot; + 
			&quot;and pin.ComplianceStatus = 1 AND pin.CreatedOn &gt;= ?&quot;),//AT-3349
	
<span class="fc" id="L996">	GET_NUMBER_OF_FO_CLEAR_AFTER_LEDATE(&quot;SELECT Count(po.id) as NumOfFundsOutClear FROM PaymentOut po &quot; + </span>
			&quot;JOIN Account a on a.id = po.AccountID &quot; + 
			&quot;Join Contact c on c.id = po.ContactID &quot; + 
			&quot;where a.TradeAccountNumber = ? and c.TradeContactID = ? &quot; + 
			&quot;and po.ComplianceStatus = 1 AND po.CreatedOn &gt;= ?&quot;),//AT-3349

<span class="fc" id="L1002">	UPDATE_FIRST_EDD_CHECK_IN_ACCOUNT(&quot;UPDATE Account SET FirstFundsInEDDCheck = ? where TradeAccountNumber = ?&quot;),</span>
	
	//Add for AT-3470
<span class="fc" id="L1005">	GET_CONTACT_WATCHLIST_FUNDS_IN(&quot;SELECT wl.ID, wl.Reason , wl.StopPaymentIn FROM ContactWatchList cwl &quot; + </span>
			&quot;JOIN WatchList wl on wl.ID = cwl.Reason &quot; + 
			&quot;WHERE cwl.Contact = (SELECT pi.ContactID FROM  PaymentIn pi where pi.ID = ?)&quot;),
	
	//Add for AT-3470
<span class="fc" id="L1010">	GET_CONTACT_WATCHLIST_FUNDS_OUT(&quot;SELECT wl.ID, wl.Reason , wl.StopPaymentOut FROM ContactWatchList cwl &quot; + </span>
			&quot;JOIN WatchList wl on wl.ID = cwl.Reason &quot; + 
			&quot;WHERE cwl.Contact = (SELECT po.ContactID FROM  PaymentOut po where po.ID = ?)&quot;),
		//AT-3830
<span class="fc" id="L1014">	UPDATE_FUNDS_IN_STATUS_WITHOUT_INITITAL_STATUS(&quot;UPDATE [PaymentIn] SET [ComplianceStatus]=(SELECT [ID] FROM [PaymentComplianceStatusEnum] WHERE [Status]=?), [FraugsterStatus]= ?, [SanctionStatus]= ?, &quot;</span>
			+ &quot; [BlacklistStatus] = ?, [CustomCheckStatus] = ?,[ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=? , [isOnQueue] = ?, [STPFlag] = ?,[DebitCardFraudCheckStatus]=?, [IntuitionCheckStatus]=? WHERE id=?&quot;),
	
<span class="fc" id="L1017">	UPDATE_FUNDS_OUT_STATUS_WITHOUT_INITITAL_STATUS(&quot;UPDATE [PaymentOut] SET [ComplianceStatus]=(SELECT [ID] FROM [PaymentComplianceStatusEnum] WHERE [Status]=?), [BlacklistStatus]=?, [FraugsterStatus]=?, &quot;</span>
			+ &quot; [SanctionStatus]=?,[CustomCheckStatus]=?,  [ComplianceDoneOn]=?, [UpdatedBy]=?, [UpdatedOn]=?, [isOnQueue]=?, [STPFlag]=?, [PaymentReferenceStatus]=?, [IntuitionCheckStatus]=? WHERE id=?&quot;),
	
	//Add for AT-3738
<span class="fc" id="L1021">	GET_ZERO_CLEAR_FUNDSIN_FOR_CDINC_ACCOUNT(&quot;SELECT Count(pin.id) AS NumOfFundsInClear &quot; + </span>
			&quot; FROM PaymentIn pin &quot; + 
			&quot; JOIN Account a ON a.id = pin.AccountID &quot; + 
			&quot; where a.TradeAccountNumber = ? AND pin.ComplianceStatus = 1&quot;),
	
	//Added for AT-3658
<span class="fc" id="L1027">		GET_FUNDS_OUT_ID_FOR_PAYMENT_REFERENCE(&quot;SELECT po.id AS fundsoutId, &quot;</span>
				+ &quot; poa.attributes AS POAttrib, &quot;
				+ &quot; pcs.status AS POComplianceStatus, PaymentReferenceStatus, &quot;
				+ &quot; po.accountid, po.ContactID&quot;
				+ &quot; FROM paymentout po &quot;
				+ &quot; JOIN paymentoutattribute poa ON po.id = poa.id &quot;
				+ &quot; JOIN [paymentcompliancestatusenum] pcs ON po.compliancestatus = pcs.id &quot;
				+ &quot; LEFT JOIN Event e ON e.paymentoutid = po.id &quot;
				+ &quot; WHERE po.tradepaymentid =? &quot;
				+ &quot; and po.OrganizationID = (SELECT id from Organization where code=?)&quot;),
		
		//Added for AT-3658
<span class="fc" id="L1039">		UPDATE_FUNDS_OUT_PAYMENT_REFERENCE_STATUS(&quot;UPDATE [PaymentOut] SET  [PaymentReferenceStatus]= ?, [UpdatedBy]=?, [UpdatedOn]=?  WHERE id=?&quot;),</span>
		
		//Add for AT-3987
<span class="fc" id="L1042">		GET_CONTACT_WATCHLIST(&quot;SELECT wl.Reason from ContactWatchList cwl Join WatchList wl ON wl.ID = cwl.Reason where cwl.Contact = ?&quot;),</span>
		
<span class="fc" id="L1044">		GET_TM_MQ_MESSAGE_FROM_DB(&quot;declare @Id int;&quot;</span>
				+ &quot;DECLARE @COUNT int; &quot;
				+ &quot;SET @COUNT = ?; &quot;
				+ &quot; select TOP 1 @Id=Id from comp.TransactionMonitoringMQ where DeliveryStatus in (1,3) and RetryCount&lt;@COUNT order by id asc &quot;
				+ &quot; Select ID, (SELECT o.Code from Organization o WHERE ID = OrganizationID) AS OrganizationCode , &quot;
				+ &quot; RequestType, AccountID , ContactID, PaymentInID, PaymentOutID, RequestJson, RetryCount, CreatedBy ,CreatedOn, isPresent, &quot;
				+ &quot;(SELECT a.DormantFlag FROM Account a WHERE a.ID= AccountID) as DormantFlag &quot;
				+ &quot; from comp.TransactionMonitoringMQ where id = @Id&quot;),
		
<span class="fc" id="L1053">		UPDATE_TM_MQ_STATUS_TO_DB(&quot;update TransactionMonitoringMQ set DeliveryStatus=?,RetryCount=?,DeliveredOn=? where id=?&quot;),</span>
		
<span class="fc" id="L1055">		INSERT_TM_MQ_PROFILE_ACTIVITY_LOG_STP(&quot;INSERT INTO [ProfileActivityLog] ([Timestamp], [ActivityBy], [OrganizationID], [AccountID], [ContactID], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn]) &quot;</span>
				+ &quot; VALUES( ?, ?, (SELECT id as orgID from Organization where code=?), ?, ?, ?, ?, ?, ?)&quot;),
		
<span class="fc" id="L1058">		INSERT_TM_MQ_PAYMENT_IN_ACTIVITY_LOG_STP(&quot;INSERT INTO [PaymentInActivityLog] ([PaymentInID], [ActivityBy], [Timestamp], [CreatedBy], [CreatedOn]) &quot;</span>
				+ &quot; VALUES(?, ?, ?, ?, ?)&quot;),
		
<span class="fc" id="L1061">		INSERT_TM_MQ_PAYMENT_OUT_ACTIVITY_LOG_STP(&quot;INSERT INTO [PaymentOutActivityLog] ([PaymentOutID], [ActivityBy], [Timestamp], [CreatedBy], [CreatedOn]) &quot;</span>
				+ &quot; VALUES(?, ?, ?, ?, ?)&quot;),
		
		//Added for AT-4185
<span class="fc" id="L1065">		UPDATE_ACC_TM_FLAG(&quot;UPDATE Account SET # IntuitionRiskLevel = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ? &quot;),</span>
		
		//update accountTMFlag if signup in TMMQ flow else update as it is
<span class="fc" id="L1068">		UPDATE_ACC_TM_FLAG_MQ(&quot;UPDATE Account SET AccountTMFlag = CASE AccountTMFlag WHEN 0 THEN # else AccountTMFlag END WHERE ID = ? &quot;),</span>
		
		//Added for AT-4185
<span class="fc" id="L1071">		DELETE_DELIVERED_RECORD_FROM_TMMQ(&quot;DELETE FROM TransactionMonitoringMQ WHERE DeliveryStatus = 2 And AccountID = ?&quot;),</span>
	
		//AT-4181
<span class="fc" id="L1074">		UPDATE_INTUITION_STATUS_PFX(&quot;SELECT a.ID, a.TradeAccountID, a.TradeAccountNumber, a.CRMAccountID, a.ComplianceDoneOn, a.AccountStatus, a.Version, a.AccountTMFlag, &quot;</span>
				+ &quot;JSON_VALUE(aa.[Attributes], '$.reg_date_time') AS regDateTime, a.IntuitionRiskLevel,&quot;
				+ &quot;c.ID AS ContactID, c.CRMContactID, c.TradeContactID, c.ComplianceStatus &quot;
				+ &quot;FROM Account a &quot;
				+ &quot;JOIN AccountAttribute aa ON a.ID = aa.ID &quot;
				+ &quot;JOIN contact c ON a.id = c.accountid &quot;
				+ &quot;WHERE c.ID = ?&quot;),
		
<span class="fc" id="L1082">		UPDATE_INTUITION_STATUS_CFX(&quot;SELECT a.ID, a.TradeAccountID, a.TradeAccountNumber, a.CRMAccountID, a.ComplianceDoneOn, a.AccountStatus, a.Version, a.AccountTMFlag, &quot;</span>
				+ &quot;JSON_VALUE(aa.[Attributes], '$.reg_date_time') AS regDateTime, a.IntuitionRiskLevel,&quot;
				+ &quot;c.ID AS ContactID, c.CRMContactID, c.TradeContactID, c.ComplianceStatus &quot;
				+ &quot;FROM Account a &quot;
				+ &quot;JOIN AccountAttribute aa ON a.ID = aa.ID &quot;
				+ &quot;JOIN contact c ON a.id = c.accountid &quot;
				+ &quot;WHERE c.AccountID = ?&quot;),
		
<span class="fc" id="L1090">		UPDATE_ACCOUNT_INTUITION_RISK_LEVEL(&quot;UPDATE Account SET IntuitionRiskLevel = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ?&quot;),</span>
		
		//Add for AT-4239
<span class="fc" id="L1093">		GET_CONTACT_STATUS_UPDATE_REASON(&quot;SELECT sur.Reason FROM ProfileStatusReason psr JOIN StatusUpdateReason sur on sur.ID = psr.StatusUpdateReasonID WHERE psr.ContactID = ?&quot;),</span>
		
<span class="fc" id="L1095">		GET_ACCOUNT_CONTACT_DETAILS_FOR_INTUITION(&quot;SELECT a.ID as accID, c.ID as conID, a.LegalEntity, a.OrganizationID, &quot;</span>
				+ &quot;acse.Status as accComplianceStatus, ccse.Status as conComplianceStatus, &quot;
				+ &quot;aa.[Attributes] as accAtt, ca.[Attributes] as conAtt, &quot;
				+ &quot;aa.Version as accVersion, a.CreatedOn, &quot;
				+ &quot;a.BlacklistStatus as accBlacklistStatus, &quot;
				+ &quot;a.SanctionStatus as accSanctionStatus, &quot;
				+ &quot;a.FraugsterStatus as accFraugsterStatus, &quot;
				+ &quot;a.AccountTMFlag, &quot;
				+ &quot;a.IntuitionRiskLevel, &quot;
				+ &quot;(SELECT o.Code from Organization o WHERE ID = a.OrganizationID) AS OrganizationCode, &quot;
				+ &quot;c.EIDStatus as conEIDStatus, &quot;
				+ &quot;c.FraugsterStatus as conFraugsterStatus, &quot;
				+ &quot;c.SanctionStatus as conSanctionStatus, &quot;
				+ &quot;c.BlacklistStatus as conBlacklistStatus, &quot;
				+ &quot;c.CustomCheckStatus as conCustomCheckStatus, &quot;
				+ &quot;c.Version as version, &quot;
				+ &quot;a.LegacyTradeAccountNumber &quot; // Added for AT-5393
				+ &quot;FROM Account a &quot;
				+ &quot;JOIN AccountAttribute aa on a.ID = aa.ID &quot;
				+ &quot;JOIN Contact c on c.AccountID = a.ID &quot;
				+ &quot;JOIN ContactAttribute ca on ca.ID = c.ID &quot;
				+ &quot;JOIN AccountComplianceStatusEnum acse on a.ComplianceStatus = acse.ID  &quot;
				+ &quot;JOIN ContactComplianceStatusEnum ccse on c.ComplianceStatus = ccse.ID &quot;
				+ &quot;WHERE a.TradeAccountNumber = ? &quot;),
		
<span class="fc" id="L1120">		GET_FRAUGSTER_CONTACT_STATUS_FOR_INTUITION(&quot;SELECT TOP 1 esl.Status, JSON_VALUE([Summary],'$.fraugsterApproved') as fraugsterApproved, esl.UpdatedOn &quot;</span>
				+ &quot;from  EventServiceLog esl &quot;
				+ &quot;JOIN Event e on esl.EventID = e.ID and e.PaymentInID IS NULL AND e.PaymentOutID IS NULL &quot;
				+ &quot;WHERE esl.EntityType = 3 and esl.ServiceType = 6 and esl.EntityID = ? &quot;
				+ &quot;ORDER BY esl.ID DESC&quot;),
		
<span class="fc" id="L1126">		GET_COMPLIANCE_LOG_FOR_INTUITION(&quot;SELECT TOP 1 pal.Comments FROM ProfileActivityLog pal &quot;</span>
				+ &quot;JOIN ProfileActivityLogDetail pald on pal.ID = pald.ActivityID and pald.Log LIKE '%Compliance Log Added%' &quot;
				+ &quot;WHERE pal.AccountID = ? ORDER BY pal.CreatedOn DESC &quot;),
		
<span class="fc" id="L1130">		GET_ONFIDO_CONTACT_STATUS_FOR_INTUITION(&quot;SELECT TOP 1 esl.EntityID, JSON_VALUE(esl.Summary ,'$.status') AS ESL_OnfidoStatus from EventServiceLog esl &quot;</span>
				+ &quot;JOIN Event e on esl.EventID = e.ID and e.PaymentInID IS NULL AND e.PaymentOutID IS NULL &quot;
				+ &quot;WHERE esl.ServiceType = 13 and esl.EntityID = ? ORDER BY esl.ID DESC&quot;),
		
		//AT-4451
<span class="fc" id="L1135">		GET_FUNDS_IN_FOR_DETAILS_INTUITION(&quot;SELECT pi.ID as payInId,&quot;</span>
				+ &quot; pi.AccountID as accountid,&quot;
				+ &quot; pi.ContactID as ContactID,&quot;
				+ &quot; pia.[Attributes] as PIAttrib,&quot;
				+ &quot; pi.FraugsterStatus,&quot;
				+ &quot; pi.BlacklistStatus ,&quot;
				+ &quot; pi.SanctionStatus ,&quot;
				+ &quot; pi.CustomCheckStatus ,&quot;
				+ &quot; pi.ComplianceStatus as PIComplianceStatus,&quot;
				+ &quot; pi.InitialStatus ,&quot;
				+ &quot; a.TradeAccountNumber ,&quot;
				+ &quot; a.AccountTMFlag ,&quot;
				+ &quot; (SELECT o.Code from Organization o WHERE ID = a.OrganizationID) AS OrganizationCode ,&quot; //AT-4749
				+ &quot; c.TradeContactID,&quot;
				+ &quot; a.Version as AccountVersion,&quot;
				+ &quot; JSON_VALUE(aa.[Attributes],'$.company.etailer') as Etailer&quot; //AT-5310
				+ &quot; FROM PaymentIn pi &quot;
				+ &quot; JOIN PaymentInAttribute pia ON&quot;
				+ &quot; pi.id = pia.id&quot;
				+ &quot; JOIN Account a on&quot;
				+ &quot; a.ID = pi.AccountID&quot;
				+ &quot; JOIN AccountAttribute aa ON a.ID = aa.ID&quot;
				+ &quot; JOIN Contact c on&quot;
				+ &quot; c.ID = pi.ContactID&quot;
				+ &quot; WHERE pi.TradePaymentID = ?&quot;),
		
		//AT-4451
<span class="fc" id="L1162">		GET_FUNDS_IN_COUNTRY_CHECK_STATUS_FOR_INTUITION(&quot;SELECT&quot;</span>
				+ &quot; TOP 1 esl.Status,&quot;
				+ &quot; JSON_VALUE([Summary],&quot;
				+ &quot; '$.status') as CountryCheckStatus&quot;
				+ &quot; from&quot;
				+ &quot; EventServiceLog esl&quot;
				+ &quot; JOIN Event e on&quot;
				+ &quot; esl.EventID = e.ID&quot;
				+ &quot; and e.PaymentInID IS NOT NULL&quot;
				+ &quot; WHERE&quot;
				+ &quot; esl.EntityType = 3&quot;
				+ &quot; and esl.ServiceType = 8&quot;
				+ &quot; and esl.EntityID = ?&quot;
				+ &quot; ORDER BY&quot;
				+ &quot; esl.ID DESC&quot;),
		
		//AT-4451
<span class="fc" id="L1179">		GET_STATUS_UPDATE_REASON_FOR_PAYMENT_IN_INTUITION(&quot;SELECT&quot;</span>
				+ &quot; sur.Reason&quot;
				+ &quot; FROM&quot;
				+ &quot; PaymentInStatusReason pisr&quot;
				+ &quot; JOIN StatusUpdateReason sur on&quot;
				+ &quot; sur.ID = pisr.StatusUpdateReasonID&quot;
				+ &quot; WHERE&quot;
				+ &quot; pisr.PaymentInID = ?&quot;),
		
		//AT-4451
<span class="fc" id="L1189">		GET_FUNDS_OUT_DETAILS_FOR_INTUITION(&quot;SELECT&quot;</span>
				+ &quot; po.ID as payOutId,&quot;
				+ &quot; po.AccountID as accountid,&quot;
				+ &quot; po.ContactID as ContactID,&quot;
				+ &quot; poa.[Attributes] as POAttrib,&quot;
				+ &quot; po.FraugsterStatus,&quot;
				+ &quot; po.BlacklistStatus ,&quot;
				+ &quot; po.CustomCheckStatus ,&quot;
				+ &quot; po.PaymentReferenceStatus ,&quot;
				+ &quot; po.ComplianceStatus ,&quot;
				+ &quot; po.InitialStatus ,&quot;
				+ &quot; a.TradeAccountNumber ,&quot;
				+ &quot; a.AccountTMFlag ,&quot;
				+&quot;  (SELECT o.Code from Organization o WHERE ID = a.OrganizationID) AS OrganizationCode,&quot; //AT-4749
				+ &quot; c.TradeContactID,&quot;
				+ &quot; a.Version as AccountVersion,&quot;
				+ &quot; JSON_VALUE(aa.[Attributes],'$.company.etailer') as Etailer,&quot; //AT-5310
				+ &quot; JSON_VALUE(aa.[Attributes],'$.affiliate_name') as AffiliateName &quot; //AT-5454
				+ &quot; FROM&quot;
				+ &quot; PaymentOut po&quot;
				+ &quot; JOIN PaymentOutAttribute poa ON&quot;
				+ &quot; po.id = poa.id&quot;
				+ &quot; JOIN Account a on&quot;
				+ &quot; a.ID = po.AccountID&quot;
				+ &quot; JOIN AccountAttribute aa ON a.ID = aa.ID&quot;
				+ &quot; JOIN Contact c on&quot;
				+ &quot; c.ID = po.ContactID&quot;
				+ &quot; WHERE&quot;
				+ &quot; po.TradePaymentID = ?&quot;),
		
		//AT-4451
<span class="fc" id="L1220">		GET_FUNDS_OUT_COUNTRY_CHECK_STATUS_FOR_INTUITION(&quot;SELECT&quot;</span>
				+ &quot; TOP 1 esl.Status,&quot;
				+ &quot; JSON_VALUE([Summary],&quot;
				+ &quot; '$.status') as CountryCheckStatus&quot;
				+ &quot; from&quot;
				+ &quot; EventServiceLog esl&quot;
				+ &quot; JOIN Event e on&quot;
				+ &quot; esl.EventID = e.ID&quot;
				+ &quot; AND e.PaymentOutID IS NOT NULL&quot;
				+ &quot; WHERE&quot;
				+ &quot; esl.EntityType = 2&quot;
				+ &quot; and esl.ServiceType = 8&quot;
				+ &quot; and esl.EntityID = ?&quot;
				+ &quot; ORDER BY&quot;
				+ &quot; esl.ID DESC&quot;),
		
		//AT-4451
<span class="fc" id="L1237">		GET_FUNDS_OUT_CONTACT_SANCTION_STATUS(&quot;SELECT&quot;</span>
				+ &quot; TOP 1 esl.Status,&quot;
				+ &quot; JSON_VALUE([Summary],&quot;
				+ &quot; '$.status') as ContactSanctionStatus&quot;
				+ &quot; from&quot;
				+ &quot; EventServiceLog esl&quot;
				+ &quot; JOIN Event e on&quot;
				+ &quot; esl.EventID = e.ID&quot;
				+ &quot; AND e.PaymentOutID IS NOT NULL&quot;
				+ &quot; WHERE&quot;
				+ &quot; esl.EntityType = 3&quot;
				+ &quot; and esl.ServiceType = 7&quot;
				+ &quot; and esl.EntityID = ? and e.PaymentOutID = ?&quot;
				+ &quot; ORDER BY&quot;
				+ &quot; esl.ID DESC&quot;),
		
		//AT-4451
<span class="fc" id="L1254">		GET_FUNDS_OUT_BENEFICIARY_SANCTION_STATUS(&quot;SELECT&quot;</span>
				+ &quot; TOP 1 esl.Status,&quot;
				+ &quot; JSON_VALUE([Summary],&quot;
				+ &quot; '$.status') as BeneficierySanctionStatus&quot;
				+ &quot; from&quot;
				+ &quot; EventServiceLog esl&quot;
				+ &quot; JOIN Event e on&quot;
				+ &quot; esl.EventID = e.ID&quot;
				+ &quot; AND e.PaymentOutID IS NOT NULL&quot;
				+ &quot; WHERE&quot;
				+ &quot; esl.EntityType = 2&quot;
				+ &quot; and esl.ServiceType = 7&quot;
				+ &quot; and esl.EntityID = ? and e.PaymentOutID = ?&quot;
				+ &quot; ORDER BY&quot;
				+ &quot; esl.ID DESC&quot;),
		
		//AT-4451
<span class="fc" id="L1271">		GET_FUNDS_OUT_BANK_SANCTION_STATUS(&quot;SELECT&quot;</span>
				+ &quot; TOP 1 esl.Status,&quot;
				+ &quot; JSON_VALUE([Summary],&quot;
				+ &quot; '$.status') as BankSanctionStatus&quot;
				+ &quot; from&quot;
				+ &quot; EventServiceLog esl&quot;
				+ &quot; JOIN Event e on&quot;
				+ &quot; esl.EventID = e.ID&quot;
				+ &quot; AND e.PaymentOutID IS NOT NULL&quot;
				+ &quot; WHERE&quot;
				+ &quot; esl.EntityType = 4&quot;
				+ &quot; and esl.ServiceType = 7&quot;
				+ &quot; and esl.EntityID = ? and e.PaymentOutID = ?&quot;
				+ &quot; ORDER BY&quot;
				+ &quot; esl.ID DESC&quot;),
		
		//AT-4451
<span class="fc" id="L1288">		GET_STATUS_UPDATE_REASON_FOR_PAYMENT_OUT_INTUITION(&quot;SELECT&quot;</span>
				+ &quot; sur.Reason&quot;
				+ &quot; FROM&quot;
				+ &quot; PaymentOutStatusReason posr &quot;
				+ &quot; JOIN StatusUpdateReason sur on&quot;
				+ &quot; sur.ID = posr.StatusUpdateReasonID&quot;
				+ &quot; WHERE&quot;
				+ &quot; posr.PaymentOutID = ?&quot;),
		
		//AT-4475
<span class="fc" id="L1298">		GET_PAYMENT_REFERENCE_MATCHED_KEYWORD_FOR_INTUITION(&quot;SELECT&quot;</span>
				+ &quot; TOP 1 &quot;
				+ &quot; JSON_VALUE([Summary],&quot;
				+ &quot; '$.sanctionText') as SanctionText&quot;
				+ &quot; from&quot;
				+ &quot; EventServiceLog esl&quot;
				+ &quot; JOIN Event e on&quot;
				+ &quot; esl.EventID = e.ID&quot;
				+ &quot; AND e.PaymentOutID IS NOT NULL&quot;
				+ &quot; WHERE&quot;
				+ &quot; esl.EntityType = 2&quot;
				+ &quot; and esl.ServiceType = 15&quot;
				+ &quot; and esl.EntityID = ?&quot;
				+ &quot; ORDER BY&quot;
				+ &quot; esl.ID DESC&quot;),
		
		//AT-4558
<span class="fc" id="L1315">		UPDATE_PAYMENT_IN_INTUITION_CLIENT_RISK_LEVEL(&quot;UPDATE PaymentIn SET IntuitionClientRiskLevel = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ?&quot;),</span>
		
		//AT-4558
<span class="fc" id="L1318">		UPDATE_PAYMENT_OUT_INTUITION_CLIENT_RISK_LEVEL(&quot;UPDATE PaymentOut SET IntuitionClientRiskLevel = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ?&quot;),</span>
		
		//AT-4666
<span class="fc" id="L1321">		GET_COUNTRY_SHORT_CODE(&quot;select code,shortcode from country&quot;),</span>
		
<span class="fc" id="L1323">		UPDATE_PAYMENT_IN_INTUITION_CHECK_STATUS(&quot;UPDATE PaymentIn SET IntuitionCheckStatus = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ?&quot;),</span>
		
<span class="fc" id="L1325">		UPDATE_PAYMENT_OUT_INTUITION_CHECK_STATUS(&quot;UPDATE PaymentOut SET IntuitionCheckStatus = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ?&quot;),</span>
		
<span class="fc" id="L1327">		GET_FUNDS_IN_ACCOUNT_DETAILS_FOR_DELETE_OPI(&quot;SELECT  ac.id AS accountid, &quot;</span>
				+ &quot; ac.type AS custType, &quot;
				+ &quot; ac.OrganizationID, &quot;
				+ &quot; aa.attributes AS acattrib,&quot;
				+ &quot; pi2.ID AS payInId &quot;
				+ &quot; FROM &quot;
				+ &quot; [account] ac &quot;
				+ &quot; JOIN [accountattribute] aa &quot;
				+ &quot; ON ac.id = aa.id &quot;
				+ &quot; JOIN PaymentIn pi2 ON pi2.AccountID = ac.ID &quot;
				+ &quot; WHERE  tradeaccountnumber = ? and pi2.TradePaymentID = ?&quot;
				+ &quot; and ac.OrganizationID= &quot;
				+ &quot; (SELECT id from Organization where code=?)&quot;),
		
<span class="fc" id="L1341">		UPDATE_PAYMENT_IN_STATUS(&quot;UPDATE [PaymentIn] SET [UpdatedBy]=?, [UpdatedOn]=? , [ComplianceStatus] = ? WHERE id = ?&quot;),</span>
		
<span class="fc" id="L1343">		GET_PAYMENT_STATUS(&quot;Select ComplianceStatus from # WHERE ID = ? &quot;),</span>
		
<span class="fc" id="L1345">		GET_ALL_TM_MQ_MESSAGE_FROM_DB(&quot; Select TOP 60 ID, (SELECT o.Code from Organization o WHERE ID = OrganizationID) AS OrganizationCode , \r\n&quot;</span>
				+ &quot; RequestType, AccountID , ContactID, PaymentInID, PaymentOutID, RequestJson, RetryCount, CreatedBy ,CreatedOn, isPresent \r\n&quot;
				+ &quot; from comp.TransactionMonitoringMQ where DeliveryStatus in (1,3) and RetryCount&lt;? &quot;),
		
		//AT-4773
<span class="fc" id="L1350">		GET_ACCOUNT_ID_USING_TRADE_ACCOUNT_NUMBER(&quot;SELECT a.ID FROM Comp.Account a WHERE a.TradeAccountNumber = ?&quot;),</span>
		
<span class="fc" id="L1352">		SAVE_INTO_TRANSACTION_MONITORING_MQ(&quot;INSERT INTO [TransactionMonitoringMQ]( [OrganizationID], [RequestType], [AccountID], [ContactID], [PaymentInID], [PaymentOutID], [RequestJson], [DeliveryStatus], [DeliverOn], [CreatedBy], [CreatedOn], [isPresent]) &quot;</span>
	    		+ &quot;    VALUES((SELECT ID FROM Organization WHERE code=?),?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;),
		
<span class="fc" id="L1355">		GET_ACCOUNTID_FROM_TRADEACCOUNTNUMBER(&quot;SELECT a.ID, o.Code, c.ID AS contactId, a.TradeAccountID, a.AccountTMFlag FROM Account a JOIN Organization o ON a.OrganizationID = o.ID &quot;</span>
				+ &quot;JOIN Contact c ON a.ID = c.AccountID WHERE a.TradeAccountNumber=? AND c.TradeContactID = ?&quot;),
	    
<span class="fc" id="L1358">		INSERT_INTO_CARD_ATTRIBUTE(&quot;INSERT INTO CardAttribute ([CardID], [AccountID], [Attributes], [CreatedBy], [CreatedOn], [UpdatedBy], [UpdatedOn], [CardStatus], [ContactID]) VALUES(?, ?, ?, ?, ?, ?, ?,?,?)&quot;),</span>
		
<span class="fc" id="L1360">		UPDATE_INTO_CARD_ATTRIBUTE(&quot;UPDATE CardAttribute SET [Attributes]=?, [UpdatedBy]=?, [UpdatedOn]=?, [CardStatus]=? WHERE CardID=?&quot;),</span>
	
<span class="fc" id="L1362">		GET_CARD_DETAILS(&quot;SELECT * FROM CardAttribute WHERE CardID=?&quot;),</span>
	
<span class="fc" id="L1364">		GET_CARD_DETAILS_BY_ACCOUNT_ID(&quot;SELECT * FROM CardAttribute WHERE AccountID=?&quot;),</span>
		
<span class="fc" id="L1366">		GET_PAYMENT_STATUS_BY_PAYMENT_TRADE_ID(&quot;SELECT p.ComplianceStatus FROM Comp.# p WHERE p.TradePaymentID = ?&quot;),</span>
	
<span class="fc" id="L1368">		UPDATE_INTO_ACCOUNT_TMFLAG(&quot;UPDATE Account SET AccountTMFlag = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ? &quot;), //AT-5127</span>
	
<span class="fc" id="L1370">		AUDIT_FAILED_KAFKA_INSERT_QUERY(&quot;INSERT INTO [KafkaFailedTxRequestAudit]([MessageId], [MessageContent], [Topic], [Status], [CreatedOn], [UpdatedOn], [ErrorMessage]) VALUES(?, ?, ?, ?, ?, ?, ?)&quot;),</span>
		
<span class="fc" id="L1372">		GET_FAILED_KAFKA_TX_QUERY(&quot;SELECT AuditId, MessageId, MessageContent, Topic, Status, CreatedOn, UpdatedOn, ErrorMessage from [KafkaFailedTxRequestAudit]  where status = ? &quot;),		</span>
	    
<span class="fc" id="L1374">		GET_PAYMENT_IN_TX_DETAILS_QUERY(&quot;SELECT pi.ID as id, &quot;</span>
				+ &quot;org.id as organizationID,  &quot;
				+ &quot;org.Code as organizationCode, &quot;
				+ &quot;org.Name as organizationName, &quot;
				+ &quot;acnt.ID as accountID , &quot;
				+ &quot;acnt.Name as accountName, &quot;
				+ &quot;acnt.TradeAccountID as tradeAccountId, &quot;
				+ &quot;acnt.CRMAccountID as cRMAccountID, &quot;
				+ &quot;acnt.TradeAccountNumber as tradeAccountNumber, &quot;
				+ &quot;cnt.Id as contactID , &quot;
				+ &quot;cnt.Name as contactName, &quot;
				+ &quot;pi.TradeContractNumber as tradeContractNumber , &quot;
				+ &quot;pi.TradePaymentID as tradePaymentID , &quot;
				+ &quot;pi.CreatedBy as createdBy, &quot;
				+ &quot;cusr.SSOUserID as createdBySSOUserId , &quot;
				+ &quot;pi.CreatedOn as createdOn ,&quot;
				+ &quot;pi.UpdatedBy as updatedBy , &quot;
				+ &quot;uusr.SSOUserID as updatedBySSOUserId , &quot;
				+ &quot;pi.UpdatedOn as updatedOn, &quot;
				+ &quot;pi.TransactionDate as transactionDate , &quot;
				+ &quot;acntCmpStsEnum.Description as description ,  &quot;
				+ &quot;acntCmpStsEnum.ID as complianceStatusId ,  &quot;
				+ &quot;acntCmpStsEnum.Status as complianceStatus , &quot;
				+ &quot;acnt.ComplianceDoneOn as complianceDoneOn, &quot;
				+ &quot;fraudSrvSts.ID as fraugsterStatusId, &quot;
				+ &quot;fraudSrvSts.Status as fraugsterStatus, &quot;
				+ &quot;santionSrvSts.ID as sanctionStatusId, &quot;
				+ &quot;santionSrvSts.Status as sanctionStatus, &quot;
				+ &quot;blckListSrvSts.ID as blacklistStatusId, &quot;
				+ &quot;blckListSrvSts.Status as blacklistStatus, &quot;
				+ &quot;customChkSrvSts.ID as customCheckStatusId, &quot;
				+ &quot;customChkSrvSts.Status as customCheckStatus, &quot;
				+ &quot;pi.IsOnQueue as isOnQueue, &quot;
				+ &quot;pi.stpFlag as sTPFlag, &quot;
				+ &quot;pi.LegacyTradePaymentId as legacyTradePaymentId , &quot;
				+ &quot;pi.LegacyTradeContractNumber as legacyTradeContractNumber , &quot;
				+ &quot;le.ID as legalEntityID, &quot;
				+ &quot;le.code as legalEntityCode,  &quot;
				+ &quot;le.name as legalEntityName, &quot;
				+ &quot;pi.InitialStatus as initialStatus , &quot;
				+ &quot;debitFraudSrvSts.ID as debitCardFraudCheckStatusId, &quot;
				+ &quot;debitFraudSrvSts.Status as debitCardFraudCheckStatus, &quot;
				+ &quot;pi.intuitionClientRiskLevel as intuitionClientRiskLevel,  &quot;
				+ &quot;intuitionSrvSts.Id as intuitionCheckStatusId, &quot;
				+ &quot;intuitionSrvSts.Status as intuitionCheckStatus, &quot;
				+ &quot;pi.ComplianceDoneOn as paymentClearedOn , &quot;
				+ &quot;pial.ID as activityID , &quot;
				+ &quot;pial.ActivityBy as activityBy , &quot;
				+ &quot;actbyusr.SSOUserID as activityByUserId , &quot;
				+ &quot;pial.Timestamp activityTimestamp , &quot;
				+ &quot;pial.Comments as activityComments, &quot;
				+ &quot;pial.CreatedBy as activityCreatedBy ,  &quot;
				+ &quot;actcrbyusr.SSOUserID as activityCreatedByUserId , &quot;
				+ &quot;pial.CreatedOn activityCreatedOn, &quot;
				+ &quot;piald.ActivityType activityType,  &quot;
				+ &quot;ate.Module activityTypeModule , &quot;
				+ &quot;ate.Type activityTypeValue, &quot;
				+ &quot;piald.CreatedOn as activityDetailsCreatedOn, &quot;
				+ &quot;piald.Log as activityLog, &quot;
				+ &quot;pi.Deleted as deleted  &quot;
				+ &quot;FROM  [PaymentIn] pi  &quot;
				+ &quot;LEFT OUTER JOIN   [PaymentInActivityLog] pial &quot;
				+ &quot;on pial.PaymentInID =pi.ID &quot;
				+ &quot;  AND pial.ID = ( &quot;
				+ &quot; SELECT  MAX(ID) &quot;
				+ &quot; FROM [PaymentInActivityLog] z &quot;
				+ &quot; WHERE z.PaymentInID = pial.PaymentInID &quot;
				+ &quot; ) &quot;
				+ &quot;LEFT OUTER JOIN   [PaymentInActivityLogDetail] piald &quot;
				+ &quot;on piald.ActivityID=pial.ID &quot;
				+ &quot;LEFT OUTER JOIN   [Organization] org  &quot;
				+ &quot;on org.id = pi.OrganizationID &quot;
				+ &quot;LEFT OUTER JOIN   [Account] acnt &quot;
				+ &quot;on acnt.ID = pi.AccountId &quot;
				+ &quot;LEFT OUTER JOIN   [Contact] cnt &quot;
				+ &quot; on cnt.ID=pi.ContactId &quot;
				+ &quot;LEFT OUTER JOIN   [User] cusr &quot;
				+ &quot;on cusr.ID=pi.CreatedBy &quot;
				+ &quot;LEFT OUTER JOIN   [User] uusr &quot;
				+ &quot;on uusr.ID=pi.UpdatedBy &quot;
				+ &quot;LEFT OUTER JOIN   [User] actbyusr &quot;
				+ &quot;on actbyusr.ID=pial.ActivityBy  &quot;
				+ &quot;LEFT OUTER JOIN   [User] actcrbyusr &quot;
				+ &quot;on actcrbyusr.ID=pial.CreatedBy &quot;
				+ &quot;LEFT OUTER JOIN   [AccountComplianceStatusEnum] acntCmpStsEnum &quot;
				+ &quot;on acntCmpStsEnum.ID= acnt.ComplianceStatus   &quot;
				+ &quot;LEFT OUTER JOIN   [ServiceStatusEnum] fraudSrvSts &quot;
				+ &quot;on fraudSrvSts.ID = pi.FraugsterStatus  &quot;
				+ &quot;LEFT OUTER JOIN   [ServiceStatusEnum] santionSrvSts &quot;
				+ &quot;on santionSrvSts.ID = pi.SanctionStatus  &quot;
				+ &quot;LEFT OUTER JOIN   [ServiceStatusEnum] blckListSrvSts &quot;
				+ &quot;on blckListSrvSts.ID = pi.BlacklistStatus &quot;
				+ &quot;LEFT OUTER JOIN   [ServiceStatusEnum] customChkSrvSts &quot;
				+ &quot;on customChkSrvSts.ID = pi.CustomCheckStatus  &quot;
				+ &quot;LEFT OUTER JOIN   [ServiceStatusEnum] debitFraudSrvSts &quot;
				+ &quot;on debitFraudSrvSts.ID = pi.DebitCardFraudCheckStatus &quot;
				+ &quot;LEFT OUTER JOIN   [ServiceStatusEnum] intuitionSrvSts &quot;
				+ &quot;on intuitionSrvSts.ID = pi.IntuitionCheckStatus &quot;
				+ &quot;LEFT OUTER JOIN   [LegalEntity] le &quot;
				+ &quot;on le.id = pi.LegalEntityID &quot;
				+ &quot;LEFT OUTER JOIN   [Country] country &quot;
				+ &quot;on country.ID= cnt.country &quot;
				+ &quot;LEFT OUTER JOIN   [ActivityTypeEnum] ate  &quot;
				+ &quot;on ate.id=piald.activityType &quot;
				+ &quot;where pi.TradePaymentID = ?  &quot;),
		
<span class="fc" id="L1480">		GET_PAYMENT_OUT_TX_DETAILS_QUERY(&quot;SELECT po.ID as id,&quot;</span>
				+ &quot; org.id as organizationID, &quot;
				+ &quot; org.Code as organizationCode, &quot;
				+ &quot; org.Name as organizationName, &quot;
				+ &quot; acnt.ID as accountID , &quot;
				+ &quot; acnt.Name as accountName, &quot;
				+ &quot; acnt.TradeAccountID as tradeAccountId, &quot;
				+ &quot; acnt.CRMAccountID as cRMAccountID, &quot;
				+ &quot; acnt.TradeAccountNumber as tradeAccountNumber, &quot;
				+ &quot; cnt.Id as contactID , &quot;
				+ &quot; cnt.Name as contactName, &quot;
				+ &quot; po.ContractNumber as tradeContractNumber ,  &quot;
				+ &quot; po.TradePaymentID as tradePaymentID , &quot;
				+ &quot; po.CreatedBy as createdBy, &quot;
				+ &quot; cusr.SSOUserID as createdBySSOUserId , &quot;
				+ &quot; po.CreatedOn as createdOn ,&quot;
				+ &quot; po.UpdatedBy as updatedBy , &quot;
				+ &quot; uusr.SSOUserID as updatedBySSOUserId , &quot;
				+ &quot; po.UpdatedOn as updatedOn, &quot;				
				+ &quot; po.TransactionDate as transactionDate , &quot;
				+ &quot; acntCmpStsEnum.Description as description ,  &quot;
				+ &quot; acntCmpStsEnum.ID as complianceStatusId ,  &quot;
				+ &quot; acntCmpStsEnum.Status as complianceStatus , &quot;
				+ &quot; acnt.ComplianceDoneOn as complianceDoneOn, &quot;
				+ &quot; fraudSrvSts.ID as fraugsterStatusId, &quot;
				+ &quot; fraudSrvSts.Status as fraugsterStatus, &quot;
				+ &quot; santionSrvSts.ID as sanctionStatusId, &quot;
				+ &quot; santionSrvSts.Status as sanctionStatus, &quot;
				+ &quot; blckListSrvSts.ID as blacklistStatusId, &quot;
				+ &quot; blckListSrvSts.Status as blacklistStatus, &quot;
				+ &quot; customChkSrvSts.ID as customCheckStatusId, &quot;
				+ &quot; customChkSrvSts.Status as customCheckStatus, &quot;
				+ &quot; po.IsOnQueue as isOnQueue, &quot;
				+ &quot; po.STPFlag as sTPFlag, &quot;
				+ &quot; po.LegacyTradePaymentId as legacyTradePaymentId , &quot;
				+ &quot; po.LegacyTradeContractNumber as legacyTradeContractNumber , &quot;
				+ &quot; le.ID as legalEntityID, &quot;
				+ &quot; le.code as legalEntityCode,  &quot;
				+ &quot; le.name as legalEntityName, &quot;
				+ &quot; po.InitialStatus as initialStatus , &quot;
				+ &quot; po.intuitionClientRiskLevel as intuitionClientRiskLevel,  &quot;
				+ &quot; intuitionSrvSts.Id as intuitionCheckStatusId, &quot;
				+ &quot; intuitionSrvSts.Status as intuitionCheckStatus, &quot;
				+ &quot; paymentSrvSts.Id as paymentReferenceStatusId, &quot;
				+ &quot; paymentSrvSts.Status as paymentReferenceStatus, &quot;
				+ &quot; po.ComplianceDoneOn as paymentClearedOn , &quot;
				+ &quot; poal.ID as activityID ,  &quot;
				+ &quot; poal.ActivityBy as activityBy , &quot;
				+ &quot; actbyusr.SSOUserID as activityByUserId , &quot;
				+ &quot; poal.Timestamp activityTimestamp , &quot;
				+ &quot; poal.Comments as activityComments, &quot;
				+ &quot; poal.CreatedBy as activityCreatedBy ,  &quot;
				+ &quot; actcrbyusr.SSOUserID as activityCreatedByUserId , &quot;
				+ &quot; poal.CreatedOn activityCreatedOn, &quot;
				+ &quot; poald.ActivityType activityType,  &quot;
				+ &quot; ate.Module activityTypeModule , &quot;
				+ &quot; ate.Type activityTypeValue, &quot;
				+ &quot; poald.CreatedOn as activityDetailsCreatedOn, &quot;
				+ &quot; poald.Log as activityLog, &quot;
				+ &quot; po.Deleted as deleted  &quot;
				+ &quot; FROM  [PaymentOut] po  &quot;
				+ &quot; LEFT OUTER JOIN   [PaymentOutActivityLog] poal &quot;
				+ &quot; on poal.PaymentOutID =po.ID &quot;
				+ &quot;  AND poal.ID = ( &quot;
				+ &quot;		 SELECT  MAX(ID) &quot;
				+ &quot;		 FROM [PaymentOutActivityLog] z &quot;
				+ &quot;		 WHERE z.PaymentOutID = poal.PaymentOutID &quot;
				+ &quot;		  ) &quot;
				+ &quot;LEFT OUTER JOIN   [PaymentOutActivityLogDetail] poald &quot;
				+ &quot;on poald.ActivityID=poal.ID &quot;
				+ &quot; LEFT OUTER JOIN  [Organization] org  &quot;
				+ &quot; on org.id = po.OrganizationID &quot;
				+ &quot; LEFT OUTER JOIN   [Account] acnt &quot;
				+ &quot; on acnt.ID = po.AccountId &quot;
				+ &quot; LEFT OUTER JOIN   [Contact] cnt &quot;
				+ &quot; on cnt.ID=po.ContactId &quot;
				+ &quot; LEFT OUTER JOIN   [User] cusr &quot;
				+ &quot; on cusr.ID=po.createdBy &quot;
				+ &quot;LEFT OUTER JOIN   [User] uusr &quot;
				+ &quot;on uusr.ID=po.UpdatedBy &quot;
				+ &quot;LEFT OUTER JOIN   [User] actbyusr &quot;
				+ &quot;on actbyusr.ID=poal.ActivityBy  &quot;
				+ &quot;LEFT OUTER JOIN   [User] actcrbyusr &quot;
				+ &quot;on actcrbyusr.ID=poal.CreatedBy &quot;
				+ &quot; LEFT OUTER JOIN   [AccountComplianceStatusEnum] acntCmpStsEnum &quot;
				+ &quot; on acntCmpStsEnum.ID= acnt.ComplianceStatus  &quot;
				+ &quot; LEFT OUTER JOIN   [ServiceStatusEnum] fraudSrvSts &quot;
				+ &quot; on fraudSrvSts.ID = po.FraugsterStatus  &quot;
				+ &quot; LEFT OUTER JOIN   [ServiceStatusEnum] santionSrvSts &quot;
				+ &quot; on santionSrvSts.ID = po.SanctionStatus  &quot;
				+ &quot; LEFT OUTER JOIN   [ServiceStatusEnum] blckListSrvSts &quot;
				+ &quot; on blckListSrvSts.ID = po.BlacklistStatus &quot;
				+ &quot; LEFT OUTER JOIN   [ServiceStatusEnum] customChkSrvSts &quot;
				+ &quot; on customChkSrvSts.ID = po.CustomCheckStatus  &quot;
				+ &quot; LEFT OUTER JOIN   [ServiceStatusEnum] intuitionSrvSts &quot;
				+ &quot; on intuitionSrvSts.ID = po.IntuitionCheckStatus &quot;
				+ &quot; LEFT OUTER JOIN   [ServiceStatusEnum] paymentSrvSts &quot;
				+ &quot; on paymentSrvSts.ID = po.PaymentReferenceStatus  &quot;
				+ &quot; LEFT OUTER JOIN   [LegalEntity] le &quot;
				+ &quot; on le.id = po.LegalEntityID &quot;
				+ &quot; LEFT OUTER JOIN   [Country] country &quot;
				+ &quot; on country.ID= cnt.Country &quot;
				+ &quot; LEFT OUTER JOIN   [ActivityTypeEnum] ate  &quot;
				+ &quot; on ate.id=poald.ActivityType &quot;
				+ &quot; where po.TradePaymentID = ?  &quot;),
		
<span class="fc" id="L1586">		GET_TRADE_PAYMENT_ID_FROM_FUNDS_IN_ID(&quot; Select tradePaymentId from [PaymentIn] where ID=? &quot;),</span>

<span class="fc" id="L1588">		GET_TRADE_PAYMENT_ID_FROM_FUNDS_OUT_ID(&quot; Select tradePaymentId from [PaymentOut] where ID=? &quot;),</span>

		//AT-5023
<span class="fc" id="L1591">		GET_POST_CARD_TM_MQ_MESSAGE_FROM_DB(&quot;declare @Id int; &quot;</span>
				+ &quot;DECLARE @COUNT int; &quot;
				+ &quot;SET @COUNT = ?; &quot;
				+ &quot;select TOP 1 @Id = Id from comp.PostCardTransactionMonitoringMQ where DeliveryStatus in (1, 3) and RetryCount&lt;@COUNT order by id asc Select ID, TransactionID , CardRequestType, RequestJson, RetryCount, CreatedBy , CreatedOn, isPresent from comp.PostCardTransactionMonitoringMQ where id = @Id&quot;),
		
<span class="fc" id="L1596">		UPDATE_POST_CARD_TM_MQ_STATUS(&quot;UPDATE PostCardTransactionMonitoringMQ SET DeliveryStatus=?,RetryCount=?,DeliveredOn=? WHERE id=?&quot;),</span>
		
<span class="fc" id="L1598">		DELETE_DELIVERED_RECORD_FROM_POST_CARD_TMMQ(&quot;DELETE FROM PostCardTransactionMonitoringMQ WHERE DeliveryStatus = 2 And ID = ?&quot;),</span>
		
		//AT-5364
<span class="fc" id="L1601">		GET_DETAILS_FOR_INTUITION_HISTORIC_PAYMENT_IN_RECORDS(&quot;SELECT p.ID as payInId,&quot;</span>
				+ &quot; p.AccountID as accountid,&quot;
				+ &quot; p.ContactID as ContactID, &quot;
				+ &quot; pia.[Attributes] as PIAttrib, &quot;
				+ &quot; p.FraugsterStatus, &quot;
				+ &quot; p.BlacklistStatus , &quot;
				+ &quot; p.SanctionStatus , &quot;
				+ &quot; p.CustomCheckStatus , &quot;
				+ &quot; p.ComplianceStatus as PIComplianceStatus, &quot;
				+ &quot; p.InitialStatus ,&quot;
				+ &quot; a.TradeAccountNumber , &quot;
				+ &quot; a.AccountTMFlag , &quot;
				+ &quot; (SELECT o.Code from Organization o WHERE ID = a.OrganizationID) AS OrganizationCode , c.TradeContactID, &quot;
				+ &quot; a.Version as AccountVersion, &quot;
				+ &quot; JSON_VALUE(aa.[Attributes],'$.company.etailer') as Etailer,&quot;
				+ &quot; ISNULL(CASE JSON_VALUE(pia.[Attributes],'$.trade.payment_time')&quot; //Added for AT-5486
				+ &quot; WHEN '' THEN Format(cast(p.CreatedOn as datetime2),'yyyy-MM-dd HH:mm:ss')&quot;
				+ &quot; ELSE Format(cast(JSON_VALUE(pia.[Attributes],'$.trade.payment_time') as datetime2),'yyyy-MM-dd HH:mm:ss') END,&quot;
				+ &quot; Format(cast(p.CreatedOn as datetime2),'yyyy-MM-dd HH:mm:ss'))  as PaymentTime&quot;
				+ &quot; FROM PaymentIn p &quot;
				+ &quot; JOIN PaymentInAttribute pia ON &quot;
				+ &quot; p.id = pia.id &quot;
				+ &quot; JOIN Account a on &quot;
				+ &quot; a.ID = p.AccountID &quot;
				+ &quot; JOIN AccountAttribute aa ON a.ID = aa.ID &quot;
				+ &quot; JOIN Contact c on&quot;
				+ &quot; c.ID = p.ContactID &quot;
				+ &quot; WHERE a.AccountTMFlag = 4 AND a.DormantFlag = 1 and p.CreatedOn &lt; CURRENT_TIMESTAMP&quot;),
		
		//AT-5364
<span class="fc" id="L1631">		UPDATE_ACCOUNT_TM_FLAG_FOR_HISTORIC_PAYMENTS(&quot;UPDATE Account SET AccountTMFlag = ?, UpdatedBy = ?, UpdatedOn = ? WHERE ID = ?&quot;),</span>
	
		//AT-5304
<span class="fc" id="L1634">	    GET_DETAILS_FOR_INTUITION_HISTORIC_PAYMENT_OUT_RECORDS(&quot;SELECT  p.ID as payOutId,&quot;</span>
	   		+ &quot; p.AccountID as accountid,&quot;
	   		+ &quot; p.ContactID as ContactID,&quot;
	   		+ &quot; poa.[Attributes] as POAttrib,&quot;
	   		+ &quot; p.FraugsterStatus,&quot;
	   		+ &quot; p.BlacklistStatus ,&quot;
	   		+ &quot; p.SanctionStatus ,&quot;
	   		+ &quot; p.CustomCheckStatus ,&quot;
	   		+ &quot;             p.PaymentReferenceStatus,&quot;
	   		+ &quot; p.ComplianceStatus as POComplianceStatus,&quot;
	   		+ &quot; p.InitialStatus ,&quot;
	   		+ &quot; a.TradeAccountNumber ,&quot;
	   		+ &quot; a.AccountTMFlag ,&quot;
	   		+ &quot; (SELECT o.Code&quot;
	   		+ &quot; from Organization o&quot;
	   		+ &quot; WHERE ID = a.OrganizationID) AS OrganizationCode , c.TradeContactID, a.Version as AccountVersion,&quot;
	   		+ &quot; JSON_VALUE(aa.[Attributes],'$.company.etailer') as Etailer,&quot;
	   		+ &quot; ISNULL(CASE JSON_VALUE(poa.[Attributes],'$.beneficiary.trans_ts')&quot; //Added for AT-5486
	   		+ &quot; WHEN '' THEN Format(cast(p.CreatedOn as datetime2),'yyyy-MM-dd HH:mm:ss')&quot;
	   		+ &quot; ELSE Format(cast(JSON_VALUE(poa.[Attributes],'$.beneficiary.trans_ts') as datetime2),'yyyy-MM-dd HH:mm:ss') END,&quot;
	   		+ &quot; Format(cast(p.CreatedOn as datetime2),'yyyy-MM-dd HH:mm:ss')) as TransactionTimeDate&quot;
	   		+ &quot; FROM PaymentOut p&quot;
	   		+ &quot; JOIN PaymentOutAttribute poa ON p.id = poa.id&quot;
	   		+ &quot; JOIN Account a on &quot;
	   		+ &quot; a.ID = p.AccountID&quot;
	   		+ &quot; JOIN AccountAttribute aa ON a.ID = aa.ID&quot;
	   		+ &quot; JOIN Contact c on c.ID = p.ContactID&quot;
	   		+ &quot; WHERE a.AccountTMFlag = 4&quot;
	   		+ &quot; AND a.DormantFlag = 1&quot;
	   		+ &quot; AND p.CreatedOn &lt; CURRENT_TIMESTAMP&quot;);

	
		
	private String query;
	
<span class="fc" id="L1669">	DBQueryConstant(String query){</span>
<span class="fc" id="L1670">		this.query = query;</span>
<span class="fc" id="L1671">	}</span>
	
	public String getQuery(){
<span class="fc" id="L1674">		return this.query;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>