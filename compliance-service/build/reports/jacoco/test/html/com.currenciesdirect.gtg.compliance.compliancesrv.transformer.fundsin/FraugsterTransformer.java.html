<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FraugsterTransformer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.compliancesrv.transformer.fundsin</a> &gt; <span class="el_source">FraugsterTransformer.java</span></div><h1>FraugsterTransformer.java</h1><pre class="source lang-java linenums">/**
 * 
 */
package com.currenciesdirect.gtg.compliance.compliancesrv.transformer.fundsin;

import java.util.ArrayList;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.messaging.Message;

import com.currenciesdirect.gtg.compliance.commons.domain.DeviceInfo;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInContactResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterPaymentsInResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterSummary;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FundsInFraugsterResendRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fundsin.request.FundsInCreateRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fundsin.request.FundsInTrade;
import com.currenciesdirect.gtg.compliance.commons.enums.CustomerTypeEnum;
import com.currenciesdirect.gtg.compliance.compliancesrv.ComplianceException;
import com.currenciesdirect.gtg.compliance.compliancesrv.MessageContextHeaders;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.EntityEnum;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.ServiceStatus;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.UserProfile;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.Account;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.Contact;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.EventServiceLog;
import com.currenciesdirect.gtg.compliance.compliancesrv.msg.MessageContext;
import com.currenciesdirect.gtg.compliance.compliancesrv.msg.MessageExchange;
import com.currenciesdirect.gtg.compliance.compliancesrv.msg.ServiceProviderEnum;
import com.currenciesdirect.gtg.compliance.compliancesrv.msg.ServiceTypeEnum;
import com.currenciesdirect.gtg.compliance.compliancesrv.transformer.AbstractTransformer;
import com.currenciesdirect.gtg.compliance.compliancesrv.util.Constants;
import com.currenciesdirect.gtg.compliance.compliancesrv.util.JsonConverterUtil;

/**
 * The Class FraugsterTransformer.
 *
 * @author manish
 */
<span class="nc" id="L44">public class FraugsterTransformer extends AbstractTransformer {</span>

	/** The Constant LOG. */
<span class="nc" id="L47">	private static final Logger LOG = LoggerFactory.getLogger(FraugsterTransformer.class);</span>

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.currenciesdirect.gtg.compliance.compliancesrv.core.ITransfomer#
	 * transformRequest(org.springframework.messaging.Message)
	 */
	@Override
	public Message&lt;MessageContext&gt; transformRequest(Message&lt;MessageContext&gt; message) {

		try {
<span class="nc" id="L59">			UserProfile token = (UserProfile) message.getHeaders().get(MessageContextHeaders.GATEWAY_USER);</span>
<span class="nc" id="L60">			MessageExchange messageExchange = message.getPayload().getGatewayMessageExchange();</span>
<span class="nc" id="L61">			FundsInCreateRequest fundsInCreateRequest = (FundsInCreateRequest) messageExchange.getRequest();</span>
<span class="nc" id="L62">			Contact contact = (Contact) fundsInCreateRequest.getAdditionalAttribute(Constants.FIELD_CONTACT);</span>

<span class="nc" id="L64">			Integer eventId = (Integer) message.getPayload().getGatewayMessageExchange().getRequest()</span>
<span class="nc" id="L65">					.getAdditionalAttribute(Constants.FIELD_EVENTID);</span>
<span class="nc" id="L66">			FraugsterPaymentsInRequest fraugsterPaymentsInRequest = createServiceRequest(fundsInCreateRequest,</span>
<span class="nc" id="L67">					messageExchange.getServiceInterface().name());</span>
			
			ServiceStatus defaultStatus;
<span class="nc bnc" id="L70" title="All 2 branches missed.">			if (fundsInCreateRequest.getAdditionalAttribute(Constants.PERFORM_CHECKS).equals(Boolean.TRUE)) {</span>
<span class="nc" id="L71">				defaultStatus = ServiceStatus.NOT_PERFORMED;</span>
			} else {
<span class="nc" id="L73">				defaultStatus = ServiceStatus.NOT_REQUIRED;</span>
			}

<span class="nc" id="L76">			FraugsterPaymentsInResponse fraugsterPaymentsInResponse = createServiceDeafaultResponse(contact.getId(),</span>
					defaultStatus);
<span class="nc" id="L78">			FraugsterSummary fraugsterSummary = new FraugsterSummary();</span>
<span class="nc" id="L79">			fraugsterSummary.setStatus(fraugsterPaymentsInResponse.getStatus());</span>
			// use this to update the FraugsterSchedularData table.
<span class="nc" id="L81">			fraugsterSummary.setCdTrasId(fraugsterPaymentsInRequest.getContactRequests().get(0).getTransactionID());</span>

<span class="nc" id="L83">			MessageExchange ccExchange = createMessageExchange(fraugsterPaymentsInRequest, fraugsterPaymentsInResponse,</span>
					ServiceTypeEnum.FRAUGSTER_SERVICE);
<span class="nc" id="L85">			ccExchange.addEventServiceLog(createEventServiceLogEntryWithStatus(eventId,</span>
<span class="nc" id="L86">					ServiceTypeEnum.FRAUGSTER_SERVICE, ServiceProviderEnum.FRAUGSTER_FUNDSIN_SERVICE, contact.getId(),</span>
<span class="nc" id="L87">					contact.getVersion(), EntityEnum.CONTACT.name(), token.getUserID(), fraugsterPaymentsInResponse,</span>
					fraugsterSummary, defaultStatus));

<span class="nc" id="L90">			message.getPayload().appendMessageExchange(ccExchange);</span>
<span class="nc" id="L91">		} catch (Exception e) {</span>
<span class="nc" id="L92">			LOG.error(&quot;Error in Fraugster transformer class : transformRequest -&quot;, e);</span>
<span class="nc" id="L93">			message.getPayload().setFailed(true);</span>
<span class="nc" id="L94">		}</span>
<span class="nc" id="L95">		return message;</span>
	}

	/**
	 * Creates the service deafault response.
	 *
	 * @param contactId
	 *            the contact id
	 * @param defaultStatus
	 *            the default status
	 * @return the fraugster payments in response
	 */
	private FraugsterPaymentsInResponse createServiceDeafaultResponse(Integer contactId, ServiceStatus defaultStatus) {

<span class="nc" id="L109">		FraugsterPaymentsInResponse fPaymentInResponse = new FraugsterPaymentsInResponse();</span>
<span class="nc" id="L110">		List&lt;FraugsterPaymentsInContactResponse&gt; fContactResponses = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L111">		FraugsterPaymentsInContactResponse response = new FraugsterPaymentsInContactResponse();</span>
<span class="nc" id="L112">		response.setId(contactId);</span>
<span class="nc" id="L113">		response.setStatus(defaultStatus.name());</span>
<span class="nc" id="L114">		fContactResponses.add(response);</span>
<span class="nc" id="L115">		fPaymentInResponse.setContactResponses(fContactResponses);</span>
<span class="nc" id="L116">		fPaymentInResponse.setStatus(defaultStatus.name());</span>
<span class="nc" id="L117">		return fPaymentInResponse;</span>
	}

	/**
	 * Creates the service request.
	 *
	 * @param fundsInRequest
	 *            the funds in request
	 * @param type
	 *            the type
	 * @return the fraugster payments in request
	 * @throws ComplianceException
	 *             the compliance exception
	 */
	private FraugsterPaymentsInRequest createServiceRequest(FundsInCreateRequest fundsInRequest, String type) {
<span class="nc" id="L132">		FraugsterPaymentsInRequest request = new FraugsterPaymentsInRequest();</span>
<span class="nc" id="L133">		List&lt;FraugsterPaymentsInContactRequest&gt; fContactRequests = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L134">		Account account = (Account) fundsInRequest.getAdditionalAttribute(&quot;account&quot;);</span>
		FraugsterPaymentsInContactRequest fContactRequest;
<span class="nc" id="L136">		fContactRequest = transformPaymantInRequest(fundsInRequest);</span>
<span class="nc" id="L137">		fContactRequests.add(fContactRequest);</span>
<span class="nc" id="L138">		request.setContactRequests(fContactRequests);</span>
<span class="nc" id="L139">		request.setOrgCode(fundsInRequest.getOrgCode());</span>
<span class="nc" id="L140">		request.setCorrelationID(fundsInRequest.getCorrelationID());</span>
<span class="nc" id="L141">		request.setSourceApplication(fundsInRequest.getSourceApplication());</span>
<span class="nc" id="L142">		request.setRequestType(type);</span>
<span class="nc" id="L143">		request.setCustType(CustomerTypeEnum.getCustumerTypeAsString(account.getCustomerType()));</span>
<span class="nc" id="L144">		return request;</span>
	}

	/**
	 * Transform paymant in request.
	 *
	 * @param fundsInRequest
	 *            the funds in request
	 * @return the fraugster payments in contact request
	 * @throws ComplianceException
	 *             the compliance exception
	 */
	private FraugsterPaymentsInContactRequest transformPaymantInRequest(FundsInCreateRequest fundsInRequest) {
<span class="nc" id="L157">		Account account = (Account) fundsInRequest.getAdditionalAttribute(&quot;account&quot;);</span>
<span class="nc" id="L158">		Contact contact = (Contact) fundsInRequest.getAdditionalAttribute(&quot;contact&quot;);</span>
<span class="nc" id="L159">		DeviceInfo deviceInfo = fundsInRequest.getDeviceInfo();</span>
<span class="nc" id="L160">		FraugsterPaymentsInContactRequest requestData = new FraugsterPaymentsInContactRequest();</span>
<span class="nc" id="L161">		FundsInTrade trade = fundsInRequest.getTrade();</span>
<span class="nc" id="L162">		requestData.setEventType(&quot;payment_in&quot;);</span>
<span class="nc" id="L163">		requestData.setId(contact.getId());</span>
<span class="nc" id="L164">		requestData.setAccountIdentification(trade.getAccountIdentification());</span>
<span class="nc" id="L165">		requestData.setAddressOnCard(trade.getBillAddressLine());</span>
<span class="nc" id="L166">		requestData.setaVSResult(trade.getAvsResult());</span>
<span class="nc" id="L167">		requestData.setaVTradeFrequency(trade.getAvTradeFrequency());</span>
<span class="nc" id="L168">		requestData.setaVTradeValue(trade.getAvTradeValue());</span>
<span class="nc" id="L169">		requestData.setChequeClearanceDate(trade.getChequeClearanceDate());</span>
<span class="nc" id="L170">		requestData.setCurrency(trade.getTransactionCurrency().substring(0, 3));</span>
<span class="nc" id="L171">		requestData.setCustomerAccountNumber(contact.getContactSFID());</span>
<span class="nc" id="L172">		requestData.setCustomerAddressOrPostcode(trade.getBillAdZip());</span>
<span class="nc" id="L173">		requestData.setCustomerFirstName(contact.getFirstName());</span>
<span class="nc" id="L174">		requestData.setCustomerLastName(contact.getLastName());</span>
<span class="nc" id="L175">		requestData.setDebitCardAddedDate(trade.getDebitCardAddedDate());</span>
<span class="nc" id="L176">		requestData.setDateAndTime(trade.getPaymentTime());</span>
<span class="nc" id="L177">		requestData.setNameOnCard(trade.getCcFirstName());</span>
<span class="nc" id="L178">		requestData.setOrganizationCode(fundsInRequest.getOrgCode());</span>
<span class="nc" id="L179">		requestData.setPaymentType(trade.getPaymentMethod());</span>
<span class="nc" id="L180">		requestData.setReason(trade.getPurposeOfTrade());</span>
<span class="nc" id="L181">		requestData.setRegistrationDateTime(account.getRegistrationDateTime());</span>
<span class="nc" id="L182">		requestData.setThirdPartyPayment(String.valueOf(trade.getThirdPartyPayment()));</span>
<span class="nc" id="L183">		requestData.setThreeDStatus(trade.getIsThreeds());</span>
<span class="nc" id="L184">		requestData.setTransactionAmount((float) trade.getSellingAmount());</span>
		//following fields are added for fraud predict
<span class="nc" id="L186">		requestData.setPurposeOfTrade(trade.getPurposeOfTrade());</span>
<span class="nc" id="L187">		requestData.setCountryOfFund(trade.getCountryOfFund());</span>
<span class="nc" id="L188">		requestData.setTurnover(trade.getTurnover());</span>
<span class="nc" id="L189">		requestData.setSellingAmountGbpValue(Double.toString(trade.getSellingAmountBaseValue()));</span>
<span class="nc" id="L190">		requestData.setContractNumber(trade.getContractNumber());</span>
<span class="nc bnc" id="L191" title="All 4 branches missed.">		if (null != fundsInRequest.getRiskScore() &amp;&amp; null!= fundsInRequest.getRiskScore().getTScore()) {</span>
<span class="nc" id="L192">		requestData.setRiskScore(Double.toString(fundsInRequest.getRiskScore().getTScore()));</span>
		}
		
		
		/**
		 * Changes made for to set unique TransactionID by concatenate FundsInID
		 * and TradeAccountNumber- Saylee
		 */
<span class="nc" id="L200">		requestData.setTransactionID(String.valueOf(fundsInRequest.getFundsInId())</span>
<span class="nc" id="L201">				+ (String.valueOf(fundsInRequest.getTrade().getTradeAccountNumber())));</span>
<span class="nc" id="L202">		requestData.setTransactionReference(trade.getTransactionReference());</span>

<span class="nc" id="L204">		requestData.setCustID(leftPadWithZero(account.getId()));</span>

<span class="nc bnc" id="L206" title="All 2 branches missed.">		if (null != deviceInfo) {</span>
<span class="nc" id="L207">		    requestData.setUserAgent(deviceInfo.getUserAgent());</span>
<span class="nc" id="L208">			requestData.setBrowserLanguage(deviceInfo.getBrowserLanguage());</span>
<span class="nc" id="L209">			requestData.setBrowserMajorVersion(deviceInfo.getBrowserMajorVersion());</span>
<span class="nc" id="L210">			requestData.setBrowserName(deviceInfo.getBrowserName());</span>
<span class="nc" id="L211">			requestData.setBrowserOnline(deviceInfo.getBrowserOnline());</span>
			// Added ScreenResolution instead of BrowserScreenResolution and
			// DeviceResolution
<span class="nc" id="L214">			requestData.setBrowserScreenResolution(deviceInfo.getScreenResolution());</span>
<span class="nc" id="L215">			requestData.setDeviceID(deviceInfo.getDeviceId());</span>
<span class="nc" id="L216">			requestData.setDeviceManufacturer(deviceInfo.getDeviceManufacturer());</span>
<span class="nc" id="L217">			requestData.setDeviceName(deviceInfo.getDeviceName());</span>
<span class="nc" id="L218">			requestData.setDeviceType(deviceInfo.getDeviceType());</span>
<span class="nc" id="L219">			requestData.setDeviceVersion(deviceInfo.getDeviceVersion());</span>
			//following 2 fields are added for fraud predict
<span class="nc" id="L221">			requestData.setBrowserMajorVersion(deviceInfo.getBrowserMajorVersion());</span>
<span class="nc" id="L222">			requestData.setBrowserType(deviceInfo.getBrowserName());</span>
<span class="nc" id="L223">			requestData.setOsName(deviceInfo.getOsName());	</span>
		}
		
		/** set fraugster signup score **/
<span class="nc" id="L227">		String fraugsterSignupScore = (String) fundsInRequest.getAdditionalAttribute(&quot;FraugsterSignupScore&quot;);</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">		if (null != fraugsterSignupScore) {</span>
<span class="nc" id="L229">			requestData.setCustSignupScore(Float.parseFloat(fraugsterSignupScore));</span>
		}
<span class="nc" id="L231">		return requestData;</span>
	}

	/**
	 * Left pad with zero.
	 *
	 * @param id
	 *            the id
	 * @return the string
	 */
	private String leftPadWithZero(Integer id) {
<span class="nc" id="L242">		String pad = &quot;0000000000&quot;;</span>
<span class="nc" id="L243">		return (pad + id).substring((pad + id).length() - 10);</span>
	}

	/*
	 * (non-Javadoc)
	 * 
	 * @see com.currenciesdirect.gtg.compliance.compliancesrv.core.ITransfomer#
	 * transformResponse(org.springframework.messaging.Message)
	 */
	@Override
	public Message&lt;MessageContext&gt; transformResponse(Message&lt;MessageContext&gt; message) {
<span class="nc" id="L254">		MessageExchange exchange = null;</span>
		try {
<span class="nc" id="L256">			exchange = message.getPayload().getMessageExchange(ServiceTypeEnum.FRAUGSTER_SERVICE);</span>
<span class="nc" id="L257">			transformPaymentInResponse(exchange);</span>
<span class="nc" id="L258">		} catch (Exception e) {</span>
<span class="nc" id="L259">			LOG.error(&quot;Error in Fraugster transformer class : transformResponse -&quot;, e);</span>
<span class="nc" id="L260">			message.getPayload().setFailed(true);</span>
<span class="nc" id="L261">		}</span>
<span class="nc" id="L262">		return message;</span>
	}

	/**
	 * Creates the default failure response.
	 *
	 * @param exchange
	 *            the exchange
	 */
	private FraugsterPaymentsInResponse createDefaultFailureResponse(MessageExchange exchange,
			FraugsterPaymentsInRequest request) {
		FraugsterPaymentsInResponse fResponse;
<span class="nc" id="L274">		fResponse = new FraugsterPaymentsInResponse();</span>

<span class="nc" id="L276">		List&lt;FraugsterPaymentsInContactResponse&gt; conactResponseList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L277">		FraugsterSummary fraugsterSummary = new FraugsterSummary();</span>

<span class="nc bnc" id="L279" title="All 2 branches missed.">		for (FraugsterPaymentsInContactRequest contact : request.getContactRequests()) {</span>
<span class="nc" id="L280">			FraugsterPaymentsInContactResponse contactResponse = new FraugsterPaymentsInContactResponse();</span>
<span class="nc" id="L281">			EventServiceLog eventServiceLog = exchange.getEventServiceLog(ServiceTypeEnum.FRAUGSTER_SERVICE,</span>
<span class="nc" id="L282">					EntityEnum.CONTACT.name(), contact.getId());</span>
<span class="nc" id="L283">			contactResponse.setId(contact.getId());</span>
<span class="nc" id="L284">			contactResponse.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L285">			conactResponseList.add(contactResponse);</span>
<span class="nc" id="L286">			fResponse.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L287">			fResponse.setContactResponses(null);</span>
<span class="nc" id="L288">			fraugsterSummary.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L289">			fraugsterSummary.setFrgTransId(Constants.NOT_AVAILABLE);</span>
<span class="nc" id="L290">			fraugsterSummary.setScore(Constants.NOT_AVAILABLE);</span>
<span class="nc" id="L291">			eventServiceLog.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L292">			eventServiceLog.setSummary(JsonConverterUtil.convertToJsonWithoutNull(fraugsterSummary));</span>
<span class="nc" id="L293">			eventServiceLog.setProviderResponse(JsonConverterUtil.convertToJsonWithoutNull(contactResponse));</span>
<span class="nc" id="L294">		}</span>
<span class="nc" id="L295">		fResponse.setContactResponses(conactResponseList);</span>
<span class="nc" id="L296">		exchange.setResponse(fResponse);</span>
<span class="nc" id="L297">		return fResponse;</span>
	}

	/**
	 * Transform payment in response.
	 *
	 * @param exchange
	 *            the exchange
	 */
	private void transformPaymentInResponse(MessageExchange exchange) {
		
<span class="nc" id="L308">    	     FraugsterPaymentsInResponse fResponse = (FraugsterPaymentsInResponse) exchange.getResponse();</span>
<span class="nc" id="L309">   		     FraugsterPaymentsInRequest request = exchange.getRequest(FraugsterPaymentsInRequest.class);</span>
   		     
<span class="nc bnc" id="L311" title="All 4 branches missed.">			if (fResponse == null|| fResponse.getContactResponses().get(0).getStatus().equals(ServiceStatus.SERVICE_FAILURE.name())) {</span>
<span class="nc" id="L312">					fResponse = createDefaultFailureResponse(exchange, request);</span>
				}
		
<span class="nc bnc" id="L315" title="All 2 branches missed.">				if (&quot;SUCCESS&quot;.equalsIgnoreCase(fResponse.getStatus())) {</span>
<span class="nc" id="L316">					fResponse.setStatus(ServiceStatus.PASS.name());</span>
				}
		
<span class="nc" id="L319">				List&lt;FraugsterPaymentsInContactResponse&gt; identityResponse = fResponse.getContactResponses();</span>
<span class="nc bnc" id="L320" title="All 2 branches missed.">				for (FraugsterPaymentsInContactResponse response : identityResponse) {</span>
<span class="nc bnc" id="L321" title="All 4 branches missed.">					if (identityResponse != null &amp;&amp; !response.getStatus().equals(ServiceStatus.SERVICE_FAILURE.name())) {</span>
<span class="nc bnc" id="L322" title="All 2 branches missed.">						if (&quot;SUCCESS&quot;.equalsIgnoreCase(response.getStatus())) {</span>
<span class="nc" id="L323">							response.setStatus(ServiceStatus.PASS.name());</span>
						}
		
<span class="nc" id="L326">						EventServiceLog eventServiceLog = exchange.getEventServiceLog(ServiceTypeEnum.FRAUGSTER_SERVICE,</span>
<span class="nc" id="L327">								EntityEnum.CONTACT.name(), response.getId());</span>
<span class="nc" id="L328">						readResponse(eventServiceLog, response);</span>
					}
<span class="nc" id="L330">				}</span>
<span class="nc" id="L331">   		     }</span>
   		     
	
	/**
	 * Transform fraugster resend request.
	 *
	 * @param message the message
	 * @return the message
	 */
	public Message&lt;MessageContext&gt; transformFraugsterResendRequest(Message&lt;MessageContext&gt; message) {

		try {
<span class="nc" id="L343">			MessageExchange messageExchange = message.getPayload().getGatewayMessageExchange();</span>
<span class="nc" id="L344">			FundsInFraugsterResendRequest resendRequest = messageExchange</span>
<span class="nc" id="L345">					.getRequest(FundsInFraugsterResendRequest.class);</span>

<span class="nc" id="L347">			FundsInCreateRequest fundsInRequest = (FundsInCreateRequest) resendRequest</span>
<span class="nc" id="L348">					.getAdditionalAttribute(Constants.OLD_REQUEST);</span>

<span class="nc" id="L350">			Integer eventId = (Integer) message.getPayload().getGatewayMessageExchange().getRequest()</span>
<span class="nc" id="L351">					.getAdditionalAttribute(&quot;eventId&quot;);</span>

<span class="nc" id="L353">			FraugsterPaymentsInRequest request = createServiceRequest(fundsInRequest, &quot;FUNDS_IN&quot;);</span>

<span class="nc" id="L355">			FraugsterPaymentsInContactResponse defaultResponse = new FraugsterPaymentsInContactResponse();</span>
<span class="nc" id="L356">			FraugsterSummary summary = new FraugsterSummary();</span>
			FraugsterPaymentsInResponse fPaymentInResponse;
			MessageExchange ccExchange;
<span class="nc" id="L359">			fPaymentInResponse = createServiceDeafaultResponse(ServiceStatus.NOT_PERFORMED, fundsInRequest);</span>
<span class="nc" id="L360">			defaultResponse.setStatus(ServiceStatus.NOT_PERFORMED.name());</span>
<span class="nc" id="L361">			summary.setStatus(ServiceStatus.NOT_PERFORMED.name());</span>
			// use this to update the FraugsterSchedularData table.
<span class="nc" id="L363">			summary.setCdTrasId(request.getContactRequests().get(0).getTransactionID());</span>
<span class="nc" id="L364">			ccExchange = createMessageExchange(request, fPaymentInResponse, ServiceTypeEnum.FRAUGSTER_SERVICE);</span>

<span class="nc" id="L366">			Contact contact = (Contact) fundsInRequest.getAdditionalAttribute(Constants.FIELD_CONTACT);</span>

<span class="nc" id="L368">			ccExchange.addEventServiceLog(createEventServiceLogEntryWithStatus(eventId, ServiceTypeEnum.FRAUGSTER_SERVICE,</span>
<span class="nc" id="L369">							ServiceProviderEnum.FRAUGSTER_FUNDSIN_SERVICE, contact.getId(), contact.getVersion(),</span>
<span class="nc" id="L370">							EntityEnum.CONTACT.name(), 1, defaultResponse, summary, ServiceStatus.NOT_PERFORMED));</span>

<span class="nc" id="L372">			message.getPayload().appendMessageExchange(ccExchange);</span>
<span class="nc" id="L373">		} catch (Exception ex) {</span>
<span class="nc" id="L374">			LOG.error(&quot;Error in Fraugster transformer class : transformRequest -&quot;, ex);</span>
<span class="nc" id="L375">			message.getPayload().setFailed(true);</span>
<span class="nc" id="L376">		}</span>
<span class="nc" id="L377">		return message;</span>
	}

	/**
	 * @param status
	 * @param fundsInRequest
	 * @return payment in response
	 */
	private FraugsterPaymentsInResponse createServiceDeafaultResponse(ServiceStatus status,
			FundsInCreateRequest fundsInRequest) {

<span class="nc" id="L388">		Contact contact = (Contact) fundsInRequest.getAdditionalAttribute(&quot;contact&quot;);</span>
<span class="nc" id="L389">		FraugsterPaymentsInResponse fPaymentInResponse = new FraugsterPaymentsInResponse();</span>
<span class="nc" id="L390">		List&lt;FraugsterPaymentsInContactResponse&gt; fContactResponses = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L391">		fPaymentInResponse.setStatus(status.name());</span>
<span class="nc" id="L392">		FraugsterPaymentsInContactResponse response = new FraugsterPaymentsInContactResponse();</span>
<span class="nc" id="L393">		response.setId(contact.getId());</span>
<span class="nc" id="L394">		response.setStatus(status.name());</span>
<span class="nc" id="L395">		fContactResponses.add(response);</span>
<span class="nc" id="L396">		fPaymentInResponse.setContactResponses(fContactResponses);</span>
<span class="nc" id="L397">		return fPaymentInResponse;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>