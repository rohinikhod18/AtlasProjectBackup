<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MessageContext.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.compliancesrv.msg</a> &gt; <span class="el_source">MessageContext.java</span></div><h1>MessageContext.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.compliancesrv.msg;

import java.io.Serializable;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.UUID;

import com.currenciesdirect.gtg.compliance.commons.domain.base.BaseResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.fraugster.FraugsterOnUpdateRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fundsin.request.FundsInCreateRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.fundsout.request.FundsOutRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.internalruleservice.InternalServiceRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.internalruleservice.InternalServiceResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.kyc.KYCProviderRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.kyc.KYCProviderResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.msg.ServiceMessage;
import com.currenciesdirect.gtg.compliance.commons.domain.sanction.SanctionRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.sanction.SanctionUpdateRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.transactionmonitoring.IntuitionHistoricPaymentsRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.transactionmonitoring.IntuitionPaymentStatusUpdateRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.transactionmonitoring.IntuitionPaymentStatusUpdateResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.transactionmonitoring.TransactionMonitoringMQServiceResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.transactionmonitoring.TransactionMonitoringPaymentInResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.transactionmonitoring.TransactionMonitoringPaymentOutResponse;
import com.currenciesdirect.gtg.compliance.compliancesrv.InternalProcessingCode;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.OperationEnum;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.fundsin.FundsInComplianceStatus;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.fundsout.FundsOutComplianceStatus;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.fundsin.response.FundsInCreateResponse;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.fundsout.response.FundsOutResponse;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.profile.delete.contact.DeleteContactRequest;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.RegistrationServiceRequest;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.response.RegistrationResponse;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.transactionmonitoringmq.TransactionMonitoringMQRequest;
import com.currenciesdirect.gtg.compliance.compliancesrv.util.Constants;


/**
 * The Class MessageContext.
 */
public class MessageContext implements Serializable {

	/** The Constant serialVersionUID. */
	private static final long serialVersionUID = 1L;
	
	/** The transaction id. */
	private String transactionId;
	
	/** The message collection. */
	private final LinkedList&lt;MessageExchangeWrapper&gt; messageCollection;
	
	/** The internal processing code. */
	private InternalProcessingCode internalProcessingCode;
	
	/** The audit info. */
	private final AuditInfo auditInfo;
	
	/** The org code. */
	private String orgCode;
	
	/** The service tobe invoked. */
	private ServiceTypeEnum serviceTobeInvoked;
	
	/** The failed. */
<span class="fc" id="L66">	private boolean failed = false;</span>
	
	/** The no message left. */
<span class="fc" id="L69">	private Boolean noMessageLeft = Boolean.FALSE;</span>

	/** The retry count. */
<span class="fc" id="L72">	private Integer retryCount = 0;</span>
	
	

	public Boolean getNoMessageLeft() {
<span class="nc" id="L77">		return noMessageLeft;</span>
	}

	public void setNoMessageLeft(Boolean noMessageLeft) {
<span class="nc" id="L81">		this.noMessageLeft = noMessageLeft;</span>
<span class="nc" id="L82">	}</span>

	public Integer getRetryCount() {
<span class="nc" id="L85">		return retryCount;</span>
	}

	public void setRetryCount(Integer retryCount) {
<span class="nc" id="L89">		this.retryCount = retryCount;</span>
<span class="nc" id="L90">	}</span>

	/**
	 * Instantiates a new message context.
	 */
<span class="fc" id="L95">	public MessageContext() {</span>
<span class="fc" id="L96">		auditInfo = new AuditInfo();</span>
<span class="fc" id="L97">		messageCollection = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L98">		internalProcessingCode = InternalProcessingCode.NOT_CLEARED;</span>
<span class="fc" id="L99">		transactionId = UUID.randomUUID().toString();</span>
<span class="fc" id="L100">	}</span>

	/**
	 * Gets the org code.
	 *
	 * @return the org code
	 */
	public String getOrgCode() {
<span class="fc" id="L108">		return orgCode;</span>
	}

	/**
	 * Sets the org code.
	 *
	 * @param orgCode the new org code
	 */
	public void setOrgCode(String orgCode) {
<span class="fc" id="L117">		this.orgCode = orgCode;</span>
<span class="fc" id="L118">	}</span>

	/**
	 * Gets the transaction id.
	 *
	 * @return the transaction id
	 */
	public String getTransactionId() {
<span class="nc" id="L126">		return transactionId;</span>
	}

	/**
	 * Sets the transaction id.
	 *
	 * @param transactionId the new transaction id
	 */
	public void setTransactionId(String transactionId) {
<span class="nc" id="L135">		this.transactionId = transactionId;</span>
<span class="nc" id="L136">	}</span>

	/**
	 * Gets the message collection.
	 *
	 * @return the message collection
	 */
	public List&lt;MessageExchangeWrapper&gt; getMessageCollection() {
<span class="fc" id="L144">		return messageCollection;</span>
	}

	/**
	 * Append message exchange.
	 *
	 * @param messagExchange the messag exchange
	 */
	public void appendMessageExchange(MessageExchange messagExchange) {
<span class="fc" id="L153">		messageCollection.add(new MessageExchangeWrapper(messagExchange));</span>
<span class="fc" id="L154">	}</span>

	/**
	 * Gets the message exchange size.
	 *
	 * @return the message exchange size
	 */
	public int getMessageExchangeSize() {
<span class="nc" id="L162">		return messageCollection.size();</span>
	}
	
	/**
	 * Gets the service tobe invoked.
	 *
	 * @return the service tobe invoked
	 */
	public ServiceTypeEnum getServiceTobeInvoked() {
<span class="nc" id="L171">		return serviceTobeInvoked;</span>
	}

	/**
	 * Sets the service tobe invoked.
	 *
	 * @param serviceTobeInvoked the new service tobe invoked
	 */
	public void setServiceTobeInvoked(ServiceTypeEnum serviceTobeInvoked) {
<span class="nc" id="L180">		this.serviceTobeInvoked = serviceTobeInvoked;</span>
<span class="nc" id="L181">	}</span>

	/**
	 * Clear all.
	 */
	public void clearAll() {
<span class="nc bnc" id="L187" title="All 2 branches missed.">		for (MessageExchangeWrapper exchange : messageCollection) {</span>
<span class="nc" id="L188">			exchange.getMessageExchange().clear();</span>
<span class="nc" id="L189">		}</span>

<span class="nc" id="L191">	}</span>

	/**
	 * Gets the message exchange.
	 *
	 * @param serviceTypeEnum the service type enum
	 * @return the message exchange
	 */
	public MessageExchange getMessageExchange(ServiceTypeEnum serviceTypeEnum) {
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">		for (MessageExchangeWrapper exchange : messageCollection) {</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">			if (exchange.getMessageExchange().getServiceTypeEnum()==serviceTypeEnum) {</span>
<span class="fc" id="L202">				return exchange.getMessageExchange();</span>
			}
<span class="fc" id="L204">		}</span>
<span class="nc" id="L205">		return null;</span>
	}
	
	/**
	 * Gets the gateway message exchange.
	 *
	 * @return the gateway message exchange
	 */
	public MessageExchange getGatewayMessageExchange() {
<span class="fc" id="L214">		ServiceTypeEnum serviceTypeEnum = ServiceTypeEnum.GATEWAY_SERVICE;</span>
<span class="pc bpc" id="L215" title="1 of 2 branches missed.">		for (MessageExchangeWrapper exchange : messageCollection) {</span>
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">			if (exchange.getMessageExchange().getServiceTypeEnum() == serviceTypeEnum){</span>
<span class="fc" id="L217">				return exchange.getMessageExchange();</span>
			}
<span class="nc" id="L219">		}</span>
<span class="nc" id="L220">		return null;</span>
	}
	
	/**
	 * Removes the message exchange.
	 *
	 * @param serviceTypeEnum the service type enum
	 */
	public void removeMessageExchange(ServiceTypeEnum serviceTypeEnum) {
<span class="nc" id="L229">		Iterator&lt;MessageExchangeWrapper&gt; it = messageCollection.iterator();</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">		while (it.hasNext()) {</span>
<span class="nc" id="L231">			MessageExchangeWrapper exchange = it.next();</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">			if (exchange.getMessageExchange().getServiceTypeEnum()==serviceTypeEnum) {</span>
<span class="nc" id="L233">				it.remove();</span>
<span class="nc" id="L234">				break;</span>
			}
<span class="nc" id="L236">		}</span>
<span class="nc" id="L237">	}</span>

	/**
	 * Gets the internal processing code.
	 *
	 * @return the internal processing code
	 */
	public InternalProcessingCode getInternalProcessingCode() {
<span class="nc" id="L245">		return internalProcessingCode;</span>
	}

	/**
	 * Sets the internal processing code.
	 *
	 * @param internalProcessingCode the new internal processing code
	 */
	public void setInternalProcessingCode(InternalProcessingCode internalProcessingCode) {
<span class="nc" id="L254">		this.internalProcessingCode = internalProcessingCode;</span>
<span class="nc" id="L255">	}</span>

	/**
	 * Gets the audit info.
	 *
	 * @return the audit info
	 */
	public AuditInfo getAuditInfo() {
<span class="fc" id="L263">		return auditInfo;</span>
	}

	/* (non-Javadoc)
	 * @see java.lang.Object#equals(java.lang.Object)
	 */
	@Override
	public boolean equals(Object obj) {
<span class="nc bnc" id="L271" title="All 2 branches missed.">		if (this == obj)</span>
<span class="nc" id="L272">			return true;</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">		if (obj == null)</span>
<span class="nc" id="L274">			return false;</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">		if (getClass() != obj.getClass())</span>
<span class="nc" id="L276">			return false;</span>
<span class="nc" id="L277">		MessageContext other = (MessageContext) obj;</span>
<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (messageCollection == null) {</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">			if (other.messageCollection != null)</span>
<span class="nc" id="L280">				return false;</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">		} else if (!messageCollection.equals(other.messageCollection)) {</span>
<span class="nc" id="L282">			return false;</span>
		}
<span class="nc bnc" id="L284" title="All 2 branches missed.">		if (orgCode == null) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">			if (other.orgCode != null) {</span>
<span class="nc" id="L286">				return false;</span>
			}
<span class="nc bnc" id="L288" title="All 2 branches missed.">		} else if (!orgCode.equals(other.orgCode)) {</span>
<span class="nc" id="L289">			return false;</span>
		}
<span class="nc bnc" id="L291" title="All 2 branches missed.">		if (transactionId == null) {</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">			if (other.transactionId != null) {</span>
<span class="nc" id="L293">				return false;</span>
			}
<span class="nc bnc" id="L295" title="All 2 branches missed.">		} else if (!transactionId.equals(other.transactionId)) {</span>
<span class="nc" id="L296">			return false;</span>
		}
<span class="nc" id="L298">		return true;</span>
	}

	/* (non-Javadoc)
	 * @see java.lang.Object#hashCode()
	 */
	@Override
	public int hashCode() {
<span class="nc" id="L306">		final int prime = 31;</span>
<span class="nc" id="L307">		int result = 1;</span>
<span class="nc bnc" id="L308" title="All 2 branches missed.">		result = prime * result + ((messageCollection == null) ? 0 : messageCollection.hashCode());</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">		result = prime * result + ((orgCode == null) ? 0 : orgCode.hashCode());</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">		result = prime * result + ((transactionId == null) ? 0 : transactionId.hashCode());</span>
<span class="nc" id="L311">		return result;</span>
	}
	
	/**
	 * Gets the interna rules request size.
	 *
	 * @return the interna rules request size
	 */
	public Integer getInternaRulesRequestSize(){
<span class="nc" id="L320">		InternalServiceRequest iRequest = (InternalServiceRequest)this.getMessageExchange(ServiceTypeEnum.INTERNAL_RULE_SERVICE).getRequest();</span>
<span class="nc" id="L321">		return iRequest.getSearchdata().size();</span>
	}
	
	/**
	 * Gets the KYC request size.
	 *
	 * @return the KYC request size
	 */
	public Integer getKYCRequestSize(){
<span class="nc" id="L330">		KYCProviderRequest kycRequest = (KYCProviderRequest)this.getMessageExchange(ServiceTypeEnum.KYC_SERVICE).getRequest();</span>
<span class="nc" id="L331">		return kycRequest.getContact().size();</span>
	}
	
	/**
	 * Gets the fraugster on update request size.
	 *
	 * @return the fraugster on update request size
	 */
	public Integer getFraugsterOnUpdateRequestSize(){
<span class="nc" id="L340">		FraugsterOnUpdateRequest fraugsterOnUpdateRequest = (FraugsterOnUpdateRequest)this.getMessageExchange(ServiceTypeEnum.FRAUGSTER_SERVICE).getRequest();</span>
<span class="nc bnc" id="L341" title="All 2 branches missed.">		return fraugsterOnUpdateRequest.getContactRequests()==null?0:fraugsterOnUpdateRequest.getContactRequests().size();</span>
	}
	
	/**
	 * Gets the sanction request size.
	 *
	 * @return the sanction request size
	 */
	public Integer getSanctionRequestSize(){
<span class="nc" id="L350">		SanctionRequest kycRequest = (SanctionRequest)this.getMessageExchange(ServiceTypeEnum.SANCTION_SERVICE).getRequest();</span>
<span class="nc bnc" id="L351" title="All 2 branches missed.">		return kycRequest.getContactrequests()==null?0:kycRequest.getContactrequests().size();</span>
	}
	
	/**
	 * Gets the KYC status.
	 *
	 * @return the KYC status
	 */
	public String getKYCStatus(){
<span class="nc" id="L360">		KYCProviderResponse kycResponse = (KYCProviderResponse)this.getMessageExchange(ServiceTypeEnum.KYC_SERVICE).getResponse();</span>
<span class="nc" id="L361">		return kycResponse.getStatus();</span>
	}
	
	/**
	 * Gets the internal rule service status.
	 *
	 * @return the internal rule service status
	 */
	public String getInternalRuleServiceStatus(){
<span class="nc" id="L370">		InternalServiceResponse internalServiceResponse = (InternalServiceResponse)this.getMessageExchange(ServiceTypeEnum.INTERNAL_RULE_SERVICE).getResponse();</span>
<span class="nc" id="L371">		return internalServiceResponse.getStatus();</span>
	}
	
	/**
	 * Gets the account status.
	 *
	 * @return the account status
	 */
	public String getAccountStatus(){
<span class="nc" id="L380">		RegistrationResponse response  = (RegistrationResponse)this.getGatewayMessageExchange().getResponse();</span>
<span class="nc" id="L381">		return response.getAccount().getAcs().toString();</span>
	}
	
	/**
	 * Gets the validation result.
	 *
	 * @return the validation result
	 */
	public String getValidationResult(){
<span class="nc" id="L390">		BaseResponse regResponse = (BaseResponse)this.getGatewayMessageExchange().getResponse();</span>
<span class="nc" id="L391">		return regResponse.getDecision().toString();</span>
	}
	
	/**
	 * Do perform other checks.
	 *
	 * @return true, if successful
	 */
	public boolean doPerformOtherChecks(){
<span class="nc" id="L400">		ServiceMessage iRequest =this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L401">		return (Boolean) iRequest.getAdditionalAttribute(Constants.PERFORM_CHECKS);</span>
	}
	
	/**
	 * Do send email after address update.
	 *
	 * @return true, if successful
	 */
	public boolean doSendEmailAfterAddressUpdate(){
<span class="nc" id="L410">		ServiceMessage iRequest =this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L411">		return (Boolean) iRequest.getAdditionalAttribute(Constants.SEND_EMAIL_ON_ADDRESS_CHANGE);</span>
	}
	
	/**
	 * Gets the request resource type.
	 *
	 * @return the request resource type
	 */
	public String getRequestResourceType(){
<span class="nc" id="L420">		SanctionUpdateRequest sanctionUpdateRequest = (SanctionUpdateRequest)this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L421">		return sanctionUpdateRequest.getResourceType();</span>
	}
	
	/**
	 * Checks if is failed.
	 *
	 * @return true, if is failed
	 */
	public boolean isFailed(){
<span class="nc" id="L430">		return failed;</span>
	}
	
	/**
	 * Sets the failed.
	 *
	 * @param failed the new failed
	 */
	public void setFailed(boolean failed){
<span class="nc" id="L439">		this.failed = failed;</span>
<span class="nc" id="L440">	}</span>

	/**
	 * Checks if is broadcast required.
	 *
	 * @return the isBroadcastRequired
	 */
	public boolean isBroadcastRequired() {
<span class="nc" id="L448">		ServiceMessage iRequest =this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L449">		return (Boolean) iRequest.getAdditionalAttribute(Constants.FIELD_BROADCAST_REQUIRED);</span>
	}
	
	/**
	 * Checks if is sanction eligible.
	 *
	 * @return true, if is sanction eligible
	 */
	public boolean isSanctionEligible() {
<span class="nc" id="L458">		ServiceMessage request = this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L459">		return (boolean) request.getAdditionalAttribute(Constants.RECHECK_SANCTION_ELIGIBLE);</span>
	}

	/**
	 * Checks if is fraugster eligible.
	 *
	 * @return true, if is fraugster eligible
	 */
	public boolean isFraugsterEligible() {
<span class="nc" id="L468">		ServiceMessage request = this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L469">		return (boolean) request.getAdditionalAttribute(Constants.RECHECK_FRAUGSTER_ELIGIBLE);</span>
	}
	
	/**
	 * Checks if is custom check eligible.
	 *
	 * @return true, if is custom check eligible
	 */
	public boolean isCustomCheckEligible() {
<span class="nc" id="L478">		ServiceMessage request = this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L479">		return (boolean) request.getAdditionalAttribute(Constants.RECHECK_CUSTOM_CHECK_ELIGIBLE);</span>
	}
	
	/**
	 * Checks if is internal rule service eligible.
	 *
	 * @return true, if is internal rule service eligible
	 */
	public boolean isInternalRuleServiceEligible() {
<span class="nc" id="L488">		ServiceMessage request = this.getGatewayMessageExchange().getRequest();</span>
<span class="nc bnc" id="L489" title="All 2 branches missed.">		return (boolean) request.getAdditionalAttribute(Constants.RECHECK_BLACKLIST_ELIGIBLE) </span>
<span class="nc bnc" id="L490" title="All 2 branches missed.">				|| (boolean) request.getAdditionalAttribute(Constants.RECHECK_COUNTRY_CHECK_ELIGIBLE);</span>
	}

	/**
	 * Checks if is internal rule service eligible for reg.
	 *
	 * @return true, if is internal rule service eligible for reg
	 */
	public boolean isInternalRuleServiceEligibleForReg() {
<span class="nc" id="L499">		ServiceMessage request = this.getGatewayMessageExchange().getRequest();</span>
<span class="nc bnc" id="L500" title="All 2 branches missed.">		return (boolean) request.getAdditionalAttribute(&quot;isBlacklistEligible&quot;)</span>
<span class="nc bnc" id="L501" title="All 2 branches missed.">				|| (boolean) request.getAdditionalAttribute(&quot;isCountryCheckEligible&quot;)</span>
<span class="nc bnc" id="L502" title="All 2 branches missed.">				|| (boolean) request.getAdditionalAttribute(&quot;isIpCheckEligible&quot;)</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">				|| (boolean) request.getAdditionalAttribute(&quot;isGlobalCheckEligible&quot;);</span>
	}
	
	/**
	 * Checks if is eid eligible.
	 *
	 * @return true, if is eid eligible
	 */
	public boolean isEidEligible() {
<span class="nc" id="L512">		ServiceMessage request = this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L513">		return (boolean) request.getAdditionalAttribute(&quot;isEidEligible&quot;);</span>
	}
	
	public String getCustTypeForContactDeletion(){
<span class="nc" id="L517">		DeleteContactRequest request = (DeleteContactRequest)this.getGatewayMessageExchange().getRequest();</span>
<span class="nc" id="L518">		RegistrationServiceRequest regRequest = (RegistrationServiceRequest)request.getAdditionalAttribute(&quot;regRequest&quot;);</span>
<span class="nc" id="L519">		return regRequest.getAccount().getCustType();</span>
	}
	
	/* (non-Javadoc)
	 * @see java.lang.Object#toString()
	 */
	@Override
	public String toString() {
<span class="nc" id="L527">		return &quot;MessageContext [transactionId=&quot; + transactionId + &quot;, serviceTobeInvoked=&quot; + serviceTobeInvoked + &quot;]&quot;;</span>
	}

	public boolean isIntuitionEligible() {
<span class="nc" id="L531">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L532">		RegistrationServiceRequest regRequest = messageExchange.getRequest(RegistrationServiceRequest.class);</span>

<span class="nc" id="L534">		int accountTMFlag = (int) regRequest.getAdditionalAttribute(&quot;AccountTMFlag&quot;);</span>

<span class="nc bnc" id="L536" title="All 2 branches missed.">		if (messageExchange.getOperation() == OperationEnum.NEW_REGISTRATION) {</span>
<span class="nc" id="L537">			return true;</span>
		} else {
<span class="nc bnc" id="L539" title="All 6 branches missed.">			return (accountTMFlag == 1 || accountTMFlag == 2 || accountTMFlag == 4);</span>
		}
	}
	
	//AT-4715
	public boolean isIntuitionStatusHold() {
<span class="nc" id="L545">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L546">		FundsInCreateResponse response = messageExchange.getResponse(FundsInCreateResponse.class);</span>
<span class="nc" id="L547">		boolean status = false;</span>
		
<span class="nc bnc" id="L549" title="All 2 branches missed.">		if (!response.getStatus().equalsIgnoreCase(FundsInComplianceStatus.HOLD.name())) </span>
<span class="nc" id="L550">			status = true;</span>
		
<span class="nc" id="L552">		return status;</span>
	}
	
	//AT-4716
	public boolean isIntuitionFundsOutStatusHold() {
<span class="nc" id="L557">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L558">		FundsOutResponse response = messageExchange.getResponse(FundsOutResponse.class);</span>
<span class="nc" id="L559">		boolean status = false;</span>
		
<span class="nc bnc" id="L561" title="All 2 branches missed.">		if (!response.getStatus().equalsIgnoreCase(FundsOutComplianceStatus.HOLD.name())) </span>
<span class="nc" id="L562">			status = true;</span>
		
<span class="nc" id="L564">		return status;</span>
	}
	
	/**
	 * Checks if is intuition MQ status hold.
	 *
	 * @return true, if is intuition MQ status hold
	 */
	public boolean isIntuitionMQStatusHold() {
<span class="nc" id="L573">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L574">		TransactionMonitoringMQRequest transactionMonitoringMQRequest = (TransactionMonitoringMQRequest) messageExchange</span>
<span class="nc" id="L575">				.getRequest();</span>
<span class="nc" id="L576">		MessageExchange exchange = this.getMessageExchange(ServiceTypeEnum.TRANSACTION_MONITORING_MQ_RESEND);</span>

<span class="nc" id="L578">		boolean status = false;</span>

<span class="nc bnc" id="L580" title="All 2 branches missed.">		if (transactionMonitoringMQRequest.getRequestType().equalsIgnoreCase(&quot;payment_in&quot;)</span>
<span class="nc bnc" id="L581" title="All 2 branches missed.">				|| transactionMonitoringMQRequest.getRequestType().equalsIgnoreCase(&quot;payment_in_update&quot;)) {</span>
<span class="nc" id="L582">			TransactionMonitoringMQServiceResponse mqResponse = (TransactionMonitoringMQServiceResponse) exchange</span>
<span class="nc" id="L583">					.getResponse();</span>
<span class="nc" id="L584">			TransactionMonitoringPaymentInResponse response = mqResponse.getTransactionMonitoringPaymentInResponse();</span>
<span class="nc bnc" id="L585" title="All 2 branches missed.">			if (!response.getPaymentStatus().equalsIgnoreCase(FundsInComplianceStatus.HOLD.name()))</span>
<span class="nc" id="L586">				status = true;</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">		} else if (transactionMonitoringMQRequest.getRequestType().equalsIgnoreCase(&quot;payment_out&quot;)</span>
<span class="nc bnc" id="L588" title="All 2 branches missed.">				|| transactionMonitoringMQRequest.getRequestType().equalsIgnoreCase(&quot;payment_out_update&quot;)) {</span>
<span class="nc" id="L589">			TransactionMonitoringMQServiceResponse mqResponse = (TransactionMonitoringMQServiceResponse) exchange</span>
<span class="nc" id="L590">					.getResponse();</span>
<span class="nc" id="L591">			TransactionMonitoringPaymentOutResponse response = mqResponse.getTransactionMonitoringPaymentOutResponse();</span>
<span class="nc bnc" id="L592" title="All 2 branches missed.">			if (!response.getPaymentStatus().equalsIgnoreCase(FundsOutComplianceStatus.HOLD.name()))</span>
<span class="nc" id="L593">				status = true;</span>
		}

<span class="nc" id="L596">		return status;</span>
	}

	
	/**
	 * Checks if is intuition status update eligible.
	 *
	 * @return true, if is intuition status update eligible
	 */
	//AT-4749
	public boolean isIntuitionStatusUpdateEligible() {
<span class="nc" id="L607">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L608">		IntuitionPaymentStatusUpdateRequest request = (IntuitionPaymentStatusUpdateRequest) messageExchange</span>
<span class="nc" id="L609">				.getRequest();</span>
<span class="nc" id="L610">		IntuitionPaymentStatusUpdateResponse response = (IntuitionPaymentStatusUpdateResponse) messageExchange</span>
<span class="nc" id="L611">				.getResponse();</span>
<span class="nc" id="L612">		boolean decision = false;</span>
<span class="nc" id="L613">		String paymentStatus = &quot;&quot;;</span>

<span class="nc bnc" id="L615" title="All 2 branches missed.">		if (request.getTrxType().equalsIgnoreCase(&quot;FUNDSIN&quot;)) {</span>
<span class="nc" id="L616">			FundsInCreateRequest fundsInRequest = (FundsInCreateRequest) request</span>
<span class="nc" id="L617">					.getAdditionalAttribute(&quot;fundsInRequest&quot;);</span>
<span class="nc" id="L618">			paymentStatus = (String) fundsInRequest.getAdditionalAttribute(&quot;status&quot;);</span>
<span class="nc" id="L619">		} else {</span>
<span class="nc" id="L620">			FundsOutRequest fundsOutRequest = (FundsOutRequest) request.getAdditionalAttribute(&quot;fundsOutRequest&quot;);</span>
<span class="nc" id="L621">			paymentStatus = (String) fundsOutRequest.getAdditionalAttribute(&quot;status&quot;);</span>
		}
		
<span class="nc bnc" id="L624" title="All 4 branches missed.">		if (response.getPaymentStatus() != null &amp;&amp; !response.getPaymentStatus().equalsIgnoreCase(paymentStatus))</span>
<span class="nc" id="L625">			decision = true;</span>

<span class="nc" id="L627">		return decision;</span>
	}
	
	/**
	 * Payment TM transform.
	 *
	 * @return the string
	 */
	//AT-4749
	public String paymentTMTransform() {
<span class="nc" id="L637">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L638">		IntuitionPaymentStatusUpdateRequest request = (IntuitionPaymentStatusUpdateRequest) messageExchange</span>
<span class="nc" id="L639">				.getRequest();</span>
		
<span class="nc bnc" id="L641" title="All 2 branches missed.">		if (request.getTrxType().equalsIgnoreCase(&quot;FUNDSIN&quot;)) {</span>
<span class="nc" id="L642">			FundsInCreateRequest fundsInRequest = (FundsInCreateRequest) request</span>
<span class="nc" id="L643">					.getAdditionalAttribute(&quot;fundsInRequest&quot;);</span>
<span class="nc" id="L644">			messageExchange.setRequest(fundsInRequest);</span>
<span class="nc" id="L645">		} else {</span>
<span class="nc" id="L646">			FundsOutRequest fundsOutRequest = (FundsOutRequest) request.getAdditionalAttribute(&quot;fundsOutRequest&quot;);</span>
<span class="nc" id="L647">			messageExchange.setRequest(fundsOutRequest);</span>
		}
		
<span class="nc" id="L650">		return request.getTrxType();</span>
	}
	
	/**
	 * Checks if is intuition payment historic data saved.
	 *
	 * @return true, if is intuition payment historic data saved
	 */
	//AT-5264
	public boolean isIntuitionPaymentHistoricDataSaved() {
<span class="nc" id="L660">		MessageExchange messageExchange = this.getGatewayMessageExchange();</span>
<span class="nc" id="L661">		IntuitionHistoricPaymentsRequest intuitionPaymentRequest = (IntuitionHistoricPaymentsRequest) messageExchange</span>
<span class="nc" id="L662">				.getRequest();</span>

<span class="nc" id="L664">		boolean paymentInLocalSaveFlag = (boolean) intuitionPaymentRequest</span>
<span class="nc" id="L665">				.getAdditionalAttribute(&quot;IntuitionHistoricPaymentInLocalSave&quot;);</span>
<span class="nc" id="L666">		boolean paymentOutLocalSaveFlag = (boolean) intuitionPaymentRequest</span>
<span class="nc" id="L667">				.getAdditionalAttribute(&quot;IntuitionHistoricPaymentOutLocalSave&quot;);</span>

<span class="nc bnc" id="L669" title="All 4 branches missed.">		return paymentInLocalSaveFlag || paymentOutLocalSaveFlag;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>