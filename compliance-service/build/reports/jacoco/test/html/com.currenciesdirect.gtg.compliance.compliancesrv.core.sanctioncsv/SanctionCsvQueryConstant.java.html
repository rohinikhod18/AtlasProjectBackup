<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SanctionCsvQueryConstant.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.compliancesrv.core.sanctioncsv</a> &gt; <span class="el_source">SanctionCsvQueryConstant.java</span></div><h1>SanctionCsvQueryConstant.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.compliancesrv.core.sanctioncsv;

<span class="nc" id="L3">@SuppressWarnings({&quot;squid:S2479&quot;,&quot;squid:S1192&quot;})</span>
public enum SanctionCsvQueryConstant {

<span class="nc" id="L6">	GET_PFX_DETAILS(&quot;SELECT a.TradeAccountNumber AS TradeAccountNumber, \n&quot; + </span>
			&quot;	a.ID AS AccountID, \n&quot; + 
			&quot;	a.CreatedOn AS AccountCreatedOn,  \n&quot; + 
			&quot;	MAX(c.CreatedOn) AS LatestContactCreatedOn, \n&quot; + 
			&quot;	MAX(pin.CreatedOn) AS LatestPaymentInCreatedOn,  \n&quot; + 
			&quot;	MAX(pout.CreatedOn) AS LatestPaymentOutCreatedOn\n&quot; + 
			&quot;INTO #PFXFinalFilterList\n&quot; + 
			&quot;FROM Comp.Account a WITH (NOLOCK)\n&quot; + 
			&quot;LEFT JOIN Comp.Contact c WITH (NOLOCK) ON a.ID = c.AccountID\n&quot; + 
			&quot;LEFT JOIN Comp.PaymentIn pin WITH (NOLOCK) ON a.ID = pin.AccountID\n&quot; + 
			&quot;LEFT JOIN Comp.PaymentOut pout WITH (NOLOCK) ON a.ID = pout.AccountID\n&quot; + 
			&quot;WHERE a.[Type] IN (2) -- (2) PFX \n&quot; + 
			&quot;AND a.CreatedOn &lt; ?\n&quot; + 
			&quot;GROUP BY a.TradeAccountNumber, a.ID, a.CreatedOn\n&quot; + 
			&quot;SELECT DISTINCT(fl.AccountID), c.ID as ContactID, fl.TradeAccountNumber,\n&quot; + 
			&quot;	JSON_VALUE(ca.[ATTRIBUTES], '$.first_name') + ' ' + JSON_VALUE(ca.[ATTRIBUTES], '$.last_name') AS FullName,\n&quot; + 
			&quot;	JSON_VALUE(ca.[ATTRIBUTES], '$.dob') AS dob,\n&quot; + 
			&quot;	JSON_VALUE(esl.Summary, '$.sanctionId') AS Contact_SanctionID,\n&quot; + 
			&quot;	ct.DisplayName AS Citizenship\n&quot; + 
			&quot;FROM #PFXFinalFilterList fl\n&quot; + 
			&quot;JOIN Contact c WITH (NOLOCK) ON fl.AccountID = c.AccountID\n&quot; + 
			&quot;JOIN ContactAttribute ca WITH (NOLOCK) ON c.ID = ca.ID\n&quot; + 
			&quot;JOIN Country ct WITH (NOLOCK) ON c.Country = ct.ID\n&quot; + 
			&quot;JOIN Event e WITH (NOLOCK) ON fl.AccountID = e.AccountID AND e.EventType = 1\n&quot; + 
			&quot;JOIN EventServiceLog esl WITH (NOLOCK) ON e.id = esl.EventID AND esl.ServiceType = 7 AND ca.ID = esl.EntityID\n&quot; + 
			&quot;WHERE LatestContactCreatedOn IS NULL  OR LatestContactCreatedOn &lt; ?\n&quot; + 
			&quot;	AND LatestPaymentInCreatedOn IS NULL OR LatestPaymentInCreatedOn &lt; ?\n&quot; + 
			&quot;	AND LatestPaymentOutCreatedOn IS NULL OR LatestPaymentOutCreatedOn &lt; ?&quot;),

<span class="nc" id="L35">	GET_CFX_ACCOUNT_DETAILS(&quot;SELECT a.TradeAccountNumber AS TradeAccountNumber, \n&quot; + </span>
			&quot;	a.ID AS AccountID, \n&quot; + 
			&quot;	a.CreatedOn AS AccountCreatedOn,  \n&quot; + 
			&quot;	MAX(c.CreatedOn) AS LatestContactCreatedOn, \n&quot; + 
			&quot;	MAX(pin.CreatedOn) AS LatestPaymentInCreatedOn,  \n&quot; + 
			&quot;	MAX(pout.CreatedOn) AS LatestPaymentOutCreatedOn\n&quot; + 
			&quot;INTO #CFXAccountFinalFilterList\n&quot; + 
			&quot;FROM Comp.Account a WITH (NOLOCK)\n&quot; + 
			&quot;LEFT JOIN Comp.Contact c WITH (NOLOCK) ON a.ID = c.AccountID\n&quot; + 
			&quot;LEFT JOIN Comp.PaymentIn pin WITH (NOLOCK) ON a.ID = pin.AccountID\n&quot; + 
			&quot;LEFT JOIN Comp.PaymentOut pout WITH (NOLOCK) ON a.ID = pout.AccountID\n&quot; + 
			&quot;WHERE a.[Type] IN (1,3) -- (1,3) CFX \n&quot; + 
			&quot;AND a.CreatedOn &lt; ?\n&quot; + 
			&quot;GROUP BY a.TradeAccountNumber, a.ID, a.CreatedOn\n&quot; + 
			&quot;SELECT DISTINCT(fl.AccountID), c.ID as ContactID, fl.TradeAccountNumber,\n&quot; + 
			&quot;	JSON_VALUE(ca.[ATTRIBUTES], '$.first_name') + ' ' + JSON_VALUE(ca.[ATTRIBUTES], '$.last_name') AS FullName,\n&quot; + 
			&quot;	JSON_VALUE(ca.[ATTRIBUTES], '$.dob') AS dob,\n&quot; + 
			&quot;	JSON_VALUE(esl.Summary, '$.sanctionId') AS Contact_SanctionID,\n&quot; + 
			&quot;	ct.DisplayName AS Citizenship\n&quot; + 
			&quot;FROM #CFXAccountFinalFilterList fl\n&quot; + 
			&quot;JOIN Contact c WITH (NOLOCK) ON fl.AccountID = c.AccountID\n&quot; + 
			&quot;JOIN ContactAttribute ca WITH (NOLOCK) ON c.ID = ca.ID\n&quot; + 
			&quot;JOIN Country ct WITH (NOLOCK) ON c.Country = ct.ID\n&quot; + 
			&quot;JOIN Event e WITH (NOLOCK) ON fl.AccountID = e.AccountID AND e.EventType = 1\n&quot; + 
			&quot;JOIN EventServiceLog esl WITH (NOLOCK) ON e.id = esl.EventID AND esl.ServiceType = 7 AND esl.EntityID = fl.AccountID\n&quot; + 
			&quot;WHERE LatestContactCreatedOn IS NULL  OR LatestContactCreatedOn &lt; ?\n&quot; + 
			&quot;	AND LatestPaymentInCreatedOn IS NULL OR LatestPaymentInCreatedOn &lt; ?\n&quot; + 
			&quot;	AND LatestPaymentOutCreatedOn IS NULL OR LatestPaymentOutCreatedOn &lt; ?&quot;),
			
<span class="nc" id="L64">	GET_CFX_CONTACT_DETAILS(&quot;SELECT a.TradeAccountNumber AS TradeAccountNumber, \n&quot; + </span>
			&quot;	a.ID AS AccountID, \n&quot; + 
			&quot;	a.CreatedOn AS AccountCreatedOn,  \n&quot; + 
			&quot;	MAX(c.CreatedOn) AS LatestContactCreatedOn, \n&quot; + 
			&quot;	MAX(pin.CreatedOn) AS LatestPaymentInCreatedOn,  \n&quot; + 
			&quot;	MAX(pout.CreatedOn) AS LatestPaymentOutCreatedOn\n&quot; + 
			&quot;INTO #CFXContactFinalFilterList\n&quot; + 
			&quot;FROM Comp.Account a WITH (NOLOCK)\n&quot; + 
			&quot;LEFT JOIN Comp.Contact c WITH (NOLOCK) ON a.ID = c.AccountID\n&quot; + 
			&quot;LEFT JOIN Comp.PaymentIn pin WITH (NOLOCK) ON a.ID = pin.AccountID\n&quot; + 
			&quot;LEFT JOIN Comp.PaymentOut pout WITH (NOLOCK) ON a.ID = pout.AccountID\n&quot; + 
			&quot;WHERE a.[Type] IN (1,3) -- (1,3) CFX \n&quot; + 
			&quot;AND a.CreatedOn &lt; ?\n&quot; + 
			&quot;GROUP BY a.TradeAccountNumber, a.ID, a.CreatedOn\n&quot; + 
			&quot;SELECT DISTINCT(fl.AccountID), c.ID as ContactID, fl.TradeAccountNumber,\n&quot; + 
			&quot;	JSON_VALUE(ca.[ATTRIBUTES], '$.first_name') + ' ' + JSON_VALUE(ca.[ATTRIBUTES], '$.last_name') AS FullName,\n&quot; + 
			&quot;	JSON_VALUE(ca.[ATTRIBUTES], '$.dob') AS dob,\n&quot; + 
			&quot;	JSON_VALUE(esl.Summary, '$.sanctionId') AS Contact_SanctionID,\n&quot; + 
			&quot;	ct.DisplayName AS Citizenship\n&quot; + 
			&quot;FROM #CFXContactFinalFilterList fl\n&quot; + 
			&quot;JOIN Contact c WITH (NOLOCK) ON fl.AccountID = c.AccountID\n&quot; + 
			&quot;JOIN ContactAttribute ca WITH (NOLOCK) ON c.ID = ca.ID\n&quot; + 
			&quot;JOIN Country ct WITH (NOLOCK) ON c.Country = ct.ID\n&quot; + 
			&quot;JOIN Event e WITH (NOLOCK) ON fl.AccountID = e.AccountID AND e.EventType = 1\n&quot; + 
			&quot;JOIN EventServiceLog esl WITH (NOLOCK) ON e.id = esl.EventID AND esl.ServiceType = 7 AND ca.ID = esl.EntityID\n&quot; + 
			&quot;WHERE LatestContactCreatedOn IS NULL  OR LatestContactCreatedOn &lt; ?\n&quot; + 
			&quot;	AND LatestPaymentInCreatedOn IS NULL OR LatestPaymentInCreatedOn &lt; ?\n&quot; + 
			&quot;	AND LatestPaymentOutCreatedOn IS NULL OR LatestPaymentOutCreatedOn &lt; ?&quot;),
	
<span class="nc" id="L93">	GET_DEBTOR_DETAILS(&quot;WITH FundsInEvents(FundsInEventsID) AS (\n&quot; + </span>
			&quot;		SELECT ID\n&quot; + 
			&quot;		From Comp.Event WITH (NOLOCK)\n&quot; + 
			&quot;		WHERE EventType = 6 --FundsIn\n&quot; + 
			&quot;),\n&quot; + 
			&quot;DebtorSanctionESL(PaymentID, SanctionID) AS (\n&quot; + 
			&quot;		SELECT esl.EntityID,\n&quot; + 
			&quot;		JSON_VALUE(esl.ProviderResponse, '$.sanctionId') sanctionId\n&quot; + 
			&quot;		FROM Comp.EventServiceLog AS esl WITH (NOLOCK) \n&quot; + 
			&quot;		JOIN FundsInEvents ON FundsInEventsID = esl.EventID\n&quot; + 
			&quot;		WHERE esl.ServiceType = 7 --Sanction\n&quot; + 
			&quot;		AND esl.EntityType = 5  --Debtor\n&quot; + 
			&quot;),\n&quot; + 
			&quot;ThirdPartyPayInDetails(TPPaymentInAttributeID, TradeAccountNumber, DebtorName, CountryOfFund) AS \n&quot; + 
			&quot;(\n&quot; + 
			&quot;	    SELECT ID, \n&quot; + 
			&quot;		JSON_VALUE(pia.[Attributes], '$.trade.trade_account_number'),\n&quot; + 
			&quot;		JSON_VALUE(pia.[Attributes], '$.trade.debtor_name'),\n&quot; + 
			&quot;		JSON_VALUE(pia.[Attributes], '$.trade.country_of_fund')\n&quot; + 
			&quot;	    FROM Comp.PaymentInAttribute pia\n&quot; + 
			&quot;	    WHERE pia.vThirdPartyPayment = 1 \n&quot; + 
			&quot;)\n&quot; + 
			&quot;SELECT SanctionID, TradeAccountNumber, DebtorName AS 'FullName', c.DisplayName AS Citizenship,\n&quot; + 
			&quot;	'' AS dob\n&quot; + 
			&quot;FROM ThirdPartyPayInDetails tppid\n&quot; + 
			&quot;JOIN DebtorSanctionESL dsesl ON tppid.TPPaymentInAttributeID = dsesl.PaymentID\n&quot; + 
			&quot;JOIN Comp.Country c ON CountryOfFund = c.Code \n&quot; + 
			&quot;WHERE DebtorName IS NOT NULL \n&quot; + 
			&quot;	AND DebtorName != ''\n&quot; + 
			&quot;	AND SanctionID != 'Not Available'&quot;),
	
<span class="nc" id="L124">	GET_WATCHLIST_ID(&quot; SELECT [Id] as Reason FROM [Watchlist] WHERE Reason = ?&quot;),</span>
	
<span class="nc" id="L126">	CHECK_CONTACT_EXISTS_IN_CONTACTWATCHLIST(&quot;SELECT contact as ContactID FROM ContactWatchList cwl WHERE REASON=?&quot;),</span>
	
<span class="nc" id="L128">	INSERT_INACTIVE_FINSCAN_WATCHLIST(&quot;INSERT INTO [ContactWatchList](Reason,Contact,CreatedBy,CreatedOn) VALUES(?, ?, ?, ?)&quot;);</span>

	private String query;

<span class="nc" id="L132">	SanctionCsvQueryConstant(String query) {</span>
<span class="nc" id="L133">		this.query = query;</span>

<span class="nc" id="L135">	}</span>

	public String getQuery() {
<span class="nc" id="L138">		return this.query; </span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>