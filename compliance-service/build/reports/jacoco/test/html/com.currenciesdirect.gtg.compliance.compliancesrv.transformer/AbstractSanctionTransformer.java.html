<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractSanctionTransformer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.compliancesrv.transformer</a> &gt; <span class="el_source">AbstractSanctionTransformer.java</span></div><h1>AbstractSanctionTransformer.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.compliancesrv.transformer;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.List;

import com.currenciesdirect.gtg.compliance.commons.domain.sanction.SanctionContactRequest;
import com.currenciesdirect.gtg.compliance.commons.domain.sanction.SanctionContactResponse;
import com.currenciesdirect.gtg.compliance.commons.domain.sanction.SanctionSummary;
import com.currenciesdirect.gtg.compliance.compliancesrv.ComplianceException;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.ProvideCacheLoader;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.SanctionCategoryEnum;
import com.currenciesdirect.gtg.compliance.compliancesrv.core.ServiceStatus;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.Account;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.Company;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.Contact;
import com.currenciesdirect.gtg.compliance.compliancesrv.domain.reg.EventServiceLog;
import com.currenciesdirect.gtg.compliance.compliancesrv.util.Constants;
import com.currenciesdirect.gtg.compliance.compliancesrv.util.JsonConverterUtil;
import com.currenciesdirect.gtg.compliance.compliancesrv.util.StringUtils;

<span class="nc" id="L22">public abstract class AbstractSanctionTransformer extends AbstractTransformer{</span>
	
	
	protected List&lt;SanctionContactRequest&gt; createContactRequest(String orgID, List&lt;Contact&gt; contacts,
			ProvideCacheLoader cacheLoader, String category) throws ComplianceException {
<span class="nc" id="L27">		List&lt;SanctionContactRequest&gt; contactList = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L28" title="All 2 branches missed.">		for (Contact contact : contacts) {</span>
<span class="nc bnc" id="L29" title="All 2 branches missed.">			if (contact.isSanctionEligible()) {</span>
<span class="nc" id="L30">				String countryName = cacheLoader</span>
<span class="nc bnc" id="L31" title="All 2 branches missed.">						.getCountryFullName(null != contact.getCountry() ? contact.getCountry() : &quot;&quot;);</span>
<span class="nc" id="L32">				SanctionContactRequest sanctionContact = new SanctionContactRequest();</span>
<span class="nc bnc" id="L33" title="All 2 branches missed.">				if (null != countryName) {</span>
<span class="nc" id="L34">					sanctionContact.setCountry(countryName);</span>
				}
<span class="nc" id="L36">				sanctionContact.setDob(contact.getDob());</span>
<span class="nc" id="L37">				sanctionContact.setFullName(contact.getFullName());</span>
<span class="nc" id="L38">				sanctionContact.setGender(contact.getGender());</span>
<span class="nc" id="L39">				StringBuilder sanctionID = new StringBuilder();</span>
<span class="nc" id="L40">				sanctionID.append(orgID).append(&quot;-C-&quot;).append(StringUtils.leftPadWithZero(10, contact.getId()));</span>
<span class="nc" id="L41">				sanctionContact.setSanctionId(sanctionID.toString());</span>
<span class="nc" id="L42">				sanctionContact.setContactId(contact.getId());</span>
<span class="nc" id="L43">				sanctionContact.setIsExisting(contact.isSanctionPerformed());</span>
<span class="nc" id="L44">				sanctionContact.setCategory(category);</span>
<span class="nc" id="L45">				contactList.add(sanctionContact);</span>
			}
<span class="nc" id="L47">		}</span>
<span class="nc" id="L48">		return contactList;</span>
	}
	
	protected SanctionContactRequest createCompanyCFXRequest(String orgID, Account account,
			ProvideCacheLoader cacheLoader,String sanctionCategory) throws ComplianceException {
<span class="nc" id="L53">		SanctionContactRequest sanctionContact = null;</span>
<span class="nc" id="L54">		Company company = account.getCompany();</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">		if (company.isSanctionEligible()) {</span>
<span class="nc" id="L56">			String countryName = cacheLoader.getCountryFullName(</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">					null != company.getCountryOfEstablishment() ? company.getCountryOfEstablishment() : &quot;&quot;);</span>
<span class="nc" id="L58">			sanctionContact = new SanctionContactRequest();</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">			if (null != countryName) {</span>
<span class="nc" id="L60">				sanctionContact.setCountry(countryName);</span>
			}
<span class="nc" id="L62">			sanctionContact.setFullName(account.getAccountName());</span>
<span class="nc" id="L63">			StringBuilder sanctionID = new StringBuilder();</span>
<span class="nc" id="L64">			sanctionID.append(orgID).append(&quot;-A-&quot;).append(StringUtils.leftPadWithZero(10, account.getId()));</span>
<span class="nc" id="L65">			sanctionContact.setSanctionId(sanctionID.toString());</span>
<span class="nc" id="L66">			sanctionContact.setContactId(account.getId());</span>
<span class="nc" id="L67">			sanctionContact.setIsExisting(company.isSanctionPerformed());</span>
<span class="nc" id="L68">			sanctionContact.setCategory(sanctionCategory);</span>

		}
<span class="nc" id="L71">		return sanctionContact;</span>
	}
	
	protected List&lt;SanctionContactResponse&gt; createContactResponse(List&lt;Contact&gt; contacts) {
		
<span class="nc" id="L76">		return createContactResponse(contacts,ServiceStatus.NOT_PERFORMED);</span>
	}
	
	protected List&lt;SanctionContactResponse&gt; createContactResponse(List&lt;Contact&gt; contacts,ServiceStatus status) {
<span class="nc" id="L80">		List&lt;SanctionContactResponse&gt; contactResponses = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">		for (Contact contact : contacts) {</span>
<span class="nc" id="L82">			SanctionContactResponse response = new SanctionContactResponse();</span>
			/**Update Account set status to NOT_REQUIRED when contact.isSanctionEligible() is False : Laxmi B*/
<span class="nc bnc" id="L84" title="All 2 branches missed.">			if(contact.isSanctionEligible()){</span>
<span class="nc" id="L85">				response.setStatus(status.name());</span>
			} else {
<span class="nc" id="L87">				response.setStatus(ServiceStatus.NOT_REQUIRED.name());</span>
			}
			/**************************************************************/
<span class="nc" id="L90">			response.setContactId(contact.getId());</span>
<span class="nc" id="L91">			contactResponses.add(response);</span>
<span class="nc" id="L92">		}</span>
<span class="nc" id="L93">		return contactResponses;</span>
	}
	
	protected SanctionContactResponse createCFXResponse(Account account,ServiceStatus status) {
		
<span class="nc" id="L98">		SanctionContactResponse response = new SanctionContactResponse();</span>
<span class="nc" id="L99">		response.setContactId(account.getId());</span>
<span class="nc" id="L100">		response.setStatus(status.name());</span>
		
<span class="nc" id="L102">	return response;</span>
}
	
	protected SanctionSummary createSanctionSummary(String ofacList, String worldCheck, String sanctionID, String status) {
<span class="nc" id="L106">		SanctionSummary sanctionSummary = new SanctionSummary();</span>
<span class="nc" id="L107">		sanctionSummary.setOfacList(ofacList);</span>
<span class="nc" id="L108">		sanctionSummary.setWorldCheck(worldCheck);</span>
<span class="nc" id="L109">		sanctionSummary.setSanctionId(sanctionID);</span>
<span class="nc" id="L110">		sanctionSummary.setStatus(status);</span>
<span class="nc" id="L111">		sanctionSummary.setUpdatedOn(new Timestamp(System.currentTimeMillis()).toString());</span>
<span class="nc" id="L112">		return sanctionSummary;</span>
	}

	protected void updateResponseInEventLog(EventServiceLog eventServiceLog, String providerResponse, String status, 
			SanctionSummary sanctionSummary) {
<span class="nc" id="L117">		eventServiceLog.setProviderResponse(providerResponse);</span>
<span class="nc" id="L118">		eventServiceLog.setStatus(status);</span>
<span class="nc" id="L119">		eventServiceLog.setUpdatedOn(new Timestamp(System.currentTimeMillis()));</span>
<span class="nc" id="L120">		eventServiceLog.setSummary(JsonConverterUtil.convertToJsonWithoutNull(sanctionSummary));</span>
<span class="nc" id="L121">		eventServiceLog.setEventServiceLogId(eventServiceLog.getEventServiceLogId());</span>
<span class="nc" id="L122">	}</span>

	protected static String leftPadWithZero(Integer id){
<span class="nc" id="L125">		String pad = &quot;0000000000&quot;;</span>
<span class="nc" id="L126">		return (pad+id).substring((pad+id).length()-10);</span>
	}
	
	protected void createEventServiceLogForServiceFailure(EventServiceLog eventServiceLog, Object response ){
<span class="nc" id="L130">		createEventServiceLogOnFailure(eventServiceLog, response);</span>
<span class="nc" id="L131">	}</span>

	protected void createEventServiceLogOnFailure(EventServiceLog eventServiceLog, Object response) {
<span class="nc" id="L134">		SanctionSummary sanctionSummery = new SanctionSummary();</span>
<span class="nc" id="L135">		sanctionSummery.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L136">		sanctionSummery.setWorldCheck(Constants.NOT_AVAILABLE);</span>
<span class="nc" id="L137">		sanctionSummery.setOfacList(Constants.NOT_AVAILABLE);</span>
<span class="nc" id="L138">		sanctionSummery.setUpdatedOn(new Timestamp(System.currentTimeMillis()).toString());</span>
<span class="nc" id="L139">		eventServiceLog.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L140">		eventServiceLog.setSummary(JsonConverterUtil.convertToJsonWithoutNull(sanctionSummery));</span>
<span class="nc" id="L141">		eventServiceLog.setProviderResponse(JsonConverterUtil.convertToJsonWithoutNull(response));</span>
<span class="nc" id="L142">	}</span>
	
	protected void createEventServiceLogForServiceFailureWithSanctionID(EventServiceLog eventServiceLog, Object response, String sanctionID ){
<span class="nc" id="L145">		SanctionSummary sanctionSummery = new SanctionSummary();</span>
<span class="nc" id="L146">		sanctionSummery.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L147">		sanctionSummery.setUpdatedOn(new Timestamp(System.currentTimeMillis()).toString());</span>
<span class="nc" id="L148">		sanctionSummery.setWorldCheck(Constants.NOT_AVAILABLE);</span>
<span class="nc" id="L149">		sanctionSummery.setOfacList(Constants.NOT_AVAILABLE);</span>
<span class="nc" id="L150">		sanctionSummery.setSanctionId(sanctionID);</span>
<span class="nc" id="L151">		eventServiceLog.setStatus(ServiceStatus.SERVICE_FAILURE.name());</span>
<span class="nc" id="L152">		eventServiceLog.setSummary(JsonConverterUtil.convertToJsonWithoutNull(sanctionSummery));</span>
<span class="nc" id="L153">		eventServiceLog.setProviderResponse(JsonConverterUtil.convertToJsonWithoutNull(response));</span>
<span class="nc" id="L154">	}</span>
	
	/**
	 * create sanction contact response
	 * @author abhijeetg
	 * @param contact
	 * @param status
	 * @return
	 */
	protected SanctionContactResponse createContactResponse(Contact contact,ServiceStatus status,String orgID) {
<span class="nc" id="L164">		String sanctionID = createReferenceId(orgID,Constants.ENTITY_TYPE_CONTACT,contact.getId()+&quot;&quot;);</span>
<span class="nc" id="L165">			SanctionContactResponse response = new SanctionContactResponse();</span>
<span class="nc" id="L166">			response.setContactId(contact.getId());</span>
<span class="nc" id="L167">			response.setSanctionId(sanctionID);</span>
<span class="nc" id="L168">			response.setStatus(status.name());</span>
<span class="nc" id="L169">		return response;</span>
	}
	
	/**
	 * Gets the account sanction category.
	 *
	 * @return the account sanction category
	 */
	protected String getAccountSanctionCategory(){
<span class="nc" id="L178">		return SanctionCategoryEnum.ORGANIZATION.getValue();</span>
	}
	
	/**
	 * Gets the contact sanction category.
	 *
	 * @return the contact sanction category
	 */
	protected String getContactSanctionCategory(){
<span class="nc" id="L187">		return SanctionCategoryEnum.INDIVIDUAL.getValue();</span>
	}
	
	/**
	 * Gets the bank sanction category.
	 *
	 * @return the bank sanction category
	 */
	protected String getBankSanctionCategory(){
<span class="nc" id="L196">		return SanctionCategoryEnum.ORGANIZATION.getValue();</span>
	}
	
	/**
	 * Gets the beneficiary sanction category.
	 *
	 * @param beneficiaryType the beneficiary type
	 * @return the beneficiary sanction category
	 */
	protected String getBeneficiarySanctionCategory(String beneficiaryType){
		
<span class="nc bnc" id="L207" title="All 2 branches missed.">		if(StringUtils.isNullOrTrimEmpty(beneficiaryType)  </span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">				|| beneficiaryType.equalsIgnoreCase(SanctionCategoryEnum.INDIVIDUAL.getValue())){</span>
<span class="nc" id="L209">			return SanctionCategoryEnum.INDIVIDUAL.getValue();</span>
		}
<span class="nc" id="L211">		return SanctionCategoryEnum.ORGANIZATION.getValue();	</span>
	}
	
	protected String getDebtorSanctionCategory(){
<span class="nc" id="L215">		return SanctionCategoryEnum.INDIVIDUAL.getValue();</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>