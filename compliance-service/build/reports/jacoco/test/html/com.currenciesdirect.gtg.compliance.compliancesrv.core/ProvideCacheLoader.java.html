<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProvideCacheLoader.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">compliance-service</a> &gt; <a href="index.source.html" class="el_package">com.currenciesdirect.gtg.compliance.compliancesrv.core</a> &gt; <span class="el_source">ProvideCacheLoader.java</span></div><h1>ProvideCacheLoader.java</h1><pre class="source lang-java linenums">package com.currenciesdirect.gtg.compliance.compliancesrv.core;

import java.util.concurrent.ConcurrentMap;

import org.slf4j.Logger;

import com.currenciesdirect.gtg.compliance.commons.domain.config.ProviderConfigCache;
import com.currenciesdirect.gtg.compliance.commons.domain.config.ProviderProperty;
import com.currenciesdirect.gtg.compliance.compliancesrv.ComplianceException;
import com.currenciesdirect.gtg.compliance.compliancesrv.InternalProcessingCode;
import com.currenciesdirect.gtg.compliance.compliancesrv.dbport.ConfigDBService;

/**
 * The Class ProvideCacheLoader.
 */
public class ProvideCacheLoader {

	/** The Constant LOG. */
<span class="nc" id="L19">	private static final Logger LOG = org.slf4j.LoggerFactory.getLogger(ProvideCacheLoader.class);</span>
	
	/** The instance. */
	private static ProvideCacheLoader instance;

	/** The provider config. */
<span class="nc" id="L25">	private ProviderConfigCache providerConfig = new ProviderConfigCache();</span>
	
	/** The country code config cache. */
<span class="nc" id="L28">	private ProviderConfigCache countryCodeConfigCache = new ProviderConfigCache();</span>
	
	/** The user id config cache. */
<span class="nc" id="L31">	private ProviderConfigCache userIdConfigCache = new ProviderConfigCache();</span>
	
	/** The country edd number. */
<span class="nc" id="L34">	private ProviderConfigCache countryEddNumber = new ProviderConfigCache();</span>

	/** The country state cache. */
<span class="nc" id="L37">	private ProviderConfigCache countryStateCache = new ProviderConfigCache();//AT-3719</span>
	
	/** The country short code cache. */
<span class="nc" id="L40">	private ProviderConfigCache countryShortCodeCache = new ProviderConfigCache();//AT-4666</span>
	
	/**
	 * Instantiates a new provide cache loader.
	 */
<span class="nc" id="L45">	private ProvideCacheLoader() {</span>
<span class="nc" id="L46">	}</span>

	/**
	 * Gets the single instance of ProvideCacheLoader.
	 *
	 * @return single instance of ProvideCacheLoader
	 */
	public static ProvideCacheLoader getInstance() {
<span class="nc bnc" id="L54" title="All 2 branches missed.">		if (instance == null) {</span>
<span class="nc" id="L55">			instance = new ProvideCacheLoader();</span>
<span class="nc" id="L56">			loadCache(instance);</span>
		}
<span class="nc" id="L58">		return instance;</span>
	}
	

	/**
	 * Gets the provider config.
	 *
	 * @return the provider config
	 */
	public ProviderConfigCache getProviderConfig() {
<span class="nc" id="L68">		return providerConfig;</span>
	}
	
	/**
	 * Gets the country config.
	 *
	 * @return the country config
	 */
	public ProviderConfigCache getCountryConfig() {
<span class="nc" id="L77">		return countryCodeConfigCache;</span>
	}
	
	/**
	 * added under AT-2248-unrelated to any jira
	 * Gets the user id config.
	 *
	 * @return the user id config
	 */
	public ProviderConfigCache getUserIdConfig() {
<span class="nc" id="L87">		return userIdConfigCache;</span>
	}
	
	/**
	 * Gets the country edd number.
	 *
	 * @return the country edd number
	 */
	public ProviderConfigCache getCountryEddNumber() {
<span class="nc" id="L96">		return countryEddNumber;</span>
	}

	/**
	 * Gets the country state cache.
	 *
	 * @return the country state cache
	 */
	public ProviderConfigCache getCountryStateCache() {
<span class="nc" id="L105">		return countryStateCache;</span>
	}
	
	/**
	 * Gets the country short code cache.
	 *
	 * @return the country short code cache
	 */
	public ProviderConfigCache getCountryShortCodeCache() {
<span class="nc" id="L114">		return countryShortCodeCache;</span>
	}


	/**
	 * Load cache.
	 *
	 * @param provideCacheLoader the provide cache loader
	 */
	private static void loadCache(ProvideCacheLoader provideCacheLoader) {
<span class="nc" id="L124">		ConfigDBService configDBService = new ConfigDBService();</span>
		try {
			ConcurrentMap&lt;String, ProviderProperty&gt; hm;
<span class="nc" id="L127">			hm = configDBService.getProviderinitConfigProperties();</span>
<span class="nc" id="L128">			provideCacheLoader.getProviderConfig().storeAll(hm);</span>
<span class="nc" id="L129">			LOG.debug(&quot;=========  loded provider cache&quot;);</span>
			ConcurrentMap&lt;String, String&gt; countryHm;
<span class="nc" id="L131">			countryHm = configDBService.getFullNameFromISOCountryCodes();</span>
<span class="nc" id="L132">			provideCacheLoader.getCountryConfig().storeAll(countryHm);</span>
			
			ConcurrentMap&lt;String, Integer&gt; userIdHm;//added under AT-2248-unrelated to any jira
<span class="nc" id="L135">			userIdHm = configDBService.getUserIdAndName();</span>
<span class="nc" id="L136">			provideCacheLoader.getUserIdConfig().storeAll(userIdHm);</span>
			
			ConcurrentMap&lt;String,Integer&gt; eddCountryHm;//AT-3346
<span class="nc" id="L139">			eddCountryHm = configDBService.getEddNumber();</span>
<span class="nc" id="L140">			provideCacheLoader.getCountryEddNumber().storeAll(eddCountryHm);</span>
			
			ConcurrentMap&lt;String, String&gt; countryState;//AT-3719
<span class="nc" id="L143">			countryState = configDBService.getCountryStateCode();</span>
<span class="nc" id="L144">			provideCacheLoader.getCountryStateCache().storeAll(countryState);</span>
			
			ConcurrentMap&lt;String, String&gt; countryShortHm;//AT-4666
<span class="nc" id="L147">			countryShortHm = configDBService.getCountryShortCode();</span>
<span class="nc" id="L148">			provideCacheLoader.getCountryShortCodeCache().storeAll(countryShortHm);</span>
			
<span class="nc" id="L150">		} catch (ComplianceException ex) {</span>
<span class="nc" id="L151">			LOG.error(&quot;Error in class ProvideCacheLoader loadCache() :&quot;, ex);</span>
<span class="nc" id="L152">		} catch (Exception e) {</span>
<span class="nc" id="L153">			LOG.error(&quot;Error in class ProvideCacheLoader loadCache() :&quot;, e);</span>
<span class="nc" id="L154">		}</span>
<span class="nc" id="L155">	}</span>

	/**
	 * Gets the provider property.
	 *
	 * @param providerName the provider name
	 * @return the provider property
	 * @throws ComplianceException the compliance exception
	 */
	public ProviderProperty getProviderProperty(String providerName) throws ComplianceException {
		try {
<span class="nc" id="L166">			return (ProviderProperty) instance.getProviderConfig().retrieve(providerName);</span>
<span class="nc" id="L167">		} catch (Exception e) {</span>
<span class="nc" id="L168">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}
	}

	/**
	 * Gets the end point url.
	 *
	 * @param providerName the provider name
	 * @return the end point url
	 * @throws ComplianceException the compliance exception
	 */
	public String getEndPointUrl(String providerName) throws ComplianceException {
		try {
<span class="nc" id="L181">			ProviderProperty property = (ProviderProperty) instance.getProviderConfig().retrieve(providerName);</span>
<span class="nc" id="L182">			return property.getEndPointUrl();</span>
<span class="nc" id="L183">		} catch (Exception e) {</span>
<span class="nc" id="L184">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}	
	}

	/**
	 * Gets the country full name.
	 *
	 * @param countryCode the country code
	 * @return the country full name
	 * @throws ComplianceException the compliance exception
	 */
	public String getCountryFullName(String countryCode)throws ComplianceException {
		try {
<span class="nc bnc" id="L197" title="All 2 branches missed.">			if(countryCode == null){</span>
<span class="nc" id="L198">				return null;</span>
			}
<span class="nc" id="L200">			countryCode = countryCode.toUpperCase();	</span>
<span class="nc" id="L201">			return (String)instance.getCountryConfig().retrieve(countryCode);</span>
<span class="nc" id="L202">		} catch (Exception e) {</span>
<span class="nc" id="L203">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}
	}
	
	/**
	 * added under AT-2248-unrelated to any jira
	 * 
	 * Gets the user id from cache.
	 *
	 * @param userName the user name
	 * @return the user id from cache
	 * @throws ComplianceException the compliance exception
	 */
	public Integer getUserIdFromCache(String userName) throws ComplianceException {
		try {
<span class="nc bnc" id="L218" title="All 2 branches missed.">			if(userName == null){</span>
<span class="nc" id="L219">				return null;</span>
			}	
<span class="nc" id="L221">			return (Integer)instance.getUserIdConfig().retrieve(userName);</span>
<span class="nc" id="L222">		} catch (Exception e) {</span>
<span class="nc" id="L223">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}
	}
	
	/**AT-3346
	 * Gets the country edd number.
	 *
	 * @param countryCode the country code
	 * @return the country edd number
	 * @throws ComplianceException the compliance exception
	 */
	public Integer getCountryEddNumber(String countryCode) throws ComplianceException {
		try {
<span class="nc bnc" id="L236" title="All 2 branches missed.">			if(countryCode == null){</span>
<span class="nc" id="L237">				return null;</span>
			}	
<span class="nc" id="L239">			return (Integer)instance.getCountryEddNumber().retrieve(countryCode);</span>
<span class="nc" id="L240">		} catch (Exception e) {</span>
<span class="nc" id="L241">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}
	}	
	
	/**
	 * Gets the country state code value.
	 *
	 * @param countryState the country state
	 * @return the country state code value
	 * @throws ComplianceException the compliance exception
	 */
	public String getCountryStateCodeValue(String countryState)throws ComplianceException {
		try {
<span class="nc bnc" id="L254" title="All 2 branches missed.">			if(countryState == null){</span>
<span class="nc" id="L255">				return null;</span>
			}
<span class="nc" id="L257">			return (String)instance.getCountryStateCache().retrieve(countryState);</span>
<span class="nc" id="L258">		} catch (Exception e) {</span>
<span class="nc" id="L259">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}
	}
	
	//AT-4666
	/**
	 * Gets the country short code.
	 *
	 * @param countryCode the country code
	 * @return the country short code
	 * @throws ComplianceException the compliance exception
	 */
	public String getCountryShortCode(String countryCode)throws ComplianceException {
		try {
<span class="nc bnc" id="L273" title="All 2 branches missed.">			if(countryCode == null){</span>
<span class="nc" id="L274">				return null;</span>
			}
<span class="nc" id="L276">			countryCode = countryCode.toUpperCase();	</span>
<span class="nc" id="L277">			return (String)instance.getCountryShortCodeCache().retrieve(countryCode);</span>
<span class="nc" id="L278">		} catch (Exception e) {</span>
<span class="nc" id="L279">			throw new ComplianceException(InternalProcessingCode.GEN_DECLINE, e);</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>